<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">





  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-flash.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
    
  
  <link href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.4.1" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=6.4.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=6.4.1">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.1" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.4.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




<script type="text/javascript">
    (function () {
        if ('') {
            if (prompt('请输入访问密码') !== '') {
                alert('密码错误！');
                if (history.length === 1) {
                    location.replace("https://hackycy.github.io");
                } else {
                    history.back();
                }
            }
        }
    })();
</script>

  <meta name="description" content="简介WKWebView是显示交互式Web内容的对象，例如用于应用内浏览器。">
<meta name="keywords" content="Ios,WKWebView,WebKit">
<meta property="og:type" content="article">
<meta property="og:title" content="IOS基础 - WKWebView使用">
<meta property="og:url" content="http://hackycy.github.io/2019/02/28/IOS基础-WKWebView使用/index.html">
<meta property="og:site_name" content="思忆技术">
<meta property="og:description" content="简介WKWebView是显示交互式Web内容的对象，例如用于应用内浏览器。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://hackycy.github.io/2019/02/28/IOS基础-WKWebView使用/oftenuse.png">
<meta property="og:image" content="http://hackycy.github.io/2019/02/28/IOS基础-WKWebView使用/uidelegatedemo.png">
<meta property="og:image" content="http://hackycy.github.io/2019/02/28/IOS基础-WKWebView使用/uidelegatedemo2.png">
<meta property="og:image" content="http://hackycy.github.io/2019/02/28/IOS基础-WKWebView使用/browserdemo.png">
<meta property="og:image" content="https://github.static.si-yee.com/IOSWKWebView/20200604140255.png">
<meta property="og:updated_time" content="2020-07-23T08:54:05.575Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="IOS基础 - WKWebView使用">
<meta name="twitter:description" content="简介WKWebView是显示交互式Web内容的对象，例如用于应用内浏览器。">
<meta name="twitter:image" content="http://hackycy.github.io/2019/02/28/IOS基础-WKWebView使用/oftenuse.png">



  <link rel="alternate" href="/atom.xml" title="思忆技术" type="application/atom+xml">




  <link rel="canonical" href="http://hackycy.github.io/2019/02/28/IOS基础-WKWebView使用/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>IOS基础 - WKWebView使用 | 思忆技术</title>
  






  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8a525e92400d0ab6fc5484cce235a326";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">思忆技术</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">思忆，分享技术</h1>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">61</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">26</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">129</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-schedule">
    <a href="/schedule/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>日程表</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  
    <div class="reading-progress-bar"></div>
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://hackycy.github.io/2019/02/28/IOS基础-WKWebView使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hackycy">
      <meta itemprop="description" content="“被窝是天堂开设在人间的分店。”">
      <meta itemprop="image" content="https://tvax3.sinaimg.cn/crop.0.0.1006.1006.180/006oXysjly8g5r75wnp14j30ry0rydi1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="思忆技术">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">IOS基础 - WKWebView使用
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-02-28 15:25:01" itemprop="dateCreated datePublished" datetime="2019-02-28T15:25:01+00:00">2019-02-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-07-23 08:54:05" itemprop="dateModified" datetime="2020-07-23T08:54:05+00:00">2020-07-23</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Ios/" itemprop="url" rel="index"><span itemprop="name">Ios</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/28/IOS基础-WKWebView使用/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/02/28/IOS基础-WKWebView使用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

          
            <span class="post-letters-count">
                &nbsp; | &nbsp;
              <i class="fa fa-align-right"></i>
              <span>字数统计:6k字</span>
                &nbsp; | &nbsp;
              <i class="fa fa-align-left"></i>
              <span>阅读时长:27分</span>
            </span>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>WKWebView是显示交互式Web内容的对象，例如用于应用内浏览器。</p>
<a id="more"></a>
<p><strong>WKWebView对比UIWebView的优势</strong></p>
<blockquote>
<p>1.WKWebView的内存开销要比UIWebView小很多<br>2.拥有高达60FPS滚动刷新率及内置手势<br>3.支持了更多的HTML5特性<br>4.html页面和WKWebView交互更方便<br>5.Safari相同的JavaScript引擎<br>6.提供常用的属性，如加载网页进度的属性estimatedProgress</p>
</blockquote>
<h1 id="WKWebView"><a href="#WKWebView" class="headerlink" title="WKWebView"></a><a href="https://developer.apple.com/documentation/webkit/wkwebview" target="_blank" rel="noopener">WKWebView</a></h1><h2 id="类摘要"><a href="#类摘要" class="headerlink" title="类摘要"></a>类摘要</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WKWebView</span> : <span class="title">UIView</span></span></span><br></pre></td></tr></table></figure>
<blockquote>
<p> 从iOS 8.0和OS X 10.10开始，使用WKWebView将Web内容添加到您的应用程序。不要使用UIWebView或WebView。</p>
</blockquote>
<h2 id="类方法"><a href="#类方法" class="headerlink" title="类方法"></a>类方法</h2><h3 id="确定WebKit是否可以加载内容"><a href="#确定WebKit是否可以加载内容" class="headerlink" title="确定WebKit是否可以加载内容"></a>确定WebKit是否可以加载内容</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">handlesURLScheme</span>(<span class="title">String</span>) -&gt; <span class="title">Bool</span></span></span><br><span class="line"><span class="class">//返回<span class="title">WebKit</span>是否本机支持使用特定<span class="title">URL</span>方案加载资源。</span></span><br></pre></td></tr></table></figure>
<h3 id="初始化Web视图"><a href="#初始化Web视图" class="headerlink" title="初始化Web视图"></a>初始化Web视图</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> configuration: <span class="type">WKWebViewConfiguration</span></span><br><span class="line"><span class="comment">//用于初始化Web视图的配置副本。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">init</span>(frame: <span class="type">CGRect</span>, configuration: <span class="type">WKWebViewConfiguration</span>)</span><br><span class="line"><span class="comment">//返回使用指定框架和配置初始化的Web视图。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">init</span>?(coder: <span class="type">NSCoder</span>)</span><br></pre></td></tr></table></figure>
<h3 id="检查视图信息"><a href="#检查视图信息" class="headerlink" title="检查视图信息"></a>检查视图信息</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scrollView: <span class="type">UIScrollView</span></span><br><span class="line"><span class="comment">//与Web视图关联的滚动视图。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> title: <span class="type">String?</span></span><br><span class="line"><span class="comment">//当前页面标题。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> url: <span class="type">URL?</span></span><br><span class="line"><span class="comment">//当前活动网址。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> customUserAgent: <span class="type">String?</span></span><br><span class="line"><span class="comment">//自定义用户代理字符串。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> serverTrust: <span class="type">SecTrust?</span></span><br><span class="line"><span class="comment">//当前已提交导航的SecTrustRef对象。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> certificateChain: [<span class="type">Any</span>]</span><br><span class="line"><span class="comment">//形成当前已提交导航的证书链的对象数组。 -- 弃用</span></span><br></pre></td></tr></table></figure>
<h3 id="设置代理"><a href="#设置代理" class="headerlink" title="设置代理"></a>设置代理</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> navigationDelegate: <span class="type">WKNavigationDelegate?</span></span><br><span class="line"><span class="comment">//Web视图的导航委托。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> uiDelegate: <span class="type">WKUIDelegate?</span></span><br><span class="line"><span class="comment">//Web视图的用户界面委托。</span></span><br></pre></td></tr></table></figure>
<h3 id="加载内容"><a href="#加载内容" class="headerlink" title="加载内容"></a>加载内容</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> estimatedProgress: <span class="type">Double</span></span><br><span class="line"><span class="comment">//估计当前导航的加载比例。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hasOnlySecureContent: <span class="type">Bool</span></span><br><span class="line"><span class="comment">//一个布尔值，指示页面上的所有资源是否已通过安全加密的连接加载。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadHTMLString</span><span class="params">(String, baseURL: URL?)</span></span> -&gt; <span class="type">WKNavigation?</span></span><br><span class="line"><span class="comment">//设置网页内容和基本URL。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> isLoading: <span class="type">Bool</span></span><br><span class="line"><span class="comment">//一个布尔值，指示视图当前是否正在加载内容。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reload</span><span class="params">()</span></span> -&gt; <span class="type">WKNavigation?</span></span><br><span class="line"><span class="comment">//重新加载当前页面。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reload</span><span class="params">(<span class="keyword">Any</span>?)</span></span></span><br><span class="line"><span class="comment">//重新加载当前页面。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reloadFromOrigin</span><span class="params">()</span></span> -&gt; <span class="type">WKNavigation?</span></span><br><span class="line"><span class="comment">//重新加载当前页面，如果可能，使用缓存验证条件执行端到端重新验证。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reloadFromOrigin</span><span class="params">(<span class="keyword">Any</span>?)</span></span></span><br><span class="line"><span class="comment">//重新加载当前页面，如果可能，使用缓存验证条件执行端到端重新验证。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">stopLoading</span><span class="params">()</span></span></span><br><span class="line"><span class="comment">//停止加载当前页面上的所有资源。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">stopLoading</span><span class="params">(<span class="keyword">Any</span>?)</span></span></span><br><span class="line"><span class="comment">//停止加载当前页面上的所有资源。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">load</span><span class="params">(Data, mimeType: String, characterEncodingName: String, baseURL: URL)</span></span> -&gt; <span class="type">WKNavigation?</span></span><br><span class="line"><span class="comment">//设置网页内容和基本URL。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadFileURL</span><span class="params">(URL, allowingReadAccessTo: URL)</span></span> -&gt; <span class="type">WKNavigation?</span></span><br><span class="line"><span class="comment">//导航到文件系统上请求的文件URL</span></span><br></pre></td></tr></table></figure>
<h3 id="缩放内容"><a href="#缩放内容" class="headerlink" title="缩放内容"></a>缩放内容</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> allowsMagnification: <span class="type">Bool</span></span><br><span class="line"><span class="comment">//一个布尔值，指示放大手势是否会更改Web视图的放大率。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> magnification: <span class="type">CGFloat</span></span><br><span class="line"><span class="comment">//页面内容当前缩放的因子。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setMagnification</span><span class="params">(CGFloat, centeredAt: CGPoint)</span></span></span><br><span class="line"><span class="comment">//按指定因子缩放页面内容，并将结果集中在指定点上。</span></span><br></pre></td></tr></table></figure>
<h3 id="导航"><a href="#导航" class="headerlink" title="导航"></a>导航</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> allowsBackForwardNavigationGestures: <span class="type">Bool</span></span><br><span class="line"><span class="comment">//一个布尔值，指示水平滑动手势是否会触发后退列表导航。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> backForwardList: <span class="type">WKBackForwardList</span></span><br><span class="line"><span class="comment">//Web视图的后退列表。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> canGoBack: <span class="type">Bool</span></span><br><span class="line"><span class="comment">//一个布尔值，指示后向列表中是否有可以导航到的后退项。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> canGoForward: <span class="type">Bool</span></span><br><span class="line"><span class="comment">//一个布尔值，指示后向列表中是否存在可以导航到的前向项。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> allowsLinkPreview: <span class="type">Bool</span></span><br><span class="line"><span class="comment">//一个布尔值，用于确定按下链接是否显示链接目标的预览。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">goBack</span><span class="params">()</span></span> -&gt; <span class="type">WKNavigation?</span></span><br><span class="line"><span class="comment">//导航到后退列表中的后退项目。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">goBack</span><span class="params">(<span class="keyword">Any</span>?)</span></span></span><br><span class="line"><span class="comment">//导航到后退列表中的后退项目。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">goForward</span><span class="params">()</span></span> -&gt; <span class="type">WKNavigation?</span></span><br><span class="line"><span class="comment">//导航到后退列表中的前进项目。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">goForward</span><span class="params">(<span class="keyword">Any</span>?)</span></span></span><br><span class="line"><span class="comment">//导航到后退列表中的前进项目。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">go</span><span class="params">(to: WKBackForwardListItem)</span></span> -&gt; <span class="type">WKNavigation?</span></span><br><span class="line"><span class="comment">//导航到后退列表中的项目并将其设置为当前项目。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">load</span><span class="params">(URLRequest)</span></span> -&gt; <span class="type">WKNavigation?</span></span><br><span class="line"><span class="comment">//导航到请求的URL。</span></span><br></pre></td></tr></table></figure>
<h3 id="执行JS"><a href="#执行JS" class="headerlink" title="执行JS"></a>执行JS</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">evaluateJavaScript</span><span class="params">(String, completionHandler: <span class="params">(<span class="params">(<span class="keyword">Any</span>?, Error?)</span></span></span></span> -&gt; <span class="type">Void</span>)?)</span><br><span class="line"><span class="comment">//JavaScript字符串。</span></span><br></pre></td></tr></table></figure>
<h3 id="拍摄快照"><a href="#拍摄快照" class="headerlink" title="拍摄快照"></a>拍摄快照</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">takeSnapshot</span><span class="params">(with: WKSnapshotConfiguration?, completionHandler: <span class="params">(UIImage?, Error?)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line"><span class="comment">//拍摄视图可见视口的快照。</span></span><br></pre></td></tr></table></figure>
<h2 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> WebKit</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">WKUIDelegate</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> webView: <span class="type">WKWebView!</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">loadView</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> webConfiguration = <span class="type">WKWebViewConfiguration</span>()</span><br><span class="line">        webView = <span class="type">WKWebView</span>(frame: .zero, configuration: webConfiguration)</span><br><span class="line">        webView.uiDelegate = <span class="keyword">self</span></span><br><span class="line">        view = webView</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> myURL = <span class="type">URL</span>(string:<span class="string">"https://www.apple.com"</span>)</span><br><span class="line">        <span class="keyword">let</span> myRequest = <span class="type">URLRequest</span>(url: myURL!)</span><br><span class="line">      	<span class="comment">//加载URL</span></span><br><span class="line">        webView.load(myRequest)</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>要允许用户在网页历史记录中前后移动，请使用和方法作为按钮操作。当用户无法向某个方向移动时，请使用和属性禁用按钮。<a href="https://developer.apple.com/documentation/webkit/wkwebview/1414952-goback" target="_blank" rel="noopener"><code>goBack()</code></a>、<a href="https://developer.apple.com/documentation/webkit/wkwebview/1414993-goforward" target="_blank" rel="noopener"><code>goForward()</code></a>、<a href="https://developer.apple.com/documentation/webkit/wkwebview/1414966-cangoback" target="_blank" rel="noopener"><code>canGoBack</code></a>、<a href="https://developer.apple.com/documentation/webkit/wkwebview/1414962-cangoforward" target="_blank" rel="noopener"><code>canGoForward</code></a>。</p>
<p>默认情况下，Web视图会自动将Web内容中显示的电话号码转换为电话链接。点击电话链接后，电话应用程序将启动并拨打该号码。若要关闭此默认行为，请使用不包含该标志的位域设置该属性。<a href="https://developer.apple.com/documentation/webkit/wkwebviewconfiguration/1641937-datadetectortypes" target="_blank" rel="noopener"><code>dataDetectorTypes</code></a>、<a href="https://developer.apple.com/documentation/webkit/wkdatadetectortypes" target="_blank" rel="noopener"><code>WKDataDetectorTypes</code></a>、<a href="https://developer.apple.com/documentation/webkit/wkdatadetectortypes/1641917-phonenumber" target="_blank" rel="noopener"><code>phoneNumber</code></a></p>
<p>您还可以使用以第一次在Web视图中显示的方式以编程方式设置Web内容的比例。此后，用户可以使用手势来改变比例。<a href="https://developer.apple.com/documentation/webkit/wkwebview/1414996-setmagnification" target="_blank" rel="noopener"><code>setMagnification(_:centeredAt:)</code></a></p>
<h1 id="WKNavigationDelegate"><a href="#WKNavigationDelegate" class="headerlink" title="WKNavigationDelegate"></a><a href="https://developer.apple.com/documentation/webkit/wknavigationdelegate" target="_blank" rel="noopener">WKNavigationDelegate</a></h1><p>WKNavigationDelegate协议的方法可帮助您实现在Web视图接受，加载和完成导航请求的过程中触发的自定义行为。</p>
<h2 id="协议方法"><a href="#协议方法" class="headerlink" title="协议方法"></a>协议方法</h2><h3 id="启动导航"><a href="#启动导航" class="headerlink" title="启动导航"></a>启动导航</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(WKWebView, didCommit: WKNavigation!)</span></span></span><br><span class="line"><span class="comment">//在Web视图开始接收Web内容时调用。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(WKWebView, didStartProvisionalNavigation: WKNavigation!)</span></span></span><br><span class="line"><span class="comment">//在Web视图中开始加载Web内容时调用。</span></span><br></pre></td></tr></table></figure>
<h3 id="响应服务器操作"><a href="#响应服务器操作" class="headerlink" title="响应服务器操作"></a>响应服务器操作</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(WKWebView, didCommit: WKNavigation!)</span></span></span><br><span class="line"><span class="comment">//在Web视图开始接收Web内容时调用。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(WKWebView, didReceiveServerRedirectForProvisionalNavigation: WKNavigation!)</span></span></span><br><span class="line"><span class="comment">//在Web视图收到服务器重定向时调用。</span></span><br></pre></td></tr></table></figure>
<h3 id="身份验证"><a href="#身份验证" class="headerlink" title="身份验证"></a>身份验证</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(WKWebView, didReceive: URLAuthenticationChallenge, completionHandler: <span class="params">(URLSession.AuthChallengeDisposition, URLCredential?)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line"><span class="comment">//在Web视图需要响应身份验证质询时调用。</span></span><br></pre></td></tr></table></figure>
<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(WKWebView, didFail: WKNavigation!, withError: Error)</span></span></span><br><span class="line"><span class="comment">//在导航期间发生错误时调用。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(WKWebView, didFailProvisionalNavigation: WKNavigation!, withError: Error)</span></span></span><br><span class="line"><span class="comment">//在Web视图加载内容时发生错误时调用。</span></span><br></pre></td></tr></table></figure>
<h3 id="跟踪加载进度"><a href="#跟踪加载进度" class="headerlink" title="跟踪加载进度"></a>跟踪加载进度</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(WKWebView, didFinish: WKNavigation!)</span></span></span><br><span class="line"><span class="comment">//导航完成时调用。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webViewWebContentProcessDidTerminate</span><span class="params">(WKWebView)</span></span></span><br><span class="line"><span class="comment">//在Web视图的Web内容进程终止时调用。</span></span><br></pre></td></tr></table></figure>
<h3 id="允许导航"><a href="#允许导航" class="headerlink" title="允许导航"></a>允许导航</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(WKWebView, decidePolicyFor: WKNavigationAction, decisionHandler: <span class="params">(WKNavigationActionPolicy)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line"><span class="comment">//决定是允许还是取消导航。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(WKWebView, decidePolicyFor: WKNavigationResponse, decisionHandler: <span class="params">(WKNavigationResponsePolicy)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line"><span class="comment">//决定在知道响应后是允许还是取消导航。</span></span><br></pre></td></tr></table></figure>
<h3 id="导航政策"><a href="#导航政策" class="headerlink" title="导航政策"></a>导航政策</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">WKNavigationActionPolicy</span></span></span><br><span class="line"><span class="class">//从该方法传回决策处理程序的策略。</span></span><br><span class="line"><span class="class"><span class="title">webView</span>(<span class="title">_</span>:<span class="title">decidePolicyFor</span>:<span class="title">decisionHandler</span>:)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">enum</span> <span class="title">WKNavigationResponsePolicy</span></span></span><br><span class="line"><span class="class">//从该方法传回决策处理程序的策略。</span></span><br><span class="line"><span class="class"><span class="title">webView</span>(<span class="title">_</span>:<span class="title">decidePolicyFor</span>:<span class="title">decisionHandler</span>:)</span></span><br></pre></td></tr></table></figure>
<h1 id="WKUIDelegate"><a href="#WKUIDelegate" class="headerlink" title="WKUIDelegate"></a><a href="https://developer.apple.com/documentation/webkit/wkuidelegate" target="_blank" rel="noopener">WKUIDelegate</a></h1><p>WKUIDelegate协议提供网页的呈现接口的方法，例如alert。</p>
<p>WKWebView委托实现此协议以控制新窗口的打开，增强用户单击元素时显示的默认菜单项的行为，以及执行其他与用户界面相关的任务。可以在处理JavaScript或其他插件内容时调用这些方法。默认Web视图实现假定每个Web视图有一个窗口，因此非传统用户界面可能实现用户界面委托。</p>
<h2 id="协议方法-1"><a href="#协议方法-1" class="headerlink" title="协议方法"></a>协议方法</h2><h3 id="创建Web视图"><a href="#创建Web视图" class="headerlink" title="创建Web视图"></a>创建Web视图</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(WKWebView, createWebViewWith: WKWebViewConfiguration, <span class="keyword">for</span>: WKNavigationAction, windowFeatures: WKWindowFeatures)</span></span> -&gt; <span class="type">WKWebView?</span></span><br><span class="line"><span class="comment">//创建新的Web视图。</span></span><br></pre></td></tr></table></figure>
<h3 id="显示UI面板"><a href="#显示UI面板" class="headerlink" title="显示UI面板"></a>显示UI面板</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(WKWebView, runJavaScriptAlertPanelWithMessage: String, initiatedByFrame: WKFrameInfo, completionHandler: <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line"><span class="comment">//显示JavaScript警报面板。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(WKWebView, runJavaScriptConfirmPanelWithMessage: String, initiatedByFrame: WKFrameInfo, completionHandler: <span class="params">(Bool)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line"><span class="comment">//显示JavaScript确认面板。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(WKWebView, runJavaScriptTextInputPanelWithPrompt: String, defaultText: String?, initiatedByFrame: WKFrameInfo, completionHandler: <span class="params">(String?)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line"><span class="comment">//显示JavaScript文本输入面板。</span></span><br></pre></td></tr></table></figure>
<h3 id="关闭Web视图"><a href="#关闭Web视图" class="headerlink" title="关闭Web视图"></a>关闭Web视图</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webViewDidClose</span><span class="params">(WKWebView)</span></span></span><br><span class="line"><span class="comment">//通知您的应用程序DOM窗口已成功关闭。</span></span><br></pre></td></tr></table></figure>
<h3 id="显示上传面板"><a href="#显示上传面板" class="headerlink" title="显示上传面板"></a>显示上传面板</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(WKWebView, runOpenPanelWith: WKOpenPanelParameters, initiatedByFrame: WKFrameInfo, completionHandler: <span class="params">([URL]?)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line"><span class="comment">//显示文件上传面板。</span></span><br></pre></td></tr></table></figure>
<h3 id="响应强制触摸操作"><a href="#响应强制触摸操作" class="headerlink" title="响应强制触摸操作"></a>响应强制触摸操作</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(WKWebView, shouldPreviewElement: WKPreviewElementInfo)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line"><span class="comment">//确定给定元素是否应显示预览。 -- 弃用</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(WKWebView, previewingViewControllerForElement: WKPreviewElementInfo, defaultActions: [WKPreviewActionItem])</span></span> -&gt; <span class="type">UIViewController?</span></span><br><span class="line"><span class="comment">//当用户执行窥视动作时调用。 -- 弃用</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(WKWebView, commitPreviewingViewController: UIViewController)</span></span></span><br><span class="line"><span class="comment">//当用户在预览上执行弹出操作时调用。 -- 弃用</span></span><br></pre></td></tr></table></figure>
<h1 id="WKWebViewConfiguration"><a href="#WKWebViewConfiguration" class="headerlink" title="WKWebViewConfiguration"></a><a href="https://developer.apple.com/documentation/webkit/wkwebviewconfiguration" target="_blank" rel="noopener">WKWebViewConfiguration</a></h1><p>用于初始化Web视图的属性集合。使用该类，您可以确定网页的呈现时间，处理媒体播放的方式，用户可以选择的项目的粒度以及许多其他选项。<code>WKWebViewConfiguration</code>仅在首次初始化Web视图时使用。创建后，您无法使用此类更改Web视图的配置。</p>
<h2 id="类方法-1"><a href="#类方法-1" class="headerlink" title="类方法"></a>类方法</h2><h3 id="配置新Web视图的属性"><a href="#配置新Web视图的属性" class="headerlink" title="配置新Web视图的属性"></a>配置新Web视图的属性</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> applicationNameForUserAgent: <span class="type">String?</span></span><br><span class="line"><span class="comment">//用户代理字符串中使用的应用程序的名称。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> preferences: <span class="type">WKPreferences</span></span><br><span class="line"><span class="comment">//Web视图要使用的首选项对象。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> processPool: <span class="type">WKProcessPool</span></span><br><span class="line"><span class="comment">//从中获取视图的Web内容过程的进程池。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> userContentController: <span class="type">WKUserContentController</span></span><br><span class="line"><span class="comment">//JS注入脚本到WebView</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> websiteDataStore: <span class="type">WKWebsiteDataStore</span></span><br><span class="line"><span class="comment">//Web视图要使用的网站数据存储。</span></span><br></pre></td></tr></table></figure>
<h3 id="确定网页可伸缩性"><a href="#确定网页可伸缩性" class="headerlink" title="确定网页可伸缩性"></a>确定网页可伸缩性</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ignoresViewportScaleLimits: <span class="type">Bool</span></span><br><span class="line"><span class="comment">//一个布尔值，用于确定对象是否应始终允许缩放网页。</span></span><br></pre></td></tr></table></figure>
<h3 id="设置渲染首选项"><a href="#设置渲染首选项" class="headerlink" title="设置渲染首选项"></a>设置渲染首选项</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> suppressesIncrementalRendering: <span class="type">Bool</span></span><br><span class="line"><span class="comment">//一个布尔值，指示Web视图是否在内容呈现完全加载到内存之前抑制内容呈现。</span></span><br></pre></td></tr></table></figure>
<h3 id="设置媒体播放首选项"><a href="#设置媒体播放首选项" class="headerlink" title="设置媒体播放首选项"></a>设置媒体播放首选项</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> allowsInlineMediaPlayback: <span class="type">Bool</span></span><br><span class="line"><span class="comment">//一个布尔值，指示HTML5视频是否内联播放或使用本机全屏控制器。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> allowsAirPlayForMediaPlayback: <span class="type">Bool</span></span><br><span class="line"><span class="comment">//一个布尔值，指示是否允许AirPlay。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> allowsPictureInPictureMediaPlayback: <span class="type">Bool</span></span><br><span class="line"><span class="comment">//一个布尔值，指示HTML5视频是否可以播放画中画。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mediaTypesRequiringUserActionForPlayback: <span class="type">WKAudiovisualMediaTypes</span></span><br><span class="line"><span class="comment">//确定哪些媒体类型需要用户手势才能开始播放。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mediaPlaybackAllowsAirPlay: <span class="type">Bool</span></span><br><span class="line"><span class="comment">//allowsAirPlayForMediaPlayback -- 弃用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> requiresUserActionForMediaPlayback: <span class="type">Bool</span></span><br><span class="line"><span class="comment">//一个布尔值，指示HTML5视频是否要求用户开始播放（true）或视频是否可以自动播放（false）。 -- 弃用</span></span><br><span class="line"><span class="keyword">var</span> mediaPlaybackRequiresUserAction: <span class="type">Bool</span></span><br><span class="line"><span class="comment">//mediaTypesRequiringUserActionForPlayback -- 弃用</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">WKAudiovisualMediaTypes</span></span></span><br><span class="line"><span class="class">//需要用户手势才能开始播放的媒体类型</span></span><br></pre></td></tr></table></figure>
<h3 id="设置选择粒度"><a href="#设置选择粒度" class="headerlink" title="设置选择粒度"></a>设置选择粒度</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> selectionGranularity: <span class="type">WKSelectionGranularity</span></span><br><span class="line"><span class="comment">//用户可以在Web视图中以交互方式选择内容的粒度级别。</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">WKSelectionGranularity</span></span></span><br><span class="line"><span class="class">//用于以交互方式创建和修改选择的粒度。</span></span><br></pre></td></tr></table></figure>
<h3 id="选择用户界面方向性"><a href="#选择用户界面方向性" class="headerlink" title="选择用户界面方向性"></a>选择用户界面方向性</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> userInterfaceDirectionPolicy: <span class="type">WKUserInterfaceDirectionPolicy</span></span><br><span class="line"><span class="comment">//用户界面元素的方向性。</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">WKUserInterfaceDirectionPolicy</span></span></span><br><span class="line"><span class="class">//该策略用于确定<span class="title">Web</span>视图中用户界面元素的方向性。</span></span><br></pre></td></tr></table></figure>
<h3 id="识别数据类型"><a href="#识别数据类型" class="headerlink" title="识别数据类型"></a>识别数据类型</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dataDetectorTypes: <span class="type">WKDataDetectorTypes</span></span><br><span class="line"><span class="comment">//所需的数据检测类型。</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">WKDataDetectorTypes</span></span></span><br><span class="line"><span class="class">//检测到的数据类型。</span></span><br></pre></td></tr></table></figure>
<h3 id="为新的URL方案添加处理程序"><a href="#为新的URL方案添加处理程序" class="headerlink" title="为新的URL方案添加处理程序"></a>为新的URL方案添加处理程序</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setURLSchemeHandler</span><span class="params">(WKURLSchemeHandler?, forURLScheme: String)</span></span></span><br><span class="line"><span class="comment">//为给定的URL方案添加URL方案处理程序对象。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">urlSchemeHandler</span><span class="params">(forURLScheme: String)</span></span> -&gt; <span class="type">WKURLSchemeHandler?</span></span><br><span class="line"><span class="comment">//返回给定URL方案的当前注册的方案处理程序</span></span><br></pre></td></tr></table></figure>
<h1 id="WKPreferences"><a href="#WKPreferences" class="headerlink" title="WKPreferences"></a><a href="https://developer.apple.com/documentation/webkit/wkpreferences" target="_blank" rel="noopener">WKPreferences</a></h1><p><code>WKPreferences</code>对象封装用于web视图偏好设置。与Web视图关联的首选项对象由其Web视图配置指定。</p>
<h2 id="类方法-2"><a href="#类方法-2" class="headerlink" title="类方法"></a>类方法</h2><h3 id="设置渲染首选项-1"><a href="#设置渲染首选项-1" class="headerlink" title="设置渲染首选项"></a>设置渲染首选项</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> minimumFontSize: <span class="type">CGFloat</span></span><br><span class="line"><span class="comment">//最小字体大小。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tabFocusesLinks: <span class="type">Bool</span></span><br></pre></td></tr></table></figure>
<h3 id="设置Java和JavaScript首选项"><a href="#设置Java和JavaScript首选项" class="headerlink" title="设置Java和JavaScript首选项"></a>设置Java和JavaScript首选项</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> javaEnabled: <span class="type">Bool</span></span><br><span class="line"><span class="comment">//一个布尔值，指示是否启用了Java。 -- 弃用</span></span><br><span class="line"><span class="keyword">var</span> javaScriptCanOpenWindowsAutomatically: <span class="type">Bool</span></span><br><span class="line"><span class="comment">//一个布尔值，指示JavaScript是否可以打开窗口而无需用户交互。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> javaScriptEnabled: <span class="type">Bool</span></span><br><span class="line"><span class="comment">//一个布尔值，指示是否启用JavaScript。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> plugInsEnabled: <span class="type">Bool</span></span><br><span class="line"><span class="comment">//一个布尔值，指示是否启用了插件。 -- 弃用</span></span><br></pre></td></tr></table></figure>
<h1 id="WKProcessPool"><a href="#WKProcessPool" class="headerlink" title="WKProcessPool"></a><a href="https://developer.apple.com/documentation/webkit/wkprocesspool" target="_blank" rel="noopener">WKProcessPool</a></h1><p>WKProcessPool对象表示Web内容进程的池。</p>
<p>与Web视图关联的进程池由其Web视图配置指定。每个Web视图都有自己的Web内容流程，直到达到实现定义的流程限制；之后，具有相同流程池的Web视图最终共享Web内容流程。</p>
<blockquote>
<p>该类没有属性或它自己的方法</p>
</blockquote>
<h1 id="WKUserContentController"><a href="#WKUserContentController" class="headerlink" title="WKUserContentController"></a><a href="https://developer.apple.com/documentation/webkit/wkusercontentcontroller" target="_blank" rel="noopener">WKUserContentController</a></h1><p>该对象为Javascript提供了注射用户脚本到WKWebVIew的方法。</p>
<h2 id="类方法-3"><a href="#类方法-3" class="headerlink" title="类方法"></a>类方法</h2><h3 id="添加消息处理程序"><a href="#添加消息处理程序" class="headerlink" title="添加消息处理程序"></a>添加消息处理程序</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(WKScriptMessageHandler, name: String)</span></span></span><br><span class="line"><span class="comment">//添加脚本消息处理程序。</span></span><br></pre></td></tr></table></figure>
<h3 id="添加和删除用户脚本"><a href="#添加和删除用户脚本" class="headerlink" title="添加和删除用户脚本"></a>添加和删除用户脚本</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addUserScript</span><span class="params">(WKUserScript)</span></span></span><br><span class="line"><span class="comment">//添加用户脚本。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">removeAllUserScripts</span><span class="params">()</span></span></span><br><span class="line"><span class="comment">//删除所有关联的用户脚本。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">removeScriptMessageHandler</span><span class="params">(forName: String)</span></span></span><br><span class="line"><span class="comment">//删除脚本消息处理程序。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> userScripts: [<span class="type">WKUserScript</span>]</span><br><span class="line"><span class="comment">//与用户内容控制器关联的用户脚本。</span></span><br></pre></td></tr></table></figure>
<h3 id="添加和删除内容规则"><a href="#添加和删除内容规则" class="headerlink" title="添加和删除内容规则"></a>添加和删除内容规则</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(WKContentRuleList)</span></span></span><br><span class="line"><span class="comment">//添加内容规则列表。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">(WKContentRuleList)</span></span></span><br><span class="line"><span class="comment">//删除规则列表。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">removeAllContentRuleLists</span><span class="params">()</span></span></span><br><span class="line"><span class="comment">//删除所有规则列表。</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WKContentRuleList</span></span></span><br><span class="line"><span class="class">//要应用于<span class="title">Web</span>内容的已编译规则列表。</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">WKContentRuleListStore</span></span></span><br></pre></td></tr></table></figure>
<h1 id="WKWebView使用"><a href="#WKWebView使用" class="headerlink" title="WKWebView使用"></a>WKWebView使用</h1><p>上边的一些概念介绍完后，我们来使用一下</p>
<h2 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h2><p><img src="oftenuse.png" alt></p>
<h2 id="基本创建和配置"><a href="#基本创建和配置" class="headerlink" title="基本创建和配置"></a>基本创建和配置</h2><p>引入模块</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Webkit</span><br></pre></td></tr></table></figure>
<p>ViewController中实现<code>WKUIDelegate</code>、<code>WKNavigationDelegate</code>协议</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WKWebViewController</span>: <span class="title">UIViewController</span>, <span class="title">WKUIDelegate</span>, <span class="title">WKNavigationDelegate</span></span></span><br></pre></td></tr></table></figure>
<p>设置WKWebView的配置项</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> config = <span class="type">WKWebViewConfiguration</span>()</span><br><span class="line">config.preferences = <span class="type">WKPreferences</span>()</span><br><span class="line"><span class="comment">//IOS 下默认NO， Mac下为YES</span></span><br><span class="line">config.preferences.javaScriptCanOpenWindowsAutomatically = <span class="literal">false</span></span><br><span class="line"><span class="comment">//默认为YES</span></span><br><span class="line">config.preferences.javaScriptEnabled = <span class="literal">true</span></span><br><span class="line"><span class="comment">//默认为0</span></span><br><span class="line">config.preferences.minimumFontSize = <span class="number">10</span></span><br><span class="line"><span class="comment">//通过js与webview内容交互配置</span></span><br><span class="line">config.userContentController = <span class="type">WKUserContentController</span>()</span><br><span class="line"><span class="comment">// 在载入时就添加JS,页面通过调用showAlert函数即可</span></span><br><span class="line"><span class="keyword">let</span> script = <span class="type">WKUserScript</span>(source: <span class="string">"function showAlert() &#123; alert('在载入webview时通过Swift注入的JS方法'); &#125;"</span>, injectionTime: .atDocumentStart, forMainFrameOnly: <span class="literal">true</span>) <span class="comment">// 只添加到mainFrame中</span></span><br><span class="line">config.userContentController.addUserScript(script)</span><br></pre></td></tr></table></figure>
<p>创建WKWebVIew并遵守协议</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.webview = <span class="type">WKWebView</span>(frame: <span class="keyword">self</span>.view.frame, configuration: configWebView())</span><br><span class="line"><span class="keyword">self</span>.webview.uiDelegate = <span class="keyword">self</span></span><br><span class="line"><span class="keyword">self</span>.webview.navigationDelegate = <span class="keyword">self</span></span><br><span class="line"><span class="comment">//开启滑动返回</span></span><br><span class="line"><span class="keyword">self</span>.webview.allowsBackForwardNavigationGestures = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h2 id="WKWebVIew加载本地html"><a href="#WKWebVIew加载本地html" class="headerlink" title="WKWebVIew加载本地html"></a>WKWebVIew加载本地html</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> url = <span class="type">Bundle</span>.main.url(forResource: <span class="string">"index"</span>, withExtension: <span class="string">"html"</span>)!</span><br><span class="line"><span class="keyword">self</span>.webview.loadFileURL(url, allowingReadAccessTo: <span class="type">Bundle</span>.main.bundleURL)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>html文件放在项目目录即可。有文件夹时请更改路径</p>
</blockquote>
<h2 id="实现WKUIDelegate"><a href="#实现WKUIDelegate" class="headerlink" title="实现WKUIDelegate"></a>实现WKUIDelegate</h2><p>在网页中一般都会含有alert、promt、confirm等的对话框，需要我们原生去编码实现。</p>
<p>先创建一个<code>index.html</code>放在项目目录下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"alert('这是按钮点击的alert')"</span>&gt;</span>alert<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"confirm('这是按钮点击的confirm')"</span>&gt;</span>confirm<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"prompt('这是按钮点击的promt', '默认文字')"</span>&gt;</span>promt<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.baidu.com"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>新标签<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>新建一个类并继承<code>ViewController</code>，并遵循<code>WKUIDelegate</code>协议：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WKUIViewController</span>: <span class="title">UIViewController</span>, <span class="title">WKUIDelegate</span></span></span><br></pre></td></tr></table></figure>
<p>导入库，并添加webview到界面上，并加载本地index.html文件。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> url = <span class="type">Bundle</span>.main.url(forResource: <span class="string">"index"</span>, withExtension: <span class="string">"html"</span>)!</span><br><span class="line"><span class="keyword">self</span>.webview.loadFileURL(url, allowingReadAccessTo: <span class="type">Bundle</span>.main.bundleURL)</span><br></pre></td></tr></table></figure>
<p>预览一下界面：</p>
<p><img src="uidelegatedemo.png" alt></p>
<p>可以发现点击是没有任何反应的，但是不实现WKUIDelegate协议或者实现了协议但不实现方法是不会报错的，但是实现了方法又不在方法体内调用回调函数是会报错的。</p>
<p>这里使用UIAlertController简单实现UI：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Alert</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: WKWebView, runJavaScriptAlertPanelWithMessage message: String, initiatedByFrame frame: WKFrameInfo, completionHandler: @escaping <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> alert = <span class="type">UIAlertController</span>(title: <span class="string">"提示"</span>, message: message, preferredStyle: <span class="type">UIAlertController</span>.<span class="type">Style</span>.alert)</span><br><span class="line">  <span class="keyword">let</span> sure = <span class="type">UIAlertAction</span>(title: <span class="string">"确定"</span>, style: <span class="type">UIAlertAction</span>.<span class="type">Style</span>.<span class="keyword">default</span>) &#123; (action: <span class="type">UIAlertAction</span>) <span class="keyword">in</span></span><br><span class="line">    completionHandler()</span><br><span class="line">  &#125;</span><br><span class="line">  alert.addAction(sure)</span><br><span class="line">  <span class="keyword">self</span>.present(alert, animated: <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//Confirm</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: WKWebView, runJavaScriptConfirmPanelWithMessage message: String, initiatedByFrame frame: WKFrameInfo, completionHandler: @escaping <span class="params">(Bool)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> alert = <span class="type">UIAlertController</span>(title: <span class="string">"提示"</span>, message: message, preferredStyle: <span class="type">UIAlertController</span>.<span class="type">Style</span>.alert)</span><br><span class="line">  <span class="keyword">let</span> sure = <span class="type">UIAlertAction</span>(title: <span class="string">"确定"</span>, style: <span class="type">UIAlertAction</span>.<span class="type">Style</span>.<span class="keyword">default</span>) &#123; (action: <span class="type">UIAlertAction</span>) <span class="keyword">in</span></span><br><span class="line">    completionHandler(<span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> cancel = <span class="type">UIAlertAction</span>(title: <span class="string">"取消"</span>, style: <span class="type">UIAlertAction</span>.<span class="type">Style</span>.cancel) &#123; (action: <span class="type">UIAlertAction</span>) <span class="keyword">in</span></span><br><span class="line">    completionHandler(<span class="literal">false</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  alert.addAction(sure)</span><br><span class="line">  alert.addAction(cancel)</span><br><span class="line">  <span class="keyword">self</span>.present(alert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//Prompt</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: WKWebView, runJavaScriptTextInputPanelWithPrompt prompt: String, defaultText: String?, initiatedByFrame frame: WKFrameInfo, completionHandler: @escaping <span class="params">(String?)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> alert = <span class="type">UIAlertController</span>(title: <span class="string">"提示"</span>, message: prompt, preferredStyle: <span class="type">UIAlertController</span>.<span class="type">Style</span>.alert)</span><br><span class="line">  alert.addTextField &#123; (field: <span class="type">UITextField</span>) <span class="keyword">in</span></span><br><span class="line">    field.text = defaultText</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> cancel = <span class="type">UIAlertAction</span>(title: <span class="string">"取消"</span>, style: <span class="type">UIAlertAction</span>.<span class="type">Style</span>.cancel) &#123; (action: <span class="type">UIAlertAction</span>) <span class="keyword">in</span></span><br><span class="line">    completionHandler(<span class="literal">nil</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> sure = <span class="type">UIAlertAction</span>(title: <span class="string">"确定"</span>, style: <span class="type">UIAlertAction</span>.<span class="type">Style</span>.<span class="keyword">default</span>) &#123; (action: <span class="type">UIAlertAction</span>) <span class="keyword">in</span></span><br><span class="line">    completionHandler(alert.textFields?.first?.text)</span><br><span class="line">  &#125;</span><br><span class="line">  alert.addAction(sure)</span><br><span class="line">  alert.addAction(cancel)</span><br><span class="line">  <span class="keyword">self</span>.present(alert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)      </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//页面是弹出窗口时</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: WKWebView, createWebViewWith configuration: WKWebViewConfiguration, <span class="keyword">for</span> navigationAction: WKNavigationAction, windowFeatures: WKWindowFeatures)</span></span> -&gt; <span class="type">WKWebView?</span> &#123;</span><br><span class="line">  <span class="comment">//_blank处理</span></span><br><span class="line">  <span class="keyword">self</span>.webview.load(navigationAction.request)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现效果：</p>
<p><img src="uidelegatedemo2.png" alt></p>
<h2 id="实现标题栏和加载进度条"><a href="#实现标题栏和加载进度条" class="headerlink" title="实现标题栏和加载进度条"></a>实现标题栏和加载进度条</h2><p>WKWebView中有三个属性是支持KVO的。因此我们可以通过监听其值的变化来实现对应的功能，即<code>loading</code>、<code>title</code>、<code>estimatedProgress</code>三个属性。</p>
<p>新建一个类并继承<code>ViewController</code>，并遵循<code>WKUIDelegate</code>与<code>WKNavigationDelegate</code>协议：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BrowserViewController</span>: <span class="title">UIViewController</span>, <span class="title">WKUIDelegate</span>, <span class="title">WKNavigationDelegate</span></span></span><br></pre></td></tr></table></figure>
<p>初始化WKWebView方法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webview: <span class="type">WKWebView!</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initWebView</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">self</span>.webview = <span class="type">WKWebView</span>(frame: <span class="keyword">self</span>.view.frame, configuration: <span class="type">WKWebViewConfiguration</span>())</span><br><span class="line">  <span class="keyword">self</span>.view.addSubview(<span class="keyword">self</span>.webview)</span><br><span class="line">  <span class="keyword">self</span>.webview.load(<span class="type">URLRequest</span>(url: <span class="type">URL</span>(string: <span class="string">"https://objccn.io/"</span>)!))</span><br><span class="line">  <span class="comment">//kvo监听以实现标题栏和进度条</span></span><br><span class="line">  <span class="keyword">self</span>.webview.addObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">"estimatedProgress"</span>, options: <span class="type">NSKeyValueObservingOptions</span>.new, context: <span class="literal">nil</span>)</span><br><span class="line">  <span class="keyword">self</span>.webview.addObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">"title"</span>, options: <span class="type">NSKeyValueObservingOptions</span>.new, context: <span class="literal">nil</span>)</span><br><span class="line">  <span class="comment">//遵守协议</span></span><br><span class="line">  <span class="keyword">self</span>.webview.uiDelegate = <span class="keyword">self</span></span><br><span class="line">  <span class="keyword">self</span>.webview.navigationDelegate = <span class="keyword">self</span></span><br><span class="line">  <span class="comment">//开启滑动返回</span></span><br><span class="line">  <span class="keyword">self</span>.webview.allowsBackForwardNavigationGestures = <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>初始化进度条方法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initProgress</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">//添加进度条</span></span><br><span class="line">  progress = <span class="type">UIProgressView</span>(frame: <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: <span class="type">UIScreen</span>.main.bounds.width, height: <span class="number">2</span>))</span><br><span class="line">  progress.backgroundColor = <span class="type">UIColor</span>.blue</span><br><span class="line">  <span class="keyword">self</span>.view.addSubview(<span class="keyword">self</span>.progress)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>并在ViewDidLoad方法中调用。重载监听方法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在监听方法中监听进度条和标题的变化</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">observeValue</span><span class="params">(forKeyPath keyPath: String?, of object: <span class="keyword">Any</span>?, change: [NSKeyValueChangeKey : <span class="keyword">Any</span>]?, context: UnsafeMutableRawPointer?)</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> keyPath == <span class="string">"estimatedProgress"</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.progress.setProgress(<span class="type">Float</span>(<span class="keyword">self</span>.webview.estimatedProgress), animated: <span class="literal">true</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> keyPath == <span class="string">"title"</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.navigationController?.title = <span class="keyword">self</span>.webview.title</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.observeValue(forKeyPath: keyPath, of: object, change: change, context: context)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在实现WKNavigationDelegate的两个代理方法以实现进度条的隐藏和现实</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (void)webView:(<span class="type">WKWebView</span> *)webView didStartProvisionalNavigation:(<span class="type">WKNavigation</span> *)navigation &#123;</span><br><span class="line">    [<span class="keyword">self</span>.progressView setHidden:<span class="type">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//导航完成时调用。</span></span><br><span class="line">- (void)webView:(<span class="type">WKWebView</span> *)webView didFinishNavigation:(<span class="type">WKNavigation</span> *)navigation &#123;</span><br><span class="line">    <span class="keyword">self</span>.progress.progress = <span class="number">0.0</span>;</span><br><span class="line">  	[<span class="keyword">self</span>.progressView setHidden:<span class="type">YES</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在页面消失后取消监听，否则可能会出现一些未知的异常，在ViewController生命周期的viewDidDisappear方法中实现：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidDisappear</span><span class="params">(<span class="number">_</span> animated: Bool)</span></span> &#123;</span><br><span class="line">  <span class="keyword">super</span>.viewDidDisappear(animated)</span><br><span class="line">  <span class="keyword">self</span>.webview.removeObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">"estimatedProgress"</span>)</span><br><span class="line">  <span class="keyword">self</span>.webview.removeObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">"title"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行效果：</p>
<p><img src="browserdemo.png" alt></p>
<h2 id="应用内H5跳转第三方APP"><a href="#应用内H5跳转第三方APP" class="headerlink" title="应用内H5跳转第三方APP"></a>应用内H5跳转第三方APP</h2><p>应用内web视图页面都会有一些跳转第三方APP的需求，获取跳转APP Store。</p>
<p>这里有一个<code>redirect.html</code>页面，分别是跳转粉丝福利购、拨打电话、跳转微信APP Store。放在了项目根目录下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>跳转<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag">            <span class="attr">href</span>=<span class="string">"taobao://uland.taobao.com/coupon/edetail?e=cSq3k99USIAGQASttHIRqbFZJ9euuZYQylASqMukPydjTfHRi%2FIrN%2BlmuMDII2iZ%2FASFi097%2BCOSU6IuEVIxtk4aJXRcltkaWv9OAj9evKDahba4h8MrZ%2Bdth9k8bqqSHKTgBzHkoM7XTQC0vfau6E%2F9Zk7cDx8UPY2GSU4OeGe2s6x1NZzECw73BakMbfZC&amp;traceId=0b01319f15597018122426441e&amp;union_lens=lensId:0b015dd6_0b58_16b2578f429_586d&amp;xId=jwddSujflRkngxB4Q9tRDr3m1VxxlYIIvkQWXrAl4fhWOjMBIOJ0GkUZr8KQHPXIRTVNgd51FScfpn3ZqARc4s&amp;activityId=d236dbef811a47b69494c70b8b22012e"</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"tel://15622472425"</span>&gt;</span>打电话给客服<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://itunes.apple.com/cn/app/wechat/id414478124?mt=8"</span>&gt;</span>微信链接<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>创建WKWebView就不再多讲了，需要跳转第三方APP或者打开APP Store的链接就需要遵循<code>WKNavigationDelegate</code>协议，并实现<code>webView(_:decidePolicyFor:)</code>方法：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping <span class="params">(WKNavigationActionPolicy)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">  <span class="comment">//判断scheme，http、https、file则正常在页面加载</span></span><br><span class="line">  <span class="keyword">let</span> scheme = navigationAction.request.url?.scheme</span><br><span class="line">  <span class="keyword">if</span> scheme == <span class="string">"http"</span> || scheme == <span class="string">"https"</span> || scheme == <span class="string">"file"</span> &#123;</span><br><span class="line">    <span class="comment">//允许导航</span></span><br><span class="line">    decisionHandler(<span class="type">WKNavigationActionPolicy</span>.allow)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//否则例如scheme为taobao、alipay等则根据第三方sdk在网页中配置url，这里是都可以跳转</span></span><br><span class="line">    <span class="comment">//取消导航，打开APP</span></span><br><span class="line">    <span class="type">UIApplication</span>.shared.openURL(navigationAction.request.url!)</span><br><span class="line">    decisionHandler(<span class="type">WKNavigationActionPolicy</span>.cancel)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>对于自定义的 <code>URL Scheme</code> 类型链接，如果不实现该方法，在 <code>WKWebView</code> 里直接点击则会报错：<code>Error Domain=NSURLErrorDomain Code=-1002 &quot;unsupported URL&quot;</code>。</p>
<p>如果需要具体判断到打开某些app只要具体判断scheme即可。</p>
<p>跳转APP Store的话因为app store的网页已经配置了Universal Link跳转，所以不需要额外的配置即可跳转。</p>
<p>注意：必需要在真机上测试。</p>
</blockquote>
<h2 id="WKWebView的3Dtouch预览功能"><a href="#WKWebView的3Dtouch预览功能" class="headerlink" title="WKWebView的3Dtouch预览功能"></a>WKWebView的3Dtouch预览功能</h2><p><strong>将WKWebView的<code>allowsLinkPreview</code>属性设置<code>NO</code>即可关闭</strong></p>
<h1 id="仿微信WebView"><a href="#仿微信WebView" class="headerlink" title="仿微信WebView"></a>仿微信WebView</h1><p>运行效果：</p>
<p><img src="https://github.static.si-yee.com/IOSWKWebView/20200604140255.png" alt></p>
<p>实现代码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  CommonWebViewController.swift</span></span><br><span class="line"><span class="comment">//  xianqi</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by yzy on 2020/4/17.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> WebKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommonWebViewController</span>: <span class="title">UIViewController</span>, <span class="title">WKUIDelegate</span>, <span class="title">WKNavigationDelegate</span>, <span class="title">UIScrollViewDelegate</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// 加载的链接</span></span><br><span class="line">    <span class="keyword">var</span> requestUrl: <span class="type">String?</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.webview.load(<span class="type">URLRequest</span>(url: <span class="type">URL</span>(string: <span class="keyword">self</span>.requestUrl!)!))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">//四周均不延伸，以免出现遮挡</span></span><br><span class="line">        <span class="keyword">self</span>.edgesForExtendedLayout = []</span><br><span class="line">        <span class="keyword">self</span>.initWebView()</span><br><span class="line">        <span class="keyword">self</span>.initProgressView()</span><br><span class="line">        <span class="keyword">self</span>.setupToolbarItems()</span><br><span class="line">        <span class="comment">// 加载URL</span></span><br><span class="line">        <span class="keyword">self</span>.requestUrl = <span class="string">"https://www.baidu.com"</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: toolbar</span></span><br><span class="line">        </span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> goBackItem: <span class="type">UIBarButtonItem</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> item: <span class="type">UIBarButtonItem</span> = <span class="type">UIBarButtonItem</span>(image: <span class="type">UIImage</span>(named: <span class="string">"icon_left_arrow"</span>), style: .done, target: <span class="keyword">self</span>, action: #selector(<span class="type">CommonWebViewController</span>.goBack))</span><br><span class="line">        item.tintColor = <span class="type">UIColor</span>.black</span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> goForwardItem: <span class="type">UIBarButtonItem</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> item: <span class="type">UIBarButtonItem</span> = <span class="type">UIBarButtonItem</span>(image: <span class="type">UIImage</span>(named: <span class="string">"icon_right_arrow"</span>), style: .done, target: <span class="keyword">self</span>, action: #selector(<span class="type">CommonWebViewController</span>.goForword))</span><br><span class="line">        item.tintColor = <span class="type">UIColor</span>.black</span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> flexibleItem: <span class="type">UIBarButtonItem</span> = &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">UIBarButtonItem</span>(barButtonSystemItem: .flexibleSpace, target: <span class="literal">nil</span>, action: <span class="literal">nil</span>)</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">goBack</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.webview.canGoBack &#123;</span><br><span class="line">            webview.goBack()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">goForword</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.webview.canGoForward &#123;</span><br><span class="line">            webview.goForward()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setupToolbarItems</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.navigationController?.toolbar.isTranslucent = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">self</span>.toolbarItems = [flexibleItem, goBackItem, flexibleItem, goForwardItem, flexibleItem]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(<span class="number">_</span> animated: Bool)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewWillAppear(animated)</span><br><span class="line">        <span class="comment">// 当Push进来时如果页面没有显示NavBar，则WebView手动显示</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.navigationController?.navigationBar.isHidden ?? <span class="literal">false</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.navigationController?.setNavigationBarHidden(<span class="literal">false</span>, animated: <span class="literal">true</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidAppear</span><span class="params">(<span class="number">_</span> animated: Bool)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidAppear(animated)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillDisappear</span><span class="params">(<span class="number">_</span> animated: Bool)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewWillDisappear(animated)</span><br><span class="line">        hiddenToolbar()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">hiddenToolbar</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.navigationController?.setToolbarHidden(<span class="literal">true</span>, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">visibleToolbar</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.navigationController != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.navigationController!.isToolbarHidden &#123;</span><br><span class="line">                <span class="keyword">self</span>.navigationController?.setToolbarHidden(<span class="literal">false</span>, animated: <span class="literal">true</span>)</span><br><span class="line">                <span class="keyword">self</span>.goForwardItem.isEnabled = <span class="keyword">self</span>.webview.canGoForward</span><br><span class="line">                <span class="keyword">self</span>.goBackItem.isEnabled = <span class="keyword">self</span>.webview.canGoBack</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: webview相关</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> webview: <span class="type">WKWebView</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> wv: <span class="type">WKWebView</span> = <span class="type">WKWebView</span>()</span><br><span class="line">        <span class="comment">// normal setting</span></span><br><span class="line">        wv.uiDelegate = <span class="keyword">self</span></span><br><span class="line">        wv.navigationDelegate = <span class="keyword">self</span></span><br><span class="line">        <span class="keyword">return</span> wv</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> progressView: <span class="type">UIProgressView</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> view: <span class="type">UIProgressView</span> = <span class="type">UIProgressView</span>(progressViewStyle: .bar)</span><br><span class="line">        view.trackTintColor = <span class="type">UIColor</span>.gray</span><br><span class="line">        view.progressTintColor = <span class="type">UIColor</span>.green.withAlphaComponent(<span class="number">0.55</span>)</span><br><span class="line">        <span class="keyword">return</span> view</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">initWebView</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// add view</span></span><br><span class="line">        <span class="keyword">self</span>.view.addSubview(<span class="keyword">self</span>.webview)</span><br><span class="line">        <span class="comment">// add constraint</span></span><br><span class="line">        <span class="keyword">self</span>.webview.translatesAutoresizingMaskIntoConstraints = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">if</span> #available(iOS <span class="number">11.0</span>, *) &#123;</span><br><span class="line">            <span class="keyword">self</span>.view.addConstraint(<span class="type">NSLayoutConstraint</span>(item: <span class="keyword">self</span>.webview, attribute: .top, relatedBy: .<span class="built_in">equal</span>, toItem: <span class="keyword">self</span>.view.safeAreaLayoutGuide, attribute: .top, multiplier: <span class="number">1.0</span>, constant: <span class="number">0</span>))</span><br><span class="line">            <span class="keyword">self</span>.view.addConstraint(<span class="type">NSLayoutConstraint</span>(item: <span class="keyword">self</span>.webview, attribute: .bottom, relatedBy: .<span class="built_in">equal</span>, toItem: <span class="keyword">self</span>.view.safeAreaLayoutGuide, attribute: .bottom, multiplier: <span class="number">1.0</span>, constant: <span class="number">0</span>))</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Fallback on earlier versions</span></span><br><span class="line">            <span class="keyword">self</span>.view.addConstraint(<span class="type">NSLayoutConstraint</span>(item: <span class="keyword">self</span>.webview, attribute: .top, relatedBy: .<span class="built_in">equal</span>, toItem: <span class="keyword">self</span>.view, attribute: .top, multiplier: <span class="number">1.0</span>, constant: <span class="number">0</span>))</span><br><span class="line">            <span class="keyword">self</span>.view.addConstraint(<span class="type">NSLayoutConstraint</span>(item: <span class="keyword">self</span>.webview, attribute: .bottom, relatedBy: .<span class="built_in">equal</span>, toItem: <span class="keyword">self</span>.view, attribute: .bottom, multiplier: <span class="number">1.0</span>, constant: <span class="number">0</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.view.addConstraint(<span class="type">NSLayoutConstraint</span>(item: <span class="keyword">self</span>.webview, attribute: .<span class="keyword">left</span>, relatedBy: .<span class="built_in">equal</span>, toItem: <span class="keyword">self</span>.view, attribute: .<span class="keyword">left</span>, multiplier: <span class="number">1.0</span>, constant: <span class="number">0</span>))</span><br><span class="line">        <span class="keyword">self</span>.view.addConstraint(<span class="type">NSLayoutConstraint</span>(item: <span class="keyword">self</span>.webview, attribute: .<span class="keyword">right</span>, relatedBy: .<span class="built_in">equal</span>, toItem: <span class="keyword">self</span>.view, attribute: .<span class="keyword">right</span>, multiplier: <span class="number">1.0</span>, constant: <span class="number">0</span>))</span><br><span class="line">        <span class="comment">// 监听进度事件</span></span><br><span class="line">        <span class="keyword">self</span>.webview.addObserver(<span class="keyword">self</span>, forKeyPath: #keyPath(<span class="type">WKWebView</span>.estimatedProgress), options: .new, context: <span class="literal">nil</span>)</span><br><span class="line">        <span class="comment">// 监听网页标题</span></span><br><span class="line">        <span class="keyword">self</span>.webview.addObserver(<span class="keyword">self</span>, forKeyPath: #keyPath(<span class="type">WKWebView</span>.title), options: .new, context: <span class="literal">nil</span>)</span><br><span class="line">        <span class="comment">// 监听前进后退</span></span><br><span class="line">        <span class="keyword">self</span>.webview.addObserver(<span class="keyword">self</span>, forKeyPath: #keyPath(<span class="type">WKWebView</span>.canGoForward), options: .new, context: <span class="literal">nil</span>)</span><br><span class="line">        <span class="keyword">self</span>.webview.addObserver(<span class="keyword">self</span>, forKeyPath: #keyPath(<span class="type">WKWebView</span>.canGoBack), options: .new, context: <span class="literal">nil</span>)</span><br><span class="line">        <span class="comment">// 滚动监听</span></span><br><span class="line">        <span class="keyword">self</span>.webview.scrollView.delegate = <span class="keyword">self</span></span><br><span class="line">        <span class="comment">// 设置UA</span></span><br><span class="line">        <span class="keyword">self</span>.webview.evaluateJavaScript(<span class="string">"navigator.userAgent"</span>) &#123; (oldAgent: <span class="type">Any?</span>, error: <span class="type">Error?</span>) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> error == <span class="literal">nil</span> &#123;</span><br><span class="line">                <span class="comment">//oldAgent = [NSString stringWithFormat:@"Mozilla/5.0 (%@; CPU iPhone OS %@ like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148", [[UIDevice currentDevice] model], [[[UIDevice currentDevice] systemVersion] stringByReplacingOccurrencesOfString:@"." withString:@"_"]];</span></span><br><span class="line">                <span class="keyword">let</span> uaStr: <span class="type">String</span> = oldAgent <span class="keyword">as</span>? <span class="type">String</span> ?? <span class="string">"Mozilla/5.0 (\(UIDevice.current.model); CPU iPhone OS \(UIDevice.current.systemVersion) like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148"</span></span><br><span class="line">                <span class="comment">// 保存至本地</span></span><br><span class="line">                <span class="type">UserDefaults</span>.standard.<span class="keyword">set</span>(uaStr, forKey: <span class="string">"USER_AGENT"</span>)</span><br><span class="line">                <span class="comment">// 获取app信息</span></span><br><span class="line">                <span class="keyword">let</span> infoDic = <span class="type">Bundle</span>.main.infoDictionary</span><br><span class="line">                <span class="comment">// 获取App的版本号</span></span><br><span class="line">                <span class="keyword">let</span> appVersion = infoDic?[<span class="string">"CFBundleShortVersionString"</span>]</span><br><span class="line">                <span class="comment">// 获取App的build版本</span></span><br><span class="line">                <span class="keyword">let</span> appBuildVersion = infoDic?[<span class="string">"CFBundleVersion"</span>]</span><br><span class="line">                <span class="comment">// 真实拼接 UA</span></span><br><span class="line">                <span class="keyword">let</span> realUAStr = <span class="string">"\(uaStr)#xianqi#\(appVersion ?? 0)#\(appBuildVersion ?? 0)"</span></span><br><span class="line">                <span class="keyword">self</span>.webview.customUserAgent = realUAStr</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 手势拖动时控制Toolbar显示和隐藏 </span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">scrollViewDidScroll</span><span class="params">(<span class="number">_</span> scrollView: UIScrollView)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.webview.backForwardList.backList.<span class="built_in">count</span> &lt;= <span class="number">0</span> &amp;&amp; <span class="keyword">self</span>.webview.backForwardList.forwardList.<span class="built_in">count</span> &lt;= <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> vel = scrollView.panGestureRecognizer.velocity(<span class="keyword">in</span>: scrollView)</span><br><span class="line">        <span class="keyword">if</span> vel.y &lt; -<span class="number">8</span> &#123;</span><br><span class="line">            <span class="comment">// 向上拖动</span></span><br><span class="line">            hiddenToolbar()</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> vel.y &gt; <span class="number">8</span> &#123;</span><br><span class="line">            <span class="comment">// 向下拖动</span></span><br><span class="line">            visibleToolbar()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// 监听</span></span><br><span class="line">    <span class="comment">/// - Parameters:</span></span><br><span class="line">    <span class="comment">///   - keyPath: keyPath description</span></span><br><span class="line">    <span class="comment">///   - object: object description</span></span><br><span class="line">    <span class="comment">///   - change: change description</span></span><br><span class="line">    <span class="comment">///   - context: context description</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">observeValue</span><span class="params">(forKeyPath keyPath: String?, of object: <span class="keyword">Any</span>?, change: [NSKeyValueChangeKey : <span class="keyword">Any</span>]?, context: UnsafeMutableRawPointer?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> keyPath == #keyPath(<span class="type">WKWebView</span>.estimatedProgress) &#123;</span><br><span class="line">            <span class="keyword">self</span>.showProgressView(progress: <span class="type">Float</span>(<span class="keyword">self</span>.webview.estimatedProgress))</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> keyPath == #keyPath(<span class="type">WKWebView</span>.title) &#123;</span><br><span class="line">            <span class="keyword">self</span>.observeWebTitle(title: <span class="keyword">self</span>.webview.title)</span><br><span class="line">            <span class="comment">// 控制显示Toolbar</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.webview.backForwardList.backList.<span class="built_in">count</span> &gt; <span class="number">0</span> || <span class="keyword">self</span>.webview.backForwardList.forwardList.<span class="built_in">count</span> &gt; <span class="number">0</span> &#123;</span><br><span class="line">                visibleToolbar()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> keyPath == #keyPath(<span class="type">WKWebView</span>.canGoForward) &#123;</span><br><span class="line">            <span class="keyword">self</span>.goForwardItem.isEnabled = <span class="keyword">self</span>.webview.canGoForward</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> keyPath == #keyPath(<span class="type">WKWebView</span>.canGoBack) &#123;</span><br><span class="line">            <span class="keyword">self</span>.goBackItem.isEnabled = <span class="keyword">self</span>.webview.canGoBack</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.observeValue(forKeyPath: keyPath, of: object, change: change, context: context)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// 用于方便子类重写</span></span><br><span class="line">    <span class="comment">/// - Parameter title: webview的标题</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">observeWebTitle</span><span class="params">(title: String?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.navigationItem.title = title</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">initProgressView</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// layout</span></span><br><span class="line">        <span class="keyword">self</span>.view.addSubview(<span class="keyword">self</span>.progressView)</span><br><span class="line">        <span class="comment">// add constraint</span></span><br><span class="line">        <span class="keyword">self</span>.progressView.translatesAutoresizingMaskIntoConstraints = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">if</span> #available(iOS <span class="number">11.0</span>, *) &#123;</span><br><span class="line">            <span class="keyword">self</span>.view.addConstraint(<span class="type">NSLayoutConstraint</span>(item: <span class="keyword">self</span>.progressView, attribute: .top, relatedBy: .<span class="built_in">equal</span>, toItem: <span class="keyword">self</span>.view.safeAreaLayoutGuide, attribute: .top, multiplier: <span class="number">1.0</span>, constant: <span class="number">0</span>))</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Fallback on earlier versions</span></span><br><span class="line">            <span class="keyword">self</span>.view.addConstraint(<span class="type">NSLayoutConstraint</span>(item: <span class="keyword">self</span>.progressView, attribute: .top, relatedBy: .<span class="built_in">equal</span>, toItem: <span class="keyword">self</span>.view, attribute: .top, multiplier: <span class="number">1.0</span>, constant: <span class="number">0</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 设置宽度</span></span><br><span class="line">        <span class="keyword">self</span>.view.addConstraint(<span class="type">NSLayoutConstraint</span>(item: <span class="keyword">self</span>.progressView, attribute: .<span class="keyword">left</span>, relatedBy: .<span class="built_in">equal</span>, toItem: <span class="keyword">self</span>.view, attribute: .<span class="keyword">left</span>, multiplier: <span class="number">1.0</span>, constant: <span class="number">0</span>))</span><br><span class="line">        <span class="keyword">self</span>.view.addConstraint(<span class="type">NSLayoutConstraint</span>(item: <span class="keyword">self</span>.progressView, attribute: .<span class="keyword">right</span>, relatedBy: .<span class="built_in">equal</span>, toItem: <span class="keyword">self</span>.view, attribute: .<span class="keyword">right</span>, multiplier: <span class="number">1.0</span>, constant: <span class="number">0</span>))</span><br><span class="line">        <span class="comment">// 设置高度</span></span><br><span class="line">        <span class="keyword">self</span>.progressView.addConstraint(<span class="type">NSLayoutConstraint</span>(item: <span class="keyword">self</span>.progressView, attribute: .height, relatedBy: .<span class="built_in">equal</span>, toItem: <span class="literal">nil</span>, attribute: .height, multiplier: <span class="number">1.0</span>, constant: <span class="number">2</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">showProgressView</span><span class="params">(progress: Float)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.progressView.isHidden &#123;</span><br><span class="line">            <span class="keyword">self</span>.progressView.isHidden = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.progressView.setProgress(progress, animated: <span class="literal">true</span>)</span><br><span class="line">        <span class="keyword">if</span> progress == <span class="number">1.0</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.hideProgressView()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">hideProgressView</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.progressView.isHidden = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">self</span>.progressView.setProgress(<span class="number">0.1</span>, animated: <span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: WKUIDelegate</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: WKWebView, runJavaScriptAlertPanelWithMessage message: String, initiatedByFrame frame: WKFrameInfo, completionHandler: @escaping <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> alert = <span class="type">UIAlertController</span>(title: <span class="string">"提示"</span>, message: message, preferredStyle: <span class="type">UIAlertController</span>.<span class="type">Style</span>.alert)</span><br><span class="line">        <span class="keyword">let</span> sure = <span class="type">UIAlertAction</span>(title: <span class="string">"确定"</span>, style: <span class="type">UIAlertAction</span>.<span class="type">Style</span>.<span class="keyword">default</span>) &#123; (action: <span class="type">UIAlertAction</span>) <span class="keyword">in</span></span><br><span class="line">          completionHandler()</span><br><span class="line">        &#125;</span><br><span class="line">        alert.addAction(sure)</span><br><span class="line">        <span class="keyword">self</span>.present(alert, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: WKNavigationDelegate</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: WKWebView, didFinish navigation: WKNavigation!)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.hideProgressView()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping <span class="params">(WKNavigationActionPolicy)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> scheme = navigationAction.request.url?.scheme</span><br><span class="line">        <span class="comment">// about 用于解决LayUI框架显示问题</span></span><br><span class="line">        <span class="keyword">if</span> scheme == <span class="string">"http"</span> || scheme == <span class="string">"https"</span> || scheme == <span class="string">"file"</span> || scheme == <span class="string">"about"</span> &#123;</span><br><span class="line">            decisionHandler(.allow)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//否则例如scheme为taobao、alipay等则根据第三方sdk在网页中配置url，这里是都可以跳转</span></span><br><span class="line">        <span class="keyword">if</span> <span class="type">UIApplication</span>.shared.canOpenURL(navigationAction.request.url!) &#123;</span><br><span class="line">            <span class="comment">//取消导航，打开APP</span></span><br><span class="line">            <span class="type">UIApplication</span>.shared.openURL(navigationAction.request.url!)</span><br><span class="line">            <span class="comment">// 取消</span></span><br><span class="line">            decisionHandler(.cancel)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        decisionHandler(.allow)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.webview.removeObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">"estimatedProgress"</span>)</span><br><span class="line">        <span class="keyword">self</span>.webview.removeObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">"title"</span>)</span><br><span class="line">        <span class="keyword">self</span>.webview.removeObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">"url"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>包括了设置UA的方式，至于左侧的关闭按钮和右侧的更多按钮则可以自己实现美化。这里不多实现了。</p>
</blockquote>
<h1 id="资料参考"><a href="#资料参考" class="headerlink" title="资料参考"></a>资料参考</h1><p><a href="https://developer.apple.com/documentation/webkit/wkwebview" target="_blank" rel="noopener">https://developer.apple.com/documentation/webkit/wkwebview</a></p>
<p><a href="https://kangzubin.com/wkwebview-link/" target="_blank" rel="noopener">https://kangzubin.com/wkwebview-link/</a></p>
<p><a href="https://www.jianshu.com/p/bf2008d80e2d" target="_blank" rel="noopener">https://www.jianshu.com/p/bf2008d80e2d</a></p>
<p><a href="https://blog.csdn.net/kmonarch/article/details/83585795" target="_blank" rel="noopener">https://blog.csdn.net/kmonarch/article/details/83585795</a></p>
<p><a href="https://www.jianshu.com/p/0f825df61037" target="_blank" rel="noopener">https://www.jianshu.com/p/0f825df61037</a></p>

      
    </div>

    

    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.png" alt="hackycy 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="hackycy 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Ios/" rel="tag"><i class="fa fa-tag"></i> Ios</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/02/28/解决AndroidStudio导入项目在-Building-gradle-project-info-一直卡住/" rel="next" title="解决AndroidStudio导入项目在 Building gradle project info 一直卡住">
                <i class="fa fa-chevron-left"></i> 解决AndroidStudio导入项目在 Building gradle project info 一直卡住
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/03/01/Objective-C之Block/" rel="prev" title="Objective-C之Block">
                Objective-C之Block <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://tvax3.sinaimg.cn/crop.0.0.1006.1006.180/006oXysjly8g5r75wnp14j30ry0rydi1.jpg" alt="hackycy">
            
              <p class="site-author-name" itemprop="name">hackycy</p>
              <p class="site-description motion-element" itemprop="description">“被窝是天堂开设在人间的分店。”</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">129</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">26</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">61</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/hackycy" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:qa894178522@qq.com" target="_blank" title="E-Mail" rel="external nofollow"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://plus.google.com/101705678931630585525" target="_blank" title="Google" rel="external nofollow"><i class="fa fa-fw fa-google"></i>Google</a>
                  
                </span>
              
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                推荐
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.si-yee.com" title="思忆技术" target="_blank">思忆技术</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://lover.si-yee.com" title="我与她的爱情计时器" target="_blank">我与她的爱情计时器</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.aliyun.com" title="阿里云" target="_blank">阿里云</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WKWebView"><span class="nav-number">2.</span> <span class="nav-text">WKWebView</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#类摘要"><span class="nav-number">2.1.</span> <span class="nav-text">类摘要</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#类方法"><span class="nav-number">2.2.</span> <span class="nav-text">类方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#确定WebKit是否可以加载内容"><span class="nav-number">2.2.1.</span> <span class="nav-text">确定WebKit是否可以加载内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#初始化Web视图"><span class="nav-number">2.2.2.</span> <span class="nav-text">初始化Web视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#检查视图信息"><span class="nav-number">2.2.3.</span> <span class="nav-text">检查视图信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置代理"><span class="nav-number">2.2.4.</span> <span class="nav-text">设置代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#加载内容"><span class="nav-number">2.2.5.</span> <span class="nav-text">加载内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#缩放内容"><span class="nav-number">2.2.6.</span> <span class="nav-text">缩放内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#导航"><span class="nav-number">2.2.7.</span> <span class="nav-text">导航</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#执行JS"><span class="nav-number">2.2.8.</span> <span class="nav-text">执行JS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#拍摄快照"><span class="nav-number">2.2.9.</span> <span class="nav-text">拍摄快照</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#简单使用"><span class="nav-number">2.3.</span> <span class="nav-text">简单使用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WKNavigationDelegate"><span class="nav-number">3.</span> <span class="nav-text">WKNavigationDelegate</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#协议方法"><span class="nav-number">3.1.</span> <span class="nav-text">协议方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#启动导航"><span class="nav-number">3.1.1.</span> <span class="nav-text">启动导航</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#响应服务器操作"><span class="nav-number">3.1.2.</span> <span class="nav-text">响应服务器操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#身份验证"><span class="nav-number">3.1.3.</span> <span class="nav-text">身份验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#错误处理"><span class="nav-number">3.1.4.</span> <span class="nav-text">错误处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#跟踪加载进度"><span class="nav-number">3.1.5.</span> <span class="nav-text">跟踪加载进度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#允许导航"><span class="nav-number">3.1.6.</span> <span class="nav-text">允许导航</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#导航政策"><span class="nav-number">3.1.7.</span> <span class="nav-text">导航政策</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WKUIDelegate"><span class="nav-number">4.</span> <span class="nav-text">WKUIDelegate</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#协议方法-1"><span class="nav-number">4.1.</span> <span class="nav-text">协议方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建Web视图"><span class="nav-number">4.1.1.</span> <span class="nav-text">创建Web视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#显示UI面板"><span class="nav-number">4.1.2.</span> <span class="nav-text">显示UI面板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#关闭Web视图"><span class="nav-number">4.1.3.</span> <span class="nav-text">关闭Web视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#显示上传面板"><span class="nav-number">4.1.4.</span> <span class="nav-text">显示上传面板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#响应强制触摸操作"><span class="nav-number">4.1.5.</span> <span class="nav-text">响应强制触摸操作</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WKWebViewConfiguration"><span class="nav-number">5.</span> <span class="nav-text">WKWebViewConfiguration</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#类方法-1"><span class="nav-number">5.1.</span> <span class="nav-text">类方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置新Web视图的属性"><span class="nav-number">5.1.1.</span> <span class="nav-text">配置新Web视图的属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#确定网页可伸缩性"><span class="nav-number">5.1.2.</span> <span class="nav-text">确定网页可伸缩性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置渲染首选项"><span class="nav-number">5.1.3.</span> <span class="nav-text">设置渲染首选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置媒体播放首选项"><span class="nav-number">5.1.4.</span> <span class="nav-text">设置媒体播放首选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置选择粒度"><span class="nav-number">5.1.5.</span> <span class="nav-text">设置选择粒度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#选择用户界面方向性"><span class="nav-number">5.1.6.</span> <span class="nav-text">选择用户界面方向性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#识别数据类型"><span class="nav-number">5.1.7.</span> <span class="nav-text">识别数据类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#为新的URL方案添加处理程序"><span class="nav-number">5.1.8.</span> <span class="nav-text">为新的URL方案添加处理程序</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WKPreferences"><span class="nav-number">6.</span> <span class="nav-text">WKPreferences</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#类方法-2"><span class="nav-number">6.1.</span> <span class="nav-text">类方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#设置渲染首选项-1"><span class="nav-number">6.1.1.</span> <span class="nav-text">设置渲染首选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置Java和JavaScript首选项"><span class="nav-number">6.1.2.</span> <span class="nav-text">设置Java和JavaScript首选项</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WKProcessPool"><span class="nav-number">7.</span> <span class="nav-text">WKProcessPool</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WKUserContentController"><span class="nav-number">8.</span> <span class="nav-text">WKUserContentController</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#类方法-3"><span class="nav-number">8.1.</span> <span class="nav-text">类方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#添加消息处理程序"><span class="nav-number">8.1.1.</span> <span class="nav-text">添加消息处理程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加和删除用户脚本"><span class="nav-number">8.1.2.</span> <span class="nav-text">添加和删除用户脚本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加和删除内容规则"><span class="nav-number">8.1.3.</span> <span class="nav-text">添加和删除内容规则</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WKWebView使用"><span class="nav-number">9.</span> <span class="nav-text">WKWebView使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#常用方法"><span class="nav-number">9.1.</span> <span class="nav-text">常用方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基本创建和配置"><span class="nav-number">9.2.</span> <span class="nav-text">基本创建和配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WKWebVIew加载本地html"><span class="nav-number">9.3.</span> <span class="nav-text">WKWebVIew加载本地html</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实现WKUIDelegate"><span class="nav-number">9.4.</span> <span class="nav-text">实现WKUIDelegate</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实现标题栏和加载进度条"><span class="nav-number">9.5.</span> <span class="nav-text">实现标题栏和加载进度条</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#应用内H5跳转第三方APP"><span class="nav-number">9.6.</span> <span class="nav-text">应用内H5跳转第三方APP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WKWebView的3Dtouch预览功能"><span class="nav-number">9.7.</span> <span class="nav-text">WKWebView的3Dtouch预览功能</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#仿微信WebView"><span class="nav-number">10.</span> <span class="nav-text">仿微信WebView</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#资料参考"><span class="nav-number">11.</span> <span class="nav-text">资料参考</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hackycy <a class="theme-link" target="_blank" rel="external nofollow" href="http://www.beian.miit.gov.cn/">粤ICP备19140352号</a></span>

  

  
</div>


  



  <div class="powered-by">
    <span id="busuanzi_container_site_uv">
    本站访客数:<span id="busuanzi_value_site_uv"></span>次
    </span>
    &nbsp|&nbsp
  </div>
  <div class="powered-by">
    <span>
    本站总字数:<span>302k</span>字
    </span>
    &nbsp|&nbsp
  </div>
  <div class="powered-by">由 <a class="theme-link" target="_blank" rel="external nofollow" href="https://hexo.io">Hexo</a> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a class="theme-link" target="_blank" rel="external nofollow" href="https://theme-next.org">NexT.Mist</a> v6.4.1</div>




        
<div class="busuanzi-count">
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  













  



  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/reading_progress/reading_progress.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.1"></script>



  

  
    <script id="dsq-count-scr" src="https://zjyzy.disqus.com/count.js" async></script>
  

  
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'http://hackycy.github.io/2019/02/28/IOS基础-WKWebView使用/';
        this.page.identifier = '2019/02/28/IOS基础-WKWebView使用/';
        this.page.title = 'IOS基础 - WKWebView使用';
        };
      function loadComments () {
        var d = document, s = d.createElement('script');
        s.src = 'https://zjyzy.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      }
      
        loadComments();
      
    </script>
  












  





  

  

  

  
  

  
  

  


  
  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
          if(result)$(this).text('复制成功')
          else $(this).text('复制失败')
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('复制')
        }, 300)
      }).append(e)
    })
  </script>


<!-- ҳ����С���� --> 
<script type="text/javascript" src="/js/src/love.js"></script>
</body>
</html>
