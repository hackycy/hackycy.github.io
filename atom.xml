<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ€å¿†æŠ€æœ¯</title>
  
  <subtitle>æ€å¿†ï¼Œåˆ†äº«æŠ€æœ¯</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://hackycy.github.io/"/>
  <updated>2020-06-04T06:12:49.380Z</updated>
  <id>http://hackycy.github.io/</id>
  
  <author>
    <name>hackycy</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>è§£å†³Macé€šè¿‡Brewå®‰è£…DartæŠ¥é”™ï¼šFailed to download resource dart</title>
    <link href="http://hackycy.github.io/2020/06/03/%E8%A7%A3%E5%86%B3Mac%E9%80%9A%E8%BF%87Brew%E5%AE%89%E8%A3%85Dart%E6%8A%A5%E9%94%99%EF%BC%9AFailed-to-download-resource-dart/"/>
    <id>http://hackycy.github.io/2020/06/03/è§£å†³Macé€šè¿‡Brewå®‰è£…DartæŠ¥é”™ï¼šFailed-to-download-resource-dart/</id>
    <published>2020-06-03T12:12:35.000Z</published>
    <updated>2020-06-04T06:12:49.380Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨å­¦ä¹ Flutterçš„ç¬¬ä¸€æ­¥ä»å®‰è£…å°±å¼€å§‹è¸©å‘äº†ã€‚å®‰è£…Dartç¡¬æ˜¯å®‰è£…ä¸ä¸Šã€‚ç§‘å­¦ä¸Šç½‘ä¹Ÿæœ‰å°±æ˜¯å®‰ä¸ä¸Šã€‚æ‰¾äº†äº›èµ„æ–™ï¼Œè®°å½•äº†ä¸€ä¸‹è§£å†³æ–¹æ¡ˆã€‚</p><a id="more"></a><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>é¦–å…ˆæ˜¯dartå®˜ç½‘æ¨èä½¿ç”¨brewå‘½ä»¤å®‰è£…dartï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://github.static.si-yee.com/posts/fixmacinstalldart/20200604141048.png" alt></p><p>ä½†æ˜¯å‡ºç°äº†ä»¥ä¸‹çš„é”™è¯¯ï¼š</p><p><img src="https://github.static.si-yee.com/posts/fixmacinstalldart/20200604141008.png" alt></p><p>è¯¦ç»†æŠ¥é”™å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ brew install dart</span><br><span class="line">Updating Homebrew...</span><br><span class="line">==&gt; Installing dart from dart-lang/dart</span><br><span class="line">==&gt; Downloading https://storage.googleapis.com/dart-archive/channels/stable/release/2.8.3/sdk/dartsdk-macos-x64-release.zip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-=O=-               <span class="comment">#    #     #     #                                        </span></span><br><span class="line">curl: (7) Failed to connect to storage.googleapis.com port 443: Operation timed out</span><br><span class="line">Error: An exception occurred within a child process:</span><br><span class="line">  DownloadError: Failed to download resource <span class="string">"dart"</span></span><br><span class="line">Download failed: https://storage.googleapis.com/dart-archive/channels/stable/release/2.8.3/sdk/dartsdk-macos-x64-release.zip</span><br></pre></td></tr></table></figure><h1 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h1><p>æŠ¥é”™ä¸­æœ‰å›æ˜¾èµ„æºçš„åœ°å€é“¾æ¥ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå·±æµè§ˆå™¨æˆ–è€…è¿…é›·å»ä¸‹è½½åˆ°æœ¬åœ°ã€‚</p><p>ç„¶åä½¿ç”¨ç»ˆç«¯æŸ¥çœ‹Homebrewçš„ç¼“å­˜åœ°å€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ brew --cache</span><br><span class="line">/Users/zjyzy/Library/Caches/Homebrew</span><br></pre></td></tr></table></figure><p>æœ€åå°†ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶ æ‹·è´åˆ° ä¸Šé¢ç¼“å­˜åœ°å€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp ~/Downloads/dartsdk-macos-x64-release.zip /Users/zjyzy/Library/Caches/Homebrew</span><br></pre></td></tr></table></figure><p>æ¥ç€å†æ‰§è¡Œå‘½ä»¤å°±å¯ä»¥æ­£å¸¸å®‰è£…æˆåŠŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install dart</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰æ„å¤–ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥è§£å†³é—®é¢˜äº†ã€‚ä½†æ˜¯ä¸å¹¸ï¼Œæˆ‘è¿˜æ˜¯ä¸èƒ½è§£å†³é—®é¢˜ã€‚ç»§ç»­æŸ¥æ‰¾äº†ä¸€äº›èµ„æ–™ï¼š</p><p>å®‰è£…æ—¶ç»™å‘½ä»¤åŠ ä¸ª <code>-v</code> æ‰“å°å‘½ä»¤çš„è¯¦ç»†æ—¥å¿—çœ‹çœ‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ brew install dart -v</span><br><span class="line">==&gt; Installing dart from dart-lang/dart</span><br><span class="line">/usr/bin/sandbox-exec -f /private/tmp/homebrew20200603-12459-1ulm7yo.sb nice ruby -W0 -I <span class="variable">$LOAD_PATH</span> -- /usr/<span class="built_in">local</span>/Homebrew/Library/Homebrew/build.rb /usr/<span class="built_in">local</span>/Homebrew/Library/Taps/dart-lang/homebrew-dart/dart.rb --verbose</span><br><span class="line">==&gt; Downloading https://storage.googleapis.com/dart-archive/channels/stable/release/2.8.3/sdk/dartsdk-macos-x64-release.zip</span><br><span class="line">/usr/bin/curl -q --globoff --show-error --user-agent Homebrew/2.2.2\ \(Macintosh\;\ Intel\ Mac\ OS\ X\ 10.15.4\)\ curl/7.64.1 --fail --location --remote-time --<span class="built_in">continue</span>-at 0 --output /Users/zjyzy/Library/Caches/Homebrew/downloads/a21b0f967308afab39b415842adf710f903b479ccb472feb7f13960160733911--dartsdk-macos-x64-release.zip.incomplete https://storage.googleapis.com/dart-archive/channels/stable/release/2.8.3/sdk/dartsdk-macos-x64-release.zip</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">  0     0    0     0    0     0      0      0 --:--:--  0:01:15 --:--:--     0</span><br><span class="line">curl: (7) Failed to connect to storage.googleapis.com port 443: Operation timed out</span><br><span class="line">Error: An exception occurred within a child process:</span><br><span class="line">  DownloadError: Failed to download resource <span class="string">"dart"</span></span><br><span class="line">Download failed: https://storage.googleapis.com/dart-archive/channels/stable/release/2.8.3/sdk/dartsdk-macos-x64-release.zip</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„çœ‹è¿™æ¡ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/curl -q --globoff --show-error --user-agent Homebrew/2.2.2\ \(Macintosh\;\ Intel\ Mac\ OS\ X\ 10.15.4\)\ curl/7.64.1 --fail --location --remote-time --<span class="built_in">continue</span>-at 0 --output /Users/zjyzy/Library/Caches/Homebrew/downloads/a21b0f967308afab39b415842adf710f903b479ccb472feb7f13960160733911--dartsdk-macos-x64-release.zip.incomplete https://storage.googleapis.com/dart-archive/channels/stable/release/2.8.3/sdk/dartsdk-macos-x64-release.zip</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ° Homebrew ä¸‹è½½ dart çš„ç¼“å­˜åœ°å€ä¸º:<code>/Users/zjyzy/Library/Caches/Homebrew/downloads/a21b0f967308afab39b415842adf710f903b479ccb472feb7f13960160733911--dartsdk-macos-x64-release.zip.incomplete</code></p><p><code>XXX.incomplete</code> è¡¨ç¤ºä¸‹è½½æœªå®Œæˆï¼Œä½†è¿™æ˜¯ Homebrew æœŸæœ›çš„ä¸‹è½½æ–‡ä»¶è·¯å¾„ã€‚é‚£ä¹ˆæˆ‘ä»¬å°†ä»æµè§ˆå™¨ä¸‹è½½å¥½çš„åŒ…æ”¾åˆ°è¯¥ç›®å½•ä¸‹ï¼Œå¹¶å»é™¤<code>.incomplete</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp ~/Downloads/dartsdk-macos-x64-release.zip /Users/zjyzy/Library/Caches/Homebrew/downloads/a21b0f967308afab39b415842adf710f903b479ccb472feb7f13960160733911--dartsdk-macos-x64-release.zip</span><br></pre></td></tr></table></figure><p><strong>å…ˆå»ä¸‹è½½æ–‡ä»¶è·¯å¾„åˆ é™¤æ‰æœªä¸‹è½½å¥½çš„åŒ…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /Users/zjyzy/Library/Caches/Homebrew/downloads</span><br><span class="line">$ rm -rf a21b0f967308afab39b415842adf710f903b479ccb472feb7f13960160733911--dartsdk-macos-x64-release.zip.incomplete</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶åœ¨å®‰è£…æŸ¥çœ‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">$ brew install dart -v</span><br><span class="line">Updating Homebrew...</span><br><span class="line">==&gt; Installing dart from dart-lang/dart</span><br><span class="line">/usr/bin/sandbox-exec -f /private/tmp/homebrew20200603-14161-iaxt0b.sb nice ruby -W0 -I <span class="variable">$LOAD_PATH</span> -- /usr/<span class="built_in">local</span>/Homebrew/Library/Homebrew/build.rb /usr/<span class="built_in">local</span>/Homebrew/Library/Taps/dart-lang/homebrew-dart/dart.rb --verbose</span><br><span class="line">==&gt; Downloading https://storage.googleapis.com/dart-archive/channels/stable/release/2.8.3/sdk/dartsdk-macos-x64-release.zip</span><br><span class="line">Already downloaded: /Users/zjyzy/Library/Caches/Homebrew/downloads/a21b0f967308afab39b415842adf710f903b479ccb472feb7f13960160733911--dartsdk-macos-x64-release.zip</span><br><span class="line">==&gt; Verifying a21b0f967308afab39b415842adf710f903b479ccb472feb7f13960160733911--dartsdk-macos-x64-release.zip checksum</span><br><span class="line">unzip -o /Users/zjyzy/Library/Caches/Homebrew/downloads/a21b0f967308afab39b415842adf710f903b479ccb472feb7f13960160733911--dartsdk-macos-x64-release.zip -d /private/tmp/d20200603-14162-sr2oas</span><br><span class="line">cp -pR /private/tmp/d20200603-14162-sr2oas/dart-sdk/. /private/tmp/dart-20200603-14162-bg4o22/dart-sdk</span><br><span class="line">chmod -Rf +w /private/tmp/d20200603-14162-sr2oas</span><br><span class="line">==&gt; Cleaning</span><br><span class="line">==&gt; Finishing up</span><br><span class="line">ln -s ../Cellar/dart/2.8.3/bin/dart dart</span><br><span class="line">ln -s ../Cellar/dart/2.8.3/bin/dart2js dart2js</span><br><span class="line">ln -s ../Cellar/dart/2.8.3/bin/dart2native dart2native</span><br><span class="line">ln -s ../Cellar/dart/2.8.3/bin/dartanalyzer dartanalyzer</span><br><span class="line">ln -s ../Cellar/dart/2.8.3/bin/dartaotruntime dartaotruntime</span><br><span class="line">ln -s ../Cellar/dart/2.8.3/bin/dartdevc dartdevc</span><br><span class="line">ln -s ../Cellar/dart/2.8.3/bin/dartdoc dartdoc</span><br><span class="line">ln -s ../Cellar/dart/2.8.3/bin/dartfmt dartfmt</span><br><span class="line">ln -s ../Cellar/dart/2.8.3/bin/pub pub</span><br><span class="line">/usr/bin/sandbox-exec -f /private/tmp/homebrew20200603-14268-12qkciz.sb nice ruby -W0 -I <span class="variable">$LOAD_PATH</span> -- /usr/<span class="built_in">local</span>/Homebrew/Library/Homebrew/postinstall.rb /usr/<span class="built_in">local</span>/Homebrew/Library/Taps/dart-lang/homebrew-dart/dart.rb -v</span><br><span class="line">==&gt; Caveats</span><br><span class="line">Please note the path to the Dart SDK:</span><br><span class="line">  /usr/<span class="built_in">local</span>/opt/dart/libexec</span><br><span class="line">==&gt; Summary</span><br><span class="line">ğŸº  /usr/<span class="built_in">local</span>/Cellar/dart/2.8.3: 502 files, 486MB, built <span class="keyword">in</span> 7 seconds</span><br><span class="line">==&gt; `brew cleanup` has not been run <span class="keyword">in</span> 30 days, running now...</span><br><span class="line">Removing: /Users/zjyzy/Library/Caches/Homebrew/openssl@1.1--1.1.1d.mojave.bottle.tar.gz... (5.2MB)</span><br><span class="line">Removing: /Users/zjyzy/Library/Caches/Homebrew/python--3.7.4_1.mojave.bottle.tar.gz... (14.6MB)</span><br><span class="line">Removing: /Users/zjyzy/Library/Caches/Homebrew/readline--8.0.1.mojave.bottle.tar.gz... (517.9KB)</span><br><span class="line">Removing: /Users/zjyzy/Library/Caches/Homebrew/sqlite--3.29.0.mojave.bottle.tar.gz... (1.9MB)</span><br><span class="line">Removing: /Users/zjyzy/Library/Caches/Homebrew/watchman--4.9.0_3.mojave.bottle.tar.gz... (536.8KB)</span><br><span class="line">Removing: /Users/zjyzy/Library/Caches/Homebrew/Cask/motrix--1.4.1.dmg... (63MB)</span><br><span class="line">rm /usr/<span class="built_in">local</span>/share/man/man5/npm-folders.5</span><br><span class="line">rm /usr/<span class="built_in">local</span>/share/man/man5/npm-global.5</span><br><span class="line">rm /usr/<span class="built_in">local</span>/share/man/man5/npm-json.5</span><br><span class="line">rm /usr/<span class="built_in">local</span>/share/man/man5/npm-package-locks.5</span><br><span class="line">rm /usr/<span class="built_in">local</span>/share/man/man5/npm-shrinkwrap.json.5</span><br><span class="line">rm /usr/<span class="built_in">local</span>/share/man/man5/package-lock.json.5</span><br><span class="line">rm /usr/<span class="built_in">local</span>/share/man/man5/package.json.5</span><br><span class="line">rm /usr/<span class="built_in">local</span>/share/man/man7/npm-coding-style.7</span><br><span class="line">rm /usr/<span class="built_in">local</span>/share/man/man7/npm-config.7</span><br><span class="line">rm /usr/<span class="built_in">local</span>/share/man/man7/npm-developers.7</span><br><span class="line">rm /usr/<span class="built_in">local</span>/share/man/man7/npm-disputes.7</span><br><span class="line">rm /usr/<span class="built_in">local</span>/share/man/man7/npm-index.7</span><br><span class="line">rm /usr/<span class="built_in">local</span>/share/man/man7/npm-orgs.7</span><br><span class="line">rm /usr/<span class="built_in">local</span>/share/man/man7/npm-registry.7</span><br><span class="line">rm /usr/<span class="built_in">local</span>/share/man/man7/npm-scope.7</span><br><span class="line">rm /usr/<span class="built_in">local</span>/share/man/man7/npm-scripts.7</span><br><span class="line">rm /usr/<span class="built_in">local</span>/share/man/man7/removing-npm.7</span><br><span class="line">rmdir /usr/<span class="built_in">local</span>/lib/node_modules/@vue/cli/node_modules/@apollo/protobufjs/cli/node_modules</span><br><span class="line">Pruned 17 symbolic links and 1 directories from /usr/<span class="built_in">local</span></span><br></pre></td></tr></table></figure><p>å‘½ä»¤éªŒè¯dartå®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ brew info dart</span><br><span class="line">dart-lang/dart/dart: stable 2.8.3, devel 2.9.0-13.0.dev</span><br><span class="line">The Dart SDK</span><br><span class="line">https://dart.dev</span><br><span class="line">Conflicts with:</span><br><span class="line">  dart-beta (because dart-beta ships the same binaries)</span><br><span class="line">/usr/<span class="built_in">local</span>/Cellar/dart/2.8.3 (502 files, 486MB) *</span><br><span class="line">  Built from <span class="built_in">source</span> on 2020-06-03 at 13:04:47</span><br><span class="line">From: https://github.com/dart-lang/homebrew-dart/blob/master/dart.rb</span><br><span class="line">==&gt; Options</span><br><span class="line">--devel</span><br><span class="line">Install development version 2.9.0-13.0.dev</span><br><span class="line">==&gt; Caveats</span><br><span class="line">Please note the path to the Dart SDK:</span><br><span class="line">  /usr/<span class="built_in">local</span>/opt/dart/libexec</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼ŒdartSDKå·²ç»å®‰è£…æˆåŠŸã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://shockerli.net/post/homebrew-install-download-error/" target="_blank" rel="noopener">https://shockerli.net/post/homebrew-install-download-error/</a></p><p><a href="https://www.cnblogs.com/lmyupupblogs/p/12785753.html" target="_blank" rel="noopener">https://www.cnblogs.com/lmyupupblogs/p/12785753.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨å­¦ä¹ Flutterçš„ç¬¬ä¸€æ­¥ä»å®‰è£…å°±å¼€å§‹è¸©å‘äº†ã€‚å®‰è£…Dartç¡¬æ˜¯å®‰è£…ä¸ä¸Šã€‚ç§‘å­¦ä¸Šç½‘ä¹Ÿæœ‰å°±æ˜¯å®‰ä¸ä¸Šã€‚æ‰¾äº†äº›èµ„æ–™ï¼Œè®°å½•äº†ä¸€ä¸‹è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Flutter" scheme="http://hackycy.github.io/categories/Flutter/"/>
    
    
      <category term="Dart" scheme="http://hackycy.github.io/tags/Dart/"/>
    
  </entry>
  
  <entry>
    <title>JavaScriptå·¥å…·å‡½æ•°å¤§å…¨</title>
    <link href="http://hackycy.github.io/2020/06/01/JavaScript%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E5%A4%A7%E5%85%A8/"/>
    <id>http://hackycy.github.io/2020/06/01/JavaScriptå·¥å…·å‡½æ•°å¤§å…¨/</id>
    <published>2020-06-01T11:28:14.000Z</published>
    <updated>2020-06-04T06:12:49.280Z</updated>
    
    <content type="html"><![CDATA[<p>æŠ„å½•ä¸€äº›JavaScriptå·¥å…·å‡½æ•°å¤§å…¨<br><a id="more"></a></p><h1 id="ä¸ºå…ƒç´ æ·»åŠ onæ–¹æ³•"><a href="#ä¸ºå…ƒç´ æ·»åŠ onæ–¹æ³•" class="headerlink" title="ä¸ºå…ƒç´ æ·»åŠ onæ–¹æ³•"></a>ä¸ºå…ƒç´ æ·»åŠ onæ–¹æ³•</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Element.prototype.on = Element.prototype.addEventListener;</span><br><span class="line"></span><br><span class="line">NodeList.prototype.on = <span class="function"><span class="keyword">function</span> (<span class="params">event, fn</span>) </span>&#123;ã€</span><br><span class="line">    [][<span class="string">'forEach'</span>].call(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">        el.on(event, fn);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="ä¸ºå…ƒç´ æ·»åŠ triggeræ–¹æ³•"><a href="#ä¸ºå…ƒç´ æ·»åŠ triggeræ–¹æ³•" class="headerlink" title="ä¸ºå…ƒç´ æ·»åŠ triggeræ–¹æ³•"></a>ä¸ºå…ƒç´ æ·»åŠ triggeræ–¹æ³•</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Element.prototype.trigger = <span class="function"><span class="keyword">function</span>(<span class="params">type, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> event = <span class="built_in">document</span>.createEvent(<span class="string">"HTMLEvents"</span>);</span><br><span class="line">  event.initEvent(type, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">  event.data = data || &#123;&#125;;</span><br><span class="line">  event.eventName = type;</span><br><span class="line">  event.target = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">this</span>.dispatchEvent(event);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">NodeList.prototype.trigger = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  [][<span class="string">"forEach"</span>].call(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">    el[<span class="string">"trigger"</span>](event);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="è½¬ä¹‰htmlæ ‡ç­¾"><a href="#è½¬ä¹‰htmlæ ‡ç­¾" class="headerlink" title="è½¬ä¹‰htmlæ ‡ç­¾"></a>è½¬ä¹‰htmlæ ‡ç­¾</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HtmlEncode</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> text</span><br><span class="line">    .replace(<span class="regexp">/&amp;/g</span>, <span class="string">"&amp;"</span>)</span><br><span class="line">    .replace(<span class="regexp">/\"/g</span>, <span class="string">'"'</span>)</span><br><span class="line">    .replace(<span class="regexp">/&lt;/g</span>, <span class="string">"&lt;"</span>)</span><br><span class="line">    .replace(<span class="regexp">/&gt;/g</span>, <span class="string">"&gt;"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="HTMLæ ‡ç­¾è½¬ä¹‰"><a href="#HTMLæ ‡ç­¾è½¬ä¹‰" class="headerlink" title="HTMLæ ‡ç­¾è½¬ä¹‰"></a>HTMLæ ‡ç­¾è½¬ä¹‰</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HTML æ ‡ç­¾è½¬ä¹‰</span></span><br><span class="line"><span class="comment">// @param &#123;Array.&lt;DOMString&gt;&#125; templateData å­—ç¬¦ä¸²ç±»å‹çš„tokens</span></span><br><span class="line"><span class="comment">// @param &#123;...&#125; ..vals è¡¨è¾¾å¼å ä½ç¬¦çš„è¿ç®—ç»“æœtokens</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SaferHTML</span>(<span class="params">templateData</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> s = templateData[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; <span class="built_in">arguments</span>.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> arg = <span class="built_in">String</span>(<span class="built_in">arguments</span>[i]);</span><br><span class="line">    <span class="comment">// Escape special characters in the substitution.</span></span><br><span class="line">    s += arg</span><br><span class="line">      .replace(<span class="regexp">/&amp;/g</span>, <span class="string">"&amp;amp;"</span>)</span><br><span class="line">      .replace(<span class="regexp">/&lt;/g</span>, <span class="string">"&amp;lt;"</span>)</span><br><span class="line">      .replace(<span class="regexp">/&gt;/g</span>, <span class="string">"&amp;gt;"</span>);</span><br><span class="line">    <span class="comment">// Don't escape special characters in the template.</span></span><br><span class="line">    s += templateData[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è°ƒç”¨</span></span><br><span class="line"><span class="keyword">var</span> html = SaferHTML<span class="string">`&lt;p&gt;è¿™æ˜¯å…³äºå­—ç¬¦ä¸²æ¨¡æ¿çš„ä»‹ç»&lt;/p&gt;`</span>;</span><br></pre></td></tr></table></figure><h1 id="è·¨æµè§ˆå™¨ç»‘å®šäº‹ä»¶"><a href="#è·¨æµè§ˆå™¨ç»‘å®šäº‹ä»¶" class="headerlink" title="è·¨æµè§ˆå™¨ç»‘å®šäº‹ä»¶"></a>è·¨æµè§ˆå™¨ç»‘å®šäº‹ä»¶</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addEventSamp</span>(<span class="params">obj, evt, fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!oTarget) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (obj.addEventListener) &#123;</span><br><span class="line">    obj.addEventListener(evt, fn, <span class="literal">false</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj.attachEvent) &#123;</span><br><span class="line">    obj.attachEvent(<span class="string">"on"</span> + evt, fn);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    oTarget[<span class="string">"on"</span> + sEvtType] = fn;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åŠ å…¥æ”¶è—å¤¹"><a href="#åŠ å…¥æ”¶è—å¤¹" class="headerlink" title="åŠ å…¥æ”¶è—å¤¹"></a>åŠ å…¥æ”¶è—å¤¹</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addFavorite</span>(<span class="params">sURL, sTitle</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.external.addFavorite(sURL, sTitle);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="built_in">window</span>.sidebar.addPanel(sTitle, sURL, <span class="string">""</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      alert(<span class="string">"åŠ å…¥æ”¶è—å¤±è´¥ï¼Œè¯·ä½¿ç”¨Ctrl+Dè¿›è¡Œæ·»åŠ "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æå–é¡µé¢ä»£ç ä¸­æ‰€æœ‰ç½‘å€"><a href="#æå–é¡µé¢ä»£ç ä¸­æ‰€æœ‰ç½‘å€" class="headerlink" title="æå–é¡µé¢ä»£ç ä¸­æ‰€æœ‰ç½‘å€"></a>æå–é¡µé¢ä»£ç ä¸­æ‰€æœ‰ç½‘å€</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> aa = <span class="built_in">document</span>.documentElement.outerHTML</span><br><span class="line">  .match(</span><br><span class="line">    /(url\(|src=|href=)[\<span class="string">"\']*([^\"\'\(\)\&lt;\&gt;\[\] ]+)[\"\'\)]*|(http:\/\/[\w\-\.]+[^\"\'\(\)\&lt;\&gt;\[\] ]+)/gi</span></span><br><span class="line"><span class="string">  )</span></span><br><span class="line"><span class="string">  .join("</span>\r\n<span class="string">")</span></span><br><span class="line"><span class="string">  .replace(/^(src=|href=|url\()[\"\']*|[\"\'\&gt;\) ]*$/gim, "</span><span class="string">");</span></span><br><span class="line"><span class="string">alert(aa);</span></span><br></pre></td></tr></table></figure><h1 id="åŠ¨æ€åŠ è½½è„šæœ¬æ–‡ä»¶"><a href="#åŠ¨æ€åŠ è½½è„šæœ¬æ–‡ä»¶" class="headerlink" title="åŠ¨æ€åŠ è½½è„šæœ¬æ–‡ä»¶"></a>åŠ¨æ€åŠ è½½è„šæœ¬æ–‡ä»¶</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">appendscript</span>(<span class="params">src, text, reload, charset</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> id = hash(src + text);</span><br><span class="line">  <span class="keyword">if</span> (!reload &amp;&amp; in_array(id, evalscripts)) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span> (reload &amp;&amp; $(id)) &#123;</span><br><span class="line">    $(id).parentNode.removeChild($(id));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  evalscripts.push(id);</span><br><span class="line">  <span class="keyword">var</span> scriptNode = <span class="built_in">document</span>.createElement(<span class="string">"script"</span>);</span><br><span class="line">  scriptNode.type = <span class="string">"text/javascript"</span>;</span><br><span class="line">  scriptNode.id = id;</span><br><span class="line">  scriptNode.charset = charset</span><br><span class="line">    ? charset</span><br><span class="line">    : BROWSER.firefox</span><br><span class="line">    ? <span class="built_in">document</span>.characterSet</span><br><span class="line">    : <span class="built_in">document</span>.charset;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (src) &#123;</span><br><span class="line">      scriptNode.src = src;</span><br><span class="line">      scriptNode.onloadDone = <span class="literal">false</span>;</span><br><span class="line">      scriptNode.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        scriptNode.onloadDone = <span class="literal">true</span>;</span><br><span class="line">        JSLOADED[src] = <span class="number">1</span>;</span><br><span class="line">      &#125;;</span><br><span class="line">      scriptNode.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">          (scriptNode.readyState == <span class="string">"loaded"</span> ||</span><br><span class="line">            scriptNode.readyState == <span class="string">"complete"</span>) &amp;&amp;</span><br><span class="line">          !scriptNode.onloadDone</span><br><span class="line">        ) &#123;</span><br><span class="line">          scriptNode.onloadDone = <span class="literal">true</span>;</span><br><span class="line">          JSLOADED[src] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (text) &#123;</span><br><span class="line">      scriptNode.text = text;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">document</span>.getElementsByTagName(<span class="string">"head"</span>)[<span class="number">0</span>].appendChild(scriptNode);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è¿”å›é¡¶éƒ¨çš„é€šç”¨æ–¹æ³•"><a href="#è¿”å›é¡¶éƒ¨çš„é€šç”¨æ–¹æ³•" class="headerlink" title="è¿”å›é¡¶éƒ¨çš„é€šç”¨æ–¹æ³•"></a>è¿”å›é¡¶éƒ¨çš„é€šç”¨æ–¹æ³•</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">backTop</span>(<span class="params">btnId</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(btnId);</span><br><span class="line">  <span class="keyword">var</span> d = <span class="built_in">document</span>.documentElement;</span><br><span class="line">  <span class="keyword">var</span> b = <span class="built_in">document</span>.body;</span><br><span class="line">  <span class="built_in">window</span>.onscroll = <span class="keyword">set</span>;</span><br><span class="line">  btn.style.display = "none";</span><br><span class="line">  btn.onclick = function() &#123;</span><br><span class="line">    btn.style.display = <span class="string">"none"</span>;</span><br><span class="line">    <span class="built_in">window</span>.onscroll = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">this</span>.timer = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      d.scrollTop -= <span class="built_in">Math</span>.ceil((d.scrollTop + b.scrollTop) * <span class="number">0.1</span>);</span><br><span class="line">      b.scrollTop -= <span class="built_in">Math</span>.ceil((d.scrollTop + b.scrollTop) * <span class="number">0.1</span>);</span><br><span class="line">      <span class="keyword">if</span> (d.scrollTop + b.scrollTop == <span class="number">0</span>)</span><br><span class="line">        clearInterval(btn.timer, (<span class="built_in">window</span>.onscroll = <span class="keyword">set</span>));</span><br><span class="line">    &#125;, 10);</span><br><span class="line">  &#125;;</span><br><span class="line">  function <span class="keyword">set</span>() &#123;</span><br><span class="line">    btn.style.display = d.scrollTop + b.scrollTop &gt; <span class="number">100</span> ? <span class="string">"block"</span> : <span class="string">"none"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">backTop(<span class="string">"goTop"</span>);</span><br></pre></td></tr></table></figure><h1 id="å®ç°base64è§£ç "><a href="#å®ç°base64è§£ç " class="headerlink" title="å®ç°base64è§£ç "></a>å®ç°base64è§£ç </h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">base64_decode</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> b64 = <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="</span>;</span><br><span class="line">  <span class="keyword">var</span> o1,</span><br><span class="line">    o2,</span><br><span class="line">    o3,</span><br><span class="line">    h1,</span><br><span class="line">    h2,</span><br><span class="line">    h3,</span><br><span class="line">    h4,</span><br><span class="line">    bits,</span><br><span class="line">    i = <span class="number">0</span>,</span><br><span class="line">    ac = <span class="number">0</span>,</span><br><span class="line">    dec = <span class="string">""</span>,</span><br><span class="line">    tmp_arr = [];</span><br><span class="line">  <span class="keyword">if</span> (!data) &#123;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;</span><br><span class="line">  data += <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    h1 = b64.indexOf(data.charAt(i++));</span><br><span class="line">    h2 = b64.indexOf(data.charAt(i++));</span><br><span class="line">    h3 = b64.indexOf(data.charAt(i++));</span><br><span class="line">    h4 = b64.indexOf(data.charAt(i++));</span><br><span class="line">    bits = (h1 &lt;&lt; <span class="number">18</span>) | (h2 &lt;&lt; <span class="number">12</span>) | (h3 &lt;&lt; <span class="number">6</span>) | h4;</span><br><span class="line">    o1 = (bits &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">    o2 = (bits &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">    o3 = bits &amp; <span class="number">0xff</span>;</span><br><span class="line">    <span class="keyword">if</span> (h3 == <span class="number">64</span>) &#123;</span><br><span class="line">      tmp_arr[ac++] = <span class="built_in">String</span>.fromCharCode(o1);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (h4 == <span class="number">64</span>) &#123;</span><br><span class="line">      tmp_arr[ac++] = <span class="built_in">String</span>.fromCharCode(o1, o2);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      tmp_arr[ac++] = <span class="built_in">String</span>.fromCharCode(o1, o2, o3);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">while</span> (i &lt; data.length);</span><br><span class="line">  dec = tmp_arr.join(<span class="string">""</span>);</span><br><span class="line">  dec = utf8_decode(dec);</span><br><span class="line">  <span class="keyword">return</span> dec;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç¡®è®¤æ˜¯å¦æ˜¯é”®ç›˜æœ‰æ•ˆè¾“å…¥å€¼"><a href="#ç¡®è®¤æ˜¯å¦æ˜¯é”®ç›˜æœ‰æ•ˆè¾“å…¥å€¼" class="headerlink" title="ç¡®è®¤æ˜¯å¦æ˜¯é”®ç›˜æœ‰æ•ˆè¾“å…¥å€¼"></a>ç¡®è®¤æ˜¯å¦æ˜¯é”®ç›˜æœ‰æ•ˆè¾“å…¥å€¼</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkKey</span>(<span class="params">iKey</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (iKey == <span class="number">32</span> || iKey == <span class="number">229</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="comment">/*ç©ºæ ¼å’Œå¼‚å¸¸*/</span></span><br><span class="line">  <span class="keyword">if</span> (iKey &gt; <span class="number">47</span> &amp;&amp; iKey &lt; <span class="number">58</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="comment">/*æ•°å­—*/</span></span><br><span class="line">  <span class="keyword">if</span> (iKey &gt; <span class="number">64</span> &amp;&amp; iKey &lt; <span class="number">91</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="comment">/*å­—æ¯*/</span></span><br><span class="line">  <span class="keyword">if</span> (iKey &gt; <span class="number">95</span> &amp;&amp; iKey &lt; <span class="number">108</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="comment">/*æ•°å­—é”®ç›˜1*/</span></span><br><span class="line">  <span class="keyword">if</span> (iKey &gt; <span class="number">108</span> &amp;&amp; iKey &lt; <span class="number">112</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="comment">/*æ•°å­—é”®ç›˜2*/</span></span><br><span class="line">  <span class="keyword">if</span> (iKey &gt; <span class="number">185</span> &amp;&amp; iKey &lt; <span class="number">193</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="comment">/*ç¬¦å·1*/</span></span><br><span class="line">  <span class="keyword">if</span> (iKey &gt; <span class="number">218</span> &amp;&amp; iKey &lt; <span class="number">223</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="comment">/*ç¬¦å·2*/</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å…¨è§’åŠè§’è½¬æ¢"><a href="#å…¨è§’åŠè§’è½¬æ¢" class="headerlink" title="å…¨è§’åŠè§’è½¬æ¢"></a>å…¨è§’åŠè§’è½¬æ¢</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//iCase: 0å…¨åˆ°åŠï¼Œ1åŠåˆ°å…¨ï¼Œå…¶ä»–ä¸è½¬åŒ–</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">chgCase</span>(<span class="params">sStr, iCase</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    <span class="keyword">typeof</span> sStr != <span class="string">"string"</span> ||</span><br><span class="line">    sStr.length &lt;= <span class="number">0</span> ||</span><br><span class="line">    !(iCase === <span class="number">0</span> || iCase == <span class="number">1</span>)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> sStr;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> i,</span><br><span class="line">    oRs = [],</span><br><span class="line">    iCode;</span><br><span class="line">  <span class="keyword">if</span> (iCase) &#123;</span><br><span class="line">    <span class="comment">/*åŠ-&gt;å…¨*/</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; sStr.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">      iCode = sStr.charCodeAt(i);</span><br><span class="line">      <span class="keyword">if</span> (iCode == <span class="number">32</span>) &#123;</span><br><span class="line">        iCode = <span class="number">12288</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (iCode &lt; <span class="number">127</span>) &#123;</span><br><span class="line">        iCode += <span class="number">65248</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      oRs.push(<span class="built_in">String</span>.fromCharCode(iCode));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">/*å…¨-&gt;åŠ*/</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; sStr.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">      iCode = sStr.charCodeAt(i);</span><br><span class="line">      <span class="keyword">if</span> (iCode == <span class="number">12288</span>) &#123;</span><br><span class="line">        iCode = <span class="number">32</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (iCode &gt; <span class="number">65280</span> &amp;&amp; iCode &lt; <span class="number">65375</span>) &#123;</span><br><span class="line">        iCode -= <span class="number">65248</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      oRs.push(<span class="built_in">String</span>.fromCharCode(iCode));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> oRs.join(<span class="string">""</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç‰ˆæœ¬å¯¹æ¯”"><a href="#ç‰ˆæœ¬å¯¹æ¯”" class="headerlink" title="ç‰ˆæœ¬å¯¹æ¯”"></a>ç‰ˆæœ¬å¯¹æ¯”</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compareVersion</span>(<span class="params">v1, v2</span>) </span>&#123;</span><br><span class="line">  v1 = v1.split(<span class="string">"."</span>);</span><br><span class="line">  v2 = v2.split(<span class="string">"."</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> len = <span class="built_in">Math</span>.max(v1.length, v2.length);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (v1.length &lt; len) &#123;</span><br><span class="line">    v1.push(<span class="string">"0"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (v2.length &lt; len) &#123;</span><br><span class="line">    v2.push(<span class="string">"0"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> num1 = <span class="built_in">parseInt</span>(v1[i]);</span><br><span class="line">    <span class="keyword">var</span> num2 = <span class="built_in">parseInt</span>(v2[i]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (num1 &gt; num2) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (num1 &lt; num2) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‹ç¼©CSSæ ·å¼ä»£ç "><a href="#å‹ç¼©CSSæ ·å¼ä»£ç " class="headerlink" title="å‹ç¼©CSSæ ·å¼ä»£ç "></a>å‹ç¼©CSSæ ·å¼ä»£ç </h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compressCss</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//å‹ç¼©ä»£ç </span></span><br><span class="line">  s = s.replace(<span class="regexp">/\/\*(.|\n)*?\*\//g</span>, <span class="string">""</span>); <span class="comment">//åˆ é™¤æ³¨é‡Š</span></span><br><span class="line">  s = s.replace(<span class="regexp">/\s*([\&#123;\&#125;\:\;\,])\s*/g</span>, <span class="string">"$1"</span>);</span><br><span class="line">  s = s.replace(<span class="regexp">/\,[\s\.\#\d]*\&#123;/g</span>, <span class="string">"&#123;"</span>); <span class="comment">//å®¹é”™å¤„ç†</span></span><br><span class="line">  s = s.replace(<span class="regexp">/;\s*;/g</span>, <span class="string">";"</span>); <span class="comment">//æ¸…é™¤è¿ç»­åˆ†å·</span></span><br><span class="line">  s = s.match(<span class="regexp">/^\s*(\S+(\s+\S+)*)\s*$/</span>); <span class="comment">//å»æ‰é¦–å°¾ç©ºç™½</span></span><br><span class="line">  <span class="keyword">return</span> s == <span class="literal">null</span> ? <span class="string">""</span> : s[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è·å–å½“å‰è·¯å¾„"><a href="#è·å–å½“å‰è·¯å¾„" class="headerlink" title="è·å–å½“å‰è·¯å¾„"></a>è·å–å½“å‰è·¯å¾„</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> currentPageUrl = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span>.href === <span class="string">"undefined"</span>) &#123;</span><br><span class="line">  currentPageUrl = <span class="built_in">document</span>.location.toString().toLowerCase();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  currentPageUrl = <span class="keyword">this</span>.href.toString().toLowerCase();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å­—ç¬¦ä¸²é•¿åº¦æˆªå–"><a href="#å­—ç¬¦ä¸²é•¿åº¦æˆªå–" class="headerlink" title="å­—ç¬¦ä¸²é•¿åº¦æˆªå–"></a>å­—ç¬¦ä¸²é•¿åº¦æˆªå–</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cutstr</span>(<span class="params">str, len</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> temp,</span><br><span class="line">        icount = <span class="number">0</span>,</span><br><span class="line">        patrn = <span class="regexp">/[^\x00-\xff]/</span>ï¼Œ</span><br><span class="line">        strre = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; str.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (icount &lt; len - <span class="number">1</span>) &#123;</span><br><span class="line">            temp = str.substr(i, <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (patrn.exec(temp) == <span class="literal">null</span>) &#123;</span><br><span class="line">                   icount = icount + <span class="number">1</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                icount = icount + <span class="number">2</span></span><br><span class="line">            &#125;</span><br><span class="line">            strre += temp</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> strre + <span class="string">"..."</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ—¶é—´æ—¥æœŸæ ¼å¼è½¬æ¢"><a href="#æ—¶é—´æ—¥æœŸæ ¼å¼è½¬æ¢" class="headerlink" title="æ—¶é—´æ—¥æœŸæ ¼å¼è½¬æ¢"></a>æ—¶é—´æ—¥æœŸæ ¼å¼è½¬æ¢</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Date</span>.prototype.format = <span class="function"><span class="keyword">function</span>(<span class="params">formatStr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> str = formatStr;</span><br><span class="line">  <span class="keyword">var</span> Week = [<span class="string">"æ—¥"</span>, <span class="string">"ä¸€"</span>, <span class="string">"äºŒ"</span>, <span class="string">"ä¸‰"</span>, <span class="string">"å››"</span>, <span class="string">"äº”"</span>, <span class="string">"å…­"</span>];</span><br><span class="line">  str = str.replace(<span class="regexp">/yyyy|YYYY/</span>, <span class="keyword">this</span>.getFullYear());</span><br><span class="line">  str = str.replace(</span><br><span class="line">    /yy|YY/,</span><br><span class="line">    <span class="keyword">this</span>.getYear() % <span class="number">100</span> &gt; <span class="number">9</span></span><br><span class="line">      ? (<span class="keyword">this</span>.getYear() % <span class="number">100</span>).toString()</span><br><span class="line">      : <span class="string">"0"</span> + (<span class="keyword">this</span>.getYear() % <span class="number">100</span>)</span><br><span class="line">  );</span><br><span class="line">  str = str.replace(</span><br><span class="line">    /MM/,</span><br><span class="line">    <span class="keyword">this</span>.getMonth() + <span class="number">1</span> &gt; <span class="number">9</span></span><br><span class="line">      ? (<span class="keyword">this</span>.getMonth() + <span class="number">1</span>).toString()</span><br><span class="line">      : <span class="string">"0"</span> + (<span class="keyword">this</span>.getMonth() + <span class="number">1</span>)</span><br><span class="line">  );</span><br><span class="line">  str = str.replace(<span class="regexp">/M/g</span>, <span class="keyword">this</span>.getMonth() + <span class="number">1</span>);</span><br><span class="line">  str = str.replace(<span class="regexp">/w|W/g</span>, Week[<span class="keyword">this</span>.getDay()]);</span><br><span class="line">  str = str.replace(</span><br><span class="line">    /dd|DD/,</span><br><span class="line">    <span class="keyword">this</span>.getDate() &gt; <span class="number">9</span> ? <span class="keyword">this</span>.getDate().toString() : <span class="string">"0"</span> + <span class="keyword">this</span>.getDate()</span><br><span class="line">  );</span><br><span class="line">  str = str.replace(<span class="regexp">/d|D/g</span>, <span class="keyword">this</span>.getDate());</span><br><span class="line">  str = str.replace(</span><br><span class="line">    /hh|HH/,</span><br><span class="line">    <span class="keyword">this</span>.getHours() &gt; <span class="number">9</span> ? <span class="keyword">this</span>.getHours().toString() : <span class="string">"0"</span> + <span class="keyword">this</span>.getHours()</span><br><span class="line">  );</span><br><span class="line">  str = str.replace(<span class="regexp">/h|H/g</span>, <span class="keyword">this</span>.getHours());</span><br><span class="line">  str = str.replace(</span><br><span class="line">    /mm/,</span><br><span class="line">    <span class="keyword">this</span>.getMinutes() &gt; <span class="number">9</span></span><br><span class="line">      ? <span class="keyword">this</span>.getMinutes().toString()</span><br><span class="line">      : <span class="string">"0"</span> + <span class="keyword">this</span>.getMinutes()</span><br><span class="line">  );</span><br><span class="line">  str = str.replace(<span class="regexp">/m/g</span>, <span class="keyword">this</span>.getMinutes());</span><br><span class="line">  str = str.replace(</span><br><span class="line">    /ss|SS/,</span><br><span class="line">    <span class="keyword">this</span>.getSeconds() &gt; <span class="number">9</span></span><br><span class="line">      ? <span class="keyword">this</span>.getSeconds().toString()</span><br><span class="line">      : <span class="string">"0"</span> + <span class="keyword">this</span>.getSeconds()</span><br><span class="line">  );</span><br><span class="line">  str = str.replace(<span class="regexp">/s|S/g</span>, <span class="keyword">this</span>.getSeconds());</span><br><span class="line">  <span class="keyword">return</span> str;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–</span></span><br><span class="line"><span class="built_in">Date</span>.prototype.format = <span class="function"><span class="keyword">function</span>(<span class="params">format</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> o = &#123;</span><br><span class="line">    <span class="string">"M+"</span>: <span class="keyword">this</span>.getMonth() + <span class="number">1</span>, <span class="comment">//month</span></span><br><span class="line">    <span class="string">"d+"</span>: <span class="keyword">this</span>.getDate(), <span class="comment">//day</span></span><br><span class="line">    <span class="string">"h+"</span>: <span class="keyword">this</span>.getHours(), <span class="comment">//hour</span></span><br><span class="line">    <span class="string">"m+"</span>: <span class="keyword">this</span>.getMinutes(), <span class="comment">//minute</span></span><br><span class="line">    <span class="string">"s+"</span>: <span class="keyword">this</span>.getSeconds(), <span class="comment">//second</span></span><br><span class="line">    <span class="string">"q+"</span>: <span class="built_in">Math</span>.floor((<span class="keyword">this</span>.getMonth() + <span class="number">3</span>) / <span class="number">3</span>), <span class="comment">//quarter</span></span><br><span class="line">    S: <span class="keyword">this</span>.getMilliseconds() <span class="comment">//millisecond</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/(y+)/</span>.test(format))</span><br><span class="line">    format = format.replace(</span><br><span class="line">      <span class="built_in">RegExp</span>.$<span class="number">1</span>,</span><br><span class="line">      (<span class="keyword">this</span>.getFullYear() + <span class="string">""</span>).substr(<span class="number">4</span> - <span class="built_in">RegExp</span>.$<span class="number">1.</span>length)</span><br><span class="line">    );</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> o) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"("</span> + k + <span class="string">")"</span>).test(format))</span><br><span class="line">      format = format.replace(</span><br><span class="line">        <span class="built_in">RegExp</span>.$<span class="number">1</span>,</span><br><span class="line">        <span class="built_in">RegExp</span>.$<span class="number">1.</span>length == <span class="number">1</span> ? o[k] : (<span class="string">"00"</span> + o[k]).substr((<span class="string">""</span> + o[k]).length)</span><br><span class="line">      );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> format;</span><br><span class="line">&#125;;</span><br><span class="line">alert(<span class="keyword">new</span> <span class="built_in">Date</span>().format(<span class="string">"yyyy-MM-dd hh:mm:ss"</span>));</span><br></pre></td></tr></table></figure><h1 id="è·¨æµè§ˆå™¨åˆ é™¤äº‹ä»¶"><a href="#è·¨æµè§ˆå™¨åˆ é™¤äº‹ä»¶" class="headerlink" title="è·¨æµè§ˆå™¨åˆ é™¤äº‹ä»¶"></a>è·¨æµè§ˆå™¨åˆ é™¤äº‹ä»¶</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delEvt</span>(<span class="params">obj, evt, fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!obj) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (obj.addEventListener) &#123;</span><br><span class="line">    obj.addEventListener(evt, fn, <span class="literal">false</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oTarget.attachEvent) &#123;</span><br><span class="line">    obj.attachEvent(<span class="string">"on"</span> + evt, fn);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    obj[<span class="string">"on"</span> + evt] = fn;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åˆ¤æ–­æ˜¯å¦ä»¥æŸä¸ªå­—ç¬¦ä¸²ç»“æŸ"><a href="#åˆ¤æ–­æ˜¯å¦ä»¥æŸä¸ªå­—ç¬¦ä¸²ç»“æŸ" class="headerlink" title="åˆ¤æ–­æ˜¯å¦ä»¥æŸä¸ªå­—ç¬¦ä¸²ç»“æŸ"></a>åˆ¤æ–­æ˜¯å¦ä»¥æŸä¸ªå­—ç¬¦ä¸²ç»“æŸ</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>.prototype.endWith = <span class="function"><span class="keyword">function</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> d = <span class="keyword">this</span>.length - s.length;</span><br><span class="line">  <span class="keyword">return</span> d &gt;= <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.lastIndexOf(s) == d;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="è¿”å›è„šæœ¬å†…å®¹"><a href="#è¿”å›è„šæœ¬å†…å®¹" class="headerlink" title="è¿”å›è„šæœ¬å†…å®¹"></a>è¿”å›è„šæœ¬å†…å®¹</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">evalscript</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (s.indexOf(<span class="string">"&lt;script"</span>) == <span class="number">-1</span>) <span class="keyword">return</span> s;</span><br><span class="line">  <span class="keyword">var</span> p = <span class="regexp">/&lt;script[^\&gt;]*?&gt;([^\x00]*?)&lt;\/script&gt;/gi</span>;</span><br><span class="line">  <span class="keyword">var</span> arr = [];</span><br><span class="line">  <span class="keyword">while</span> ((arr = p.exec(s))) &#123;</span><br><span class="line">    <span class="keyword">var</span> p1 = <span class="regexp">/&lt;script[^\&gt;]*?src=\"([^\&gt;]*?)\"[^\&gt;]*?(reload=\"1\")?(?:charset=\"([\w\-]+?)\")?&gt;&lt;\/script&gt;/i</span>;</span><br><span class="line">    <span class="keyword">var</span> arr1 = [];</span><br><span class="line">    arr1 = p1.exec(arr[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">if</span> (arr1) &#123;</span><br><span class="line">      appendscript(arr1[<span class="number">1</span>], <span class="string">""</span>, arr1[<span class="number">2</span>], arr1[<span class="number">3</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      p1 = <span class="regexp">/&lt;script(.*?)&gt;([^\x00]+?)&lt;\/script&gt;/i</span>;</span><br><span class="line">      arr1 = p1.exec(arr[<span class="number">0</span>]);</span><br><span class="line">      appendscript(<span class="string">""</span>, arr1[<span class="number">2</span>], arr1[<span class="number">1</span>].indexOf(<span class="string">"reload="</span>) != <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ ¼å¼åŒ–CSSæ ·å¼ä»£ç "><a href="#æ ¼å¼åŒ–CSSæ ·å¼ä»£ç " class="headerlink" title="æ ¼å¼åŒ–CSSæ ·å¼ä»£ç "></a>æ ¼å¼åŒ–CSSæ ·å¼ä»£ç </h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatCss</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//æ ¼å¼åŒ–ä»£ç </span></span><br><span class="line">  s = s.replace(<span class="regexp">/\s*([\&#123;\&#125;\:\;\,])\s*/g</span>, <span class="string">"$1"</span>);</span><br><span class="line">  s = s.replace(<span class="regexp">/;\s*;/g</span>, <span class="string">";"</span>); <span class="comment">//æ¸…é™¤è¿ç»­åˆ†å·</span></span><br><span class="line">  s = s.replace(<span class="regexp">/\,[\s\.\#\d]*&#123;/g</span>, <span class="string">"&#123;"</span>);</span><br><span class="line">  s = s.replace(<span class="regexp">/([^\s])\&#123;([^\s])/g</span>, <span class="string">"$1 &#123;\n\t$2"</span>);</span><br><span class="line">  s = s.replace(<span class="regexp">/([^\s])\&#125;([^\n]*)/g</span>, <span class="string">"$1\n&#125;\n$2"</span>);</span><br><span class="line">  s = s.replace(<span class="regexp">/([^\s]);([^\s\&#125;])/g</span>, <span class="string">"$1;\n\t$2"</span>);</span><br><span class="line">  <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è·å–cookieå€¼"><a href="#è·å–cookieå€¼" class="headerlink" title="è·å–cookieå€¼"></a>è·å–cookieå€¼</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> arr = <span class="built_in">document</span>.cookie.match(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"(^| )"</span> + name + <span class="string">"=([^;]*)(;|$)"</span>));</span><br><span class="line">  <span class="keyword">if</span> (arr != <span class="literal">null</span>) <span class="keyword">return</span> <span class="built_in">unescape</span>(arr[<span class="number">2</span>]);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è·å¾—URLä¸­GETå‚æ•°å€¼"><a href="#è·å¾—URLä¸­GETå‚æ•°å€¼" class="headerlink" title="è·å¾—URLä¸­GETå‚æ•°å€¼"></a>è·å¾—URLä¸­GETå‚æ•°å€¼</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”¨æ³•ï¼šå¦‚æœåœ°å€æ˜¯ test.htm?t1=1&amp;t2=2&amp;t3=3, é‚£ä¹ˆèƒ½å–å¾—ï¼šGET["t1"], GET["t2"], GET["t3"]</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getGet</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  querystr = <span class="built_in">window</span>.location.href.split(<span class="string">"?"</span>);</span><br><span class="line">  <span class="keyword">if</span> (querystr[<span class="number">1</span>]) &#123;</span><br><span class="line">    GETs = querystr[<span class="number">1</span>].split(<span class="string">"&amp;"</span>);</span><br><span class="line">    GET = [];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; GETs.length; i++) &#123;</span><br><span class="line">      tmp_arr = GETs.split(<span class="string">"="</span>);</span><br><span class="line">      key = tmp_arr[<span class="number">0</span>];</span><br><span class="line">      GET[key] = tmp_arr[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> querystr[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è·å–ç§»åŠ¨è®¾å¤‡åˆå§‹åŒ–å¤§å°"><a href="#è·å–ç§»åŠ¨è®¾å¤‡åˆå§‹åŒ–å¤§å°" class="headerlink" title="è·å–ç§»åŠ¨è®¾å¤‡åˆå§‹åŒ–å¤§å°"></a>è·å–ç§»åŠ¨è®¾å¤‡åˆå§‹åŒ–å¤§å°</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getInitZoom</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>._initZoom) &#123;</span><br><span class="line">    <span class="keyword">var</span> screenWidth = <span class="built_in">Math</span>.min(screen.height, screen.width);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.isAndroidMobileDevice() &amp;&amp; !<span class="keyword">this</span>.isNewChromeOnAndroid()) &#123;</span><br><span class="line">      screenWidth = screenWidth / <span class="built_in">window</span>.devicePixelRatio;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>._initZoom = screenWidth / <span class="built_in">document</span>.body.offsetWidth;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>._initZoom;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è·å–é¡µé¢é«˜åº¦"><a href="#è·å–é¡µé¢é«˜åº¦" class="headerlink" title="è·å–é¡µé¢é«˜åº¦"></a>è·å–é¡µé¢é«˜åº¦</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPageHeight</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> g = <span class="built_in">document</span>,</span><br><span class="line">    a = g.body,</span><br><span class="line">    f = g.documentElement,</span><br><span class="line">    d = g.compatMode == <span class="string">"BackCompat"</span> ? a : g.documentElement;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.max(f.scrollHeight, a.scrollHeight, d.clientHeight);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è·å–é¡µé¢scrollLeft"><a href="#è·å–é¡µé¢scrollLeft" class="headerlink" title="è·å–é¡µé¢scrollLeft"></a>è·å–é¡µé¢scrollLeft</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPageScrollLeft</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="built_in">document</span>;</span><br><span class="line">  <span class="keyword">return</span> a.documentElement.scrollLeft || a.body.scrollLeft;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è·å–é¡µé¢scrollTop"><a href="#è·å–é¡µé¢scrollTop" class="headerlink" title="è·å–é¡µé¢scrollTop"></a>è·å–é¡µé¢scrollTop</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPageScrollTop</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="built_in">document</span>;</span><br><span class="line">  <span class="keyword">return</span> a.documentElement.scrollTop || a.body.scrollTop;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è·å–é¡µé¢å¯è§†é«˜åº¦"><a href="#è·å–é¡µé¢å¯è§†é«˜åº¦" class="headerlink" title="è·å–é¡µé¢å¯è§†é«˜åº¦"></a>è·å–é¡µé¢å¯è§†é«˜åº¦</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPageViewHeight</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> d = <span class="built_in">document</span>,</span><br><span class="line">    a = d.compatMode == <span class="string">"BackCompat"</span> ? d.body : d.documentElement;</span><br><span class="line">  <span class="keyword">return</span> a.clientHeight;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è·å–é¡µé¢å¯è§†å®½åº¦"><a href="#è·å–é¡µé¢å¯è§†å®½åº¦" class="headerlink" title="è·å–é¡µé¢å¯è§†å®½åº¦"></a>è·å–é¡µé¢å¯è§†å®½åº¦</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPageViewWidth</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> d = <span class="built_in">document</span>,</span><br><span class="line">    a = d.compatMode == <span class="string">"BackCompat"</span> ? d.body : d.documentElement;</span><br><span class="line">  <span class="keyword">return</span> a.clientWidth;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è·å–é¡µé¢å®½åº¦"><a href="#è·å–é¡µé¢å®½åº¦" class="headerlink" title="è·å–é¡µé¢å®½åº¦"></a>è·å–é¡µé¢å®½åº¦</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPageWidth</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> g = <span class="built_in">document</span>,</span><br><span class="line">    a = g.body,</span><br><span class="line">    f = g.documentElement,</span><br><span class="line">    d = g.compatMode == <span class="string">"BackCompat"</span> ? a : g.documentElement;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.max(f.scrollWidth, a.scrollWidth, d.clientWidth);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è·å–ç§»åŠ¨è®¾å¤‡å±å¹•å®½åº¦"><a href="#è·å–ç§»åŠ¨è®¾å¤‡å±å¹•å®½åº¦" class="headerlink" title="è·å–ç§»åŠ¨è®¾å¤‡å±å¹•å®½åº¦"></a>è·å–ç§»åŠ¨è®¾å¤‡å±å¹•å®½åº¦</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getScreenWidth</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> smallerSide = <span class="built_in">Math</span>.min(screen.width, screen.height);</span><br><span class="line">  <span class="keyword">var</span> fixViewPortsExperiment =</span><br><span class="line">    rendererModel.runningExperiments.FixViewport ||</span><br><span class="line">    rendererModel.runningExperiments.fixviewport;</span><br><span class="line">  <span class="keyword">var</span> fixViewPortsExperimentRunning =</span><br><span class="line">    fixViewPortsExperiment &amp;&amp; fixViewPortsExperiment.toLowerCase() === <span class="string">"new"</span>;</span><br><span class="line">  <span class="keyword">if</span> (fixViewPortsExperiment) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.isAndroidMobileDevice() &amp;&amp; !<span class="keyword">this</span>.isNewChromeOnAndroid()) &#123;</span><br><span class="line">      smallerSide = smallerSide / <span class="built_in">window</span>.devicePixelRatio;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> smallerSide;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è·å–ç½‘é¡µè¢«å·å»çš„ä½ç½®"><a href="#è·å–ç½‘é¡µè¢«å·å»çš„ä½ç½®" class="headerlink" title="è·å–ç½‘é¡µè¢«å·å»çš„ä½ç½®"></a>è·å–ç½‘é¡µè¢«å·å»çš„ä½ç½®</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getScrollXY</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">document</span>.body.scrollTop</span><br><span class="line">    ? &#123;</span><br><span class="line">        x: <span class="built_in">document</span>.body.scrollLeft,</span><br><span class="line">        y: <span class="built_in">document</span>.body.scrollTop</span><br><span class="line">      &#125;</span><br><span class="line">    : &#123;</span><br><span class="line">        x: <span class="built_in">document</span>.documentElement.scrollLeft,</span><br><span class="line">        y: <span class="built_in">document</span>.documentElement.scrollTop</span><br><span class="line">      &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è·å–URLä¸Šçš„å‚æ•°"><a href="#è·å–URLä¸Šçš„å‚æ•°" class="headerlink" title="è·å–URLä¸Šçš„å‚æ•°"></a>è·å–URLä¸Šçš„å‚æ•°</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–URLä¸­çš„æŸå‚æ•°å€¼,ä¸åŒºåˆ†å¤§å°å†™</span></span><br><span class="line"><span class="comment">// è·å–URLä¸­çš„æŸå‚æ•°å€¼,ä¸åŒºåˆ†å¤§å°å†™,</span></span><br><span class="line"><span class="comment">// é»˜è®¤æ˜¯å–'hash'é‡Œçš„å‚æ•°ï¼Œ</span></span><br><span class="line"><span class="comment">// å¦‚æœä¼ å…¶ä»–å‚æ•°æ”¯æŒå–â€˜searchâ€™ä¸­çš„å‚æ•°</span></span><br><span class="line"><span class="comment">// @param &#123;String&#125; name å‚æ•°åç§°</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getUrlParam</span>(<span class="params">name, type = <span class="string">"hash"</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> newName = name,</span><br><span class="line">    reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"(^|&amp;)"</span> + newName + <span class="string">"=([^&amp;]*)(&amp;|$)"</span>, <span class="string">"i"</span>),</span><br><span class="line">    paramHash = <span class="built_in">window</span>.location.hash.split(<span class="string">"?"</span>)[<span class="number">1</span>] || <span class="string">""</span>,</span><br><span class="line">    paramSearch = <span class="built_in">window</span>.location.search.split(<span class="string">"?"</span>)[<span class="number">1</span>] || <span class="string">""</span>,</span><br><span class="line">    param;</span><br><span class="line"></span><br><span class="line">  type === <span class="string">"hash"</span> ? (param = paramHash) : (param = paramSearch);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> result = param.match(reg);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (result != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> result[<span class="number">2</span>].split(<span class="string">"/"</span>)[<span class="number">0</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ£€éªŒURLé“¾æ¥æ˜¯å¦æœ‰æ•ˆ"><a href="#æ£€éªŒURLé“¾æ¥æ˜¯å¦æœ‰æ•ˆ" class="headerlink" title="æ£€éªŒURLé“¾æ¥æ˜¯å¦æœ‰æ•ˆ"></a>æ£€éªŒURLé“¾æ¥æ˜¯å¦æœ‰æ•ˆ</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUrlState</span>(<span class="params">URL</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> xmlhttp = <span class="keyword">new</span> ActiveXObject(<span class="string">"microsoft.xmlhttp"</span>);</span><br><span class="line">  xmlhttp.Open(<span class="string">"GET"</span>, URL, <span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    xmlhttp.Send();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> result = xmlhttp.responseText;</span><br><span class="line">    <span class="keyword">if</span> (result) &#123;</span><br><span class="line">      <span class="keyword">if</span> (xmlhttp.Status == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è·å–çª—ä½“å¯è§èŒƒå›´çš„å®½ä¸é«˜"><a href="#è·å–çª—ä½“å¯è§èŒƒå›´çš„å®½ä¸é«˜" class="headerlink" title="è·å–çª—ä½“å¯è§èŒƒå›´çš„å®½ä¸é«˜"></a>è·å–çª—ä½“å¯è§èŒƒå›´çš„å®½ä¸é«˜</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getViewSize</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> de = <span class="built_in">document</span>.documentElement;</span><br><span class="line">  <span class="keyword">var</span> db = <span class="built_in">document</span>.body;</span><br><span class="line">  <span class="keyword">var</span> viewW = de.clientWidth == <span class="number">0</span> ? db.clientWidth : de.clientWidth;</span><br><span class="line">  <span class="keyword">var</span> viewH = de.clientHeight == <span class="number">0</span> ? db.clientHeight : de.clientHeight;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Array</span>(viewW, viewH);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è·å–ç§»åŠ¨è®¾å¤‡æœ€å¤§åŒ–å¤§å°"><a href="#è·å–ç§»åŠ¨è®¾å¤‡æœ€å¤§åŒ–å¤§å°" class="headerlink" title="è·å–ç§»åŠ¨è®¾å¤‡æœ€å¤§åŒ–å¤§å°"></a>è·å–ç§»åŠ¨è®¾å¤‡æœ€å¤§åŒ–å¤§å°</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getZoom</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> screenWidth =</span><br><span class="line">    <span class="built_in">Math</span>.abs(<span class="built_in">window</span>.orientation) === <span class="number">90</span></span><br><span class="line">      ? <span class="built_in">Math</span>.max(screen.height, screen.width)</span><br><span class="line">      : <span class="built_in">Math</span>.min(screen.height, screen.width);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.isAndroidMobileDevice() &amp;&amp; !<span class="keyword">this</span>.isNewChromeOnAndroid()) &#123;</span><br><span class="line">    screenWidth = screenWidth / <span class="built_in">window</span>.devicePixelRatio;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> FixViewPortsExperiment =</span><br><span class="line">    rendererModel.runningExperiments.FixViewport ||</span><br><span class="line">    rendererModel.runningExperiments.fixviewport;</span><br><span class="line">  <span class="keyword">var</span> FixViewPortsExperimentRunning =</span><br><span class="line">    FixViewPortsExperiment &amp;&amp;</span><br><span class="line">    (FixViewPortsExperiment === <span class="string">"New"</span> || FixViewPortsExperiment === <span class="string">"new"</span>);</span><br><span class="line">  <span class="keyword">if</span> (FixViewPortsExperimentRunning) &#123;</span><br><span class="line">    <span class="keyword">return</span> screenWidth / <span class="built_in">window</span>.innerWidth;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> screenWidth / <span class="built_in">document</span>.body.offsetWidth;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åˆ¤æ–­æ˜¯å¦å®‰å“ç§»åŠ¨è®¾å¤‡è®¿é—®"><a href="#åˆ¤æ–­æ˜¯å¦å®‰å“ç§»åŠ¨è®¾å¤‡è®¿é—®" class="headerlink" title="åˆ¤æ–­æ˜¯å¦å®‰å“ç§»åŠ¨è®¾å¤‡è®¿é—®"></a>åˆ¤æ–­æ˜¯å¦å®‰å“ç§»åŠ¨è®¾å¤‡è®¿é—®</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isAndroidMobileDevice</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/android/i</span>.test(navigator.userAgent.toLowerCase());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åˆ¤æ–­æ˜¯å¦è‹¹æœç§»åŠ¨è®¾å¤‡è®¿é—®"><a href="#åˆ¤æ–­æ˜¯å¦è‹¹æœç§»åŠ¨è®¾å¤‡è®¿é—®" class="headerlink" title="åˆ¤æ–­æ˜¯å¦è‹¹æœç§»åŠ¨è®¾å¤‡è®¿é—®"></a>åˆ¤æ–­æ˜¯å¦è‹¹æœç§»åŠ¨è®¾å¤‡è®¿é—®</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isAppleMobileDevice</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/iphone|ipod|ipad|Macintosh/i</span>.test(navigator.userAgent.toLowerCase());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åˆ¤æ–­æ˜¯å¦ä¸ºæ•°å­—ç±»å‹"><a href="#åˆ¤æ–­æ˜¯å¦ä¸ºæ•°å­—ç±»å‹" class="headerlink" title="åˆ¤æ–­æ˜¯å¦ä¸ºæ•°å­—ç±»å‹"></a>åˆ¤æ–­æ˜¯å¦ä¸ºæ•°å­—ç±»å‹</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isDigit</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> patrn = <span class="regexp">/^[0-9]*$/</span>;</span><br><span class="line">  <span class="keyword">if</span> (patrn.exec(value) == <span class="literal">null</span> || value == <span class="string">""</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ˜¯å¦æ˜¯æŸç±»æ‰‹æœºå‹å·"><a href="#æ˜¯å¦æ˜¯æŸç±»æ‰‹æœºå‹å·" class="headerlink" title="æ˜¯å¦æ˜¯æŸç±»æ‰‹æœºå‹å·"></a>æ˜¯å¦æ˜¯æŸç±»æ‰‹æœºå‹å·</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”¨devicePixelRatioå’Œåˆ†è¾¨ç‡åˆ¤æ–­</span></span><br><span class="line"><span class="keyword">const</span> isIphonex = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// X XS, XS Max, XR</span></span><br><span class="line">  <span class="keyword">const</span> xSeriesConfig = [</span><br><span class="line">    &#123;</span><br><span class="line">      devicePixelRatio: <span class="number">3</span>,</span><br><span class="line">      width: <span class="number">375</span>,</span><br><span class="line">      height: <span class="number">812</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      devicePixelRatio: <span class="number">3</span>,</span><br><span class="line">      width: <span class="number">414</span>,</span><br><span class="line">      height: <span class="number">896</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      devicePixelRatio: <span class="number">2</span>,</span><br><span class="line">      width: <span class="number">414</span>,</span><br><span class="line">      height: <span class="number">896</span></span><br><span class="line">    &#125;</span><br><span class="line">  ];</span><br><span class="line">  <span class="comment">// h5</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">"undefined"</span> &amp;&amp; <span class="built_in">window</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> isIOS = <span class="regexp">/iphone/gi</span>.test(<span class="built_in">window</span>.navigator.userAgent);</span><br><span class="line">    <span class="keyword">if</span> (!isIOS) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">const</span> &#123; devicePixelRatio, screen &#125; = <span class="built_in">window</span>;</span><br><span class="line">    <span class="keyword">const</span> &#123; width, height &#125; = screen;</span><br><span class="line">    <span class="keyword">return</span> xSeriesConfig.some(</span><br><span class="line">      item =&gt;</span><br><span class="line">        item.devicePixelRatio === devicePixelRatio &amp;&amp;</span><br><span class="line">        item.width === width &amp;&amp;</span><br><span class="line">        item.height === height</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="åˆ¤æ–­æ˜¯å¦ç§»åŠ¨è®¾å¤‡"><a href="#åˆ¤æ–­æ˜¯å¦ç§»åŠ¨è®¾å¤‡" class="headerlink" title="åˆ¤æ–­æ˜¯å¦ç§»åŠ¨è®¾å¤‡"></a>åˆ¤æ–­æ˜¯å¦ç§»åŠ¨è®¾å¤‡</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isMobile</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span>._isMobile === <span class="string">"boolean"</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._isMobile;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> screenWidth = <span class="keyword">this</span>.getScreenWidth();</span><br><span class="line">  <span class="keyword">var</span> fixViewPortsExperiment =</span><br><span class="line">    rendererModel.runningExperiments.FixViewport ||</span><br><span class="line">    rendererModel.runningExperiments.fixviewport;</span><br><span class="line">  <span class="keyword">var</span> fixViewPortsExperimentRunning =</span><br><span class="line">    fixViewPortsExperiment &amp;&amp; fixViewPortsExperiment.toLowerCase() === <span class="string">"new"</span>;</span><br><span class="line">  <span class="keyword">if</span> (!fixViewPortsExperiment) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.isAppleMobileDevice()) &#123;</span><br><span class="line">      screenWidth = screenWidth / <span class="built_in">window</span>.devicePixelRatio;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> isMobileScreenSize = screenWidth &lt; <span class="number">600</span>;</span><br><span class="line">  <span class="keyword">var</span> isMobileUserAgent = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">this</span>._isMobile = isMobileScreenSize &amp;&amp; <span class="keyword">this</span>.isTouchScreen();</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>._isMobile;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åˆ¤æ–­å—æ˜¯å¦æ‰‹æœºå·ç "><a href="#åˆ¤æ–­å—æ˜¯å¦æ‰‹æœºå·ç " class="headerlink" title="åˆ¤æ–­å—æ˜¯å¦æ‰‹æœºå·ç "></a>åˆ¤æ–­å—æ˜¯å¦æ‰‹æœºå·ç </h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isMobileNumber</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i =</span><br><span class="line">      <span class="string">"134,135,136,137,138,139,150,151,152,157,158,159,187,188,147,182,183,184,178"</span>,</span><br><span class="line">    n = <span class="string">"130,131,132,155,156,185,186,145,176"</span>,</span><br><span class="line">    a = <span class="string">"133,153,180,181,189,177,173,170"</span>,</span><br><span class="line">    o = e || <span class="string">""</span>,</span><br><span class="line">    r = o.substring(<span class="number">0</span>, <span class="number">3</span>),</span><br><span class="line">    d = o.substring(<span class="number">0</span>, <span class="number">4</span>),</span><br><span class="line">    s =</span><br><span class="line">      !!<span class="regexp">/^1\d&#123;10&#125;$/</span>.test(o) &amp;&amp;</span><br><span class="line">      (n.indexOf(r) &gt;= <span class="number">0</span></span><br><span class="line">        ? <span class="string">"è”é€š"</span></span><br><span class="line">        : a.indexOf(r) &gt;= <span class="number">0</span></span><br><span class="line">        ? <span class="string">"ç”µä¿¡"</span></span><br><span class="line">        : <span class="string">"1349"</span> == d</span><br><span class="line">        ? <span class="string">"ç”µä¿¡"</span></span><br><span class="line">        : i.indexOf(r) &gt;= <span class="number">0</span></span><br><span class="line">        ? <span class="string">"ç§»åŠ¨"</span></span><br><span class="line">        : <span class="string">"æœªçŸ¥"</span>);</span><br><span class="line">  <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åˆ¤æ–­æ˜¯å¦æ˜¯ç§»åŠ¨è®¾å¤‡è®¿é—®"><a href="#åˆ¤æ–­æ˜¯å¦æ˜¯ç§»åŠ¨è®¾å¤‡è®¿é—®" class="headerlink" title="åˆ¤æ–­æ˜¯å¦æ˜¯ç§»åŠ¨è®¾å¤‡è®¿é—®"></a>åˆ¤æ–­æ˜¯å¦æ˜¯ç§»åŠ¨è®¾å¤‡è®¿é—®</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isMobileUserAgent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/iphone|ipod|android.*mobile|windows.*phone|blackberry.*mobile/i</span>.test(</span><br><span class="line">    <span class="built_in">window</span>.navigator.userAgent.toLowerCase()</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åˆ¤æ–­é¼ æ ‡æ˜¯å¦ç§»å‡ºäº‹ä»¶"><a href="#åˆ¤æ–­é¼ æ ‡æ˜¯å¦ç§»å‡ºäº‹ä»¶" class="headerlink" title="åˆ¤æ–­é¼ æ ‡æ˜¯å¦ç§»å‡ºäº‹ä»¶"></a>åˆ¤æ–­é¼ æ ‡æ˜¯å¦ç§»å‡ºäº‹ä»¶</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isMouseOut</span>(<span class="params">e, handler</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (e.type !== <span class="string">"mouseout"</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> reltg = e.relatedTarget</span><br><span class="line">    ? e.relatedTarget</span><br><span class="line">    : e.type === <span class="string">"mouseout"</span></span><br><span class="line">    ? e.toElement</span><br><span class="line">    : e.fromElement;</span><br><span class="line">  <span class="keyword">while</span> (reltg &amp;&amp; reltg !== handler) &#123;</span><br><span class="line">    reltg = reltg.parentNode;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> reltg !== handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åˆ¤æ–­æ˜¯å¦Touchå±å¹•"><a href="#åˆ¤æ–­æ˜¯å¦Touchå±å¹•" class="headerlink" title="åˆ¤æ–­æ˜¯å¦Touchå±å¹•"></a>åˆ¤æ–­æ˜¯å¦Touchå±å¹•</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isTouchScreen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="string">"ontouchstart"</span> <span class="keyword">in</span> <span class="built_in">window</span> ||</span><br><span class="line">    (<span class="built_in">window</span>.DocumentTouch &amp;&amp; <span class="built_in">document</span> <span class="keyword">instanceof</span> DocumentTouch)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åˆ¤æ–­æ˜¯å¦ä¸ºç½‘å€"><a href="#åˆ¤æ–­æ˜¯å¦ä¸ºç½‘å€" class="headerlink" title="åˆ¤æ–­æ˜¯å¦ä¸ºç½‘å€"></a>åˆ¤æ–­æ˜¯å¦ä¸ºç½‘å€</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isURL</span>(<span class="params">strUrl</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> regular = <span class="regexp">/^\b(((https?|ftp):\/\/)?[-a-z0-9]+(\.[-a-z0-9]+)*\.(?:com|edu|gov|int|mil|net|org|biz|info|name|museum|asia|coop|aero|[a-z][a-z]|((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]\d)|\d))\b(\/[-a-z0-9_:\@&amp;?=+,.!\/~%\$]*)?)$/i</span>;</span><br><span class="line">  <span class="keyword">if</span> (regular.test(strUrl)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åˆ¤æ–­æ˜¯å¦æ‰“å¼€è§†çª—"><a href="#åˆ¤æ–­æ˜¯å¦æ‰“å¼€è§†çª—" class="headerlink" title="åˆ¤æ–­æ˜¯å¦æ‰“å¼€è§†çª—"></a>åˆ¤æ–­æ˜¯å¦æ‰“å¼€è§†çª—</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isViewportOpen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !!<span class="built_in">document</span>.getElementById(<span class="string">"wixMobileViewport"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åŠ è½½æ ·å¼æ–‡ä»¶"><a href="#åŠ è½½æ ·å¼æ–‡ä»¶" class="headerlink" title="åŠ è½½æ ·å¼æ–‡ä»¶"></a>åŠ è½½æ ·å¼æ–‡ä»¶</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadStyle</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.createStyleSheet(url);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">var</span> cssLink = <span class="built_in">document</span>.createElement(<span class="string">"link"</span>);</span><br><span class="line">    cssLink.rel = <span class="string">"stylesheet"</span>;</span><br><span class="line">    cssLink.type = <span class="string">"text/css"</span>;</span><br><span class="line">    cssLink.href = url;</span><br><span class="line">    <span class="keyword">var</span> head = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"head"</span>)[<span class="number">0</span>];</span><br><span class="line">    head.appendChild(cssLink);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ›¿æ¢åœ°å€æ "><a href="#æ›¿æ¢åœ°å€æ " class="headerlink" title="æ›¿æ¢åœ°å€æ "></a>æ›¿æ¢åœ°å€æ </h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">locationReplace</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (history.replaceState) &#123;</span><br><span class="line">    history.replaceState(<span class="literal">null</span>, <span class="built_in">document</span>.title, url);</span><br><span class="line">    history.go(<span class="number">0</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    location.replace(url);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è§£å†³offsetXå…¼å®¹æ€§é—®é¢˜"><a href="#è§£å†³offsetXå…¼å®¹æ€§é—®é¢˜" class="headerlink" title="è§£å†³offsetXå…¼å®¹æ€§é—®é¢˜"></a>è§£å†³offsetXå…¼å®¹æ€§é—®é¢˜</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é’ˆå¯¹ç«ç‹ä¸æ”¯æŒoffsetX/Y</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getOffset</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> target = e.target, <span class="comment">// å½“å‰è§¦å‘çš„ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">    eventCoord,</span><br><span class="line">    pageCoord,</span><br><span class="line">    offsetCoord;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¡ç®—å½“å‰è§¦å‘å…ƒç´ åˆ°æ–‡æ¡£çš„è·ç¦»</span></span><br><span class="line">  pageCoord = getPageCoord(target);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¡ç®—å…‰æ ‡åˆ°æ–‡æ¡£çš„è·ç¦»</span></span><br><span class="line">  eventCoord = &#123;</span><br><span class="line">    X: <span class="built_in">window</span>.pageXOffset + e.clientX,</span><br><span class="line">    Y: <span class="built_in">window</span>.pageYOffset + e.clientY</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç›¸å‡è·å–å…‰æ ‡åˆ°ç¬¬ä¸€ä¸ªå®šä½çš„çˆ¶å…ƒç´ çš„åæ ‡</span></span><br><span class="line">  offsetCoord = &#123;</span><br><span class="line">    X: eventCoord.X - pageCoord.X,</span><br><span class="line">    Y: eventCoord.Y - pageCoord.Y</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> offsetCoord;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPageCoord</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> coord = &#123; <span class="attr">X</span>: <span class="number">0</span>, <span class="attr">Y</span>: <span class="number">0</span> &#125;;</span><br><span class="line">  <span class="comment">// è®¡ç®—ä»å½“å‰è§¦å‘å…ƒç´ åˆ°æ ¹èŠ‚ç‚¹ä¸ºæ­¢ï¼Œ</span></span><br><span class="line">  <span class="comment">// å„çº§ offsetParent å…ƒç´ çš„ offsetLeft æˆ– offsetTop å€¼ä¹‹å’Œ</span></span><br><span class="line">  <span class="keyword">while</span> (element) &#123;</span><br><span class="line">    coord.X += element.offsetLeft;</span><br><span class="line">    coord.Y += element.offsetTop;</span><br><span class="line">    element = element.offsetParent;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> coord;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ‰“å¼€ä¸€ä¸ªçª—ä½“é€šç”¨æ–¹æ³•"><a href="#æ‰“å¼€ä¸€ä¸ªçª—ä½“é€šç”¨æ–¹æ³•" class="headerlink" title="æ‰“å¼€ä¸€ä¸ªçª—ä½“é€šç”¨æ–¹æ³•"></a>æ‰“å¼€ä¸€ä¸ªçª—ä½“é€šç”¨æ–¹æ³•</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">openWindow</span>(<span class="params">url, windowName, width, height</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="built_in">parseInt</span>(screen.width / <span class="number">2.0</span>) - width / <span class="number">2.0</span>;</span><br><span class="line">  <span class="keyword">var</span> y = <span class="built_in">parseInt</span>(screen.height / <span class="number">2.0</span>) - height / <span class="number">2.0</span>;</span><br><span class="line">  <span class="keyword">var</span> isMSIE = navigator.appName == <span class="string">"Microsoft Internet Explorer"</span>;</span><br><span class="line">  <span class="keyword">if</span> (isMSIE) &#123;</span><br><span class="line">    <span class="keyword">var</span> p = <span class="string">"resizable=1,location=no,scrollbars=no,width="</span>;</span><br><span class="line">    p = p + width;</span><br><span class="line">    p = p + <span class="string">",height="</span>;</span><br><span class="line">    p = p + height;</span><br><span class="line">    p = p + <span class="string">",left="</span>;</span><br><span class="line">    p = p + x;</span><br><span class="line">    p = p + <span class="string">",top="</span>;</span><br><span class="line">    p = p + y;</span><br><span class="line">    retval = <span class="built_in">window</span>.open(url, windowName, p);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> win = <span class="built_in">window</span>.open(</span><br><span class="line">      url,</span><br><span class="line">      <span class="string">"ZyiisPopup"</span>,</span><br><span class="line">      <span class="string">"top="</span> +</span><br><span class="line">        y +</span><br><span class="line">        <span class="string">",left="</span> +</span><br><span class="line">        x +</span><br><span class="line">        <span class="string">",scrollbars="</span> +</span><br><span class="line">        scrollbars +</span><br><span class="line">        <span class="string">",dialog=yes,modal=yes,width="</span> +</span><br><span class="line">        width +</span><br><span class="line">        <span class="string">",height="</span> +</span><br><span class="line">        height +</span><br><span class="line">        <span class="string">",resizable=no"</span></span><br><span class="line">    );</span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">"try &#123; win.resizeTo(width, height); &#125; catch(e) &#123; &#125;"</span>);</span><br><span class="line">    win.focus();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å°†é”®å€¼å¯¹æ‹¼æ¥æˆURLå¸¦å‚æ•°"><a href="#å°†é”®å€¼å¯¹æ‹¼æ¥æˆURLå¸¦å‚æ•°" class="headerlink" title="å°†é”®å€¼å¯¹æ‹¼æ¥æˆURLå¸¦å‚æ•°"></a>å°†é”®å€¼å¯¹æ‹¼æ¥æˆURLå¸¦å‚æ•°</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">const</span> fnParams2Url = <span class="function"><span class="params">obj</span>=&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> aUrl = []</span><br><span class="line">      <span class="keyword">let</span> fnAdd = <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> key + <span class="string">'='</span> + value</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        aUrl.push(fnAdd(k, obj[k]))</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">encodeURIComponent</span>(aUrl.join(<span class="string">'&amp;'</span>))</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h1 id="å»æ‰urlå‰ç¼€"><a href="#å»æ‰urlå‰ç¼€" class="headerlink" title="å»æ‰urlå‰ç¼€"></a>å»æ‰urlå‰ç¼€</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeUrlPrefix</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  a = a</span><br><span class="line">    .replace(<span class="regexp">/ï¼š/g</span>, <span class="string">":"</span>)</span><br><span class="line">    .replace(<span class="regexp">/ï¼/g</span>, <span class="string">"."</span>)</span><br><span class="line">    .replace(<span class="regexp">/ï¼/g</span>, <span class="string">"/"</span>);</span><br><span class="line">  <span class="keyword">while</span> (</span><br><span class="line">    trim(a)</span><br><span class="line">      .toLowerCase()</span><br><span class="line">      .indexOf(<span class="string">"http://"</span>) == <span class="number">0</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    a = trim(a.replace(<span class="regexp">/http:\/\//i</span>, <span class="string">""</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ›¿æ¢å…¨éƒ¨"><a href="#æ›¿æ¢å…¨éƒ¨" class="headerlink" title="æ›¿æ¢å…¨éƒ¨"></a>æ›¿æ¢å…¨éƒ¨</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>.prototype.replaceAll = <span class="function"><span class="keyword">function</span>(<span class="params">s1, s2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(s1, <span class="string">"gm"</span>), s2);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="resizeçš„æ“ä½œ"><a href="#resizeçš„æ“ä½œ" class="headerlink" title="resizeçš„æ“ä½œ"></a>resizeçš„æ“ä½œ</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> w = <span class="built_in">document</span>.documentElement</span><br><span class="line">        ? <span class="built_in">document</span>.documentElement.clientWidth</span><br><span class="line">        : <span class="built_in">document</span>.body.clientWidth,</span><br><span class="line">      r = <span class="number">1255</span>,</span><br><span class="line">      b = Element.extend(<span class="built_in">document</span>.body),</span><br><span class="line">      classname = b.className;</span><br><span class="line">    <span class="keyword">if</span> (w &lt; r) &#123;</span><br><span class="line">      <span class="comment">//å½“çª—ä½“çš„å®½åº¦å°äº1255çš„æ—¶å€™æ‰§è¡Œç›¸åº”çš„æ“ä½œ</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//å½“çª—ä½“çš„å®½åº¦å¤§äº1255çš„æ—¶å€™æ‰§è¡Œç›¸åº”çš„æ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.addEventListener) &#123;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">"resize"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      fn();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">window</span>.attachEvent) &#123;</span><br><span class="line">    <span class="built_in">window</span>.attachEvent(<span class="string">"onresize"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      fn();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  fn();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h1 id="æ»šåŠ¨åˆ°é¡¶éƒ¨"><a href="#æ»šåŠ¨åˆ°é¡¶éƒ¨" class="headerlink" title="æ»šåŠ¨åˆ°é¡¶éƒ¨"></a>æ»šåŠ¨åˆ°é¡¶éƒ¨</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨document.documentElement.scrollTop æˆ– document.body.scrollTop è·å–åˆ°é¡¶éƒ¨çš„è·ç¦»ï¼Œä»é¡¶éƒ¨</span></span><br><span class="line"><span class="comment">// æ»šåŠ¨ä¸€å°éƒ¨åˆ†è·ç¦»ã€‚ä½¿ç”¨window.requestAnimationFrame()æ¥æ»šåŠ¨ã€‚</span></span><br><span class="line"><span class="comment">// @example</span></span><br><span class="line"><span class="comment">// scrollToTop();</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scrollToTop</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> c = <span class="built_in">document</span>.documentElement.scrollTop || <span class="built_in">document</span>.body.scrollTop;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (c &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">window</span>.requestAnimationFrame(scrollToTop);</span><br><span class="line">    <span class="built_in">window</span>.scrollTo(<span class="number">0</span>, c - c / <span class="number">8</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è®¾ç½®cookieå€¼"><a href="#è®¾ç½®cookieå€¼" class="headerlink" title="è®¾ç½®cookieå€¼"></a>è®¾ç½®cookieå€¼</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setCookie</span>(<span class="params">name, value, Hours</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">var</span> offset = <span class="number">8</span>;</span><br><span class="line">  <span class="keyword">var</span> utc = d.getTime() + d.getTimezoneOffset() * <span class="number">60000</span>;</span><br><span class="line">  <span class="keyword">var</span> nd = utc + <span class="number">3600000</span> * offset;</span><br><span class="line">  <span class="keyword">var</span> exp = <span class="keyword">new</span> <span class="built_in">Date</span>(nd);</span><br><span class="line">  exp.setTime(exp.getTime() + Hours * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">  <span class="built_in">document</span>.cookie =</span><br><span class="line">    name +</span><br><span class="line">    <span class="string">"="</span> +</span><br><span class="line">    <span class="built_in">escape</span>(value) +</span><br><span class="line">    <span class="string">";path=/;expires="</span> +</span><br><span class="line">    exp.toGMTString() +</span><br><span class="line">    <span class="string">";domain=360doc.com;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è®¾ä¸ºé¦–é¡µ"><a href="#è®¾ä¸ºé¦–é¡µ" class="headerlink" title="è®¾ä¸ºé¦–é¡µ"></a>è®¾ä¸ºé¦–é¡µ</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setHomepage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">document</span>.all) &#123;</span><br><span class="line">    <span class="built_in">document</span>.body.style.behavior = <span class="string">"url(#default#homepage)"</span>;</span><br><span class="line">    <span class="built_in">document</span>.body.setHomePage(<span class="string">"http://w3cboy.com"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">window</span>.sidebar) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.netscape) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        netscape.security.PrivilegeManager.enablePrivilege(</span><br><span class="line">          <span class="string">"UniversalXPConnect"</span></span><br><span class="line">        );</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        alert(</span><br><span class="line">          <span class="string">"è¯¥æ“ä½œè¢«æµè§ˆå™¨æ‹’ç»ï¼Œå¦‚æœæƒ³å¯ç”¨è¯¥åŠŸèƒ½ï¼Œè¯·åœ¨åœ°å€æ å†…è¾“å…¥ about:config,ç„¶åå°†é¡¹ signed.applets.codebase_principal_support å€¼è¯¥ä¸ºtrue"</span></span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> prefs = Components.classes[</span><br><span class="line">      <span class="string">"@mozilla.org/preferences-service;1"</span></span><br><span class="line">    ].getService(Components.interfaces.nsIPrefBranch);</span><br><span class="line">    prefs.setCharPref(<span class="string">"browser.startup.homepage"</span>, <span class="string">"http://w3cboy.com"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æŒ‰å­—æ¯æ’åºï¼Œå¯¹æ¯è¡Œè¿›è¡Œæ•°ç»„æ’åº"><a href="#æŒ‰å­—æ¯æ’åºï¼Œå¯¹æ¯è¡Œè¿›è¡Œæ•°ç»„æ’åº" class="headerlink" title="æŒ‰å­—æ¯æ’åºï¼Œå¯¹æ¯è¡Œè¿›è¡Œæ•°ç»„æ’åº"></a>æŒ‰å­—æ¯æ’åºï¼Œå¯¹æ¯è¡Œè¿›è¡Œæ•°ç»„æ’åº</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setSort</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> text = K1.value</span><br><span class="line">    .split(<span class="regexp">/[\r\n]/</span>)</span><br><span class="line">    .sort()</span><br><span class="line">    .join(<span class="string">"\r\n"</span>); <span class="comment">//é¡ºåº</span></span><br><span class="line">  <span class="keyword">var</span> test = K1.value</span><br><span class="line">    .split(<span class="regexp">/[\r\n]/</span>)</span><br><span class="line">    .sort()</span><br><span class="line">    .reverse()</span><br><span class="line">    .join(<span class="string">"\r\n"</span>); <span class="comment">//ååº</span></span><br><span class="line">  K1.value = K1.value != text ? text : test;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å»¶æ—¶æ‰§è¡Œ"><a href="#å»¶æ—¶æ‰§è¡Œ" class="headerlink" title="å»¶æ—¶æ‰§è¡Œ"></a>å»¶æ—¶æ‰§è¡Œ</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¯”å¦‚ sleep(1000) æ„å‘³ç€ç­‰å¾…1000æ¯«ç§’ï¼Œè¿˜å¯ä» Promiseã€Generatorã€Async/Await ç­‰è§’åº¦å®ç°ã€‚</span></span><br><span class="line"><span class="comment">// Promise</span></span><br><span class="line"><span class="keyword">const</span> sleep = <span class="function"><span class="params">time</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> setTimeout(resolve, time));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">1000</span>).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Generator</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">sleepGenerator</span>(<span class="params">time</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(resolve, time);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sleepGenerator(<span class="number">1000</span>)</span><br><span class="line">  .next()</span><br><span class="line">  .value.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//async</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params">time</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> setTimeout(resolve, time));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> out = <span class="keyword">await</span> sleep(<span class="number">1000</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params">callback, time</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> callback === <span class="string">"function"</span>) &#123;</span><br><span class="line">    setTimeout(callback, time);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sleep(output, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><h1 id="åˆ¤æ–­æ˜¯å¦ä»¥æŸä¸ªå­—ç¬¦ä¸²å¼€å¤´"><a href="#åˆ¤æ–­æ˜¯å¦ä»¥æŸä¸ªå­—ç¬¦ä¸²å¼€å¤´" class="headerlink" title="åˆ¤æ–­æ˜¯å¦ä»¥æŸä¸ªå­—ç¬¦ä¸²å¼€å¤´"></a>åˆ¤æ–­æ˜¯å¦ä»¥æŸä¸ªå­—ç¬¦ä¸²å¼€å¤´</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>.prototype.startWith = <span class="function"><span class="keyword">function</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.indexOf(s) == <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="æ¸…é™¤è„šæœ¬å†…å®¹"><a href="#æ¸…é™¤è„šæœ¬å†…å®¹" class="headerlink" title="æ¸…é™¤è„šæœ¬å†…å®¹"></a>æ¸…é™¤è„šæœ¬å†…å®¹</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stripscript</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> s.replace(<span class="regexp">/&lt;script.*?&gt;.*?&lt;\/script&gt;/gi</span>, <span class="string">""</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ—¶é—´ä¸ªæ€§åŒ–è¾“å‡ºåŠŸèƒ½"><a href="#æ—¶é—´ä¸ªæ€§åŒ–è¾“å‡ºåŠŸèƒ½" class="headerlink" title="æ—¶é—´ä¸ªæ€§åŒ–è¾“å‡ºåŠŸèƒ½"></a>æ—¶é—´ä¸ªæ€§åŒ–è¾“å‡ºåŠŸèƒ½</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1ã€&lt; 60s, æ˜¾ç¤ºä¸ºâ€œåˆšåˆšâ€</span></span><br><span class="line"><span class="comment">2ã€&gt;= 1min &amp;&amp; &lt; 60 min, æ˜¾ç¤ºä¸å½“å‰æ—¶é—´å·®â€œXXåˆ†é’Ÿå‰â€</span></span><br><span class="line"><span class="comment">3ã€&gt;= 60min &amp;&amp; &lt; 1day, æ˜¾ç¤ºä¸å½“å‰æ—¶é—´å·®â€œä»Šå¤© XX:XXâ€</span></span><br><span class="line"><span class="comment">4ã€&gt;= 1day &amp;&amp; &lt; 1year, æ˜¾ç¤ºæ—¥æœŸâ€œXXæœˆXXæ—¥ XX:XXâ€</span></span><br><span class="line"><span class="comment">5ã€&gt;= 1year, æ˜¾ç¤ºå…·ä½“æ—¥æœŸâ€œXXXXå¹´XXæœˆXXæ—¥ XX:XXâ€</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timeFormat</span>(<span class="params">time</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(time),</span><br><span class="line">    curDate = <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">    year = date.getFullYear(),</span><br><span class="line">    month = date.getMonth() + <span class="number">10</span>,</span><br><span class="line">    day = date.getDate(),</span><br><span class="line">    hour = date.getHours(),</span><br><span class="line">    minute = date.getMinutes(),</span><br><span class="line">    curYear = curDate.getFullYear(),</span><br><span class="line">    curHour = curDate.getHours(),</span><br><span class="line">    timeStr;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (year &lt; curYear) &#123;</span><br><span class="line">    timeStr = year + <span class="string">"å¹´"</span> + month + <span class="string">"æœˆ"</span> + day + <span class="string">"æ—¥ "</span> + hour + <span class="string">":"</span> + minute;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> pastTime = curDate - date,</span><br><span class="line">      pastH = pastTime / <span class="number">3600000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pastH &gt; curHour) &#123;</span><br><span class="line">      timeStr = month + <span class="string">"æœˆ"</span> + day + <span class="string">"æ—¥ "</span> + hour + <span class="string">":"</span> + minute;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pastH &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">      timeStr = <span class="string">"ä»Šå¤© "</span> + hour + <span class="string">":"</span> + minute + <span class="string">"åˆ†"</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> pastM = curDate.getMinutes() - minute;</span><br><span class="line">      <span class="keyword">if</span> (pastM &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        timeStr = pastM + <span class="string">"åˆ†é’Ÿå‰"</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        timeStr = <span class="string">"åˆšåˆš"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> timeStr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å…¨è§’è½¬æ¢ä¸ºåŠè§’å‡½æ•°"><a href="#å…¨è§’è½¬æ¢ä¸ºåŠè§’å‡½æ•°" class="headerlink" title="å…¨è§’è½¬æ¢ä¸ºåŠè§’å‡½æ•°"></a>å…¨è§’è½¬æ¢ä¸ºåŠè§’å‡½æ•°</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toCDB</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; str.length; i++) &#123;</span><br><span class="line">    code = str.charCodeAt(i);</span><br><span class="line">    <span class="keyword">if</span> (code &gt;= <span class="number">65281</span> &amp;&amp; code &lt;= <span class="number">65374</span>) &#123;</span><br><span class="line">      result += <span class="built_in">String</span>.fromCharCode(str.charCodeAt(i) - <span class="number">65248</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (code == <span class="number">12288</span>) &#123;</span><br><span class="line">      result += <span class="built_in">String</span>.fromCharCode(str.charCodeAt(i) - <span class="number">12288</span> + <span class="number">32</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      result += str.charAt(i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åŠè§’è½¬æ¢ä¸ºå…¨è§’å‡½æ•°"><a href="#åŠè§’è½¬æ¢ä¸ºå…¨è§’å‡½æ•°" class="headerlink" title="åŠè§’è½¬æ¢ä¸ºå…¨è§’å‡½æ•°"></a>åŠè§’è½¬æ¢ä¸ºå…¨è§’å‡½æ•°</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toDBC</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; str.length; i++) &#123;</span><br><span class="line">    code = str.charCodeAt(i);</span><br><span class="line">    <span class="keyword">if</span> (code &gt;= <span class="number">33</span> &amp;&amp; code &lt;= <span class="number">126</span>) &#123;</span><br><span class="line">      result += <span class="built_in">String</span>.fromCharCode(str.charCodeAt(i) + <span class="number">65248</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (code == <span class="number">32</span>) &#123;</span><br><span class="line">      result += <span class="built_in">String</span>.fromCharCode(str.charCodeAt(i) + <span class="number">12288</span> - <span class="number">32</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      result += str.charAt(i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="é‡‘é¢å¤§å†™è½¬æ¢å‡½æ•°"><a href="#é‡‘é¢å¤§å†™è½¬æ¢å‡½æ•°" class="headerlink" title="é‡‘é¢å¤§å†™è½¬æ¢å‡½æ•°"></a>é‡‘é¢å¤§å†™è½¬æ¢å‡½æ•°</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transform</span>(<span class="params">tranvalue</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> dw2 = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="string">""</span>, <span class="string">"ä¸‡"</span>, <span class="string">"äº¿"</span>); <span class="comment">//å¤§å•ä½</span></span><br><span class="line">    <span class="keyword">var</span> dw1 = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="string">"æ‹¾"</span>, <span class="string">"ä½°"</span>, <span class="string">"ä»Ÿ"</span>); <span class="comment">//å°å•ä½</span></span><br><span class="line">    <span class="keyword">var</span> dw = <span class="keyword">new</span> <span class="built_in">Array</span>(</span><br><span class="line">      <span class="string">"é›¶"</span>,</span><br><span class="line">      <span class="string">"å£¹"</span>,</span><br><span class="line">      <span class="string">"è´°"</span>,</span><br><span class="line">      <span class="string">"å"</span>,</span><br><span class="line">      <span class="string">"è‚†"</span>,</span><br><span class="line">      <span class="string">"ä¼"</span>,</span><br><span class="line">      <span class="string">"é™†"</span>,</span><br><span class="line">      <span class="string">"æŸ’"</span>,</span><br><span class="line">      <span class="string">"æŒ"</span>,</span><br><span class="line">      <span class="string">"ç–"</span></span><br><span class="line">    ); </span><br><span class="line">    <span class="comment">//æ•´æ•°éƒ¨åˆ†ç”¨</span></span><br><span class="line">    <span class="comment">//ä»¥ä¸‹æ˜¯å°å†™è½¬æ¢æˆå¤§å†™æ˜¾ç¤ºåœ¨åˆè®¡å¤§å†™çš„æ–‡æœ¬æ¡†ä¸­</span></span><br><span class="line">    <span class="comment">//åˆ†ç¦»æ•´æ•°ä¸å°æ•°</span></span><br><span class="line">    <span class="keyword">var</span> source = splits(tranvalue);</span><br><span class="line">    <span class="keyword">var</span> num = source[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> dig = source[<span class="number">1</span>];</span><br><span class="line">    <span class="comment">//è½¬æ¢æ•´æ•°éƒ¨åˆ†</span></span><br><span class="line">    <span class="keyword">var</span> k1 = <span class="number">0</span>; <span class="comment">//è®¡å°å•ä½</span></span><br><span class="line">    <span class="keyword">var</span> k2 = <span class="number">0</span>; <span class="comment">//è®¡å¤§å•ä½</span></span><br><span class="line">    <span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> str = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">var</span> len = source[<span class="number">0</span>].length; <span class="comment">//æ•´æ•°çš„é•¿åº¦</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= len; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> n = source[<span class="number">0</span>].charAt(len - i); <span class="comment">//å–å¾—æŸä¸ªä½æ•°ä¸Šçš„æ•°å­—</span></span><br><span class="line">      <span class="keyword">var</span> bn = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> (len - i - <span class="number">1</span> &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        bn = source[<span class="number">0</span>].charAt(len - i - <span class="number">1</span>); <span class="comment">//å–å¾—æŸä¸ªä½æ•°å‰ä¸€ä½ä¸Šçš„æ•°å­—</span></span><br><span class="line">      &#125;</span><br><span class="line">      sum = sum + <span class="built_in">Number</span>(n);</span><br><span class="line">      <span class="keyword">if</span> (sum != <span class="number">0</span>) &#123;</span><br><span class="line">        str = dw[<span class="built_in">Number</span>(n)].concat(str); <span class="comment">//å–å¾—è¯¥æ•°å­—å¯¹åº”çš„å¤§å†™æ•°å­—ï¼Œå¹¶æ’å…¥åˆ°strå­—ç¬¦ä¸²çš„å‰é¢</span></span><br><span class="line">        <span class="keyword">if</span> (n == <span class="string">"0"</span>) sum = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (len - i - <span class="number">1</span> &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//åœ¨æ•°å­—èŒƒå›´å†…</span></span><br><span class="line">        <span class="keyword">if</span> (k1 != <span class="number">3</span>) &#123;</span><br><span class="line">          <span class="comment">//åŠ å°å•ä½</span></span><br><span class="line">          <span class="keyword">if</span> (bn != <span class="number">0</span>) &#123;</span><br><span class="line">            str = dw1[k1].concat(str);</span><br><span class="line">          &#125;</span><br><span class="line">          k1++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">//ä¸åŠ å°å•ä½ï¼ŒåŠ å¤§å•ä½</span></span><br><span class="line">          k1 = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">var</span> temp = str.charAt(<span class="number">0</span>);</span><br><span class="line">          <span class="keyword">if</span> (temp == <span class="string">"ä¸‡"</span> || temp == <span class="string">"äº¿"</span>)</span><br><span class="line">            <span class="comment">//è‹¥å¤§å•ä½å‰æ²¡æœ‰æ•°å­—åˆ™èˆå»å¤§å•ä½</span></span><br><span class="line">            str = str.substr(<span class="number">1</span>, str.length - <span class="number">1</span>);</span><br><span class="line">          str = dw2[k2].concat(str);</span><br><span class="line">          sum = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (k1 == <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="comment">//å°å•ä½åˆ°åƒåˆ™å¤§å•ä½è¿›ä¸€</span></span><br><span class="line">        k2++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è½¬æ¢å°æ•°éƒ¨åˆ†</span></span><br><span class="line">    <span class="keyword">var</span> strdig = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">if</span> (dig != <span class="string">""</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> n = dig.charAt(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">if</span> (n != <span class="number">0</span>) &#123;</span><br><span class="line">        strdig += dw[<span class="built_in">Number</span>(n)] + <span class="string">"è§’"</span>; <span class="comment">//åŠ æ•°å­—</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">var</span> n = dig.charAt(<span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> (n != <span class="number">0</span>) &#123;</span><br><span class="line">        strdig += dw[<span class="built_in">Number</span>(n)] + <span class="string">"åˆ†"</span>; <span class="comment">//åŠ æ•°å­—</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    str += <span class="string">"å…ƒ"</span> + strdig;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"0å…ƒ"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ‹†åˆ†æ•´æ•°ä¸å°æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">splits</span>(<span class="params">tranvalue</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> value = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="string">""</span>, <span class="string">""</span>);</span><br><span class="line">  temp = tranvalue.split(<span class="string">"."</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; temp.length; i++) &#123;</span><br><span class="line">    value = temp;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ¸…é™¤ç©ºæ ¼"><a href="#æ¸…é™¤ç©ºæ ¼" class="headerlink" title="æ¸…é™¤ç©ºæ ¼"></a>æ¸…é™¤ç©ºæ ¼</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>.prototype.trim = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> reExtraSpace = <span class="regexp">/^\s*(.*?)\s+$/</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.replace(reExtraSpace, <span class="string">"$1"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¸…é™¤å·¦ç©ºæ ¼</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ltrim</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> s.replace(<span class="regexp">/^(\s*|ã€€*)/</span>, <span class="string">""</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¸…é™¤å³ç©ºæ ¼</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rtrim</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> s.replace(<span class="regexp">/(\s*|ã€€*)$/</span>, <span class="string">""</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="éšæœºæ•°æ—¶é—´æˆ³"><a href="#éšæœºæ•°æ—¶é—´æˆ³" class="headerlink" title="éšæœºæ•°æ—¶é—´æˆ³"></a>éšæœºæ•°æ—¶é—´æˆ³</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uniqueId</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="built_in">Math</span>.random,</span><br><span class="line">    b = <span class="built_in">parseInt</span>;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Date</span>()).toString() + b(<span class="number">10</span> * a()) + b(<span class="number">10</span> * a()) + b(<span class="number">10</span> * a())</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å®ç°utf8è§£ç "><a href="#å®ç°utf8è§£ç " class="headerlink" title="å®ç°utf8è§£ç "></a>å®ç°utf8è§£ç </h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">utf8_decode</span>(<span class="params">str_data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> tmp_arr = [],</span><br><span class="line">    i = <span class="number">0</span>,</span><br><span class="line">    ac = <span class="number">0</span>,</span><br><span class="line">    c1 = <span class="number">0</span>,</span><br><span class="line">    c2 = <span class="number">0</span>,</span><br><span class="line">    c3 = <span class="number">0</span>;</span><br><span class="line">  str_data += <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">while</span> (i &lt; str_data.length) &#123;</span><br><span class="line">    c1 = str_data.charCodeAt(i);</span><br><span class="line">    <span class="keyword">if</span> (c1 &lt; <span class="number">128</span>) &#123;</span><br><span class="line">      tmp_arr[ac++] = <span class="built_in">String</span>.fromCharCode(c1);</span><br><span class="line">      i++;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c1 &gt; <span class="number">191</span> &amp;&amp; c1 &lt; <span class="number">224</span>) &#123;</span><br><span class="line">      c2 = str_data.charCodeAt(i + <span class="number">1</span>);</span><br><span class="line">      tmp_arr[ac++] = <span class="built_in">String</span>.fromCharCode(((c1 &amp; <span class="number">31</span>) &lt;&lt; <span class="number">6</span>) | (c2 &amp; <span class="number">63</span>));</span><br><span class="line">      i += <span class="number">2</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      c2 = str_data.charCodeAt(i + <span class="number">1</span>);</span><br><span class="line">      c3 = str_data.charCodeAt(i + <span class="number">2</span>);</span><br><span class="line">      tmp_arr[ac++] = <span class="built_in">String</span>.fromCharCode(</span><br><span class="line">        ((c1 &amp; <span class="number">15</span>) &lt;&lt; <span class="number">12</span>) | ((c2 &amp; <span class="number">63</span>) &lt;&lt; <span class="number">6</span>) | (c3 &amp; <span class="number">63</span>)</span><br><span class="line">      );</span><br><span class="line">      i += <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> tmp_arr.join(<span class="string">""</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://mp.weixin.qq.com/s?__biz=MzUzOTM0MTE4OQ==&amp;mid=2247485899&amp;idx=1&amp;sn=de526f7f1d2ff1b42b90acc196937845&amp;chksm=fac8b121cdbf3837823eb0be690995448c15712144784a13c08c2eca04a35bc74145d4e51563&amp;mpshare=1&amp;scene=1&amp;srcid=0702WArToY4Zf2DneCeKOUoB&amp;sharer_sharetime=1590937398297&amp;sharer_shareid=3513f92f23030a0a67fb38005d1b6a29&amp;key=5a8ad89db03556ba46925cff95d066a2df5a1d5e094bc547591a271e87a02b52912188eb823da168e5f8a53a67a9ebec0966381c3f733daff7ddbe868b913ff526fb7116394abe7ebaebfe29d620fc81&amp;ascene=1&amp;uin=MjU3MDI1Njk0MA%3D%3D&amp;devicetype=Windows+10+x64&amp;version=62090070&amp;lang=zh_CN&amp;exportkey=AYuk7Hyn2g9m%2F3%2FguTy9qU4%3D&amp;pass_ticket=tlYkCwsVMifHd%2B0aIDak4asRIQAnO44krb6gL09ZBy8PXxCTYCFw6N1GoCZ9j5uG" target="_blank" rel="noopener">JSå¸¸ç”¨å¼€å‘å·¥å…·å‡½æ•°</a></p><p><a href="https://github.com/Wscats/CV/issues/27" target="_blank" rel="noopener">https://github.com/Wscats/CV/issues/27</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æŠ„å½•ä¸€äº›JavaScriptå·¥å…·å‡½æ•°å¤§å…¨&lt;br&gt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://hackycy.github.io/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="http://hackycy.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>è§£å†³Githubç½‘é¡µä¸Šå›¾ç‰‡æ˜¾ç¤ºå¤±è´¥é—®é¢˜</title>
    <link href="http://hackycy.github.io/2020/05/29/%E8%A7%A3%E5%86%B3Github%E7%BD%91%E9%A1%B5%E4%B8%8A%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98/"/>
    <id>http://hackycy.github.io/2020/05/29/è§£å†³Githubç½‘é¡µä¸Šå›¾ç‰‡æ˜¾ç¤ºå¤±è´¥é—®é¢˜/</id>
    <published>2020-05-29T16:04:10.000Z</published>
    <updated>2020-06-04T06:12:49.380Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><p>æœ€è¿‘ç§‘å­¦ä¸Šç½‘å¤±æ•ˆçš„æœ‰äº›é¢‘ç¹ï¼Œä¸ŠGithubçš„æ—¶å€™å›¾ç‰‡æ€»æ˜¯åŠ è½½ä¸å‡ºæ¥ï¼Œä¹‹å‰æ²¡æœ‰åœ¨æ„ï¼Œä½†æ˜¯è‡ªå·±åšå®¢ä¸­çš„å›¾ç‰‡ä¹Ÿæ˜¯ä¾èµ–Githubçš„æ—¶å€™å°±ç•™æ„åˆ°äº†è¿™ä¸ªé—®é¢˜ã€‚<strong>ï¼ˆå¦‚æœæœ‰ç§‘å­¦ä¸Šç½‘è¯·éšæ„ï¼‰</strong></p><a id="more"></a><p><img src="https://github.static.si-yee.com/posts/SolvetheproblemofimagedisplayfailureonGitHubwebpage/20200604140631.png" alt></p><p>ä¸»è¦æŠ¥é”™æ˜¯<code>Failed to load resource: net::ERR_CERT_COMMON_NAME_INVALID</code>ä»¥åŠ<code>Failed to load resource: net::ERR_CONNECTION_RESET</code></p><p><strong>æ¥è‡ªç½‘å‹çš„è§£é‡Šï¼š</strong></p><p>å®é™…ä¸Šï¼Œå¯ä»¥è®¤ä¸ºï¼Œ<code>ERR_CERT_COMMON_NAME_INVALID</code>å°±æ˜¯ç”¨ä¸€ä¸ªé”™è¯¯çš„åŸŸåè®¿é—®äº†æŸä¸ªèŠ‚ç‚¹çš„<code>https</code>èµ„æºã€‚å¯¼è‡´è¿™ä¸ªé”™è¯¯çš„åŸå› ï¼ŒåŸºæœ¬æ˜¯ï¼š</p><ol><li>dnsæ±¡æŸ“</li><li>hostè®¾ç½®é”™è¯¯</li><li>å®˜æ–¹æ›´æ–°äº†dnsï¼Œä½†æ˜¯dnsç¼“å­˜æ²¡æœ‰è¢«æ›´æ–°ï¼Œå¯¼è‡´é”™è¯¯è§£æã€‚</li></ol><h1 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h1><h2 id="æ–¹æ¡ˆä¸€"><a href="#æ–¹æ¡ˆä¸€" class="headerlink" title="æ–¹æ¡ˆä¸€"></a>æ–¹æ¡ˆä¸€</h2><p>æ‰“å¼€<code>github</code>ä»»æ„æœªæ˜¾ç¤ºå›¾ç‰‡çš„ç½‘é¡µï¼Œä½¿ç”¨å…ƒç´ é€‰æ‹©å™¨ï¼ˆ<code>Ctrl+Shift+C</code>ï¼‰æ”¾åœ¨æ˜¾ç¤ºä¸äº†çš„å›¾ç‰‡ä¸Šï¼Œæˆ–è€…åœ¨æ— æ³•æ˜¾ç¤ºçš„å›¾ç‰‡ä¸Šå³é”®-æ£€æŸ¥å…ƒç´ ï¼Œå®šä½åˆ°è¯¥å›¾ç‰‡çš„æ ‡ç­¾ï¼Œé‚£ä¹ˆä½ å¾—åˆ°äº†å®ƒçš„URLï¼Œå«åš<code>src</code>å±æ€§ã€‚</p><p><img src="https://github.static.si-yee.com/posts/SolvetheproblemofimagedisplayfailureonGitHubwebpage/20200604140727.png" alt></p><p>å°†URLå¤åˆ¶å‡ºæ¥åï¼Œæ‰“å¼€<a href="https://www.ipaddress.com/" target="_blank" rel="noopener">IPAddress.com</a>è¿™ä¸ªç½‘ç«™ï¼Œæœç´¢å®ƒçš„åŸŸå:<code>avatars2.githubusercontent.com</code></p><p><img src="https://github.static.si-yee.com/posts/SolvetheproblemofimagedisplayfailureonGitHubwebpage/20200604140757.png" alt></p><p>æœç´¢åä¼šçœ‹åˆ°è¯¥åŸŸåçš„ä¿¡æ¯å’Œ<code>IP</code>åœ°å€ï¼š</p><p><img src="https://github.static.si-yee.com/posts/SolvetheproblemofimagedisplayfailureonGitHubwebpage/20200604140836.png" alt></p><p>å½“å‰è¯¥åŸŸåçš„IPæ˜¯ï¼š199.232.68.133ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿è¿™ä¸ª<strong>IP</strong>å’Œ<strong>åŸŸå</strong>æ˜ å°„èµ·æ¥ã€‚</p><p><strong>ä¿®æ”¹hosts</strong></p><p>Windowä¸‹è·¯å¾„<code>C:\Windows\System32\drivers\etc\hosts</code></p><p>Macã€Linuxä¸‹è·¯å¾„<code>/etc/hosts</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># GitHub Start </span><br><span class="line">140.82.113.3      github.com</span><br><span class="line">140.82.114.20     gist.github.com</span><br><span class="line"></span><br><span class="line">151.101.184.133    assets-cdn.github.com</span><br><span class="line">151.101.184.133    raw.githubusercontent.com</span><br><span class="line">151.101.184.133    gist.githubusercontent.com</span><br><span class="line">151.101.184.133    cloud.githubusercontent.com</span><br><span class="line">151.101.184.133    camo.githubusercontent.com</span><br><span class="line">151.101.184.133    avatars0.githubusercontent.com</span><br><span class="line">199.232.68.133     avatars0.githubusercontent.com</span><br><span class="line">199.232.28.133     avatars1.githubusercontent.com</span><br><span class="line">151.101.184.133    avatars1.githubusercontent.com</span><br><span class="line">151.101.184.133    avatars2.githubusercontent.com</span><br><span class="line">199.232.28.133     avatars2.githubusercontent.com</span><br><span class="line">151.101.184.133    avatars3.githubusercontent.com</span><br><span class="line">199.232.68.133     avatars3.githubusercontent.com</span><br><span class="line">151.101.184.133    avatars4.githubusercontent.com</span><br><span class="line">199.232.68.133     avatars4.githubusercontent.com</span><br><span class="line">151.101.184.133    avatars5.githubusercontent.com</span><br><span class="line">199.232.68.133     avatars5.githubusercontent.com</span><br><span class="line">151.101.184.133    avatars6.githubusercontent.com</span><br><span class="line">199.232.68.133     avatars6.githubusercontent.com</span><br><span class="line">151.101.184.133    avatars7.githubusercontent.com</span><br><span class="line">199.232.68.133     avatars7.githubusercontent.com</span><br><span class="line">151.101.184.133    avatars8.githubusercontent.com</span><br><span class="line">199.232.68.133     avatars8.githubusercontent.com</span><br><span class="line"></span><br><span class="line"># GitHub End</span><br></pre></td></tr></table></figure><p>ä¿å­˜å³å¯ï¼Œ<strong>è¯¥æ–‡ä»¶éšæ—¶å¯èƒ½å˜æ›´ï¼Œè¯·éšæ—¶è‡ªè¡Œæ›´æ–°</strong></p><blockquote><p>windowä¸‹æ— æ³•ä¿å­˜ï¼Œæ²¡æœ‰ä¿®æ”¹æƒé™ï¼Œé¼ æ ‡å³é”®-å±æ€§-å®‰å…¨-ä¿®æ”¹æƒé™ï¼›æˆ–å°†<code>hosts</code>æ–‡ä»¶å¤åˆ¶ä¸€ä»½ï¼Œä¿®æ”¹ä¹‹åï¼Œå¤åˆ¶åˆ°åŸæ–‡ä»¶å¤¹æ›¿æ¢ï¼</p></blockquote><h2 id="æ–¹æ¡ˆäºŒ"><a href="#æ–¹æ¡ˆäºŒ" class="headerlink" title="æ–¹æ¡ˆäºŒ"></a>æ–¹æ¡ˆäºŒ</h2><p><strong>Windowç³»ç»Ÿä¸‹</strong></p><p>è¿˜å¯ä»¥ä½¿ç”¨<code>ipconfig/flush</code>å¯¹æœ¬åœ°DNSç¼“å­˜è¿›è¡Œä¸€æ¬¡åˆ·æ–°ï¼Œå¦‚æœé‡åˆ°ç½‘ç»œå¼‚å¸¸ï¼Œå¯èƒ½æ˜¯DNSç¼“å­˜çš„é—®é¢˜ï¼Œåˆ·æ–°ä¸€ä¸‹ï¼Œæ­¥éª¤ã€‚</p><p>windowså¼€å§‹â†’è¿è¡Œâ†’è¾“å…¥ï¼šCMD æŒ‰å›è½¦é”®ï¼Œæ‰“å¼€å‘½ä»¤æç¤ºç¬¦çª—å£ã€‚<br>å†è¾“å…¥ï¼š <code>ipconfig /flushdns</code> å›è½¦ï¼Œæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥é‡å»ºæœ¬åœ°DNSç¼“å­˜ã€‚</p><p><strong>Macç³»ç»Ÿä¸‹</strong></p><p>OS X Mountain Lion or Lion</p><p>Use the following Terminal command to reset the DNS cache:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo killall -HUP mDNSResponder</span><br></pre></td></tr></table></figure><p>Mac OS X v10.6</p><p>Use the following Terminal command to reset the DNS cache:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dscacheutil -flushcache</span><br></pre></td></tr></table></figure><p>mac Mojave</p><p>æ¬è¿fromï¼š<a href="https://link.zhihu.com/?target=https%3A//www.hongkiat.com/blog/how-to-clear-dns-cache-in-macos-mojave/" target="_blank" rel="noopener">https://www.hongkiat.com/blog/how-to-clear-dns-cache-in-macos-mojave/</a></p><ol><li>æ‰“å¼€ç»ˆç«¯ï¼šlaunchpadé‡Œé¢çš„â€œç»ˆç«¯â€</li><li>è¾“å…¥ï¼šsudo killall -HUP mDNSResponder; sleep 2; ç„¶åæ•²å›è½¦ï¼›</li><li>è¾“å…¥å¯†ç ï¼›ç„¶åæ•²å›è½¦</li><li>command+Qé€€å‡ºï¼Œå°±å¥½å•¦</li></ol><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://www.zhihu.com/question/19679715" target="_blank" rel="noopener">https://www.zhihu.com/question/19679715</a></p><p><a href="https://www.ipaddress.com/" target="_blank" rel="noopener">https://www.ipaddress.com/</a></p><p><a href="https://www.jianshu.com/p/30e2703a5647" target="_blank" rel="noopener">https://www.jianshu.com/p/30e2703a5647</a></p><p><a href="https://blog.csdn.net/qq_38232598/article/details/91346392" target="_blank" rel="noopener">https://blog.csdn.net/qq_38232598/article/details/91346392</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;é—®é¢˜&quot;&gt;&lt;a href=&quot;#é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜&quot;&gt;&lt;/a&gt;é—®é¢˜&lt;/h1&gt;&lt;p&gt;æœ€è¿‘ç§‘å­¦ä¸Šç½‘å¤±æ•ˆçš„æœ‰äº›é¢‘ç¹ï¼Œä¸ŠGithubçš„æ—¶å€™å›¾ç‰‡æ€»æ˜¯åŠ è½½ä¸å‡ºæ¥ï¼Œä¹‹å‰æ²¡æœ‰åœ¨æ„ï¼Œä½†æ˜¯è‡ªå·±åšå®¢ä¸­çš„å›¾ç‰‡ä¹Ÿæ˜¯ä¾èµ–Githubçš„æ—¶å€™å°±ç•™æ„åˆ°äº†è¿™ä¸ªé—®é¢˜ã€‚&lt;strong&gt;ï¼ˆå¦‚æœæœ‰ç§‘å­¦ä¸Šç½‘è¯·éšæ„ï¼‰&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ç¨‹åºäººç”Ÿ" scheme="http://hackycy.github.io/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/"/>
    
    
      <category term="github" scheme="http://hackycy.github.io/tags/github/"/>
    
  </entry>
  
  <entry>
    <title>Eggjså®ç°æ–‡ä»¶ä¸‹è½½</title>
    <link href="http://hackycy.github.io/2020/05/28/Eggjs%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/"/>
    <id>http://hackycy.github.io/2020/05/28/Eggjså®ç°æ–‡ä»¶ä¸‹è½½/</id>
    <published>2020-05-28T11:47:55.000Z</published>
    <updated>2020-06-04T06:12:48.932Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨æœ€è¿‘çš„ç¼–å†™çš„ä¸€ä¸ªä¸ªäººçš„å·¥å…·ç«™ç‚¹ä¸­æƒ³å®ç°ä¸€ä¸ªç½‘ç«™æäº¤æ•°æ®åæŠŠç‰¹å®šæ–‡ä»¶å‹ç¼©æ‰“åŒ…åæµè§ˆå™¨å‡ºç°ä¸‹è½½çš„åŠŸèƒ½ã€‚æ‰¾çš„èµ„æ–™å®ç°ä¹Ÿæ®‹ç¼ºä¸å…¨ã€‚æ‰€ä»¥è®°å½•ä¸€ä¸‹ç›®å‰èƒ½å®ç°çš„æ–¹æ¡ˆã€‚</p><a id="more"></a><p>ä½¿ç”¨åˆ°çš„æ¡†æ¶ï¼š<a href="https://stuk.github.io/jszip/" target="_blank" rel="noopener">EggJS</a>ã€<a href="https://eggjs.org/zh-cn/" target="_blank" rel="noopener">JSZip</a>ã€‚</p><h1 id="ç¼–å†™è·¯ç”±"><a href="#ç¼–å†™è·¯ç”±" class="headerlink" title="ç¼–å†™è·¯ç”±"></a>ç¼–å†™è·¯ç”±</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @param &#123;Egg.Application&#125; app - egg application</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; router, controller &#125; = app;</span><br><span class="line">  router.get(<span class="string">'/'</span>, controller.home.index);</span><br><span class="line">  router.get(<span class="string">'/download'</span>, controller.home.deal);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="ç¼–å†™æ§åˆ¶å™¨"><a href="#ç¼–å†™æ§åˆ¶å™¨" class="headerlink" title="ç¼–å†™æ§åˆ¶å™¨"></a>ç¼–å†™æ§åˆ¶å™¨</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> jszip = <span class="built_in">require</span>(<span class="string">'jszip'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Controller = <span class="built_in">require</span>(<span class="string">'egg'</span>).Controller;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é¦–é¡µ</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> index() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx &#125; = <span class="keyword">this</span>;</span><br><span class="line">    ctx.response.type = <span class="string">'html'</span>;</span><br><span class="line">    ctx.body = fs.readFileSync(path.resolve(__dirname, <span class="string">'../view/home.html'</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å¤„ç†æ•°æ®</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> deal() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx &#125; = <span class="keyword">this</span>;</span><br><span class="line">    <span class="comment">// å¤„ç†public Path</span></span><br><span class="line">    <span class="keyword">const</span> dirPath = path.resolve(__dirname, <span class="string">`../public`</span>);</span><br><span class="line">    <span class="keyword">if</span> (!fs.existsSync(dirPath)) &#123;</span><br><span class="line">      fs.mkdirSync(dirPath);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‰“åŒ…åˆ°egg-staticçš„ç›®å½•ä¸‹ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ç›®å½•ï¼Œæœ‰å†™å…¥æƒé™æ–‡ä»¶ç›®å½•å³å¯ï¼Œåç»­è¯»å–</span></span><br><span class="line">    <span class="keyword">const</span> zip = <span class="keyword">new</span> jszip();</span><br><span class="line">    zip.file(<span class="string">'test.txt'</span>, <span class="string">'detail'</span>);</span><br><span class="line">    zip.folder(<span class="string">'img'</span>);</span><br><span class="line">    <span class="keyword">const</span> content = <span class="keyword">await</span> zip.generateAsync(&#123; <span class="attr">type</span>: <span class="string">'nodebuffer'</span> &#125;);</span><br><span class="line">    <span class="keyword">const</span> zipPath = <span class="string">`<span class="subst">$&#123;dirPath&#125;</span>/download.zip`</span>;</span><br><span class="line">    fs.writeFileSync(zipPath, content);</span><br><span class="line">    <span class="comment">// è¿”å›</span></span><br><span class="line">    <span class="keyword">const</span> stats = fs.statSync(zipPath, &#123;</span><br><span class="line">      encoding: <span class="string">'utf8'</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    ctx.response.set(&#123;</span><br><span class="line">      <span class="string">'Content-Type'</span>: <span class="string">'application/octet-stream'</span>,</span><br><span class="line">      <span class="string">'Content-Disposition'</span>: <span class="string">`attachment; filename=download.zip`</span>,</span><br><span class="line">      <span class="string">'Content-Length'</span>: stats.size,</span><br><span class="line">    &#125;);</span><br><span class="line">    ctx.body = fs.createReadStream(zipPath);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = HomeController;</span><br></pre></td></tr></table></figure><blockquote><p>é¦–é¡µç›´æ¥ä½¿ç”¨æ–‡ä»¶æµæ¥æ¸²æŸ“ä¸€ä¸ªç½‘é¡µã€‚ä¸ä½¿ç”¨nunjucksç­‰æ¨¡æ¿æ¸²æŸ“æ–¹å¼ã€‚</p><p>dealæ–¹æ³•ä¸­æ‰æ˜¯å¤„ç†ä¸‹è½½æ–‡ä»¶çš„é‡ç‚¹ã€‚</p><p>è·³è½¬åˆ°/downloadè·¯å¾„æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½download.zipçš„å‹ç¼©åŒ…ã€‚è§£å‹åä¼šæœ‰ä¸€ä¸ªtest.txtæ–‡ä»¶å’Œä¸€ä¸ªimgçš„ç›®å½•ã€‚</p></blockquote><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://github.com/eggjs/egg/issues/948" target="_blank" rel="noopener">https://github.com/eggjs/egg/issues/948</a></p><p><a href="https://www.jianshu.com/p/2689a38cf643" target="_blank" rel="noopener">https://www.jianshu.com/p/2689a38cf643</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨æœ€è¿‘çš„ç¼–å†™çš„ä¸€ä¸ªä¸ªäººçš„å·¥å…·ç«™ç‚¹ä¸­æƒ³å®ç°ä¸€ä¸ªç½‘ç«™æäº¤æ•°æ®åæŠŠç‰¹å®šæ–‡ä»¶å‹ç¼©æ‰“åŒ…åæµè§ˆå™¨å‡ºç°ä¸‹è½½çš„åŠŸèƒ½ã€‚æ‰¾çš„èµ„æ–™å®ç°ä¹Ÿæ®‹ç¼ºä¸å…¨ã€‚æ‰€ä»¥è®°å½•ä¸€ä¸‹ç›®å‰èƒ½å®ç°çš„æ–¹æ¡ˆã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Nodejs" scheme="http://hackycy.github.io/categories/Nodejs/"/>
    
    
      <category term="Nodejs" scheme="http://hackycy.github.io/tags/Nodejs/"/>
    
      <category term="Egg" scheme="http://hackycy.github.io/tags/Egg/"/>
    
  </entry>
  
  <entry>
    <title>Github Action è‡ªåŠ¨åŒ–éƒ¨ç½²Hexo</title>
    <link href="http://hackycy.github.io/2020/05/26/Github-Action-%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2Hexo/"/>
    <id>http://hackycy.github.io/2020/05/26/Github-Action-è‡ªåŠ¨åŒ–éƒ¨ç½²Hexo/</id>
    <published>2020-05-26T13:51:33.000Z</published>
    <updated>2020-06-04T06:12:48.932Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯Github-Action"><a href="#ä»€ä¹ˆæ˜¯Github-Action" class="headerlink" title="ä»€ä¹ˆæ˜¯Github Action"></a>ä»€ä¹ˆæ˜¯Github Action</h1><p><code>Github Actions</code>æ˜¯<code>Github</code>æ¨å‡ºçš„ä¸€ä¸ªæ–°çš„åŠŸèƒ½ï¼Œå¯ä»¥ä¸ºæˆ‘ä»¬çš„é¡¹ç›®è‡ªåŠ¨åŒ–åœ°æ„å»ºå·¥ä½œæµï¼Œä¾‹å¦‚ä»£ç æ£€æŸ¥ï¼Œè‡ªåŠ¨åŒ–æ‰“åŒ…ï¼Œæµ‹è¯•ï¼Œå‘å¸ƒç‰ˆæœ¬ç­‰ç­‰ã€‚å…¥å£åœ¨é¡¹ç›®<code>pull request</code>çš„æ—è¾¹ã€‚</p><p>ä¸€æ¬¡æ— æ„ä¸­æŸ¥çœ‹åˆ°é˜®ä¸€å³°å¤§ç¥åšå®¢ä¸­æåˆ°çš„Github Actionï¼Œå¹³å¸¸ä¸€èˆ¬ç©è¿‡çš„æ˜¯Jenkinsã€‚çœ‹åˆ°å¯ä»¥å°†Reacté¡¹ç›®è‡ªåŠ¨éƒ¨ç½²åˆ°Github Pageæ—¶ï¼Œçµæ„Ÿå°±æƒ³åˆ°äº†è‡ªå·±çš„åŸºäºHexoæ­å»ºçš„åšå®¢æ¥å®ç°ä¸€ä¸‹è‡ªåŠ¨éƒ¨ç½²ã€‚æŸ¥äº†ä¸€ä¸‹èµ„æ–™ï¼Œçš„ç¡®å¯ä»¥å®ç°çš„ã€‚</p><a id="more"></a><blockquote><p>è¯¥æ–‡ç« ä¸æ¶‰åŠGithub Actionä»¥åŠHexoçš„æ•™å­¦ã€‚è¯·è‡ªè¡ŒæŸ¥é˜…</p></blockquote><h1 id="éƒ¨ç½²å‰å‡†å¤‡"><a href="#éƒ¨ç½²å‰å‡†å¤‡" class="headerlink" title="éƒ¨ç½²å‰å‡†å¤‡"></a>éƒ¨ç½²å‰å‡†å¤‡</h1><p>å…ˆå‡†å¤‡ä¸¤ä¸ªä»“åº“ï¼Œä¸€ä¸ªæ˜¯éƒ¨ç½²åšå®¢æ‰€äº§å‡ºé™æ€é¡µé¢ï¼ˆgithub pageï¼‰çš„ä»“åº“ï¼Œä¸€ä¸ªæ˜¯åšå®¢æ‰€æœ‰æºæ–‡ä»¶çš„ä»“åº“</p><p>åœ¨æœ¬åœ°ç”Ÿæˆä¸€ä¸ª keyï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -b 4096 -C <span class="string">"your email"</span> -f ~/.ssh/github-actions-deploy</span><br></pre></td></tr></table></figure><blockquote><p>ï¼ˆä¹Ÿå¯ä»¥ç”Ÿæˆå…¶ä»–ç§ç±»çš„ keyï¼Œå¦‚æœç”¨ä¸Šé¢çš„å‘½ä»¤ï¼Œéœ€è¦ä¿®æ”¹ä¸€ä¸‹ç”¨æˆ·åï¼‰ å›è½¦å®Œæˆå³å¯</p></blockquote><p>æŸ¥çœ‹ç§é’¥å’Œå…¬é’¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/.ssh</span><br><span class="line">$ cat github-actions-deploy</span><br><span class="line">$ cat github-actions-deploy.pub</span><br></pre></td></tr></table></figure><p>åœ¨åšå®¢æ‰€æœ‰æºæ–‡ä»¶çš„ä»“åº“<strong>Settings -&gt; Secrets</strong> é‡Œæ·»åŠ åˆšåˆšç”Ÿæˆçš„ç§é’¥ï¼Œåç§°ä¸º <code>ACTION_DEPLOY_KEY</code>ã€‚</p><p>ç„¶ååœ¨ Github Pages çš„ä»“åº“ï¼Œ<strong>Settings -&gt; Deploy keys</strong> æ·»åŠ åˆšåˆšç”Ÿæˆçš„å…¬é’¥ï¼Œåç§°éšæ„ï¼Œä½†è¦å‹¾é€‰ <strong>Allow write access</strong>ã€‚</p><p><img src="https://github.static.si-yee.com/posts/Github Action è‡ªåŠ¨åŒ–éƒ¨ç½²Hexo-20200604134453.png" alt></p><h1 id="æ·»åŠ Github-Action"><a href="#æ·»åŠ Github-Action" class="headerlink" title="æ·»åŠ Github Action"></a>æ·»åŠ Github Action</h1><p>å¯ä»¥åœ¨ç½‘é¡µä¸Š <strong>Actions</strong> é‡Œç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨æºæ–‡ä»¶çš„ä»“åº“çš„æœ¬åœ°ç›®å½•æ·»åŠ ç›´æ¥ commitã€‚</p><p>æœ¬æ–‡ç›´æ¥åœ¨æºæ–‡ä»¶çš„ä»“åº“çš„æœ¬åœ°ç›®å½•æäº¤é…ç½®æ–‡ä»¶ï¼Œå°†é…ç½®æ–‡ä»¶å­˜è‡³åŸæ–‡ä»¶ä»“åº“ç›®å½•ä¸‹çš„ <code>.github/workflows/*éšä¾¿èµ·å*.yml</code>ã€‚</p><p>è„šæœ¬é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span>    </span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Build</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Node</span> </span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">'10.x'</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">prepare</span> <span class="string">build</span> <span class="string">env</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">ACTION_DEPLOY_KEY:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.ACTION_DEPLOY_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="comment"># set up private key for deploy</span></span><br><span class="line">          <span class="string">mkdir</span> <span class="string">-p</span> <span class="string">~/.ssh/</span></span><br><span class="line">          <span class="string">echo</span> <span class="string">"$ACTION_DEPLOY_KEY"</span> <span class="string">|</span> <span class="string">tr</span> <span class="string">-d</span> <span class="string">'\r'</span> <span class="string">&gt;</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line">          <span class="string">chmod</span> <span class="number">600</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line">          <span class="string">ssh-keyscan</span> <span class="string">github.com</span> <span class="string">&gt;&gt;</span> <span class="string">~/.ssh/known_hosts</span></span><br><span class="line">          <span class="comment"># set git infomation</span></span><br><span class="line">          <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.name</span> <span class="string">'hackycy'</span></span><br><span class="line">          <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.email</span> <span class="string">'qa894178522@qq.com'</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">clone</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">git</span> <span class="string">clone</span> <span class="string">https://github.com/hackycy/hackycy.github.io.git</span> <span class="string">.deploy_git</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NPM</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Clean</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">./node_modules/.bin/hexo</span> <span class="string">clean</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Generate</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">./node_modules/.bin/hexo</span> <span class="string">generate</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">./node_modules/.bin/hexo</span> <span class="string">deploy</span></span><br></pre></td></tr></table></figure><div class="note info"><p><strong>å¯¹è¿™ä¸ªé…ç½®æ–‡ä»¶åšå‡ ç‚¹è¯´æ˜ï¼š</strong></p><ol><li>Actions åœ¨æ—©æœŸæµ‹è¯•æ—¶ç”¨çš„æ˜¯ HCL æ ¼å¼ï¼Œè€Œç°åœ¨ä½¿ç”¨ YAML é…ç½®ï¼ŒHCL æ ¼å¼é…ç½®æ–‡ä»¶å·²è¢«åºŸå¼ƒã€‚YAML æ ¼å¼éœ€è¦ä¸¥æ ¼æŒ‰ç…§ç¼©è¿›ã€‚</li><li><code>on</code> æ ‡æ³¨ä»€ä¹ˆäº‹ä»¶ä¼šè§¦å‘è¿™ä¸ª workflowï¼Œå¯ä»¥æŒ‡å®š branchesï¼Œè¯¦æƒ…å‚è€ƒ<a href="https://help.github.com/en/articles/events-that-trigger-workflows" target="_blank" rel="noopener">æ–‡æ¡£</a>ã€‚</li><li><code>runs-on</code> è®¾ç½®è¿è¡Œå¹³å°ï¼Œç›®å‰æœ‰ Windowsã€Ubuntuã€macOSï¼Œè§<a href="https://help.github.com/en/articles/virtual-environments-for-github-actions" target="_blank" rel="noopener">æ–‡æ¡£</a>ã€‚</li><li><code>uses</code> æ˜¯ä½¿ç”¨æ‰“åŒ…å¥½çš„ actionï¼Œå¯ä»¥é€šè¿‡ <code>with</code> ä¼ å‚æ•°ã€‚å®˜æ–¹æä¾›äº†ä¸€äº› Git åŸºæœ¬æ“ä½œå’Œç¯å¢ƒå®‰è£…çš„åŒ…ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Dockerã€‚</li><li><code>env</code> å¯ä»¥è®¾ç½®è¿™ä¸€æ­¥çš„ç¯å¢ƒå˜é‡ï¼Œè¿™ä¸€æ­¥è®¾ç½®çš„å˜é‡ä¸ä¼šç»§æ‰¿åˆ°ä¸‹ä¸€æ­¥ã€‚åˆšæ‰è®¾ç½®çš„ç§é’¥å¯ä»¥é€šè¿‡ <code>$</code> è·å–åˆ°ï¼Œå…·ä½“è§<a href="https://help.github.com/en/articles/virtual-environments-for-github-actions" target="_blank" rel="noopener">æ–‡æ¡£</a>ã€‚å¦å¤–ç›´æ¥å°†å¯†é’¥ echo å‡ºæ¥ä¼šè¢«æ‰“ç  :)</li><li>åœ¨ç½‘é¡µä¸Šä¿å­˜ç§é’¥å¾ˆå¯èƒ½ä¼šæŠŠ key å­˜æˆ CR-LF æ¢è¡Œæ¨¡å¼çš„ï¼Œè€Œç§é’¥æ–‡ä»¶è¦æ±‚ LF æ¨¡å¼ï¼Œè¦ç”¨ <code>tr -d &#39;\r&#39;</code> å»æ‰å›è½¦ç¬¦ã€‚</li><li>Git é…ç½®è¯·æ›´æ”¹ä¸ºè‡ªå·±çš„ã€‚</li><li>ç”±äºæˆ‘çš„åšå®¢æºä»“åº“é…ç½®äº†Submoduleï¼Œå¦‚æœæ²¡æœ‰é…ç½®çš„è¯·ç›´æ¥åˆ é™¤step nameä¸ºcloneçš„æ­¥éª¤</li></ol></div><h1 id="è‡ªåŠ¨æ„å»º"><a href="#è‡ªåŠ¨æ„å»º" class="headerlink" title="è‡ªåŠ¨æ„å»º"></a>è‡ªåŠ¨æ„å»º</h1><p>æ¯å½“ä½ å†™å®Œåšå®¢æ˜¯ç›´æ¥æäº¤åˆ°æºä»“åº“å³å¯è‡ªåŠ¨è§¦å‘æ„å»ºã€‚ä¼šé…åˆActionè‡ªåŠ¨å‘å¸ƒåˆ°Github Pageä»“åº“ã€‚</p><p><img src="https://github.static.si-yee.com/posts/Github Action è‡ªåŠ¨åŒ–éƒ¨ç½²Hexo-20200604134653.png" alt></p><h1 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h1><p>å¦‚æœåšå®¢ä¸­é…ç½®äº†ä¸»é¢˜ï¼Œè¯·æ³¨é‡Šæ‰ä¸»é¢˜ä¸‹çš„.gitignoreçš„ä¸€äº›é…ç½®ï¼Œä¾‹å¦‚æœ¬äººä½¿ç”¨çš„Nextä¸»é¢˜</p><p><img src="https://github.static.si-yee.com/posts/Github Action è‡ªåŠ¨åŒ–éƒ¨ç½²Hexo-20200604134730.png" alt></p><p>ä»¥åŠé…åˆä¸»é¢˜å®‰è£…çš„ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œæœ‰ä¸€äº›æ’ä»¶é€šè¿‡Git cloneå®‰è£…æ—¶ä¸ä¼šä¸Šä¼ åˆ°æºæ–‡ä»¶ä»“åº“ï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤æ‰æ’ä»¶ç›®å½•ä¸‹çš„.gitæ–‡ä»¶å¤¹ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html</a></p><p><a href="https://xiaopc.org/2019/08/29/github-actions-æµ‹è¯•-è‡ªåŠ¨éƒ¨ç½²-hexo/" target="_blank" rel="noopener">https://xiaopc.org/2019/08/29/github-actions-%E6%B5%8B%E8%AF%95-%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2-hexo/</a></p><p><a href="https://hateonion.me/posts/20feb22/" target="_blank" rel="noopener">https://hateonion.me/posts/20feb22/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ä»€ä¹ˆæ˜¯Github-Action&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯Github-Action&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯Github Action&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯Github Action&lt;/h1&gt;&lt;p&gt;&lt;code&gt;Github Actions&lt;/code&gt;æ˜¯&lt;code&gt;Github&lt;/code&gt;æ¨å‡ºçš„ä¸€ä¸ªæ–°çš„åŠŸèƒ½ï¼Œå¯ä»¥ä¸ºæˆ‘ä»¬çš„é¡¹ç›®è‡ªåŠ¨åŒ–åœ°æ„å»ºå·¥ä½œæµï¼Œä¾‹å¦‚ä»£ç æ£€æŸ¥ï¼Œè‡ªåŠ¨åŒ–æ‰“åŒ…ï¼Œæµ‹è¯•ï¼Œå‘å¸ƒç‰ˆæœ¬ç­‰ç­‰ã€‚å…¥å£åœ¨é¡¹ç›®&lt;code&gt;pull request&lt;/code&gt;çš„æ—è¾¹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ¬¡æ— æ„ä¸­æŸ¥çœ‹åˆ°é˜®ä¸€å³°å¤§ç¥åšå®¢ä¸­æåˆ°çš„Github Actionï¼Œå¹³å¸¸ä¸€èˆ¬ç©è¿‡çš„æ˜¯Jenkinsã€‚çœ‹åˆ°å¯ä»¥å°†Reacté¡¹ç›®è‡ªåŠ¨éƒ¨ç½²åˆ°Github Pageæ—¶ï¼Œçµæ„Ÿå°±æƒ³åˆ°äº†è‡ªå·±çš„åŸºäºHexoæ­å»ºçš„åšå®¢æ¥å®ç°ä¸€ä¸‹è‡ªåŠ¨éƒ¨ç½²ã€‚æŸ¥äº†ä¸€ä¸‹èµ„æ–™ï¼Œçš„ç¡®å¯ä»¥å®ç°çš„ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Github Action" scheme="http://hackycy.github.io/categories/Github-Action/"/>
    
    
      <category term="Github Action" scheme="http://hackycy.github.io/tags/Github-Action/"/>
    
      <category term="hexo" scheme="http://hackycy.github.io/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>VirtualBoxä¸­è§£å†³å®‰è£…CentOS7åæ— æ³•ä¸Šç½‘é—®é¢˜</title>
    <link href="http://hackycy.github.io/2020/05/22/VirtualBox%E4%B8%AD%E8%A7%A3%E5%86%B3%E5%AE%89%E8%A3%85CentOS7%E5%90%8E%E6%97%A0%E6%B3%95%E4%B8%8A%E7%BD%91%E9%97%AE%E9%A2%98/"/>
    <id>http://hackycy.github.io/2020/05/22/VirtualBoxä¸­è§£å†³å®‰è£…CentOS7åæ— æ³•ä¸Šç½‘é—®é¢˜/</id>
    <published>2020-05-22T13:41:06.000Z</published>
    <updated>2020-06-04T06:12:49.304Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å¶å°”éœ€è¦æ­å»ºä¸€äº›æµ‹è¯•ç”¨çš„ç¯å¢ƒæ—¶ä½¿ç”¨è™šæ‹Ÿæœºæ— ç–‘æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ³•ã€‚ä½†æ˜¯åœ¨å®‰è£…ç©Centos 7ç³»ç»Ÿåç½‘ç»œçš„é—®é¢˜æ˜¯ä¸€ç›´å›°æ‰°çš„ã€‚ä»¥é˜²å¿˜è®°å…ˆè®°å½•ä¸‹æ¥ã€‚</p><a id="more"></a><p>ç¯å¢ƒï¼šMac + VirtualBox</p><h1 id="é…ç½®è™šæ‹Ÿæœºçš„ç½‘å¡"><a href="#é…ç½®è™šæ‹Ÿæœºçš„ç½‘å¡" class="headerlink" title="é…ç½®è™šæ‹Ÿæœºçš„ç½‘å¡"></a>é…ç½®è™šæ‹Ÿæœºçš„ç½‘å¡</h1><p>æŒ‰ç…§ä¸‹å›¾é…ç½®è™šæ‹Ÿæœºçš„ç½‘ç»œ</p><p><img src="https://github.static.si-yee.com/posts/VirtualBoxä¸­è§£å†³å®‰è£…CentOS7åæ— æ³•ä¸Šç½‘é—®é¢˜-20200604134142.png" alt></p><p>å…¶ä¸­ï¼Œè¿æ¥æ–¹å¼é€‰æ‹©æ¡¥æ¥ç½‘å¡ã€ç•Œé¢åç§°é€‰æ‹©ä½ ä¸»æœºä¸Šç½‘ç”¨çš„æ— çº¿ç½‘å¡ã€æ§åˆ¶èŠ¯ç‰‡é€‰æ‹©æ¡Œé¢ã€æ··æ‚æ¨¡å¼é€‰æ‹©æ‹’ç»ã€å‹¾é€‰æ¥å…¥ç½‘ç»œã€‚</p><blockquote><p>é…ç½®å‰è¯·å…ˆåœæ­¢è™šæ‹Ÿæœº</p></blockquote><h1 id="é…ç½®CentOS7çš„ç½‘ç»œ"><a href="#é…ç½®CentOS7çš„ç½‘ç»œ" class="headerlink" title="é…ç½®CentOS7çš„ç½‘ç»œ"></a>é…ç½®CentOS7çš„ç½‘ç»œ</h1><p>ä¿®æ”¹ç½‘å¡å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®<code>BOOTPROTO</code>ä¸º<code>dhcp</code>ï¼Œ<code>ONBOOT</code>ä¸º<code>yes</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi /etc/sysconfig/network-scripts/ifcfg-enp0s3</span><br></pre></td></tr></table></figure><p><img src="https://github.static.si-yee.com/posts/VirtualBoxä¸­è§£å†³å®‰è£…CentOS7åæ— æ³•ä¸Šç½‘é—®é¢˜-20200604134232.png" alt></p><h1 id="é‡å¯ç½‘ç»œæœåŠ¡"><a href="#é‡å¯ç½‘ç»œæœåŠ¡" class="headerlink" title="é‡å¯ç½‘ç»œæœåŠ¡"></a>é‡å¯ç½‘ç»œæœåŠ¡</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ service network restart</span><br></pre></td></tr></table></figure><p>é…ç½®å®Œæˆåé‡å¯ç½‘ç»œï¼Œæµ‹è¯•pingé€šå³å¯ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://blog.csdn.net/scaleqiao/article/details/44206825" target="_blank" rel="noopener">https://blog.csdn.net/scaleqiao/article/details/44206825</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å¶å°”éœ€è¦æ­å»ºä¸€äº›æµ‹è¯•ç”¨çš„ç¯å¢ƒæ—¶ä½¿ç”¨è™šæ‹Ÿæœºæ— ç–‘æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ³•ã€‚ä½†æ˜¯åœ¨å®‰è£…ç©Centos 7ç³»ç»Ÿåç½‘ç»œçš„é—®é¢˜æ˜¯ä¸€ç›´å›°æ‰°çš„ã€‚ä»¥é˜²å¿˜è®°å…ˆè®°å½•ä¸‹æ¥ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="DBA" scheme="http://hackycy.github.io/categories/DBA/"/>
    
    
      <category term="Centos7" scheme="http://hackycy.github.io/tags/Centos7/"/>
    
      <category term="ç¯å¢ƒæ­å»º" scheme="http://hackycy.github.io/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    
  </entry>
  
  <entry>
    <title>iOSä¹‹æ—¥å¿—æ‰“å°ä¼˜åŒ–</title>
    <link href="http://hackycy.github.io/2020/05/21/iOS%E4%B9%8B%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0%E4%BC%98%E5%8C%96/"/>
    <id>http://hackycy.github.io/2020/05/21/iOSä¹‹æ—¥å¿—æ‰“å°ä¼˜åŒ–/</id>
    <published>2020-05-21T15:02:35.000Z</published>
    <updated>2020-06-04T06:12:49.332Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨æ—¥å¸¸å·¥ä½œå½“ä¸­ï¼ŒDebugæ¨¡å¼çš„æ‰“å°è°ƒè¯•æ˜¯åŸºæ“äº†ã€‚è€Œå”¯ä¸€çš„ä¸€æ‹›ä¸æ˜¯<code>NSLog</code>å°±æ˜¯<code>print</code>ã€‚ä½†é¡¹ç›®å¼€å‘ä¸­ä½¿ç”¨Swiftå<code>NSLog</code>å·²ç»ä¸å¸¸ç”¨äº†ã€‚</p><a id="more"></a><p>è€Œåœ¨æ—¥å¸¸å·¥ä½œå½“ä¸­ä½¿ç”¨Swiftçš„<code>debugPrint</code>æ¥è¿›è¡Œå¯¹ä¸€äº›ç½‘ç»œè¯·æ±‚çš„è¾“å‡ºç­‰çš„è°ƒè¯•å·²ç»ä¹ ä»¥ä¸ºå¸¸ã€‚ä½†æ˜¯Swiftç¼–è¯‘å™¨å¹¶ä¸ä¼šå°†<code>print</code>å’Œ<code>debugPrint</code>åˆ é™¤ã€‚åœ¨æœ€ç»ˆå‘å¸ƒçš„Appä¼šæŠŠå†…å®¹è¾“å‡ºåˆ°ç»ˆç«¯ã€‚é€ æˆäº†æ€§èƒ½çš„æŸå¤±ã€‚</p><p>ä½†æ˜¯ä½ ä¹Ÿä¸å¯èƒ½éšæ—¶éƒ½èƒ½åœ¨ä¸Šçº¿å‰æŠŠè¿™äº›æ‰“å°è¯­å¥éƒ½åˆ å»ã€‚</p><h1 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h1><p>ä½†æ˜¯æ›´å¥½çš„æ–¹æ³•æ˜¯é€šè¿‡æ·»åŠ æ¡ä»¶ç¼–è¯‘æ¥å°†è¿™äº›è¯­å¥æ’é™¤åœ¨ Release ç‰ˆæœ¬å¤–ã€‚åœ¨ Xcode çš„ Build Setting ä¸­ï¼Œåœ¨ <strong>Other Swift flags</strong> çš„ Debug æ ä¸­åŠ å…¥ <code>-D DEBUG</code> å³å¯åŠ å…¥ä¸€ä¸ªç¼–è¯‘æ ‡è¯†ã€‚</p><p><img src="https://github.static.si-yee.com/posts/iOSä¹‹æ—¥å¿—æ‰“å°ä¼˜åŒ–-20200604133855.png" alt></p><p>ä¹‹åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å°† <code>print</code> æˆ–è€… <code>debugPrint</code> åŒ…è£…ä¸€ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dPrint</span><span class="params">(item: <span class="keyword">Any</span>)</span></span> &#123;</span><br><span class="line">    #<span class="keyword">if</span> <span class="type">DEBUG</span></span><br><span class="line">    <span class="built_in">print</span>(item)</span><br><span class="line">    #endif</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œåœ¨ Release ç‰ˆæœ¬ä¸­ï¼Œ<code>dPrint</code> å°†ä¼šæ˜¯ä¸€ä¸ªç©ºæ–¹æ³•ï¼Œæ‰€æœ‰å¯¹è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šè¢«ç¼–è¯‘å™¨å‰”é™¤æ‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿™ç§å°è£…ä¸‹ï¼Œå¦‚æœä½ ä¼ å…¥çš„ <code>items</code> æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼è€Œä¸æ˜¯ç›´æ¥çš„å˜é‡çš„è¯ï¼Œè¿™ä¸ªè¡¨è¾¾å¼è¿˜æ˜¯ä¼šè¢«å…ˆæ‰§è¡Œæ±‚å€¼çš„ã€‚å¦‚æœè¿™å¯¹æ€§èƒ½ä¹Ÿäº§ç”Ÿäº†å¯æµ‹çš„å½±å“çš„è¯ï¼Œæˆ‘ä»¬æœ€å¥½ç”¨ <code>@autoclosure</code> ä¿®é¥°å‚æ•°æ¥é‡æ–°åŒ…è£… <code>print</code>ã€‚è¿™å¯ä»¥å°†æ±‚å€¼è¿è¡Œæ¨è¿Ÿåˆ°æ–¹æ³•å†…éƒ¨ï¼Œè¿™æ ·åœ¨ Release æ—¶è¿™ä¸ªæ±‚å€¼ä¹Ÿä¼šè¢«ä¸€å¹¶å»æ‰ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dPrint</span><span class="params">(item: @autoclosure <span class="params">()</span></span></span> -&gt; <span class="type">Any</span>) &#123;</span><br><span class="line">    #<span class="keyword">if</span> <span class="type">DEBUG</span></span><br><span class="line">    <span class="built_in">print</span>(item())</span><br><span class="line">    #endif</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dPrint(resultFromHeavyWork())</span><br><span class="line"><span class="comment">// Release ç‰ˆæœ¬ä¸­ resultFromHeavyWork() ä¸ä¼šè¢«æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨Time Profiler + çœŸæœºæµ‹è¯•å¯ä»¥éªŒè¯</p></blockquote><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://onevcat.com/2016/02/swift-performance/" target="_blank" rel="noopener">https://onevcat.com/2016/02/swift-performance/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨æ—¥å¸¸å·¥ä½œå½“ä¸­ï¼ŒDebugæ¨¡å¼çš„æ‰“å°è°ƒè¯•æ˜¯åŸºæ“äº†ã€‚è€Œå”¯ä¸€çš„ä¸€æ‹›ä¸æ˜¯&lt;code&gt;NSLog&lt;/code&gt;å°±æ˜¯&lt;code&gt;print&lt;/code&gt;ã€‚ä½†é¡¹ç›®å¼€å‘ä¸­ä½¿ç”¨Swiftå&lt;code&gt;NSLog&lt;/code&gt;å·²ç»ä¸å¸¸ç”¨äº†ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Ios" scheme="http://hackycy.github.io/categories/Ios/"/>
    
    
      <category term="Ios" scheme="http://hackycy.github.io/tags/Ios/"/>
    
  </entry>
  
  <entry>
    <title>IOSå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯æ—¶é—´åŒæ­¥æ–¹æ¡ˆ</title>
    <link href="http://hackycy.github.io/2020/05/12/IOS%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8E%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88/"/>
    <id>http://hackycy.github.io/2020/05/12/IOSå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯æ—¶é—´åŒæ­¥æ–¹æ¡ˆ/</id>
    <published>2020-05-12T10:35:16.000Z</published>
    <updated>2020-06-04T06:12:49.276Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ€è¿‘é¡¹ç›®çš„ç¼–å†™ä¸­ï¼Œæ¥å£éœ€è¦æäº¤ç²¾ç¡®åˆ°ç§’çº§çš„æ—¶é—´æˆ³ç”¨ä½œæ ¡éªŒã€‚ä½†æ˜¯ä»…é <code>new Date().timeIntervalSince1970</code>ä¼šé¢ä¸´ç€æœ¬åœ°çš„æ—¶é—´ä¸æœåŠ¡å™¨æ—¶é—´ä¸ä¸€è‡´çš„é—®é¢˜ã€‚é‚£ä¹ˆæœ¬æ–‡æ–¹æ¡ˆèƒ½è®©æœ¬åœ°åº”ç”¨æ—¶é—´ä¸æœåŠ¡å™¨æ—¶é—´å­˜åœ¨è¯¯å·®èŒƒå›´å†…ä¿æŒåŒæ­¥ï¼Œå‡å°‘åº”ç”¨å‡ºé”™ç‡ã€‚</p><a id="more"></a><h1 id="é¢„å¤‡çŸ¥è¯†"><a href="#é¢„å¤‡çŸ¥è¯†" class="headerlink" title="é¢„å¤‡çŸ¥è¯†"></a>é¢„å¤‡çŸ¥è¯†</h1><ul><li>è·å–è®¾å¤‡å½“å‰æ—¶é—´ <code>Now</code>ï¼Œè¯¥å€¼å—ç³»ç»Ÿæ—¶é—´å½±å“ï¼Œç”¨æˆ·å¦‚æœä¿®æ”¹æ—¶é—´ï¼Œå€¼ä¹Ÿä¼šéšç€å˜åŒ–ï¼›</li><li>è·å–è®¾å¤‡ä¸Šæ¬¡é‡å¯çš„æ—¶é—´ <code>BootTime</code>ï¼Œè¯¥å€¼å—ç³»ç»Ÿæ—¶é—´å½±å“ï¼Œç”¨æˆ·å¦‚æœä¿®æ”¹æ—¶é—´ï¼Œå€¼ä¹Ÿä¼šéšç€å˜åŒ–ï¼›</li><li>ç”±ä¸Šé¢ <code>iOS</code> æä¾›çš„ä¸¤ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥è·å–åˆ°<strong>è®¾å¤‡è‡ªä¸Šæ¬¡é‡å¯åè¿è¡Œçš„æ—¶é—´</strong>ï¼ˆ<code>BootTime - Now</code>ï¼‰ï¼Œè¯¥å€¼ä¸ç³»ç»Ÿæ—¶é—´æ— å…³ï¼›<span class="label danger">`-`è¿™ä¸ªä¸æ˜¯å‡ï¼ŒæŒ‡çš„æ˜¯åŒºé—´ï¼Œä¸‹é¢åŒç†</span> </li><li>åœ¨å¿…è¦çš„æ—¶åˆ»è·å–ä¸€ä¸‹æœåŠ¡å™¨æ—¶é—´ï¼Œç„¶åè®°å½•è¿™ä¸ªæ—¶åˆ»çš„<strong>è®¾å¤‡è‡ªä¸Šæ¬¡é‡å¯åè¿è¡Œçš„æ—¶é—´</strong>ï¼ˆ<code>BootTime - Now</code>ï¼‰</li><li>åç»­æ—¶é—´è·å–ï¼š<strong>ç°åœ¨æœåŠ¡å™¨æ—¶é—´ = ä»¥å‰æœåŠ¡å™¨æ—¶é—´ + ç°åœ¨è®¾å¤‡è‡ªä¸Šæ¬¡é‡å¯åè¿è¡Œçš„æ—¶é—´ - ä»¥å‰æœåŠ¡å™¨æ—¶é—´çš„è·å–æ—¶åˆ»çš„è®¾å¤‡è‡ªä¸Šæ¬¡é‡å¯åè¿è¡Œçš„æ—¶é—´</strong></li><li>åˆ©ç”¨AFNetworkingè‡ªåŠ¨åŒæ­¥æ—¶é—´</li></ul><h1 id="æ—¶é—´çš„è·å–"><a href="#æ—¶é—´çš„è·å–" class="headerlink" title="æ—¶é—´çš„è·å–"></a>æ—¶é—´çš„è·å–</h1><p><strong>è·å–nowçš„Unix Time</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">now</span>() -&gt; <span class="title">Int</span> </span>&#123;</span><br><span class="line"><span class="keyword">var</span> now = timeval()</span><br><span class="line"><span class="keyword">var</span> tz = timezone()</span><br><span class="line">gettimeofday(&amp;now, &amp;tz)</span><br><span class="line"><span class="keyword">return</span> now.tv_sec</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è·å–è®¾å¤‡ä¸Šæ¬¡é‡å¯çš„ Unix Time</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">boottime</span>() -&gt; <span class="title">Int</span> </span>&#123;</span><br><span class="line"><span class="keyword">var</span> mid = [<span class="type">CTL_KERN</span>, <span class="type">KERN_BOOTTIME</span>]</span><br><span class="line"><span class="keyword">var</span> boottime = timeval()</span><br><span class="line"><span class="keyword">var</span> size = <span class="type">MemoryLayout</span>.size(ofValue: boottime)</span><br><span class="line">  <span class="keyword">if</span> sysctl(&amp;mid, <span class="number">2</span>, &amp;boottime, &amp;size, <span class="literal">nil</span>, <span class="number">0</span>) != -<span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span> boottime.tv_sec</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è·å–è®¾å¤‡è‡ªä¸Šæ¬¡é‡å¯åè¿è¡Œçš„æ—¶é—´</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">now() - boottime()</span><br></pre></td></tr></table></figure><blockquote><p>ocè·å–æ–¹å¼</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="comment">//get system uptime since last boot</span></span><br><span class="line">&gt; - (<span class="built_in">NSTimeInterval</span>)uptime</span><br><span class="line">&gt; &#123;</span><br><span class="line">&gt; <span class="keyword">struct</span> timeval boottime;</span><br><span class="line">&gt; <span class="keyword">int</span> mib[<span class="number">2</span>] = &#123;<span class="built_in">CTL_KERN</span>, KERN_BOOTTIME&#125;;</span><br><span class="line">&gt; size_t size = <span class="keyword">sizeof</span>(boottime);</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="keyword">struct</span> timeval now;</span><br><span class="line">&gt; <span class="keyword">struct</span> timezone tz;</span><br><span class="line">&gt; gettimeofday(&amp;now, &amp;tz);</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="keyword">double</span> uptime = <span class="number">-1</span>;</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="keyword">if</span> (sysctl(mib, <span class="number">2</span>, &amp;boottime, &amp;size, <span class="literal">NULL</span>, <span class="number">0</span>) != <span class="number">-1</span> &amp;&amp; boottime.tv_sec != <span class="number">0</span>)</span><br><span class="line">&gt; &#123;</span><br><span class="line">&gt; uptime = now.tv_sec - boottime.tv_sec;</span><br><span class="line">&gt; uptime += (<span class="keyword">double</span>)(now.tv_usec - boottime.tv_usec) / <span class="number">1000000.0</span>;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; <span class="keyword">return</span> uptime;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><h1 id="TimeUtilsç¼–å†™"><a href="#TimeUtilsç¼–å†™" class="headerlink" title="TimeUtilsç¼–å†™"></a>TimeUtilsç¼–å†™</h1><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimeUtils</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">var</span> isServerTime: <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">var</span> diffTime: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// é¡¹ç›®ä¸­æ‰€æœ‰è·å–æ—¶é—´çš„æ–¹æ³•</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">getServerTime</span>() -&gt; <span class="title">Int</span> </span>&#123;</span><br><span class="line">        objc_sync_enter(<span class="keyword">self</span>)</span><br><span class="line">        <span class="keyword">defer</span> &#123;</span><br><span class="line">            objc_sync_exit(<span class="keyword">self</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> !isServerTime &#123;</span><br><span class="line">            <span class="keyword">let</span> t = <span class="type">Date</span>().timestamp</span><br><span class="line">            <span class="keyword">return</span> t</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> t = diffTime + (now() - boottime())</span><br><span class="line">        <span class="keyword">return</span> t</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// ç”¨äºè®¡ç®—æ—¶é—´</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">calibrationTime</span>(<span class="title">lastServerTime</span>: <span class="title">Int</span>) -&gt; <span class="title">Int</span> </span>&#123;</span><br><span class="line">        objc_sync_enter(<span class="keyword">self</span>)</span><br><span class="line">        <span class="keyword">defer</span> &#123;</span><br><span class="line">            objc_sync_exit(<span class="keyword">self</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        diffTime = lastServerTime - (now() - boottime())</span><br><span class="line">        isServerTime = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">return</span> lastServerTime</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// è·å–å½“å‰ Unix Time</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">now</span>() -&gt; <span class="title">Int</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> now = timeval()</span><br><span class="line">        <span class="keyword">var</span> tz = timezone()</span><br><span class="line">        gettimeofday(&amp;now, &amp;tz)</span><br><span class="line">        <span class="keyword">return</span> now.tv_sec</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">/// è·å–è®¾å¤‡ä¸Šæ¬¡é‡å¯çš„ Unix Time</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">boottime</span>() -&gt; <span class="title">Int</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> mid = [<span class="type">CTL_KERN</span>, <span class="type">KERN_BOOTTIME</span>]</span><br><span class="line">        <span class="keyword">var</span> boottime = timeval()</span><br><span class="line">        <span class="keyword">var</span> size = <span class="type">MemoryLayout</span>.size(ofValue: boottime)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> sysctl(&amp;mid, <span class="number">2</span>, &amp;boottime, &amp;size, <span class="literal">nil</span>, <span class="number">0</span>) != -<span class="number">1</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> boottime.tv_sec</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Date</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> timestamp: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> timeInterval: <span class="type">TimeInterval</span> = <span class="keyword">self</span>.timeIntervalSince1970</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Int</span>(timeInterval)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åˆ©ç”¨AFNetworkingåŒæ­¥æ—¶é—´"><a href="#åˆ©ç”¨AFNetworkingåŒæ­¥æ—¶é—´" class="headerlink" title="åˆ©ç”¨AFNetworkingåŒæ­¥æ—¶é—´"></a>åˆ©ç”¨AFNetworkingåŒæ­¥æ—¶é—´</h1><p>åˆ©ç”¨AFNå‘èµ·è¯·æ±‚è¿”å›æ—¶é€šè¿‡HTTP Headeræ¥è·å–æœåŠ¡å™¨æ—¶é—´ï¼Œæ—¶é—´æ ¼å¼ä»¥<a href="https://link.jianshu.com/?t=https%3A%2F%2Ftools.ietf.org%2Fhtml%2Frfc7231%23section-7.1.1.1" target="_blank" rel="noopener">RFC-7231</a>ä¸­å®šä¹‰çš„â€HTTPæ—¥æœŸâ€æ ¼å¼æ¥å‘é€ï¼Œè§£æè¯¥æ—¶é—´éœ€è¦ç”¨åˆ°ä»¥ä¸‹çš„OCä»£ç ï¼ŒSwifté¡¹ç›®è¯·è‡ªè¡Œç”¨<code>Bridging-Header</code></p><p><strong>NSDate+InternetDateTime.h</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  NSDate+InternetDateTime.h</span></span><br><span class="line"><span class="comment">//  MWFeedParser</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by Michael Waterfall on 07/10/2010.</span></span><br><span class="line"><span class="comment">//  Copyright 2010 Michael Waterfall. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Formatting hints</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;</span><br><span class="line">    DateFormatHintNone, </span><br><span class="line">    DateFormatHintRFC822, </span><br><span class="line">    DateFormatHintRFC3339</span><br><span class="line">&#125; DateFormatHint;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A category to parse internet date &amp; time strings</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSDate</span> (<span class="title">InternetDateTime</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Get date from RFC3339 or RFC822 string</span></span><br><span class="line"><span class="comment">// - A format/specification hint can be used to speed up, </span></span><br><span class="line"><span class="comment">//   otherwise both will be attempted in order to get a date</span></span><br><span class="line">+ (<span class="built_in">NSDate</span> *)dateFromInternetDateTimeString:(<span class="built_in">NSString</span> *)dateString </span><br><span class="line">                                formatHint:(DateFormatHint)hint;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get date from a string using a specific date specification</span></span><br><span class="line">+ (<span class="built_in">NSDate</span> *)dateFromRFC3339String:(<span class="built_in">NSString</span> *)dateString;</span><br><span class="line">+ (<span class="built_in">NSDate</span> *)dateFromRFC822String:(<span class="built_in">NSString</span> *)dateString;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p><strong>NSDate+InternetDateTime.m</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  NSDate+InternetDateTime.m</span></span><br><span class="line"><span class="comment">//  MWFeedParser</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by Michael Waterfall on 07/10/2010.</span></span><br><span class="line"><span class="comment">//  Copyright 2010 Michael Waterfall. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"NSDate+InternetDateTime.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Always keep the formatter around as they're expensive to instantiate</span></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSDateFormatter</span> *_internetDateTimeFormatter = <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Good info on internet dates here:</span></span><br><span class="line"><span class="comment">// http://developer.apple.com/iphone/library/qa/qa2010/qa1480.html</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSDate</span> (<span class="title">InternetDateTime</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Instantiate single date formatter</span></span><br><span class="line">+ (<span class="built_in">NSDateFormatter</span> *)internetDateTimeFormatter &#123;</span><br><span class="line">    <span class="keyword">@synchronized</span>(<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!_internetDateTimeFormatter) &#123;</span><br><span class="line">            <span class="built_in">NSLocale</span> *en_US_POSIX = [[<span class="built_in">NSLocale</span> alloc] initWithLocaleIdentifier:<span class="string">@"en_US_POSIX"</span>];</span><br><span class="line">            _internetDateTimeFormatter = [[<span class="built_in">NSDateFormatter</span> alloc] init];</span><br><span class="line">            [_internetDateTimeFormatter setLocale:en_US_POSIX];</span><br><span class="line">            [_internetDateTimeFormatter setTimeZone:[<span class="built_in">NSTimeZone</span> timeZoneForSecondsFromGMT:<span class="number">0</span>]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _internetDateTimeFormatter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get a date from a string - hint can be used to speed up</span></span><br><span class="line">+ (<span class="built_in">NSDate</span> *)dateFromInternetDateTimeString:(<span class="built_in">NSString</span> *)dateString formatHint:(DateFormatHint)hint &#123;</span><br><span class="line">     <span class="comment">// Keep dateString around a while (for thread-safety)</span></span><br><span class="line"><span class="built_in">NSDate</span> *date = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">if</span> (dateString) &#123;</span><br><span class="line">        <span class="keyword">if</span> (hint != DateFormatHintRFC3339) &#123;</span><br><span class="line">            <span class="comment">// Try RFC822 first</span></span><br><span class="line">            date = [<span class="built_in">NSDate</span> dateFromRFC822String:dateString];</span><br><span class="line">            <span class="keyword">if</span> (!date) date = [<span class="built_in">NSDate</span> dateFromRFC3339String:dateString];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Try RFC3339 first</span></span><br><span class="line">            date = [<span class="built_in">NSDate</span> dateFromRFC3339String:dateString];</span><br><span class="line">            <span class="keyword">if</span> (!date) date = [<span class="built_in">NSDate</span> dateFromRFC822String:dateString];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="comment">// Finished with date string</span></span><br><span class="line"><span class="keyword">return</span> date;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// See http://www.faqs.org/rfcs/rfc822.html</span></span><br><span class="line">+ (<span class="built_in">NSDate</span> *)dateFromRFC822String:(<span class="built_in">NSString</span> *)dateString &#123;</span><br><span class="line">     <span class="comment">// Keep dateString around a while (for thread-safety)</span></span><br><span class="line">    <span class="built_in">NSDate</span> *date = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">if</span> (dateString) &#123;</span><br><span class="line">        <span class="built_in">NSDateFormatter</span> *dateFormatter = [<span class="built_in">NSDate</span> internetDateTimeFormatter];</span><br><span class="line">        <span class="keyword">@synchronized</span>(dateFormatter) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Process</span></span><br><span class="line">            <span class="built_in">NSString</span> *RFC822String = [[<span class="built_in">NSString</span> stringWithString:dateString] uppercaseString];</span><br><span class="line">            <span class="keyword">if</span> ([RFC822String rangeOfString:<span class="string">@","</span>].location != <span class="built_in">NSNotFound</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!date) &#123; <span class="comment">// Sun, 19 May 2002 15:21:36 GMT</span></span><br><span class="line">                    [dateFormatter setDateFormat:<span class="string">@"EEE, d MMM yyyy HH:mm:ss zzz"</span>]; </span><br><span class="line">                    date = [dateFormatter dateFromString:RFC822String];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!date) &#123; <span class="comment">// Sun, 19 May 2002 15:21 GMT</span></span><br><span class="line">                    [dateFormatter setDateFormat:<span class="string">@"EEE, d MMM yyyy HH:mm zzz"</span>]; </span><br><span class="line">                    date = [dateFormatter dateFromString:RFC822String];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!date) &#123; <span class="comment">// Sun, 19 May 2002 15:21:36</span></span><br><span class="line">                    [dateFormatter setDateFormat:<span class="string">@"EEE, d MMM yyyy HH:mm:ss"</span>]; </span><br><span class="line">                    date = [dateFormatter dateFromString:RFC822String];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!date) &#123; <span class="comment">// Sun, 19 May 2002 15:21</span></span><br><span class="line">                    [dateFormatter setDateFormat:<span class="string">@"EEE, d MMM yyyy HH:mm"</span>]; </span><br><span class="line">                    date = [dateFormatter dateFromString:RFC822String];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!date) &#123; <span class="comment">// 19 May 2002 15:21:36 GMT</span></span><br><span class="line">                    [dateFormatter setDateFormat:<span class="string">@"d MMM yyyy HH:mm:ss zzz"</span>]; </span><br><span class="line">                    date = [dateFormatter dateFromString:RFC822String];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!date) &#123; <span class="comment">// 19 May 2002 15:21 GMT</span></span><br><span class="line">                    [dateFormatter setDateFormat:<span class="string">@"d MMM yyyy HH:mm zzz"</span>]; </span><br><span class="line">                    date = [dateFormatter dateFromString:RFC822String];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!date) &#123; <span class="comment">// 19 May 2002 15:21:36</span></span><br><span class="line">                    [dateFormatter setDateFormat:<span class="string">@"d MMM yyyy HH:mm:ss"</span>]; </span><br><span class="line">                    date = [dateFormatter dateFromString:RFC822String];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!date) &#123; <span class="comment">// 19 May 2002 15:21</span></span><br><span class="line">                    [dateFormatter setDateFormat:<span class="string">@"d MMM yyyy HH:mm"</span>]; </span><br><span class="line">                    date = [dateFormatter dateFromString:RFC822String];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!date) <span class="built_in">NSLog</span>(<span class="string">@"Could not parse RFC822 date: \"%@\" Possible invalid format."</span>, dateString);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="comment">// Finished with date string</span></span><br><span class="line">    <span class="keyword">return</span> date;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// See http://www.faqs.org/rfcs/rfc3339.html</span></span><br><span class="line">+ (<span class="built_in">NSDate</span> *)dateFromRFC3339String:(<span class="built_in">NSString</span> *)dateString &#123;</span><br><span class="line">     <span class="comment">// Keep dateString around a while (for thread-safety)</span></span><br><span class="line">    <span class="built_in">NSDate</span> *date = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">if</span> (dateString) &#123;</span><br><span class="line">        <span class="built_in">NSDateFormatter</span> *dateFormatter = [<span class="built_in">NSDate</span> internetDateTimeFormatter];</span><br><span class="line">        <span class="keyword">@synchronized</span>(dateFormatter) &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Process date</span></span><br><span class="line">            <span class="built_in">NSString</span> *RFC3339String = [[<span class="built_in">NSString</span> stringWithString:dateString] uppercaseString];</span><br><span class="line">            RFC3339String = [RFC3339String stringByReplacingOccurrencesOfString:<span class="string">@"Z"</span> withString:<span class="string">@"-0000"</span>];</span><br><span class="line">            <span class="comment">// Remove colon in timezone as it breaks NSDateFormatter in iOS 4+.</span></span><br><span class="line">            <span class="comment">// - see https://devforums.apple.com/thread/45837</span></span><br><span class="line">            <span class="keyword">if</span> (RFC3339String.length &gt; <span class="number">20</span>) &#123;</span><br><span class="line">                RFC3339String = [RFC3339String stringByReplacingOccurrencesOfString:<span class="string">@":"</span> </span><br><span class="line">                                                                         withString:<span class="string">@""</span> </span><br><span class="line">                                                                            options:<span class="number">0</span></span><br><span class="line">                                                                              range:<span class="built_in">NSMakeRange</span>(<span class="number">20</span>, RFC3339String.length<span class="number">-20</span>)];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!date) &#123; <span class="comment">// 1996-12-19T16:39:57-0800</span></span><br><span class="line">                [dateFormatter setDateFormat:<span class="string">@"yyyy'-'MM'-'dd'T'HH':'mm':'ssZZZ"</span>]; </span><br><span class="line">                date = [dateFormatter dateFromString:RFC3339String];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!date) &#123; <span class="comment">// 1937-01-01T12:00:27.87+0020</span></span><br><span class="line">                [dateFormatter setDateFormat:<span class="string">@"yyyy'-'MM'-'dd'T'HH':'mm':'ss.SSSZZZ"</span>]; </span><br><span class="line">                date = [dateFormatter dateFromString:RFC3339String];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!date) &#123; <span class="comment">// 1937-01-01T12:00:27</span></span><br><span class="line">                [dateFormatter setDateFormat:<span class="string">@"yyyy'-'MM'-'dd'T'HH':'mm':'ss"</span>]; </span><br><span class="line">                date = [dateFormatter dateFromString:RFC3339String];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!date) <span class="built_in">NSLog</span>(<span class="string">@"Could not parse RFC3339 date: \"%@\" Possible invalid format."</span>, dateString);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="comment">// Finished with date string</span></span><br><span class="line"><span class="keyword">return</span> date;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><blockquote><p>æ¥æºï¼š<a href="https://github.com/mwaterfall/MWFeedParser/blob/master/Classes/NSDate+InternetDateTime.mï¼ˆARCï¼‰" target="_blank" rel="noopener">https://github.com/mwaterfall/MWFeedParser/blob/master/Classes/NSDate+InternetDateTime.mï¼ˆARCï¼‰</a></p></blockquote><p>åœ¨é¡¹ç›®ä¸­å°è£…ä¸€ä¸ªAFNçš„è¯·æ±‚åŸºç±»</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> AFNetworking</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">HttpMethod</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">GET</span> = <span class="string">"GET"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">POST</span> = <span class="string">"POST"</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpClient</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> baseURLString = <span class="string">"http://base.url/"</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> minResponseTime = <span class="type">Int</span>.<span class="built_in">max</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> sharedClient: <span class="type">AFHTTPSessionManager</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> baseUrl = <span class="type">URL</span>(string: baseURLString)</span><br><span class="line">        <span class="keyword">let</span> client = <span class="type">AFHTTPSessionManager</span>(baseURL: baseUrl!)</span><br><span class="line">        <span class="comment">// è®¾ç½®è¯·æ±‚æ ¼å¼</span></span><br><span class="line">        client.requestSerializer = <span class="type">AFJSONRequestSerializer</span>()</span><br><span class="line">        <span class="comment">// è®¾ç½®è¿”å›æ ¼å¼</span></span><br><span class="line">        client.responseSerializer = <span class="type">AFJSONResponseSerializer</span>()</span><br><span class="line">        <span class="comment">// è®¾ç½®ç¦æ­¢ç¼“å­˜</span></span><br><span class="line">        client.requestSerializer.cachePolicy = .reloadIgnoringLocalCacheData</span><br><span class="line">        <span class="comment">// è®¾ç½®è¶…æ—¶</span></span><br><span class="line">        client.requestSerializer.timeoutInterval = <span class="number">10</span></span><br><span class="line">        <span class="comment">// ä»¥é˜²è§£ææ ¼å¼ä¸æ”¯æŒ</span></span><br><span class="line">        client.responseSerializer.acceptableContentTypes?.insert(<span class="string">"text/html"</span>)</span><br><span class="line">        client.responseSerializer.acceptableContentTypes?.insert(<span class="string">"text/plain"</span>)</span><br><span class="line">        <span class="keyword">return</span> client</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">HttpClient</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: è¯·æ±‚æ–¹å¼</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// é¡¹ç›®å…¬å…±è¯·æ±‚ç±»</span></span><br><span class="line">    <span class="comment">/// - Parameters:</span></span><br><span class="line">    <span class="comment">///   - httpMethod: httpMethod</span></span><br><span class="line">    <span class="comment">///   - URLString: URLString</span></span><br><span class="line">    <span class="comment">///   - parameters: å‚æ•°</span></span><br><span class="line">    <span class="comment">///   - headers: è¯·æ±‚å¤´</span></span><br><span class="line">    <span class="comment">///   - progress: è¿›åº¦</span></span><br><span class="line">    <span class="comment">///   - success: æˆåŠŸå›è°ƒ</span></span><br><span class="line">    <span class="comment">///   - failure: å¤±è´¥å›è°ƒ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">request</span>(<span class="title">httpMethod</span>: <span class="title">HttpMethod</span>, <span class="title">URLString</span>: <span class="title">String</span>, <span class="title">parameters</span>: [<span class="title">String</span> : <span class="title">Any</span>]?,</span></span><br><span class="line"><span class="class">                       <span class="title">headers</span>: [<span class="title">String</span> : <span class="title">String</span>]?, <span class="title">progress</span>: ((<span class="title">Progress</span>) -&gt; <span class="title">Void</span>)?,</span></span><br><span class="line"><span class="class">                       <span class="title">success</span>: ((<span class="title">URLSessionDataTask</span>, <span class="title">Any</span>?) -&gt; <span class="title">Void</span>)?, <span class="title">failure</span>: ((<span class="title">URLSessionDataTask</span>?, <span class="title">Error</span>) -&gt; <span class="title">Void</span>)?) </span>&#123;</span><br><span class="line">        <span class="comment">// è®°å½•å½“å‰è¯·æ±‚å¼€å§‹æ—¶é—´</span></span><br><span class="line">        <span class="keyword">let</span> startTime = <span class="type">Date</span>().timestamp</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å®šä¹‰é€šç”¨æˆåŠŸå›è°ƒ</span></span><br><span class="line">        <span class="keyword">let</span> successCallback = &#123; (task: <span class="type">URLSessionDataTask</span>, result: <span class="type">Any?</span>) -&gt; () <span class="keyword">in</span></span><br><span class="line">            <span class="comment">// å½“å‰è¯·æ±‚å“åº”çš„æ—¶é—´é—´éš”</span></span><br><span class="line">            <span class="keyword">let</span> responseTime = <span class="type">Date</span>().timestamp - startTime</span><br><span class="line">            <span class="comment">//å¦‚æœè¿™ä¸€æ¬¡çš„è¯·æ±‚å“åº”æ—¶é—´å°äºä¸Šä¸€æ¬¡ï¼Œåˆ™æ›´æ–°æœ¬åœ°ç»´æŠ¤çš„æ—¶é—´</span></span><br><span class="line">            <span class="keyword">if</span> responseTime &lt;= minResponseTime &#123;</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">let</span> response = task.response <span class="keyword">as</span>? <span class="type">HTTPURLResponse</span> &#123;</span><br><span class="line">                    <span class="comment">// ç½‘ç»œå“åº”å¤´åŒ…å«Dateå­—æ®µï¼ˆä¸–ç•Œæ—¶é—´ï¼‰</span></span><br><span class="line">                    <span class="keyword">if</span> response.allHeaderFields[<span class="string">"Date"</span>] <span class="keyword">is</span> <span class="type">String</span> &#123;</span><br><span class="line">                        <span class="keyword">let</span> dateString = response.allHeaderFields[<span class="string">"Date"</span>]! <span class="keyword">as</span>! <span class="type">String</span></span><br><span class="line">                        <span class="keyword">if</span> <span class="keyword">let</span> date = <span class="type">NSDate</span>(fromInternetDateTime: dateString, formatHint: <span class="type">DateFormatHintRFC822</span>) &#123;</span><br><span class="line">                            <span class="keyword">let</span> <span class="number">_</span> = <span class="type">TimeUtils</span>.calibrationTime(lastServerTime: <span class="type">Int</span>(date.timeIntervalSince1970))</span><br><span class="line">                            minResponseTime = responseTime</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            success?(task, result)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> httpMethod == .<span class="type">GET</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.sharedClient.<span class="keyword">get</span>(<span class="type">URLString</span>, parameters: parameters, headers: safeHeaders, progress: progress, success: successCallback, failure: failure)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> httpMethod == .<span class="type">POST</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.sharedClient.post(<span class="type">URLString</span>, parameters: parameters, headers: safeHeaders, progress: progress, success: successCallback, failure: failure)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note warning"><p>è¯¥æ–¹æ¡ˆä¸‹å‰æå¿…é¡»ç¦æ­¢AFNè‡ªå¸¦çš„ç¼“å­˜ç­–ç•¥<code>client.requestSerializer.cachePolicy = .reloadIgnoringLocalCacheData</code>ã€‚ä¸ç¦æ­¢ä¼šå‡ºç°æ—¶é—´å¼‚å¸¸çš„ç°è±¡ï¼Œå¦‚é¡¹ç›®ä¸­æ˜¯ä½¿ç”¨AFNè‡ªå¸¦çš„ç¼“å­˜ç­–ç•¥åˆ™éœ€è¦æ›´æ¢é¡¹ç›®ä¸­çš„ç¼“å­˜æ–¹æ¡ˆã€‚</p></div><blockquote><p>è¯¥æ–¹æ¡ˆéƒ½ä»…åˆ°ç§’çº§ï¼Œå¦‚éœ€åˆ°æ¯«ç§’çº§è¯·åš*1000å¤„ç†</p><p>ä¸è¶³ï¼šè¿æ¥æœåŠ¡å™¨çš„è¿‡ç¨‹æ˜¯éœ€è¦æ—¶é—´çš„ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æ—¶åˆ»çš„æ—¶é—´ä¸åº”ç”¨æ”¶åˆ°å“åº”å­˜åœ¨ä¸€å®šçš„æ—¶é—´å·®ï¼Œå¯¼è‡´è¯¯å·®çš„å­˜åœ¨ï¼ˆè¯¯å·®=æœåŠ¡å™¨å‘å‡ºå“åº”-&gt;åˆ°æœ¬æœºæ”¶åˆ°å“åº”è¿™ä¸ªæ—¶é—´ï¼‰ã€‚</p><p>ä½†æ˜¯é€šè¿‡ä¸Šé¢çš„AFNæ¯æ¬¡åˆ¤æ–­ï¼Œå¯ä»¥ä½¿å¾—è¯¯å·®é€æ¸é™ä½</p></blockquote><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://www.jianshu.com/p/48ac0bb1392e" target="_blank" rel="noopener">https://www.jianshu.com/p/48ac0bb1392e</a></p><p><a href="https://www.jianshu.com/p/bb2cbfad3e77" target="_blank" rel="noopener">https://www.jianshu.com/p/bb2cbfad3e77</a></p><p><a href="https://www.jianshu.com/p/df41659b06a9" target="_blank" rel="noopener">https://www.jianshu.com/p/df41659b06a9</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æœ€è¿‘é¡¹ç›®çš„ç¼–å†™ä¸­ï¼Œæ¥å£éœ€è¦æäº¤ç²¾ç¡®åˆ°ç§’çº§çš„æ—¶é—´æˆ³ç”¨ä½œæ ¡éªŒã€‚ä½†æ˜¯ä»…é &lt;code&gt;new Date().timeIntervalSince1970&lt;/code&gt;ä¼šé¢ä¸´ç€æœ¬åœ°çš„æ—¶é—´ä¸æœåŠ¡å™¨æ—¶é—´ä¸ä¸€è‡´çš„é—®é¢˜ã€‚é‚£ä¹ˆæœ¬æ–‡æ–¹æ¡ˆèƒ½è®©æœ¬åœ°åº”ç”¨æ—¶é—´ä¸æœåŠ¡å™¨æ—¶é—´å­˜åœ¨è¯¯å·®èŒƒå›´å†…ä¿æŒåŒæ­¥ï¼Œå‡å°‘åº”ç”¨å‡ºé”™ç‡ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Ios" scheme="http://hackycy.github.io/categories/Ios/"/>
    
    
      <category term="Ios" scheme="http://hackycy.github.io/tags/Ios/"/>
    
  </entry>
  
  <entry>
    <title>IOSå¡«å‘ä¹‹URLç¼–ç é—®é¢˜</title>
    <link href="http://hackycy.github.io/2020/05/08/IOS%E5%A1%AB%E5%9D%91%E4%B9%8BURL%E7%BC%96%E7%A0%81%E9%97%AE%E9%A2%98/"/>
    <id>http://hackycy.github.io/2020/05/08/IOSå¡«å‘ä¹‹URLç¼–ç é—®é¢˜/</id>
    <published>2020-05-08T11:24:06.000Z</published>
    <updated>2020-06-04T06:12:49.276Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨ä½¿ç”¨WKWebviewçš„æ—¶å€™ï¼Œé€šå¸¸éƒ½ç¦»ä¸å¼€URLï¼Œä¸€èˆ¬çš„ç¬¦åˆç½‘ç»œæ ‡å‡†çš„URLæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯åœ¨å…¬å¸å¼€å‘çš„æ—¶å€™é‡åˆ°äº†ä¸€äº›ç‰¹æ®ŠURLçš„æ—¶å€™å°±è¸©åˆ°äº†URLç¼–ç çš„å‘ã€‚</p><p>åœ¨1994å¹´è®¢åˆ¶çš„RFC1738æ–‡æ¡£ä¸­ï¼Œå¯¹å­—ç¬¦ä¸²ä¸­çš„é™¤äº†<code>- _ .</code>ä¹‹å¤–çš„æ‰€æœ‰éå­—æ¯æ•°å­—å­—ç¬¦éƒ½æ›¿æ¢æˆç™¾åˆ†å·(%)åè·Ÿä¸¤ä½åå…­è¿›åˆ¶æ•°ï¼Œåå…­è¿›åˆ¶æ•°ä¸­å­—æ¯å¿…é¡»ä¸ºå¤§å†™ã€‚</p><p>åœ¨2005å¹´å®šä¹‰çš„RFC3986ä¸­ï¼Œå°†é’ˆå¯¹<code>- _.~</code>å››ä¸ªå­—ç¬¦ä¹‹å¤–çš„æ‰€æœ‰éå­—æ¯æ•°å­—å­—ç¬¦è¿›è¡Œç™¾åˆ†å·ç¼–ç ã€‚å½“ç„¶ æ ¹æ®URLçš„ç±»å‹ä¸åŒï¼Œæœ‰ä¹Ÿä¸€éƒ¨åˆ†é¢„ç•™å­—ç¬¦ä¸éœ€è¦è¿›è¡Œç¼–ç ï¼Œä¾‹å¦‚æŸ¥è¯¢çš„<code>URL</code>ä¸­å¯ä»¥åŒ…å«<code>? /</code>å­—ç¬¦ï¼Œä¸éœ€è¦è½¬ä¹‰ã€‚æ›´è¯¦ç»†æ–‡æ¡£çš„å¯ä»¥æŸ¥çœ‹<a href="http://www.ietf.org/rfc/rfc3986.txt" target="_blank" rel="noopener">RFC 3986</a>ã€‚</p><a id="more"></a><h1 id="Swift-URL-Encode"><a href="#Swift-URL-Encode" class="headerlink" title="Swift URL Encode"></a>Swift URL Encode</h1><p><code>addingPercentEncoding(withAllowedCharacters:</code>æ˜¯iOS7ä¹‹åå‡ºç°çš„æ–°APIç”¨äº<code>url encode</code>ã€‚</p><p>å®˜æ–¹å¯¹è¯¥æ–¹æ³•çš„è§£é‡Šï¼š</p><blockquote><p>// Returns a new string made from the receiver by replacing all characters not in the allowedCharacters set with percent encoded characters. UTF-8 encoding is used to determine the correct percent encoded characters. Entire URL strings cannot be percent-encoded. This method is intended to percent-encode an URL component or subcomponent string, NOT the entire URL string. Any characters in allowedCharacters outside of the 7-bit ASCII range are ignored.  </p></blockquote><p>æœ€åä¸€å¥Any characters in allowedCharacters outside of the 7-bit ASCII range are ignored.ï¼Œæ„æ€å°±æ˜¯è¯´ï¼Œä»»ä½•é7-bit ASCIIå­—ç¬¦æåˆ°allowedCharactersé‡Œé¢ä¹Ÿå°†è¢«å¿½ç•¥ï¼Œä¹Ÿå°±æ˜¯<code>allowedCharacters</code>é‡Œé¢çš„å­—ç¬¦è·Ÿ7-bit ASCIIå­—ç¬¦ä¸ä¼šè¢«ç¼–ç ã€‚</p><p>æ¢å¥è¯è¯´ï¼Œä¸Šé¢æ–¹æ³•åœ¨å¤„ç†çš„æ—¶å€™ä¼šç¼–ç urlçš„ä¸­çš„é7-bit ASCIIå­—ç¬¦ï¼Œå¦‚è¿™äº›ã€`#%^{}â€[]|\&lt;&gt;ã€‘ï¼Œå¦‚æœéœ€è¦å¿½ç•¥ä¹‹ï¼Œéœ€è¦é€šè¿‡.allowedCharactersè¿™ä¸ªå‚æ•°æŒ‡å®šã€‚</p><p>ç„¶è€Œå¹¶ä¸æ˜¯ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ¡ˆä¾‹ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> url1 = <span class="string">"http://github.com#aaa?name=ä¸­æ–‡å­—ç¬¦&amp;key=!*'();:@&amp;=+$,/?%#[]"</span></span><br><span class="line"><span class="built_in">print</span>(url1.addingPercentEncoding(withAllowedCharacters: <span class="type">CharacterSet</span>(charactersIn: <span class="string">"#%^&#123;&#125;\"[]|\\&lt;&gt;"</span>))!)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%68%74%74%70%3A%2F%2F%67%69%74%68%75%62%2E%63%6F%6D<span class="comment">#%61%61%61%3F%6E%61%6D%65%3D%E4%B8%AD%E6%96%87%E5%AD%97%E7%AC%A6%26%6B%65%79%3D%21%2A%27%28%29%3B%3A%40%26%3D%2B%24%2C%2F%3F%#[]</span></span><br><span class="line">Program ended with <span class="built_in">exit</span> code: 0</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åªæœ‰åé¢çš„%#[]æ²¡æœ‰è¢«ç¼–ç ï¼Œå…¶ä½™éƒ½è¢«ç¼–ç äº†ï¼Œ<strong>ä¸æ˜¯æˆ‘ä»¬ä¹‹å‰æ‰€ç†è§£çš„â€œallowedCharactersé‡Œé¢çš„å­—ç¬¦è·Ÿ7-bit ASCIIå­—ç¬¦ä¸ä¼šè¢«ç¼–ç â€ï¼Œè€Œæ˜¯åªæœ‰allowedCharactersé‡Œçš„å­—ç¬¦æ‰ä¸ä¼šè¢«ç¼–ç </strong></p><p>æ­£ç¡®çš„æ–¹æ³•ï¼šä½¿ç”¨<code>inverted</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> url1 = <span class="string">"http://github.com#aaa?name=ä¸­æ–‡å­—ç¬¦&amp;key=!*'();:@&amp;=+$,/?%#[]"</span></span><br><span class="line"><span class="built_in">print</span>(url1.addingPercentEncoding(withAllowedCharacters: <span class="type">CharacterSet</span>(charactersIn: <span class="string">"#%^&#123;&#125;\"[]|\\&lt;&gt;"</span>).inverted)!)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> url1 = <span class="string">"http://github.com#aaa?name=ä¸­æ–‡å­—ç¬¦&amp;key=!*'();:@&amp;=+$,/?%#[]"</span></span><br><span class="line"><span class="built_in">print</span>(url1.addingPercentEncoding(withAllowedCharacters: CharacterSet(charactersIn: <span class="string">"#%^&#123;&#125;\"[]|\\&lt;&gt;"</span>).inverted)!)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡é›†åˆåè½¬ä¹‹åå¾—åˆ°çš„ç»“æœæ‰æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œä½†æ˜¯æ­¤å¤„çš„æ„æ€æ˜¯åçš„ï¼Œå°±æ˜¯<strong>å¯¹é›†åˆè¿›è¡Œinvertedï¼Œè¡¨ç¤ºé›†åˆå†…çš„å­—ç¬¦å’Œé7-bit ASCIIå­—ç¬¦æ˜¯éœ€è¦è½¬ç </strong>çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»¥åä½¿ç”¨è¿™ä¸ªæ–¹æ³•è¿›è¡Œè½¬ç çš„æ—¶å€™è¦ä»åé¢è¿›è¡Œè½¬ç ï¼ŒæŠŠæƒ³è¦è¿›è¡Œè½¬ç çš„ç‰¹æ®Šå­—ç¬¦å†™åœ¨é›†åˆé‡Œå°±å¥½äº†ï¼Œæ³¨æ„è¿™é‡Œè¯´çš„æ˜¯æƒ³è¦è½¬ç çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆ<strong>!*â€˜();:@&amp;=+$,/?%#[]</strong>ï¼‰ï¼Œä¸­æ–‡ä¼šè¢«è®¤ä¸ºæ˜¯é7-bit ASCIIå­—ç¬¦ä¼šè‡ªåŠ¨è½¬ç çš„ã€‚</p><h2 id="CharacterSet"><a href="#CharacterSet" class="headerlink" title="CharacterSet"></a>CharacterSet</h2><p><code>CharacterSet</code>æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œ<code>CharacterSet.urlHostAllowed</code>ç­‰é¢„åˆ¶ç±»å‹åŒ…å«äº†æ‰€æœ‰ä¸éœ€è¦è¢«è½¬ç çš„å­—ç¬¦ï¼Œ<strong>åè¿‡æ¥è¯´å°±æ˜¯æŒ‡æ˜äº†éœ€è¦è¢«è½¬ç çš„å­—ç¬¦</strong>ã€‚<code>CharacterSet</code>ç±»ä¸­æä¾›äº†ä¸€äº›å¸¸ç”¨çš„URLè½¬ç çš„ç±»å‹:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CharacterSet</span>.urlHostAllowed: è¢«è½¬ä¹‰çš„å­—ç¬¦æœ‰  <span class="string">"#%/&lt;&gt;?@\^`&#123;|&#125;</span></span><br><span class="line"><span class="string">CharacterSet.urlPathAllowed: è¢«è½¬ä¹‰çš„å­—ç¬¦æœ‰  "</span>#%;&lt;&gt;?[\]^`&#123;|&#125;</span><br><span class="line"><span class="type">CharacterSet</span>.urlUserAllowed: è¢«è½¬ä¹‰çš„å­—ç¬¦æœ‰   <span class="string">"#%/:&lt;&gt;?@[\]^`</span></span><br><span class="line"><span class="string">CharacterSet.urlQueryAllowed: è¢«è½¬ä¹‰çš„å­—ç¬¦æœ‰  "</span>#%&lt;&gt;[\]^`&#123;|&#125;</span><br><span class="line"><span class="type">CharacterSet</span>.urlPasswordAllowed è¢«è½¬ä¹‰çš„å­—ç¬¦æœ‰ <span class="string">"#%/:&lt;&gt;?@[\]^`&#123;|&#125;</span></span><br><span class="line"><span class="string">CharacterSet.urlFragmentAllowed è¢«è½¬ä¹‰çš„å­—ç¬¦æœ‰ "</span>#%&lt;&gt;[\]^`&#123;|&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h3 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> url1 = <span class="string">"http://github.com?name=ä¸­æ–‡å­—ç¬¦&amp;key=!*'();:@&amp;=+$,/?%#[]"</span></span><br><span class="line"><span class="built_in">print</span>(url1.addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed)!)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://github.com?name=%E4%B8%AD%E6%96%87%E5%AD%97%E7%AC%A6&amp;key=!*<span class="string">'();:@&amp;=+$,/?%25%23%5B%5D</span></span><br><span class="line"><span class="string">Program ended with exit code: 0</span></span><br></pre></td></tr></table></figure><h3 id="è§£ç "><a href="#è§£ç " class="headerlink" title="è§£ç "></a>è§£ç </h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> encodeUrl1 = <span class="string">"http://github.com%23aaa?name=%E4%B8%AD%E6%96%87%E5%AD%97%E7%AC%A6&amp;key=!*'();:@&amp;=+$,/?%25%23%5B%5D"</span></span><br><span class="line"><span class="built_in">print</span>(encodeUrl1.removingPercentEncoding!)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://github.com<span class="comment">#aaa?name=ä¸­æ–‡å­—ç¬¦&amp;key=!*'();:@&amp;=+$,/?%#[]</span></span><br><span class="line">Program ended with <span class="built_in">exit</span> code: 0</span><br></pre></td></tr></table></figure><h1 id="URLå¸¦æœ‰-ç¬¦å·çš„é—®é¢˜"><a href="#URLå¸¦æœ‰-ç¬¦å·çš„é—®é¢˜" class="headerlink" title="URLå¸¦æœ‰#ç¬¦å·çš„é—®é¢˜"></a>URLå¸¦æœ‰#ç¬¦å·çš„é—®é¢˜</h1><p>#æ˜¯urlä¸­çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œæ˜¯è·Ÿåœ¨urlå‚æ•°ä¹‹åçš„çš„æœ€åä¸€éƒ¨åˆ†ï¼Œä½œä¸ºä¸€ä¸ªurlçš„é”šç‚¹ï¼Œç”¨äºæµè§ˆå™¨çš„å®šä½ã€‚</p><p>ä½†æ˜¯åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„æ—¶å€™å‘ç°#å·è¢«è½¬ä¹‰æ‰äº†ï¼Œå‰ç«¯é‚£è¾¹å°±æ²¡æœ‰åŠæ³•æ­£å¸¸æ˜¾ç¤ºã€‚æ‰€ä»¥éœ€è¦å…¶ä»–ç‰¹æ®Šå­—ç¬¦æ­£å¸¸è½¬ä¹‰ï¼Œé™¤å»#å·ã€‚</p><h2 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h2><p>æ²¿ç”¨é¢„åˆ¶ç±»å‹ï¼Œé‡‡ç”¨insertæ–¹æ³•</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> urlStr = <span class="string">"http://test.com/ä¸­æ–‡/main.html#/help"</span></span><br><span class="line"><span class="keyword">var</span> charSet = <span class="type">CharacterSet</span>.urlQueryAllowed</span><br><span class="line">charSet.insert(charactersIn: <span class="string">"#"</span>)</span><br><span class="line"><span class="keyword">let</span> encodingURL = urlStr.addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed)!</span><br><span class="line"><span class="built_in">print</span>(encodingURL)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé‡‡ç”¨äº†é¢„åˆ¶çš„ï¼Œinsertä¼šåè¿‡æ¥è¢«åˆ é™¤æ‰</p><blockquote><p>è‡³äºinsertçš„åŸå› ï¼Œå¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ä»¥ä¸‹ä»£ç </p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">let</span> url1 = <span class="string">"http://github.com#aaa?name=ä¸­æ–‡å­—ç¬¦&amp;key=!*'();:@&amp;=+$,/?%#[]"</span></span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="string">"-----------------æœªåè½¬æƒ…å†µ-------------------------"</span>)</span><br><span class="line">&gt; <span class="keyword">var</span> s1 = <span class="type">CharacterSet</span>(charactersIn: #<span class="string">"[]"</span>#)</span><br><span class="line">&gt; <span class="built_in">print</span>(url1.addingPercentEncoding(withAllowedCharacters: s1.inverted)!)</span><br><span class="line">&gt; s1.insert(charactersIn: <span class="string">"["</span>)</span><br><span class="line">&gt; <span class="built_in">print</span>(url1.addingPercentEncoding(withAllowedCharacters: s1.inverted)!)</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="string">"-----------------åè½¬æƒ…å†µ-------------------------"</span>)</span><br><span class="line">&gt; <span class="keyword">var</span> s2 = <span class="type">CharacterSet</span>(charactersIn: #<span class="string">"[]"</span>#).inverted</span><br><span class="line">&gt; <span class="built_in">print</span>(url1.addingPercentEncoding(withAllowedCharacters: s2)!)</span><br><span class="line">&gt; s2.insert(charactersIn: <span class="string">"["</span>)</span><br><span class="line">&gt; <span class="built_in">print</span>(url1.addingPercentEncoding(withAllowedCharacters: s2)!)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><blockquote><p>è¾“å‡ºç»“æœï¼Œç•™æ„æœ€åçš„[]ç¬¦å·æ˜¯å¦è¢«è½¬ä¹‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; -----------------æœªåè½¬æƒ…å†µ-------------------------</span><br><span class="line">&gt; http://github.com<span class="comment">#aaa?name=%E4%B8%AD%E6%96%87%E5%AD%97%E7%AC%A6&amp;key=!*'();:@&amp;=+$,/?%#%5B%5D</span></span><br><span class="line">&gt; http://github.com<span class="comment">#aaa?name=%E4%B8%AD%E6%96%87%E5%AD%97%E7%AC%A6&amp;key=!*'();:@&amp;=+$,/?%#%5B%5D</span></span><br><span class="line">&gt; -----------------åè½¬æƒ…å†µ-------------------------</span><br><span class="line">&gt; http://github.com<span class="comment">#aaa?name=%E4%B8%AD%E6%96%87%E5%AD%97%E7%AC%A6&amp;key=!*'();:@&amp;=+$,/?%#%5B%5D</span></span><br><span class="line">&gt; http://github.com<span class="comment">#aaa?name=%E4%B8%AD%E6%96%87%E5%AD%97%E7%AC%A6&amp;key=!*'();:@&amp;=+$,/?%#[%5D</span></span><br><span class="line">&gt; Program ended with <span class="built_in">exit</span> code: 0</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><blockquote><p>è¿˜æœªæ‰¾åˆ°è§£é‡Šç†ç”±</p></blockquote><h2 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h2><p>è‡ªå®šä¹‰</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> urlStr = <span class="string">"http://test.com/ä¸­æ–‡/main.html#/help"</span></span><br><span class="line"><span class="keyword">let</span> encodingURL = urlStr.addingPercentEncoding(withAllowedCharacters: <span class="type">CharacterSet</span>(charactersIn: #<span class="string">""</span>%&lt;&gt;[\]^`&#123;|&#125;<span class="string">"#).inverted)!</span></span><br><span class="line"><span class="string">print(encodingURL)</span></span><br></pre></td></tr></table></figure><h1 id="Jsonçš„URLç¼–ç "><a href="#Jsonçš„URLç¼–ç " class="headerlink" title="Jsonçš„URLç¼–ç "></a>Jsonçš„URLç¼–ç </h1><p>æˆ‘å…¬å¸æœ‰çš„é“¾æ¥éœ€è¦æ‹¼æ¥ä¸Šä¸€å¤§æ®µçš„jsonï¼Œé‡Œé¢jsonè¿˜æœ‰å¤æ‚çš„&amp;ç­‰ç¬¦å·ï¼Œé¢„åˆ¶çš„è‚¯å®šä¸å¤Ÿç”¨ï¼Œåªèƒ½é‡‡ç”¨è‡ªå®šä¹‰æ–¹æ³•ï¼š</p><p>æ‰€ä»¥å°è£…äº†æ–¹æ³•ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">String</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">urlEncoding</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> toSearchword = (<span class="keyword">self</span> <span class="keyword">as</span> <span class="type">NSString</span>).addingPercentEncoding(withAllowedCharacters: <span class="type">CharacterSet</span>(charactersIn: #<span class="string">"?!@#$^&amp;%*+,:;='"</span>`&lt;&gt;()[]&#123;&#125;/\|<span class="string">"#).inverted)</span></span><br><span class="line"><span class="string">        return toSearchword as String? ?? "</span><span class="string">"</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥ä½¿ç”¨å³å¯</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> urlStr = <span class="string">"http://test.com/ä¸­æ–‡/main.html#/help"</span></span><br><span class="line"><span class="built_in">print</span>(urlStr.urlEncoding())</span><br></pre></td></tr></table></figure><h1 id="é¢˜å¤–è¯"><a href="#é¢˜å¤–è¯" class="headerlink" title="é¢˜å¤–è¯"></a>é¢˜å¤–è¯</h1><h2 id="Swift-5-å­—ç¬¦ä¸²è½¬ä¹‰å­—ç¬¦å¤„ç†"><a href="#Swift-5-å­—ç¬¦ä¸²è½¬ä¹‰å­—ç¬¦å¤„ç†" class="headerlink" title="Swift 5 å­—ç¬¦ä¸²è½¬ä¹‰å­—ç¬¦å¤„ç†"></a>Swift 5 å­—ç¬¦ä¸²è½¬ä¹‰å­—ç¬¦å¤„ç†</h2><p>å¢åŠ äº† # ç¬¦å·ï¼Œä½¿å¾—å†™å­—ç¬¦ä¸²æ›´åŠ ç®€å•ã€‚</p><p><strong>åœ¨å­—ç¬¦ä¸²ä¸­åŒ…å« â€œ æ—¶ä¸å¿…å†åŠ  \ </strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//before</span><br><span class="line">let rain = &quot;The is\&quot;new\&quot;string&quot; </span><br><span class="line">//after</span><br><span class="line">let rain = #&quot;The is&quot;new&quot;string&quot;#</span><br></pre></td></tr></table></figure><p><strong>åŒ…å« \ åæ–œæ ä¹Ÿä¸éœ€è¦å†åŠ è½¬ä¹‰ç¬¦</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//before</span></span><br><span class="line"><span class="keyword">let</span> rain = <span class="string">"The is\\new string"</span> </span><br><span class="line"><span class="comment">//after</span></span><br><span class="line"><span class="keyword">let</span> rain = <span class="meta">#"The is \new string"#</span></span><br></pre></td></tr></table></figure><p><strong>ç”±äºåæ–œæ ä½œä¸ºå­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ï¼Œæ‰€ä»¥åœ¨æ’å…¥å€¼çš„æ—¶å€™éœ€è¦åœ¨åé¢å†åŠ ä¸ª #</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//before</span></span><br><span class="line"><span class="keyword">let</span> age = <span class="number">26</span></span><br><span class="line"><span class="keyword">let</span> dontpanic = <span class="string">"myAge is \(age)"</span></span><br><span class="line"><span class="comment">// after</span></span><br><span class="line"><span class="keyword">let</span> answer = <span class="number">26</span></span><br><span class="line"><span class="keyword">let</span> dontpanic = <span class="meta">#"myAge is \#(age)"#</span></span><br></pre></td></tr></table></figure><p><strong>å½“å­—ç¬¦ä¸²åŒ…å« # æ—¶ï¼Œ å‰ååº”ç”¨ ## åŒ…è£¹å­—ç¬¦ä¸²</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="built_in">str</span> = ##<span class="string">"this is "</span>a<span class="string">"#good ideal"</span>##</span><br></pre></td></tr></table></figure><p><strong>ç”¨ #â€â€â€ å¼€å¤´ â€œâ€â€#ç»“å°¾ æ¥è¡¨ç¤ºå¤šè¡Œå­—ç¬¦ä¸²</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> multiline = <span class="comment">#"""</span></span><br><span class="line">The answer to life,</span><br><span class="line">the universe,</span><br><span class="line">and everything is \<span class="comment">#(answer).</span></span><br><span class="line"><span class="string">""</span><span class="string">"#</span></span><br></pre></td></tr></table></figure><p><strong>ç”±äºä¸ç”¨åæ–œæ è½¬ä¹‰ ä½¿å¾—æ­£åˆ™è¡¨è¾¾å¼æ›´åŠ ç®€æ´æ˜äº†</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//before</span></span><br><span class="line"><span class="keyword">let</span> regex1 = <span class="string">"\\\\[A-Z]+[A-Za-z]+\\.[a-z]+"</span></span><br><span class="line"><span class="comment">//after</span></span><br><span class="line"><span class="keyword">let</span> regex2 = <span class="meta">#"\\[A-Z]+[A-Za-z]+\.[a-z]+"#</span></span><br></pre></td></tr></table></figure><h2 id="Objective-C-url-encode"><a href="#Objective-C-url-encode" class="headerlink" title="Objective-C url encode"></a>Objective-C url encode</h2><p>APIè°ƒç”¨éƒ½æ˜¯ä¸€æ ·çš„,ä¸è¿‡ç½‘ä¸Šæµä¼ çš„æ¯”è¾ƒå¤šçš„æ˜¯ç”¨çš„<code>C API</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NSString *ciphertext = @&quot;saf#*&amp;&quot;;        </span><br><span class="line">NSCharacterSet *set = [[NSCharacterSet characterSetWithCharactersInString:@&quot;!*&apos;();:@&amp;=+$,/?%#[]&quot;] invertedSet];</span><br><span class="line">NSString *resultString = [ciphertext stringByAddingPercentEncodingWithAllowedCharacters: set];</span><br></pre></td></tr></table></figure><p>C API</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NSString *ciphertext = @<span class="string">"saf#*&amp;"</span>;</span><br><span class="line">NSString *encodedStr = (NSString *)CFBridgingRelease(CFURLCreateStringByAddingPercentEscapes</span><br><span class="line">                                                     (kCFAllocatorDefault,</span><br><span class="line">                                                      (CFStringRef)ciphertext,</span><br><span class="line">                                                      <span class="literal">NULL</span>,</span><br><span class="line">                                                      CFSTR(<span class="string">"!*'();:@&amp;=+$,/?%#[]"</span>),</span><br><span class="line">                                                      kCFStringEncodingUTF8));</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://www.jianshu.com/p/c135127a3df2" target="_blank" rel="noopener">https://www.jianshu.com/p/c135127a3df2</a></p><p><a href="https://www.jianshu.com/p/74f7c5bbca50" target="_blank" rel="noopener">https://www.jianshu.com/p/74f7c5bbca50</a></p><p><a href="https://www.hangge.com/blog/cache/detail_1583.html" target="_blank" rel="noopener">https://www.hangge.com/blog/cache/detail_1583.html</a></p><p><a href="https://www.cnblogs.com/luoxiaofu/p/7110011.html" target="_blank" rel="noopener">https://www.cnblogs.com/luoxiaofu/p/7110011.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨ä½¿ç”¨WKWebviewçš„æ—¶å€™ï¼Œé€šå¸¸éƒ½ç¦»ä¸å¼€URLï¼Œä¸€èˆ¬çš„ç¬¦åˆç½‘ç»œæ ‡å‡†çš„URLæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯åœ¨å…¬å¸å¼€å‘çš„æ—¶å€™é‡åˆ°äº†ä¸€äº›ç‰¹æ®ŠURLçš„æ—¶å€™å°±è¸©åˆ°äº†URLç¼–ç çš„å‘ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨1994å¹´è®¢åˆ¶çš„RFC1738æ–‡æ¡£ä¸­ï¼Œå¯¹å­—ç¬¦ä¸²ä¸­çš„é™¤äº†&lt;code&gt;- _ .&lt;/code&gt;ä¹‹å¤–çš„æ‰€æœ‰éå­—æ¯æ•°å­—å­—ç¬¦éƒ½æ›¿æ¢æˆç™¾åˆ†å·(%)åè·Ÿä¸¤ä½åå…­è¿›åˆ¶æ•°ï¼Œåå…­è¿›åˆ¶æ•°ä¸­å­—æ¯å¿…é¡»ä¸ºå¤§å†™ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨2005å¹´å®šä¹‰çš„RFC3986ä¸­ï¼Œå°†é’ˆå¯¹&lt;code&gt;- _.~&lt;/code&gt;å››ä¸ªå­—ç¬¦ä¹‹å¤–çš„æ‰€æœ‰éå­—æ¯æ•°å­—å­—ç¬¦è¿›è¡Œç™¾åˆ†å·ç¼–ç ã€‚å½“ç„¶ æ ¹æ®URLçš„ç±»å‹ä¸åŒï¼Œæœ‰ä¹Ÿä¸€éƒ¨åˆ†é¢„ç•™å­—ç¬¦ä¸éœ€è¦è¿›è¡Œç¼–ç ï¼Œä¾‹å¦‚æŸ¥è¯¢çš„&lt;code&gt;URL&lt;/code&gt;ä¸­å¯ä»¥åŒ…å«&lt;code&gt;? /&lt;/code&gt;å­—ç¬¦ï¼Œä¸éœ€è¦è½¬ä¹‰ã€‚æ›´è¯¦ç»†æ–‡æ¡£çš„å¯ä»¥æŸ¥çœ‹&lt;a href=&quot;http://www.ietf.org/rfc/rfc3986.txt&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;RFC 3986&lt;/a&gt;ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Ios" scheme="http://hackycy.github.io/categories/Ios/"/>
    
    
      <category term="Ios" scheme="http://hackycy.github.io/tags/Ios/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€æ¬¡ Vivo Y91 è°ƒè¯•APKçš„å‘</title>
    <link href="http://hackycy.github.io/2020/04/14/%E8%AE%B0%E4%B8%80%E6%AC%A1-Vivo-Y91-%E8%B0%83%E8%AF%95APK%E7%9A%84%E5%9D%91/"/>
    <id>http://hackycy.github.io/2020/04/14/è®°ä¸€æ¬¡-Vivo-Y91-è°ƒè¯•APKçš„å‘/</id>
    <published>2020-04-14T14:47:46.000Z</published>
    <updated>2020-06-04T06:12:49.380Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h1><p>åœ¨é¡¹ç›®å·¥ä½œæµ‹è¯•é€”ä¸­ï¼Œå‘ç°Vivo Y91çš„æœºå‹å´ä¸€ç›´å‡ºç°debugå®‰è£…è¿è¡Œé—®é¢˜</p><a id="more"></a><h1 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h1><p>1.è®¾ç½®Android Studioï¼Œå…³é—­<code>Instant Run</code>ã€‚<code>File</code>-&gt;<code>Settings</code>-&gt;<code>BUild,Executionâ€¦</code>-&gt;<code>Instant Run</code> , å…³é—­å‹¾é€‰<code>Enable Instant Run</code><br>2.åœ¨ä½ çš„gradle.propertiesæ–‡ä»¶æ·»åŠ ä¸€å¥:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android.injected.testOnly = false</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–è§£å†³æ–¹æ³•ï¼ˆæœªæµ‹è¯•ï¼‰"><a href="#å…¶ä»–è§£å†³æ–¹æ³•ï¼ˆæœªæµ‹è¯•ï¼‰" class="headerlink" title="å…¶ä»–è§£å†³æ–¹æ³•ï¼ˆæœªæµ‹è¯•ï¼‰"></a>å…¶ä»–è§£å†³æ–¹æ³•ï¼ˆæœªæµ‹è¯•ï¼‰</h2><p>æ ¹æ®æ¯ä¸ªæ‰‹æœºä¸åŒï¼ŒæœªçŸ¥ä¹Ÿä¸å¤ªä¸€æ ·ï¼Œæ¯”å¦‚ vivo x21 æ˜¯åœ¨ï¼šè®¾ç½® -&gt; æ›´å¤šè®¾ç½® -&gt; æœªçŸ¥xxç®¡ç†ï¼ˆè®°ä¸å¤ªæ¸…æ¥šäº†ï¼‰ã€‚</p><p>ä¸€åŠ 3Tå‰æ®µæ—¶é—´æ›´æ–°äº† Android 8.0 ï¼Œå®ƒçš„ä½ç½®åœ¨ï¼š è®¾ç½® -&gt; åº”ç”¨ç¨‹åº -&gt; ç‰¹æ®Šè®¿é—®æƒé™ -&gt; å®‰è£…æœªçŸ¥åº”ç”¨ã€‚å¦‚ä¸‹å›¾ï¼Œæ‰“å¼€å¯¹åº”çš„è½¯ä»¶å³å¯ã€‚</p><h1 id="è§£é‡Š"><a href="#è§£é‡Š" class="headerlink" title="è§£é‡Š"></a>è§£é‡Š</h1><p>å…³äºå¼€å‘è¿‡ç¨‹ä¸­æ˜¯å¦å¼€å¯ Instant Runï¼Œæˆ‘ä¸ªäººå»ºè®®è¿˜æ˜¯å…³é—­å®ƒï¼Œæˆ‘åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¸€ç›´éƒ½æ˜¯å…³é—­ç€çš„ï¼Œå› ä¸ºä¹‹å‰å¼€å¯å®ƒï¼Œå‡ºç°äº†ä¸€äº›è«åå…¶å¦™çš„é—®é¢˜ï¼Œç›®å‰æˆ‘ä»¬çš„ç¥å™¨ Android Studio å·²ç»ä¼˜åŒ–çš„å¾ˆå¥½äº†ï¼Œå³ä½¿é‡æ–°æ‰“åŒ…ï¼Œä¹Ÿæµªè´¹ä¸äº†å¤šå°‘æ—¶é—´ã€‚</p><p>å…³äº<code>android.injected.testOnly = false</code>çš„è®¾ç½®ï¼Œé‚£æ˜¯å› ä¸ºæˆ‘ä»¬è·‘çš„ run apkéƒ½æ˜¯ debug ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯æµ‹è¯•ç‰ˆæœ¬ï¼Œè€Œ vivo çš„ä¸€äº›å°±ä¸æ”¯æŒè¿™ä¸ªæµ‹è¯•apkï¼ˆç½‘ä¸Šæœ‰äººè¿™æ ·è¯´ï¼Œç»è¿‡éªŒè¯ï¼Œä¸å‡ï¼Œåœ¨æ‰¾ç­”æ¡ˆçš„è¿‡ç¨‹ä¸­ï¼Œçœ‹åˆ°è¿‡å¾ˆå¤šåæ§½ï¼švivo x21ã€Y91ä¸é€‚åˆåšæµ‹è¯•æœºï¼Œå› ä¸ºå®ƒåªè®¤æ­£å¼åŒ…ï¼‰</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;åŸå› &quot;&gt;&lt;a href=&quot;#åŸå› &quot; class=&quot;headerlink&quot; title=&quot;åŸå› &quot;&gt;&lt;/a&gt;åŸå› &lt;/h1&gt;&lt;p&gt;åœ¨é¡¹ç›®å·¥ä½œæµ‹è¯•é€”ä¸­ï¼Œå‘ç°Vivo Y91çš„æœºå‹å´ä¸€ç›´å‡ºç°debugå®‰è£…è¿è¡Œé—®é¢˜&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://hackycy.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="http://hackycy.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Androidå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯æ—¶é—´åŒæ­¥æ–¹æ¡ˆ</title>
    <link href="http://hackycy.github.io/2020/03/20/Android%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8E%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88/"/>
    <id>http://hackycy.github.io/2020/03/20/Androidå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯æ—¶é—´åŒæ­¥æ–¹æ¡ˆ/</id>
    <published>2020-03-20T11:50:41.000Z</published>
    <updated>2020-06-04T06:12:48.892Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ€è¿‘é¡¹ç›®çš„ç¼–å†™ä¸­ï¼Œæ¥å£éœ€è¦æäº¤ç²¾ç¡®åˆ°ç§’çº§çš„æ—¶é—´æˆ³ç”¨ä½œæ ¡éªŒã€‚ä½†æ˜¯ä»…ä»…ä½¿ç”¨<code>System.currentTimeMillis()</code>ä¼šé¢ä¸´ç€æœ¬åœ°çš„æ—¶é—´ä¸æœåŠ¡å™¨æ—¶é—´ä¸ä¸€è‡´çš„é—®é¢˜ã€‚é‚£ä¹ˆæœ¬æ–‡æ–¹æ¡ˆèƒ½è®©æœ¬åœ°åº”ç”¨æ—¶é—´ä¸æœåŠ¡å™¨æ—¶é—´å­˜åœ¨è¯¯å·®èŒƒå›´å†…ä¿æŒåŒæ­¥ï¼Œå‡å°‘åº”ç”¨å‡ºé”™ç‡ã€‚</p><a id="more"></a><h1 id="é¢„å¤‡çŸ¥è¯†"><a href="#é¢„å¤‡çŸ¥è¯†" class="headerlink" title="é¢„å¤‡çŸ¥è¯†"></a>é¢„å¤‡çŸ¥è¯†</h1><ul><li><code>SystemClock.elapsedRealtime()</code> ï¼šæ‰‹æœºç³»ç»Ÿå¼€æœºæ—¶é—´ï¼ˆåŒ…å«ç¡çœ æ—¶é—´ï¼‰ï¼Œç”¨æˆ·æ— æ³•åœ¨è®¾ç½®é‡Œé¢ä¿®æ”¹ã€‚</li><li>åœ¨å¿…è¦çš„æ—¶åˆ»è·å–ä¸€ä¸‹æœåŠ¡å™¨æ—¶é—´ï¼Œç„¶åè®°å½•è¿™ä¸ªæ—¶åˆ»çš„æ‰‹æœºå¼€æœºæ—¶é—´ï¼ˆelapsedRealtimeï¼‰</li><li>åç»­æ—¶é—´è·å–ï¼š<strong>ç°åœ¨æœåŠ¡å™¨æ—¶é—´ = ä»¥å‰æœåŠ¡å™¨æ—¶é—´ + ç°åœ¨æ‰‹æœºå¼€æœºæ—¶é—´ - ä»¥å‰æœåŠ¡å™¨æ—¶é—´çš„è·å–æ—¶åˆ»çš„æ‰‹æœºå¼€æœºæ—¶é—´</strong></li><li>åˆ©ç”¨OkHttpçš„Interceptorè‡ªåŠ¨åŒæ­¥æ—¶é—´</li></ul><h1 id="TimeUtilsç¼–å†™"><a href="#TimeUtilsç¼–å†™" class="headerlink" title="TimeUtilsç¼–å†™"></a>TimeUtilsç¼–å†™</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.os.SystemClock;</span><br><span class="line"><span class="keyword">import</span> android.text.TextUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.blankj.utilcode.util.LogUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> okhttp3.Headers;</span><br><span class="line"><span class="keyword">import</span> okhttp3.Interceptor;</span><br><span class="line"><span class="keyword">import</span> okhttp3.Request;</span><br><span class="line"><span class="keyword">import</span> okhttp3.Response;</span><br><span class="line"><span class="keyword">import</span> okhttp3.internal.http.HttpDate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥å‰æœåŠ¡å™¨æ—¶é—´ - ä»¥å‰æœåŠ¡å™¨æ—¶é—´çš„è·å–æ—¶åˆ»çš„ç³»ç»Ÿå¯åŠ¨æ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> diffTime = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜¯å¦æ˜¯æœåŠ¡å™¨æ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> isServerTime = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å½“å‰æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">getServerTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isServerTime) &#123;</span><br><span class="line">            <span class="keyword">return</span> System.currentTimeMillis() / <span class="number">1000</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (diffTime + SystemClock.elapsedRealtime()) / <span class="number">1000</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">calibrationTime</span><span class="params">(<span class="keyword">long</span> lastServerTime)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è®°å½•æ—¶é—´å·®</span></span><br><span class="line">        diffTime = lastServerTime - SystemClock.elapsedRealtime();</span><br><span class="line">        isServerTime = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">return</span> lastServerTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * åˆ©ç”¨OkHttpçš„Interceptorè‡ªåŠ¨åŒæ­¥æ—¶é—´</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeSyncInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> minResponseTime = Long.MAX_VALUE;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            Request request = chain.request();</span><br><span class="line">            <span class="keyword">long</span> startTime = System.nanoTime();</span><br><span class="line">            Response proceed = chain.proceed(request);</span><br><span class="line">            <span class="keyword">long</span> lastTime = System.nanoTime() - startTime;</span><br><span class="line"></span><br><span class="line">            Headers headers = proceed.headers();</span><br><span class="line">            calibration(lastTime, headers);</span><br><span class="line">            <span class="keyword">return</span> proceed;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">calibration</span><span class="params">(<span class="keyword">long</span> responseTime, Headers headers)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (headers == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å¦‚æœè¿™ä¸€æ¬¡çš„è¯·æ±‚å“åº”æ—¶é—´å°äºä¸Šä¸€æ¬¡ï¼Œåˆ™æ›´æ–°æœ¬åœ°ç»´æŠ¤çš„æ—¶é—´</span></span><br><span class="line">            <span class="keyword">if</span> (responseTime &gt;= minResponseTime) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="comment">// ç½‘ç»œå“åº”å¤´åŒ…å«Dateå­—æ®µï¼ˆä¸–ç•Œæ—¶é—´ï¼‰</span></span><br><span class="line">          <span class="comment">// åˆ©ç”¨Interceptorè®°å½•æ¯æ¬¡è¯·æ±‚å“åº”æ—¶é—´ï¼Œå¦‚æœæœ¬æ¬¡ç½‘ç»œæ“ä½œçš„æ—¶é—´å°äºä¸Šä¸€æ¬¡ç½‘ç»œæ“ä½œçš„æ—¶é—´ï¼Œåˆ™è·å–Dateå­—æ®µï¼Œè½¬æ¢æ—¶åŒºåæ›´æ–°æœ¬åœ°TimeUtilsã€‚</span></span><br><span class="line">            String standardTime = headers.get(<span class="string">"Date"</span>);</span><br><span class="line">            <span class="keyword">if</span> (!TextUtils.isEmpty(standardTime)) &#123;</span><br><span class="line"></span><br><span class="line">                Date parse = HttpDate.parse(standardTime);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (parse != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// å®¢æˆ·ç«¯è¯·æ±‚è¿‡ç¨‹ä¸€èˆ¬å¤§äºæ¯”æ”¶åˆ°å“åº”æ—¶é—´è€—æ—¶ï¼Œæ‰€ä»¥æ²¡æœ‰ç®€å•çš„é™¤2 åŠ ä¸Šå»ï¼Œè€Œæ˜¯ç›´æ¥ç”¨è¯¥æ—¶é—´</span></span><br><span class="line">                    TimeUtils.calibrationTime(parse.getTime());</span><br><span class="line">                    minResponseTime = responseTime;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åŸç†å°±æ˜¯é€šè¿‡HTTP Headeræ¥è·å–æœåŠ¡å™¨æ—¶é—´ï¼ˆæ³¨ï¼šæ—¶é—´æ ¼å¼ä»¥<a href="https://link.jianshu.com/?t=https%3A%2F%2Ftools.ietf.org%2Fhtml%2Frfc7231%23section-7.1.1.1" target="_blank" rel="noopener">RFC-7231</a>ä¸­å®šä¹‰çš„â€HTTPæ—¥æœŸâ€æ ¼å¼æ¥å‘é€ï¼‰</p><p>åœ¨OkHttpClientå¢åŠ è¯¥Utilsä¸‹çš„æ‹¦æˆªå™¨å³å¯ã€‚</p><p>ç”±äºé¡¹ç›®ä¸­åªéœ€è¦ç²¾ç¡®åˆ°ç§’ï¼Œè€Œè·å–çš„éƒ½æ˜¯ç²¾ç¡®åˆ°æ¯«ç§’çº§åˆ«ï¼Œæ‰€ä»¥TimeUtilsä¸‹è·å–çš„æ—¶å€™åšäº†é™¤ä»¥1000å¤„ç†ã€‚å¯èƒ½ä¼šå­˜åœ¨ç‚¹è¯¯å·®å§ã€‚ä½†æ˜¯åœ¨é¡¹ç›®ä¸­è¯¯å·®èŒƒå›´ä¸å¤§ï¼Œè¿˜åœ¨å¯æ¥å—èŒƒå›´å†…ã€‚</p><p>ä¸è¶³ï¼šè¿æ¥æœåŠ¡å™¨çš„è¿‡ç¨‹æ˜¯éœ€è¦æ—¶é—´çš„ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æ—¶åˆ»çš„æ—¶é—´ä¸åº”ç”¨æ”¶åˆ°å“åº”å­˜åœ¨ä¸€å®šçš„æ—¶é—´å·®ï¼Œå¯¼è‡´è¯¯å·®çš„å­˜åœ¨ï¼ˆè¯¯å·®=æœåŠ¡å™¨å‘å‡ºå“åº”-&gt;åˆ°æœ¬æœºæ”¶åˆ°å“åº”è¿™ä¸ªæ—¶é—´ï¼‰ã€‚</p><p>ä½†æ˜¯é€šè¿‡ä¸Šé¢çš„TimeSyncInterceptoræ¯æ¬¡åˆ¤æ–­ï¼Œå¯ä»¥ä½¿å¾—è¯¯å·®é€æ¸é™ä½</p></blockquote><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://blog.csdn.net/qinci/article/details/70666631" target="_blank" rel="noopener">https://blog.csdn.net/qinci/article/details/70666631</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æœ€è¿‘é¡¹ç›®çš„ç¼–å†™ä¸­ï¼Œæ¥å£éœ€è¦æäº¤ç²¾ç¡®åˆ°ç§’çº§çš„æ—¶é—´æˆ³ç”¨ä½œæ ¡éªŒã€‚ä½†æ˜¯ä»…ä»…ä½¿ç”¨&lt;code&gt;System.currentTimeMillis()&lt;/code&gt;ä¼šé¢ä¸´ç€æœ¬åœ°çš„æ—¶é—´ä¸æœåŠ¡å™¨æ—¶é—´ä¸ä¸€è‡´çš„é—®é¢˜ã€‚é‚£ä¹ˆæœ¬æ–‡æ–¹æ¡ˆèƒ½è®©æœ¬åœ°åº”ç”¨æ—¶é—´ä¸æœåŠ¡å™¨æ—¶é—´å­˜åœ¨è¯¯å·®èŒƒå›´å†…ä¿æŒåŒæ­¥ï¼Œå‡å°‘åº”ç”¨å‡ºé”™ç‡ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://hackycy.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="http://hackycy.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Android TextViewå¯Œæ–‡æœ¬ä¹‹Htmlæ ‡ç­¾</title>
    <link href="http://hackycy.github.io/2020/03/19/Android-TextView%E5%AF%8C%E6%96%87%E6%9C%AC%E4%B9%8BHtml%E6%A0%87%E7%AD%BE/"/>
    <id>http://hackycy.github.io/2020/03/19/Android-TextViewå¯Œæ–‡æœ¬ä¹‹Htmlæ ‡ç­¾/</id>
    <published>2020-03-19T11:59:58.000Z</published>
    <updated>2020-06-04T06:12:48.820Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>TextViewä½œä¸ºä¸€ä¸ªæˆ‘ä»¬ç»å¸¸ä½¿ç”¨åˆ°çš„æ§ä»¶ï¼Œä½†æ˜¯åœ¨å†™ä¸€äº›UIçš„æ—¶å€™ä¼šé‡åˆ°ä¸€äº›ç‰¹åˆ«çš„æƒ…å†µï¼Œæ¥çœ‹ä¸€ä¸‹ç¤ºä¾‹å›¾ï¼š</p><a id="more"></a><p><img src="anli.png" alt></p><p>åˆ¸çš„ä»·æ ¼æ˜¯éœ€è¦çªå‡ºæ˜¾ç¤ºçš„ï¼Œè¿˜æœ‰åŸä»·ä¹Ÿéœ€è¦æ˜¾ç¤ºä¸€ä¸ªåˆ é™¤çº¿ã€‚</p><h1 id="TextViewçš„å¤šæ ·åŒ–æ˜¾ç¤º"><a href="#TextViewçš„å¤šæ ·åŒ–æ˜¾ç¤º" class="headerlink" title="TextViewçš„å¤šæ ·åŒ–æ˜¾ç¤º"></a>TextViewçš„å¤šæ ·åŒ–æ˜¾ç¤º</h1><p>å¦‚æœæ˜¯æ˜¾ç¤ºä¸åŒæ ·çš„å¤§å°æ–‡æœ¬å­—ä½“é¢œè‰²å¯ä»¥ç›´æ¥ä½¿ç”¨SpannableStringå®ç°ã€‚ä½†æ˜¯è¿™é‡Œä½¿ç”¨HTMLæ ‡ç­¾æ¥å®ç°æ•ˆæœã€‚</p><p>ä¾‹å¦‚å›¾ä¸Šçš„åˆ¸åæ–‡æœ¬ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mTextView.setText(Html.fromHtml(<span class="string">"&lt;small&gt;åˆ¸åä»…&lt;/small&gt;&lt;big&gt; 20 &lt;/big&gt;&lt;small&gt;å…ƒ&lt;/small&gt;"</span>));</span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨strings.xmlä¸­å®šä¹‰æ—¶å€™éœ€è¦æ³¨æ„ï¼Œéœ€è¦è½¬ä¹‰HTMLæ ‡ç­¾ï¼Œä¸ç„¶çš„è¯ ç»è¿‡Androidå¤„ç†å æ‰€æœ‰çš„HTMLæ ‡ç­¾éƒ½ç»™è¿‡æ»¤æ‰äº†ã€‚éœ€è¦æŠŠæ‰€æœ‰çš„â€œ&lt;â€ç”¨â€œ&lt;â€æ›¿æ¢ï¼Œä¾‹å¦‚ï¼š </p><p><code>&lt;string name=&quot;htmlText&quot;&gt;&amp;lt;strong&gt;ç²—ä½“&amp;lt;/strong&gt;&lt;/string&gt;</code></p><p>å¦‚æœæ–‡æœ¬å†…å®¹æ¯”è¾ƒé•¿ï¼Œ åˆ™è½¬ä¹‰èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œå¹¶ä¸”é˜…è¯»ä¹Ÿä¸å¤ªæ–¹ä¾¿ï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨XMLçš„CDATAæ ‡è®°ï¼Œ å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"discount_price2"</span>&gt;</span>&lt;![CDATA[&lt;small&gt;åˆ¸åä»…&lt;/small&gt;&lt;big&gt; %1$s &lt;/big&gt;&lt;small&gt;å…ƒ&lt;/small&gt;]]&gt;<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>strings.xmlä¸­èŠ‚ç‚¹æ˜¯æ”¯æŒå ä½ç¬¦çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><code>&lt;string name=&quot;data&quot;&gt;æ•´æ•°å‹:%1$dï¼Œæµ®ç‚¹å‹ï¼š%2$.2fï¼Œå­—ç¬¦ä¸²:%3$s&lt;/string&gt;</code></p><p>å…¶ä¸­%åé¢æ˜¯å ä½ç¬¦çš„ä½ç½®ï¼Œä»1å¼€å§‹ï¼Œ</p><p><strong>$ åé¢æ˜¯å¡«å……æ•°æ®çš„ç±»å‹</strong></p><ul><li>$dï¼šè¡¨ç¤ºæ•´æ•°å‹ï¼›</li><li>$f ï¼šè¡¨ç¤ºæµ®ç‚¹å‹ï¼Œå…¶ä¸­få‰é¢çš„.2è¡¨ç¤ºå°æ•°çš„ä½æ•°</li><li>$sï¼šè¡¨ç¤ºå­—ç¬¦ä¸²</li></ul><p>ç„¶åä½¿ç”¨<code>Context.getResources().getString(data, ...format)</code>å³å¯</p></blockquote><p>ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„HTMLæ ‡ç­¾ã€‚</p><table><thead><tr><th style="text-align:left">Tags</th><th style="text-align:left">Format</th></tr></thead><tbody><tr><td style="text-align:left">b, strong</td><td style="text-align:left">Bold</td></tr><tr><td style="text-align:left">i, em, cite, dfn</td><td style="text-align:left">Italics</td></tr><tr><td style="text-align:left">u</td><td style="text-align:left">Underline</td></tr><tr><td style="text-align:left">sub</td><td style="text-align:left">Subtext</td></tr><tr><td style="text-align:left">sup</td><td style="text-align:left">Supertext</td></tr><tr><td style="text-align:left">big</td><td style="text-align:left">Big</td></tr><tr><td style="text-align:left">small</td><td style="text-align:left">Small</td></tr><tr><td style="text-align:left">tt</td><td style="text-align:left">Monospace</td></tr><tr><td style="text-align:left">h1 â€¦ h6</td><td style="text-align:left">Headlines</td></tr><tr><td style="text-align:left">img</td><td style="text-align:left">Image</td></tr><tr><td style="text-align:left">font</td><td style="text-align:left">Font face and color</td></tr><tr><td style="text-align:left">blockquote</td><td style="text-align:left">For longer quotes</td></tr><tr><td style="text-align:left">a</td><td style="text-align:left">Link</td></tr><tr><td style="text-align:left">div, p</td><td style="text-align:left">Paragraph</td></tr><tr><td style="text-align:left">br</td><td style="text-align:left">Linefeed</td></tr></tbody></table><p>ä¸­æ–‡ç‰ˆï¼š</p><table><thead><tr><th>æ ‡ç­¾</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>&lt;br&gt;</code></td><td>æ’å…¥ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œæ ‡ç­¾æ˜¯ç©ºæ ‡ç­¾</td></tr><tr><td><code>&lt;p&gt;</code></td><td>å®šä¹‰æ®µè½ï¼Œæ ‡ç­¾ä¼šè‡ªåŠ¨åœ¨å…¶å‰åå„æ·»åŠ ä¸€ä¸ªç©ºè¡Œ</td></tr><tr><td><code>&lt;h1&gt;</code></td><td>h1æ ‡é¢˜</td></tr><tr><td><code>&lt;h2&gt;</code></td><td>h2æ ‡é¢˜</td></tr><tr><td><code>&lt;h3&gt;</code></td><td>h3æ ‡é¢˜</td></tr><tr><td><code>&lt;h4&gt;</code></td><td>h4æ ‡é¢˜</td></tr><tr><td><code>&lt;h5&gt;</code></td><td>h5æ ‡é¢˜</td></tr><tr><td><code>&lt;h6&gt;</code></td><td>h6æ ‡é¢˜</td></tr><tr><td><code>&lt;div&gt;</code></td><td>æ–‡æ¡£åˆ†èŠ‚</td></tr><tr><td><code>&lt;strong&gt;</code></td><td>æŠŠæ–‡æœ¬å®šä¹‰ä¸ºè¯­æ°”æ›´å¼ºçš„å¼ºè°ƒçš„å†…å®¹ã€‚TextViewä¸­è¡¨ç°ä¸ºæ–‡æœ¬åŠ ç²—</td></tr><tr><td><code>&lt;b&gt;</code></td><td>æ–‡æœ¬åŠ ç²—</td></tr><tr><td><code>&lt;em&gt;</code></td><td>æŠŠæ–‡æœ¬å®šä¹‰ä¸ºå¼ºè°ƒçš„å†…å®¹ã€‚TextViewä¸­è¡¨ç°ä¸ºæ–œä½“æ–‡æœ¬æ•ˆæœã€‚</td></tr><tr><td><code>&lt;cite&gt;</code></td><td>å®šä¹‰å¼•ç”¨ï¼ŒTextViewä¸­è¡¨ç°ä¸ºæ–œä½“æ–‡æœ¬æ•ˆæœ</td></tr><tr><td><code>&lt;dfn&gt;</code></td><td>æ ‡è®°é‚£äº›å¯¹ç‰¹æ®Šæœ¯è¯­æˆ–çŸ­è¯­çš„å®šä¹‰ã€‚TextViewä¸­è¡¨ç°ä¸ºæ–œä½“æ–‡æœ¬æ•ˆæœã€‚</td></tr><tr><td><code>&lt;i&gt;</code></td><td>æ˜¾ç¤ºæ–œä½“æ–‡æœ¬æ•ˆæœ</td></tr><tr><td><code>&lt;big&gt;</code></td><td>å‘ˆç°å¤§å·å­—ä½“æ•ˆæœ</td></tr><tr><td><code>&lt;small&gt;</code></td><td>å‘ˆç°å°å·å­—ä½“æ•ˆæœ</td></tr><tr><td><code>&lt;strike&gt;</code></td><td>å®šä¹‰åˆ é™¤çº¿æ ·å¼çš„æ–‡å­—</td></tr><tr><td><code>&lt;font size=&quot;...&quot; color=&quot;...&quot; face=&quot;...&quot;&gt;</code></td><td>è§„å®šæ–‡æœ¬çš„å­—ä½“ã€å­—ä½“å°ºå¯¸ã€å­—ä½“é¢œè‰²   colorï¼šæ–‡æœ¬é¢œè‰²ï¼›sizeï¼šæ–‡æœ¬å¤§å°ï¼›faceï¼šæ–‡æœ¬å­—ä½“</td></tr><tr><td><code>&lt;blockquote&gt;</code></td><td>å°†<code>&lt;blockquote&gt;</code> ä¸ <code>&lt;/blockquote&gt;</code>ä¹‹é—´çš„æ–‡æœ¬ä»å¸¸è§„æ–‡æœ¬ä¸­åˆ†ç¦»å‡ºæ¥,é€šå¸¸åœ¨å·¦ã€å³ä¸¤è¾¹è¿›è¡Œç¼©è¿›ï¼Œæœ‰æ—¶ä½¿ç”¨æ–œä½“</td></tr><tr><td><code>&lt;tt&gt;</code></td><td>å‘ˆç°ç±»ä¼¼æ‰“å­—æœºæˆ–è€…ç­‰å®½çš„æ–‡æœ¬æ•ˆæœ</td></tr><tr><td><code>&lt;a&gt;</code></td><td>å®šä¹‰è¶…é“¾æ¥ã€‚æœ€é‡è¦çš„å±æ€§æ˜¯ href å±æ€§ï¼Œå®ƒæŒ‡ç¤ºé“¾æ¥çš„ç›®æ ‡ã€‚ hrefï¼šæŒ‡ç¤ºé“¾æ¥çš„ç›®æ ‡</td></tr><tr><td><code>&lt;u&gt;</code></td><td>ä¸ºæ–‡æœ¬æ·»åŠ ä¸‹åˆ’çº¿</td></tr><tr><td><code>&lt;sup&gt;</code></td><td>å®šä¹‰ä¸Šæ ‡æ–‡æœ¬</td></tr><tr><td><code>&lt;sub&gt;</code></td><td>å®šä¹‰ä¸‹æ ‡æ–‡æœ¬</td></tr><tr><td><code>&lt;img src=&quot;...&quot;&gt;</code></td><td>å‘ç½‘é¡µä¸­åµŒå…¥ä¸€å¹…å›¾åƒã€‚<code>&lt;img&gt;</code>æ ‡ç­¾å¹¶ä¸ä¼šåœ¨ç½‘é¡µä¸­æ’å…¥å›¾åƒï¼Œè€Œæ˜¯ä»ç½‘é¡µä¸Šé“¾æ¥å›¾åƒã€‚<code>&lt;img&gt;</code> æ ‡ç­¾åˆ›å»ºçš„æ˜¯è¢«å¼•ç”¨å›¾åƒçš„å ä½ç©ºé—´ã€‚   srcï¼šå›¾åƒçš„urlï¼›altï¼šå›¾åƒçš„æ›¿ä»£æ–‡æœ¬</td></tr></tbody></table><h1 id="strikeæ ‡ç­¾ä½¿ç”¨æ³¨æ„"><a href="#strikeæ ‡ç­¾ä½¿ç”¨æ³¨æ„" class="headerlink" title="strikeæ ‡ç­¾ä½¿ç”¨æ³¨æ„"></a>strikeæ ‡ç­¾ä½¿ç”¨æ³¨æ„</h1><p>åœ¨ä½¿ç”¨<code>&lt;strike&gt;</code>æ—¶ï¼Œ6.0ç³»ç»Ÿå¯èƒ½ä¼šä¸æ˜¾ç¤ºã€‚åˆ™éœ€è¦åœ¨ä»£ç ä¸­ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ·»åŠ åˆ é™¤çº¿      </span></span><br><span class="line">tv.getPaint().setFlags(Paint.STRIKE_THRU_TEXT_FLAG);  </span><br><span class="line"><span class="comment">//åœ¨ä»£ç ä¸­è®¾ç½®åŠ ç²—            </span></span><br><span class="line">tv.getPaint().setFlags(Paint.FAKE_BOLD_TEXT_FLAG);  </span><br><span class="line"><span class="comment">//æ·»åŠ ä¸‹åˆ’çº¿        </span></span><br><span class="line">tv.getPaint().setFlags(Paint.UNDERLINE_TEXT_FLAG);</span><br></pre></td></tr></table></figure><p>è¦ä»€ä¹ˆæ•ˆæœå¯ä»¥è‡ªå·±åœ¨ä»£ç ä¸­è®¾ç½®ï¼Œé€‰æ‹©ä¸åŒçš„ Flags å°±è¡Œäº†ã€‚</p><h1 id="aæ ‡ç­¾ä½¿ç”¨æ³¨æ„"><a href="#aæ ‡ç­¾ä½¿ç”¨æ³¨æ„" class="headerlink" title="aæ ‡ç­¾ä½¿ç”¨æ³¨æ„"></a>aæ ‡ç­¾ä½¿ç”¨æ³¨æ„</h1><p>ä½¿ç”¨aæ ‡ç­¾åè®¾ç½®äº†hrefå±æ€§åï¼Œä¸åšä»»ä½•è®¾ç½®æ˜¯æ— æ³•è¿›è¡Œç‚¹å‡»è·³è½¬çš„ï¼Œéœ€è¦TextViewè§£æè®¾ç½®ä¸€ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tv.setText(Html.fromHtml(url));<span class="comment">//è§£æhtml</span></span><br><span class="line">tv.setMovementMethod(LinkMovementMethod.getInstance());<span class="comment">//è®¾ç½®å¯ç‚¹å‡»</span></span><br></pre></td></tr></table></figure><p>æˆ–ç€xmlä¸­æ·»åŠ </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:autoLink="web"</span><br></pre></td></tr></table></figure><p>è¿™æ ·é»˜è®¤æ˜¯ç”¨æµè§ˆå™¨æ‰“å¼€aæ ‡ç­¾é‡Œé¢çš„é“¾æ¥ã€‚</p><p><strong>ä½†æ˜¯å¦‚æœè¦è·å–åˆ°aæ ‡ç­¾çš„ç‚¹å‡»äº‹ä»¶å’Œé“¾æ¥çš„è¯ï¼Œé‚£ä¹ˆå°±è¦æ¢ä¸€ä¸ªæ–¹æ³•ï¼š</strong></p><blockquote><p>å…¶ä»–æ–¹æ³•åŸºæœ¬éƒ½è¦æ¶‰åŠåˆ°SpannableStringçš„è®¾ç½®ï¼›æˆ–æ˜¯è‡ªå®šä¹‰UrlSpanï¼Œé‡å†™å®ƒçš„onClickæ–¹æ³•ï¼›æœ‰äº›è¿˜è¦éå†æ–‡æœ¬å¯»æ‰¾ä»¥httpå¼€å¤´çš„å­—ç¬¦ä¸²ã€‚ä½†æ˜¯æƒ³è¦æ‰¾ä¸€ä¸ªæ¯”è¾ƒç®€å•äº›çš„æ–¹æ³•ï¼Œæ‰€ä»¥ç”¨äº†ä¸€ä¸‹æ–¹æ³•å®ç°</p></blockquote><p>è€Œè¯¥æ–¹æ³•ä½¿ç”¨å‚è€ƒäº†LinkMovementMethodæ¥å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.text.Layout;</span><br><span class="line"><span class="keyword">import</span> android.text.Selection;</span><br><span class="line"><span class="keyword">import</span> android.text.Spannable;</span><br><span class="line"><span class="keyword">import</span> android.text.method.LinkMovementMethod;</span><br><span class="line"><span class="keyword">import</span> android.text.method.MovementMethod;</span><br><span class="line"><span class="keyword">import</span> android.text.style.URLSpan;</span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tv.xianqi.test190629.view.activity.WebViewActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebLinkMethod</span> <span class="keyword">extends</span> <span class="title">LinkMovementMethod</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> WebLinkMethod instance;</span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">WebLinkMethod</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.context = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MovementMethod <span class="title">getInstance</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>)</span><br><span class="line">            instance = <span class="keyword">new</span> WebLinkMethod(context);</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(TextView widget, Spannable buffer, MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> action = event.getAction();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (action == MotionEvent.ACTION_UP ||</span><br><span class="line">                action == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">            <span class="keyword">int</span> x = (<span class="keyword">int</span>) event.getX();</span><br><span class="line">            <span class="keyword">int</span> y = (<span class="keyword">int</span>) event.getY();</span><br><span class="line"></span><br><span class="line">            x -= widget.getTotalPaddingLeft();</span><br><span class="line">            y -= widget.getTotalPaddingTop();</span><br><span class="line"></span><br><span class="line">            x += widget.getScrollX();</span><br><span class="line">            y += widget.getScrollY();</span><br><span class="line"></span><br><span class="line">            Layout layout = widget.getLayout();</span><br><span class="line">            <span class="keyword">int</span> line = layout.getLineForVertical(y);</span><br><span class="line">            <span class="keyword">int</span> off = layout.getOffsetForHorizontal(line, x);</span><br><span class="line"><span class="comment">//          ClickableSpan[] link = buffer.getSpans(off, off, ClickableSpan.class);</span></span><br><span class="line">            URLSpan[] link = buffer.getSpans(off, off, URLSpan<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            <span class="keyword">if</span> (link.length != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (action == MotionEvent.ACTION_UP) &#123;</span><br><span class="line"><span class="comment">//                  link[0].onClick(widget);</span></span><br><span class="line"><span class="comment">//                  è¿™é‡Œæ”¹ä¸ºæˆ‘ä»¬éœ€è¦åšçš„åŠ¨ä½œ</span></span><br><span class="line">                    WebViewActivity.startWebViewActivity(context, link[<span class="number">0</span>].getURL());</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">                    Selection.setSelection(buffer,</span><br><span class="line">                            buffer.getSpanStart(link[<span class="number">0</span>]),</span><br><span class="line">                            buffer.getSpanEnd(link[<span class="number">0</span>]));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Selection.removeSelection(buffer);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(widget, buffer, event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ—¶åˆ™æ”¹ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">textView.setMovementMethodCompat(WebLinkMethod.getInstance(<span class="keyword">this</span>));</span><br></pre></td></tr></table></figure><p>ç”±äºé¡µé¢è·³è½¬æˆ‘ä»¬éœ€è¦ç”¨åˆ°åŸé¡µé¢çš„ä¸Šä¸‹æ–‡ï¼Œäºæ˜¯ä¿®æ”¹äº†æ„é€ å‡½æ•°ï¼ŒåŠ å…¥äº†Contextï¼›</p><p>URLSpanæ˜¯ClickableSpançš„å­ç±»ï¼Œå®ç°äº†getURL()çš„æ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œè¦æ¢æˆå®ƒæˆ‘ä»¬æ‰èƒ½å–åˆ°é“¾æ¥åœ°å€ï¼Œlink[0]å°±æ˜¯æˆ‘ä»¬ç‚¹å‡»åˆ°çš„è¶…é“¾æ¥å­—ç¬¦ä¸²ï¼Œé€šè¿‡link[0].getURL()æˆ‘ä»¬å¯ä»¥è·å¾—å®ƒçš„é“¾æ¥åœ°å€ã€‚</p><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><p><a href="https://blog.csdn.net/github_37847975/article/details/75425633" target="_blank" rel="noopener">https://blog.csdn.net/github_37847975/article/details/75425633</a></p><p><a href="https://blog.csdn.net/bhadx520/article/details/47433203?depth_1-utm_source=distribute.pc_relevant_right.none-task&amp;utm_source=distribute.pc_relevant_right.none-task" target="_blank" rel="noopener">https://blog.csdn.net/bhadx520/article/details/47433203?depth_1-utm_source=distribute.pc_relevant_right.none-task&amp;utm_source=distribute.pc_relevant_right.none-task</a></p><p><a href="https://blog.csdn.net/ganggang1st/article/details/6804086" target="_blank" rel="noopener">https://blog.csdn.net/ganggang1st/article/details/6804086</a></p><p><a href="https://blog.csdn.net/yulyu/article/details/52244925" target="_blank" rel="noopener">https://blog.csdn.net/yulyu/article/details/52244925</a></p><p><a href="https://www.jianshu.com/p/c4e1aacb9685" target="_blank" rel="noopener">https://www.jianshu.com/p/c4e1aacb9685</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;TextViewä½œä¸ºä¸€ä¸ªæˆ‘ä»¬ç»å¸¸ä½¿ç”¨åˆ°çš„æ§ä»¶ï¼Œä½†æ˜¯åœ¨å†™ä¸€äº›UIçš„æ—¶å€™ä¼šé‡åˆ°ä¸€äº›ç‰¹åˆ«çš„æƒ…å†µï¼Œæ¥çœ‹ä¸€ä¸‹ç¤ºä¾‹å›¾ï¼š&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://hackycy.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="http://hackycy.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>è§£å†³Android Studioâ€”â€”Received close_notify during handshake</title>
    <link href="http://hackycy.github.io/2020/02/18/%E8%A7%A3%E5%86%B3Android-Studio%E2%80%94%E2%80%94Received-close-notify-during-handshake/"/>
    <id>http://hackycy.github.io/2020/02/18/è§£å†³Android-Studioâ€”â€”Received-close-notify-during-handshake/</id>
    <published>2020-02-18T12:24:13.000Z</published>
    <updated>2020-06-04T06:12:49.380Z</updated>
    
    <content type="html"><![CDATA[<p><strong>é—®é¢˜ERROR ï¼š Received close_notify during handshake</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* What went wrong:</span><br><span class="line">A problem occurred configuring root project &apos;NotificationDemo&apos;.</span><br><span class="line">&gt; Could not resolve all artifacts for configuration &apos;:classpath&apos;.</span><br><span class="line">   &gt; Could not download guava.jar (com.google.guava:guava:23.0)</span><br><span class="line">      &gt; Could not get resource &apos;https://jcenter.bintray.com/com/google/guava/guava/23.0/guava-23.0.jar&apos;.</span><br><span class="line">         &gt; Could not GET &apos;https://jcenter.bintray.com/com/google/guava/guava/23.0/guava-23.0.jar&apos;.</span><br><span class="line">            &gt; Received close_notify during handshake</span><br><span class="line">   &gt; Could not download kotlin-reflect.jar (org.jetbrains.kotlin:kotlin-reflect:1.2.0)</span><br><span class="line">      &gt; Could not get resource &apos;https://jcenter.bintray.com/org/jetbrains/kotlin/kotlin-reflect/1.2.0/kotlin-reflect-1.2.0.jar&apos;.</span><br><span class="line">         &gt; Could not GET &apos;https://jcenter.bintray.com/org/jetbrains/kotlin/kotlin-reflect/1.2.0/kotlin-reflect-1.2.0.jar&apos;.</span><br><span class="line">            &gt; Received close_notify during handshake</span><br></pre></td></tr></table></figure><a id="more"></a><p>å¯èƒ½æ˜¯Jcenterä¸€ç›´è¿æ¥è¶…æ—¶äº†å§ï¼Œè¯·æ±‚ä¸äº†ï¼Œæ‰€ä»¥æŸ¥äº†ä¸€ä¸‹èµ„æ–™ï¼Œæš‚æ—¶ä½¿ç”¨å›½å†…æºå³å¯ã€‚</p><blockquote><p>æœ‰ç¿»å¢™åº”è¯¥ä¸ä¼šå‡ºç°è¯¥é—®é¢˜ï¼Œä½†æ˜¯æœ€è¿‘è“ç¯å¥½åƒåˆè¿ä¸ä¸Šäº†ï¼ŒçœŸæ˜¯éº»é¬¼çƒ¦çš„ç©æ„ã€‚</p></blockquote><p><strong>è§£å†³æ–¹æ³•</strong></p><p>åœ¨é¡¹ç›®çš„ Gradle æ–‡ä»¶é‡Œï¼Œé…ç½®å›½å†…æºï¼ˆå°† <code>Jcenter()</code>æ³¨æ‰æˆ–è€…åˆ æ‰ï¼Œæ›¿æ¢æˆä¸‹å›¾ä¸¤è¡Œ<code>maven</code>é…ç½®ï¼‰</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">maven&#123;url <span class="string">'http://maven.aliyun.com/nexus/content/groups/public/'</span>&#125;</span><br><span class="line">maven&#123;url <span class="string">"https://jitpack.io"</span>&#125;</span><br></pre></td></tr></table></figure><p>é‡æ–° <code>Sync</code> æˆ–è€… <code>Rebuild</code>å³å¯</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://blog.csdn.net/w13576267399/article/details/82019359" target="_blank" rel="noopener">https://blog.csdn.net/w13576267399/article/details/82019359</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;é—®é¢˜ERROR ï¼š Received close_notify during handshake&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;* What went wrong:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;A problem occurred configuring root project &amp;apos;NotificationDemo&amp;apos;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt; Could not resolve all artifacts for configuration &amp;apos;:classpath&amp;apos;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;gt; Could not download guava.jar (com.google.guava:guava:23.0)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;gt; Could not get resource &amp;apos;https://jcenter.bintray.com/com/google/guava/guava/23.0/guava-23.0.jar&amp;apos;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;gt; Could not GET &amp;apos;https://jcenter.bintray.com/com/google/guava/guava/23.0/guava-23.0.jar&amp;apos;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;gt; Received close_notify during handshake&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;gt; Could not download kotlin-reflect.jar (org.jetbrains.kotlin:kotlin-reflect:1.2.0)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;gt; Could not get resource &amp;apos;https://jcenter.bintray.com/org/jetbrains/kotlin/kotlin-reflect/1.2.0/kotlin-reflect-1.2.0.jar&amp;apos;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;gt; Could not GET &amp;apos;https://jcenter.bintray.com/org/jetbrains/kotlin/kotlin-reflect/1.2.0/kotlin-reflect-1.2.0.jar&amp;apos;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;gt; Received close_notify during handshake&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Android" scheme="http://hackycy.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="http://hackycy.github.io/tags/Android/"/>
    
      <category term="Android Studio" scheme="http://hackycy.github.io/tags/Android-Studio/"/>
    
  </entry>
  
  <entry>
    <title>é‡å­¦Androidä¹‹Notification</title>
    <link href="http://hackycy.github.io/2020/02/11/%E9%87%8D%E5%AD%A6Android%E4%B9%8BNotification/"/>
    <id>http://hackycy.github.io/2020/02/11/é‡å­¦Androidä¹‹Notification/</id>
    <published>2020-02-11T15:48:37.000Z</published>
    <updated>2020-06-04T06:12:49.388Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯é€šçŸ¥"><a href="#ä»€ä¹ˆæ˜¯é€šçŸ¥" class="headerlink" title="ä»€ä¹ˆæ˜¯é€šçŸ¥"></a>ä»€ä¹ˆæ˜¯é€šçŸ¥</h1><p>é€šçŸ¥æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨åº”ç”¨ç¨‹åºæ­£å¸¸çš„ç”¨æˆ·ç•Œé¢ä¹‹å¤–æ˜¾ç¤ºç»™ç”¨æˆ·çš„æ¶ˆæ¯ã€‚<br>é€šçŸ¥å‘å‡ºæ—¶ï¼Œå®ƒé¦–å…ˆå‡ºç°åœ¨çŠ¶æ€æ çš„é€šçŸ¥åŒºåŸŸä¸­ï¼Œç”¨æˆ·æ‰“å¼€é€šçŸ¥æŠ½å±‰å¯æŸ¥çœ‹é€šçŸ¥è¯¦æƒ…ã€‚é€šçŸ¥åŒºåŸŸå’Œé€šçŸ¥æŠ½å±‰éƒ½æ˜¯ç”¨æˆ·å¯ä»¥éšæ—¶æŸ¥çœ‹çš„ç³»ç»Ÿæ§åˆ¶åŒºåŸŸã€‚</p><a id="more"></a><p>å„ç§é€šçŸ¥çš„å±•ç°å½¢å¼å¦‚å›¾ï¼š</p><p><img src="notificationshow.png" alt></p><h1 id="é€šçŸ¥çš„åŸºç¡€ç”¨æ³•"><a href="#é€šçŸ¥çš„åŸºç¡€ç”¨æ³•" class="headerlink" title="é€šçŸ¥çš„åŸºç¡€ç”¨æ³•"></a>é€šçŸ¥çš„åŸºç¡€ç”¨æ³•</h1><h2 id="é€šçŸ¥åˆ›å»ºæ–¹å¼åŒºåˆ«"><a href="#é€šçŸ¥åˆ›å»ºæ–¹å¼åŒºåˆ«" class="headerlink" title="é€šçŸ¥åˆ›å»ºæ–¹å¼åŒºåˆ«"></a>é€šçŸ¥åˆ›å»ºæ–¹å¼åŒºåˆ«</h2><p>éšç€Androidç³»ç»Ÿä¸æ–­å‡çº§ï¼ŒNotificationçš„åˆ›å»ºæ–¹å¼ä¹Ÿéšä¹‹å˜åŒ–ï¼Œä¸»è¦å˜åŒ–å¦‚ä¸‹:</p><p><strong>Android 3.0ä¹‹å‰</strong></p><p>Android 3.0 (API level 11)ä¹‹å‰ï¼Œä½¿ç”¨<code>new Notification()</code>æ–¹å¼åˆ›å»ºé€šçŸ¥:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">NotificationManager mNotifyMgr = </span><br><span class="line">      (NotificationManager) getSystemService(NOTIFICATION_SERVICE);</span><br><span class="line">PendingIntent contentIntent = PendingIntent.getActivity(</span><br><span class="line">      <span class="keyword">this</span>, <span class="number">0</span>, <span class="keyword">new</span> Intent(<span class="keyword">this</span>, ResultActivity<span class="class">.<span class="keyword">class</span>), 0)</span>;</span><br><span class="line"></span><br><span class="line">Notification notification = <span class="keyword">new</span> Notification(icon, tickerText, when);</span><br><span class="line">notification.setLatestEventInfo(<span class="keyword">this</span>, title, content, contentIntent);</span><br><span class="line"></span><br><span class="line">mNotifyMgr.notify(NOTIFICATIONS_ID, notification);</span><br></pre></td></tr></table></figure><p><strong>Android 3.0 (API level 11)åŠæ›´é«˜ç‰ˆæœ¬</strong></p><p>Android 3.0å¼€å§‹å¼ƒç”¨<code>new Notification()</code>æ–¹å¼ï¼Œæ”¹ç”¨<code>Notification.Builder()</code>æ¥åˆ›å»ºé€šçŸ¥:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">NotificationManager mNotifyMgr = </span><br><span class="line">      (NotificationManager) getSystemService(NOTIFICATION_SERVICE);</span><br><span class="line">PendingIntent contentIntent = PendingIntent.getActivity(</span><br><span class="line">      <span class="keyword">this</span>, <span class="number">0</span>, <span class="keyword">new</span> Intent(<span class="keyword">this</span>, ResultActivity<span class="class">.<span class="keyword">class</span>), 0)</span>;</span><br><span class="line"></span><br><span class="line">Notification notification = <span class="keyword">new</span> Notification.Builder(<span class="keyword">this</span>)</span><br><span class="line">            .setSmallIcon(R.drawable.notification_icon)</span><br><span class="line">            .setContentTitle(<span class="string">"My notification"</span>)</span><br><span class="line">            .setContentText(<span class="string">"Hello World!"</span>)</span><br><span class="line">            .setContentIntent(contentIntent)</span><br><span class="line">            .build();<span class="comment">// getNotification()</span></span><br><span class="line"></span><br><span class="line">mNotifyMgr.notify(NOTIFICATIONS_ID, notification);</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œéœ€è¦æ³¨æ„: <code>build()</code> æ˜¯Androdi 4.1(API level 16)åŠ å…¥çš„ï¼Œç”¨ä»¥æ›¿ä»£<code>getNotification()</code>ã€‚API level 16å¼€å§‹å¼ƒç”¨<code>getNotification()</code></p></blockquote><p><strong>å…¼å®¹Android 3.0ä¹‹å‰çš„ç‰ˆæœ¬</strong></p><p>ä¸ºäº†å…¼å®¹<code>API level 11</code>ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œ<code>v4 Support Library</code>ä¸­æä¾›äº†<br> <code>NotificationCompat.Builder()</code>è¿™ä¸ªæ›¿ä»£æ–¹æ³•ã€‚å®ƒä¸<code>Notification.Builder()</code>ç±»ä¼¼ï¼ŒäºŒè€…æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">NotificationManager mNotifyMgr = </span><br><span class="line">      (NotificationManager) getSystemService(NOTIFICATION_SERVICE);</span><br><span class="line">PendingIntent contentIntent = PendingIntent.getActivity(</span><br><span class="line">      <span class="keyword">this</span>, <span class="number">0</span>, new Intent(<span class="keyword">this</span>, ResultActivity<span class="class">.<span class="keyword">class</span>), <span class="type">0);</span></span></span><br><span class="line"></span><br><span class="line">NotificationCompat.Builder mBuilder = </span><br><span class="line">      new NotificationCompat.Builder(<span class="keyword">this</span>)</span><br><span class="line">            .setSmallIcon(R.drawable.notification_icon)</span><br><span class="line">            .setContentTitle(<span class="string">"My notification"</span>)</span><br><span class="line">            .setContentText(<span class="string">"Hello World!"</span>)</span><br><span class="line">            .setContentIntent(contentIntent);</span><br><span class="line"></span><br><span class="line">mNotifyMgr.notify(NOTIFICATIONS_ID, mBuilder.build());</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨ï¼šé™¤ç‰¹åˆ«è¯´æ˜å¤–ï¼Œæœ¬æ–‡å°†æ ¹æ® <code>NotificationCompat.Builder()</code> å±•å¼€è§£æï¼Œ<br><code>Notification.Builder()</code>ç±»ä¼¼ã€‚</strong></p></blockquote><h2 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h2><h3 id="é€šçŸ¥çš„å¿…è¦å±æ€§"><a href="#é€šçŸ¥çš„å¿…è¦å±æ€§" class="headerlink" title="é€šçŸ¥çš„å¿…è¦å±æ€§"></a>é€šçŸ¥çš„å¿…è¦å±æ€§</h3><p>ä¸€ä¸ªé€šçŸ¥å¿…é¡»åŒ…å«ä»¥ä¸‹ä¸‰é¡¹å±æ€§:</p><ul><li>å°å›¾æ ‡ï¼Œå¯¹åº” setSmallIcon()</li><li>é€šçŸ¥æ ‡é¢˜ï¼Œå¯¹åº” setContentTitle()</li><li>è¯¦ç»†ä¿¡æ¯ï¼Œå¯¹åº” setContentText()</li></ul><p>å…¶ä»–å±æ€§å‡ä¸ºå¯é€‰é¡¹ï¼Œæ›´å¤šå±æ€§æ–¹æ³•è¯·å‚è€ƒ<a href="https://link.jianshu.com?t=http://developer.android.com/reference/android/support/v4/app/NotificationCompat.Builder.html" target="_blank" rel="noopener">NotificationCompat.Builder</a>ã€‚</p><p>å°½ç®¡å…¶ä»–éƒ½æ˜¯å¯é€‰çš„ï¼Œä½†ä¸€èˆ¬éƒ½ä¼šä¸ºé€šçŸ¥æ·»åŠ è‡³å°‘ä¸€ä¸ªåŠ¨ä½œ(Action)ï¼Œè¿™ä¸ªåŠ¨ä½œå¯ä»¥æ˜¯è·³è½¬åˆ°Activityã€å¯åŠ¨ä¸€ä¸ªServiceæˆ–å‘é€ä¸€ä¸ªBroadcasç­‰ã€‚ é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¸ºé€šçŸ¥æ·»åŠ åŠ¨ä½œ:</p><ul><li>ä½¿ç”¨PendingIntent</li><li>é€šè¿‡å¤§è§†å›¾é€šçŸ¥çš„ <code>Action Button</code>ï¼Œä»…æ”¯æŒAndroid 4.1 (API level 16)åŠæ›´é«˜ç‰ˆæœ¬</li></ul><h3 id="åˆ›å»ºä¸€ä¸ªé€šçŸ¥"><a href="#åˆ›å»ºä¸€ä¸ªé€šçŸ¥" class="headerlink" title="åˆ›å»ºä¸€ä¸ªé€šçŸ¥"></a>åˆ›å»ºä¸€ä¸ªé€šçŸ¥</h3><p>1ã€å®ä¾‹åŒ–ä¸€ä¸ªNotificationCompat.Builderå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NotificationCompat.Builder builderNormal = <span class="keyword">new</span> NotificationCompat.Builder(<span class="keyword">this</span>)</span><br><span class="line">                        .setSmallIcon(R.mipmap.ic_launcher)</span><br><span class="line">                        .setContentTitle(<span class="string">"æ™®é€šçš„é€šçŸ¥æ ‡é¢˜"</span>)</span><br><span class="line">                        .setContentText(<span class="string">"æ™®é€šçš„é€šçŸ¥å†…å®¹"</span>);</span><br></pre></td></tr></table></figure><p>NotificationCompat.Builderè‡ªåŠ¨è®¾ç½®çš„é»˜è®¤å€¼:</p><ul><li><strong>priority:</strong> PRIORITY_DEFAULT</li><li><strong>when: </strong>System.currentTimeMillis()</li><li><strong>audio stream: </strong>STREAM_DEFAULT</li></ul><p>2ã€å®šä¹‰å¹¶è®¾ç½®ä¸€ä¸ªé€šçŸ¥åŠ¨ä½œ(Action)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Intent secIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, SecActivity<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">PendingIntent secPendingIntent = PendingIntent.getActivity(<span class="keyword">this</span>, <span class="number">0</span>,</span><br><span class="line">        secIntent, PendingIntent.FLAG_UPDATE_CURRENT);</span><br><span class="line">builder.setContentIntent(secPendingIntent);</span><br></pre></td></tr></table></figure><p>PendingIntent æ˜¯ä¸€ç§ç‰¹æ®Šçš„ Intent ï¼Œå­—é¢æ„æ€å¯ä»¥è§£é‡Šä¸ºå»¶è¿Ÿçš„ Intent ï¼Œç”¨äºåœ¨æŸä¸ªäº‹ä»¶ç»“æŸåæ‰§è¡Œç‰¹å®šçš„ Action ã€‚ä»ä¸Šé¢å¸¦ Action çš„é€šçŸ¥ä¹Ÿèƒ½éªŒè¯è¿™ä¸€ç‚¹ï¼Œå½“ç”¨æˆ·ç‚¹å‡»é€šçŸ¥æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œã€‚<br>PendingIntent æ˜¯ Android ç³»ç»Ÿç®¡ç†å¹¶æŒæœ‰çš„ç”¨äºæè¿°å’Œè·å–åŸå§‹æ•°æ®çš„å¯¹è±¡çš„æ ‡å¿—(å¼•ç”¨)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å³ä¾¿åˆ›å»ºè¯¥PendingIntentå¯¹è±¡çš„è¿›ç¨‹è¢«æ€æ­»äº†ï¼Œè¿™ä¸ªPendingItentå¯¹è±¡åœ¨å…¶ä»–è¿›ç¨‹ä¸­è¿˜æ˜¯å¯ç”¨çš„</strong>ã€‚<br>æ—¥å¸¸ä½¿ç”¨ä¸­çš„çŸ­ä¿¡ã€é—¹é’Ÿç­‰éƒ½ç”¨åˆ°äº† PendingIntentã€‚</p><p>PendingIntent ä¸»è¦å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼è·å–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–ä¸€ä¸ªç”¨äºå¯åŠ¨ Activity çš„ PendingIntent å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PendingIntent <span class="title">getActivity</span><span class="params">(Context context, <span class="keyword">int</span> requestCode, Intent intent, <span class="keyword">int</span> flags)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–ä¸€ä¸ªç”¨äºå¯åŠ¨ Service çš„ PendingIntent å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PendingIntent <span class="title">getService</span><span class="params">(Context context, <span class="keyword">int</span> requestCode, Intent intent, <span class="keyword">int</span> flags)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–ä¸€ä¸ªç”¨äºå‘ BroadcastReceiver å¹¿æ’­çš„ PendingIntent å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PendingIntent <span class="title">getBroadcast</span><span class="params">(Context context, <span class="keyword">int</span> requestCode, Intent intent, <span class="keyword">int</span> flags)</span></span></span><br></pre></td></tr></table></figure><p>PendingIntent å…·æœ‰ä»¥ä¸‹å‡ ç§ flagï¼š</p><ul><li><strong>FLAG_CANCEL_CURRENT:</strong>å¦‚æœå½“å‰ç³»ç»Ÿä¸­å·²ç»å­˜åœ¨ä¸€ä¸ªç›¸åŒçš„ PendingIntent å¯¹è±¡ï¼Œé‚£ä¹ˆå°±å°†å…ˆå°†å·²æœ‰çš„ PendingIntent å–æ¶ˆï¼Œç„¶åé‡æ–°ç”Ÿæˆä¸€ä¸ª PendingIntent å¯¹è±¡ã€‚</li><li><strong>FLAG_NO_CREATE:</strong>å¦‚æœå½“å‰ç³»ç»Ÿä¸­ä¸å­˜åœ¨ç›¸åŒçš„ PendingIntent å¯¹è±¡ï¼Œç³»ç»Ÿå°†ä¸ä¼šåˆ›å»ºè¯¥ PendingIntent å¯¹è±¡è€Œæ˜¯ç›´æ¥è¿”å› null ã€‚</li><li><strong>FLAG_ONE_SHOT:</strong>è¯¥ PendingIntent åªä½œç”¨ä¸€æ¬¡ã€‚</li><li><strong>FLAG_UPDATE_CURRENT:</strong>å¦‚æœç³»ç»Ÿä¸­å·²å­˜åœ¨è¯¥ PendingIntent å¯¹è±¡ï¼Œé‚£ä¹ˆç³»ç»Ÿå°†ä¿ç•™è¯¥ PendingIntent å¯¹è±¡ï¼Œä½†æ˜¯ä¼šä½¿ç”¨æ–°çš„ Intent æ¥æ›´æ–°ä¹‹å‰ PendingIntent ä¸­çš„ Intent å¯¹è±¡æ•°æ®ï¼Œä¾‹å¦‚æ›´æ–° Intent ä¸­çš„ Extrasã€‚</li></ul><p>3ã€ç”Ÿæˆ<code>Notification</code>å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Notification notificationNormal = builderNormal.build();</span><br></pre></td></tr></table></figure><p>4ã€ä½¿ç”¨<code>NotificationManager</code>å‘é€é€šçŸ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NotificationManager mNotificationManager;</span><br><span class="line">mNotificationManager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);</span><br><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºIDï¼Œåç»­æ›´æ–°é€šçŸ¥ä¼šä½¿ç”¨åˆ°</span></span><br><span class="line">mNotificationManager.notify(<span class="number">0</span>, notificationNormal);</span><br></pre></td></tr></table></figure><h3 id="æ›´æ–°é€šçŸ¥"><a href="#æ›´æ–°é€šçŸ¥" class="headerlink" title="æ›´æ–°é€šçŸ¥"></a>æ›´æ–°é€šçŸ¥</h3><p>æ›´æ–°é€šçŸ¥å¾ˆç®€å•ï¼Œåªéœ€å†æ¬¡å‘é€ç›¸åŒIDçš„é€šçŸ¥å³å¯ï¼Œå¦‚æœä¹‹å‰çš„é€šçŸ¥ä¾ç„¶å­˜åœ¨åˆ™ä¼šæ›´æ–°é€šçŸ¥å±æ€§ï¼Œå¦‚æœä¹‹å‰é€šçŸ¥ä¸å­˜åœ¨åˆ™é‡æ–°åˆ›å»ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">NotificationCompat.Builder builder = <span class="keyword">new</span> NotificationCompat.Builder(<span class="keyword">this</span>)</span><br><span class="line">        .setSmallIcon(R.mipmap.ic_launcher)</span><br><span class="line">        .setContentTitle(<span class="string">"æ›´æ–°çš„é€šçŸ¥æ ‡é¢˜"</span>)</span><br><span class="line">        .setContentText(<span class="string">"æ›´æ–°çš„é€šçŸ¥å†…å®¹"</span>);</span><br><span class="line"></span><br><span class="line">builder.setContentIntent(secPendingIntent);</span><br><span class="line"></span><br><span class="line">Notification notificationUpdate = builder.build();</span><br><span class="line"><span class="comment">// ä¿è¯ä¸ä¸Šè¿°åˆ›å»ºçš„ç›¸åŒIDå³å¯ã€‚</span></span><br><span class="line">mNotificationManager.notify(<span class="number">0</span>, notificationUpdate);</span><br></pre></td></tr></table></figure><h3 id="å–æ¶ˆé€šçŸ¥"><a href="#å–æ¶ˆé€šçŸ¥" class="headerlink" title="å–æ¶ˆé€šçŸ¥"></a>å–æ¶ˆé€šçŸ¥</h3><p>å–æ¶ˆé€šçŸ¥æœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼:</p><ul><li>ç‚¹å‡»é€šçŸ¥æ çš„æ¸…é™¤æŒ‰é’®ï¼Œä¼šæ¸…é™¤æ‰€æœ‰å¯æ¸…é™¤çš„é€šçŸ¥</li><li>è®¾ç½®äº† setAutoCancel() æˆ– FLAG_AUTO_CANCEL çš„é€šçŸ¥ï¼Œç‚¹å‡»è¯¥é€šçŸ¥æ—¶ä¼šæ¸…é™¤å®ƒ</li><li>é€šè¿‡ NotificationManager è°ƒç”¨ cancel(int id) æ–¹æ³•æ¸…é™¤æŒ‡å®š ID çš„é€šçŸ¥</li><li>é€šè¿‡ NotificationManager è°ƒç”¨ cancel(String tag, int id) æ–¹æ³•æ¸…é™¤æŒ‡å®š TAG å’Œ ID çš„é€šçŸ¥</li><li>é€šè¿‡ NotificationManager è°ƒç”¨ cancelAll() æ–¹æ³•æ¸…é™¤æ‰€æœ‰è¯¥åº”ç”¨ä¹‹å‰å‘é€çš„é€šçŸ¥</li></ul><p>æ·»åŠ <code>setAutoCancel</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">NotificationCompat.Builder builderNormal = <span class="keyword">new</span> NotificationCompat.Builder(<span class="keyword">this</span>)</span><br><span class="line">        .setAutoCancel(<span class="keyword">true</span>)</span><br><span class="line">        .setSmallIcon(R.mipmap.ic_launcher)</span><br><span class="line">        .setContentTitle(<span class="string">"æ™®é€šçš„é€šçŸ¥æ ‡é¢˜"</span>)</span><br><span class="line">        .setContentText(<span class="string">"æ™®é€šçš„é€šçŸ¥å†…å®¹"</span>);</span><br></pre></td></tr></table></figure><h2 id="é€šçŸ¥ç±»å‹"><a href="#é€šçŸ¥ç±»å‹" class="headerlink" title="é€šçŸ¥ç±»å‹"></a>é€šçŸ¥ç±»å‹</h2><h3 id="å¤§è§†å›¾é€šçŸ¥"><a href="#å¤§è§†å›¾é€šçŸ¥" class="headerlink" title="å¤§è§†å›¾é€šçŸ¥"></a>å¤§è§†å›¾é€šçŸ¥</h3><p>é€šçŸ¥æœ‰ä¸¤ç§è§†å›¾ï¼šæ™®é€šè§†å›¾å’Œå¤§è§†å›¾ã€‚</p><p>æ™®é€šè§†å›¾ï¼š</p><p><img src="normalview.png" alt></p><p>å¤§è§†å›¾ï¼ˆBigTextä¸ºä¾‹ï¼‰ï¼š</p><p><img src="bigtextview.png" alt></p><p>é»˜è®¤æƒ…å†µä¸‹ä¸ºæ™®é€šè§†å›¾ï¼Œå¯é€šè¿‡<code>NotificationCompat.Builder.setStyle()</code>è®¾ç½®å¤§è§†å›¾ã€‚</p><blockquote><p>æ³¨: å¤§è§†å›¾(Big Views)ç”±Android 4.1(API level 16)å¼€å§‹å¼•å…¥ï¼Œä¸”ä»…æ”¯æŒAndroid 4.1åŠæ›´é«˜ç‰ˆæœ¬ã€‚</p></blockquote><p>ä»¥ä¸Šå›¾ä¸ºä¾‹:<br>1ã€æ„å»ºAction Buttonçš„PendingIntent</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Intent dismissIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, PingService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">                dismissIntent.setAction(<span class="string">"dismiss"</span>);</span><br><span class="line">                PendingIntent p1 = PendingIntent.getService(<span class="keyword">this</span>, <span class="number">0</span>, dismissIntent, PendingIntent.FLAG_UPDATE_CURRENT);</span><br><span class="line"></span><br><span class="line">                Intent snoozeIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, PingService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">                snoozeIntent.setAction(<span class="string">"snooze"</span>);</span><br><span class="line">                PendingIntent p2 = PendingIntent.getService(<span class="keyword">this</span>, <span class="number">0</span>, snoozeIntent, PendingIntent.FLAG_UPDATE_CURRENT);</span><br></pre></td></tr></table></figure><p>2ã€æ„å»ºNotificatonCompat.Builderå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">NotificationCompat.Builder builderBig = <span class="keyword">new</span> NotificationCompat.Builder(<span class="keyword">this</span>)</span><br><span class="line">                        .setSmallIcon(R.mipmap.ic_launcher)</span><br><span class="line">                        .setContentTitle(getString(R.string.title))</span><br><span class="line">                        .setContentText(<span class="string">"ç®€è¦"</span>)</span><br><span class="line">                        .setDefaults(Notification.DEFAULT_ALL)</span><br><span class="line">  <span class="comment">// æ³¨æ„è¯¥æ­¥éª¤</span></span><br><span class="line">                        .setStyle(<span class="keyword">new</span> NotificationCompat.BigTextStyle().bigText(getString(R.string.content)))</span><br><span class="line">                        .addAction(android.R.drawable.ic_input_delete, <span class="string">"dimiss"</span>, p1)</span><br><span class="line">                        .addAction(android.R.drawable.ic_input_add, <span class="string">"snooze"</span>, p2);</span><br></pre></td></tr></table></figure><p>3ã€å…¶ä»–æ­¥éª¤ä¸æ™®é€šè§†å›¾ç›¸åŒ</p><h3 id="è¿›åº¦æ¡é€šçŸ¥"><a href="#è¿›åº¦æ¡é€šçŸ¥" class="headerlink" title="è¿›åº¦æ¡é€šçŸ¥"></a>è¿›åº¦æ¡é€šçŸ¥</h3><p><strong>æ˜ç¡®è¿›åº¦çš„è¿›åº¦æ¡</strong></p><p>ä½¿ç”¨<code>setProgress(max, progress, false)</code>æ¥æ›´æ–°è¿›åº¦ã€‚</p><ul><li>max: æœ€å¤§è¿›åº¦å€¼</li><li>progress: å½“å‰è¿›åº¦</li><li>false: æ˜¯å¦æ˜¯ä¸æ˜ç¡®çš„è¿›åº¦æ¡</li></ul><h2 id="é€šçŸ¥å¸¸è§å±æ€§"><a href="#é€šçŸ¥å¸¸è§å±æ€§" class="headerlink" title="é€šçŸ¥å¸¸è§å±æ€§"></a>é€šçŸ¥å¸¸è§å±æ€§</h2><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://developer.android.com/guide/topics/ui/notifiers/notifications.html" target="_blank" rel="noopener">https://developer.android.com/guide/topics/ui/notifiers/notifications.html</a></p><p><a href="https://developer.android.com/reference/android/app/Notification.html" target="_blank" rel="noopener">https://developer.android.com/reference/android/app/Notification.html</a></p><p><a href="https://www.cnblogs.com/travellife/p/Android-Notification-xiang-jie-yiji-ben-cao-zuo.html" target="_blank" rel="noopener">https://www.cnblogs.com/travellife/p/Android-Notification-xiang-jie-yiji-ben-cao-zuo.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ä»€ä¹ˆæ˜¯é€šçŸ¥&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯é€šçŸ¥&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯é€šçŸ¥&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯é€šçŸ¥&lt;/h1&gt;&lt;p&gt;é€šçŸ¥æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨åº”ç”¨ç¨‹åºæ­£å¸¸çš„ç”¨æˆ·ç•Œé¢ä¹‹å¤–æ˜¾ç¤ºç»™ç”¨æˆ·çš„æ¶ˆæ¯ã€‚&lt;br&gt;é€šçŸ¥å‘å‡ºæ—¶ï¼Œå®ƒé¦–å…ˆå‡ºç°åœ¨çŠ¶æ€æ çš„é€šçŸ¥åŒºåŸŸä¸­ï¼Œç”¨æˆ·æ‰“å¼€é€šçŸ¥æŠ½å±‰å¯æŸ¥çœ‹é€šçŸ¥è¯¦æƒ…ã€‚é€šçŸ¥åŒºåŸŸå’Œé€šçŸ¥æŠ½å±‰éƒ½æ˜¯ç”¨æˆ·å¯ä»¥éšæ—¶æŸ¥çœ‹çš„ç³»ç»Ÿæ§åˆ¶åŒºåŸŸã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://hackycy.github.io/categories/Android/"/>
    
    
      <category term="Notification" scheme="http://hackycy.github.io/tags/Notification/"/>
    
  </entry>
  
  <entry>
    <title>Androidè¿›ç¨‹ä¿æ´»æ¢è®¨</title>
    <link href="http://hackycy.github.io/2020/02/04/Android%E8%BF%9B%E7%A8%8B%E4%BF%9D%E6%B4%BB%E6%8E%A2%E8%AE%A8/"/>
    <id>http://hackycy.github.io/2020/02/04/Androidè¿›ç¨‹ä¿æ´»æ¢è®¨/</id>
    <published>2020-02-04T14:04:19.000Z</published>
    <updated>2020-06-04T06:12:48.904Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>Android ç³»ç»Ÿä¸ºäº†ä¿æŒç³»ç»Ÿè¿è¡Œæµç•…ï¼Œåœ¨å†…å­˜åƒç´§çš„æƒ…å†µä¸‹ï¼Œä¼šå°†ä¸€äº›è¿›ç¨‹ kill ï¼Œä»¥é‡Šæ”¾ä¸€éƒ¨åˆ†å†…å­˜ã€‚ç„¶è€Œï¼Œå¯¹äºä¸€äº›ï¼ˆå¦‚ï¼šIM-QQ ã€å¾®ä¿¡ï¼Œæ”¯ä»˜-æ”¯ä»˜å®ç­‰ï¼‰æ¯”è¾ƒé‡è¦ã€æˆ‘ä»¬å¸Œæœ›èƒ½åŠæ—¶æ”¶åˆ°æ¶ˆæ¯çš„ APPï¼Œéœ€è¦ä¿æŒè¿›ç¨‹æŒç»­æ´»è·ƒï¼Œé‚£ä¹ˆå°±éœ€è¦å®æ–½ä¸€äº›ä¿æ´»æªæ–½æ¥ä¿è¯è¿›ç¨‹èƒ½å¤ŸæŒç»­å­˜æ´»ï¼Œå³ <strong>Android è¿›ç¨‹ä¿æ´»</strong>ã€‚</p><a id="more"></a><p><strong>Android è¿›ç¨‹æ‹‰æ´»åŒ…æ‹¬ä¸¤ä¸ªå±‚é¢ï¼š</strong></p><ul><li><p>æä¾›è¿›ç¨‹ä¼˜å…ˆçº§ï¼Œé™ä½è¿›ç¨‹è¢«æ€æ­»çš„æ¦‚ç‡</p></li><li><p>åœ¨è¿›ç¨‹è¢«æ€æ­»åï¼Œè¿›è¡Œæ‹‰æ´»</p></li></ul><p>åœ¨æ­¤ä¹‹å‰ï¼Œå…ˆæ¥äº†è§£ä¸‹ Android è¿›ç¨‹çš„ä¸€äº›ç›¸å…³æ¦‚å¿µã€‚</p><h1 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h1><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒä¸€ APP çš„æ‰€æœ‰ç»„ä»¶å‡è¿è¡Œåœ¨ç›¸åŒçš„è¿›ç¨‹ä¸­ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦ï¼Œé€šè¿‡åœ¨æ¸…å•æ–‡ä»¶ä¸­é…ç½®æ¥æ§åˆ¶æŸäº›ç»„ä»¶çš„æ‰€å±è¿›ç¨‹ã€‚</p><p>å†…å­˜ä¸è¶³çš„æƒ…å†µä¸‹ï¼ŒAndroid ç³»ç»Ÿä¼šé€‰æ‹© kill æŸä¸€è¿›ç¨‹æ¥é‡Šæ”¾è¯¥è¿›ç¨‹å ç”¨çš„å†…å­˜ï¼Œä¾›å…¶å®ƒä¸ºç”¨æˆ·æä¾›æ›´ä¸ºç´§æ€¥æœåŠ¡çš„è¿›ç¨‹ä½¿ç”¨ã€‚åœ¨è¢«å…³é—­çš„è¿›ç¨‹ä¸­è¿è¡Œçš„ç»„ä»¶ä¹Ÿä¼šéšç€è¿›ç¨‹çš„å…³é—­è€Œé”€æ¯ã€‚</p><p>å†³å®š kill å“ªä¸ªè¿›ç¨‹æ—¶ï¼ŒAndroid ç³»ç»Ÿå°†æƒè¡¡æ‰€æœ‰è¿›ç¨‹å¯¹ç”¨æˆ·çš„ç›¸å¯¹é‡è¦ç¨‹åº¦ã€‚ä¾‹å¦‚ï¼šç›¸å¯¹äºæ‰˜ç®¡å¯è§ Activity çš„è¿›ç¨‹è€Œè¨€ï¼Œæ›´æœ‰å¯èƒ½ kill æ‰˜ç®¡ä¸å¯è§ Activity çš„è¿›ç¨‹ã€‚å› æ­¤ï¼Œæ˜¯å¦ç»ˆæ­¢ kill æŸä¸ªè¿›ç¨‹å–å†³äºè¯¥è¿›ç¨‹ä¸­æ‰€è¿è¡Œç»„ä»¶çš„çŠ¶æ€ã€‚</p><h1 id="è¿›ç¨‹çš„ä¼˜å…ˆçº§"><a href="#è¿›ç¨‹çš„ä¼˜å…ˆçº§" class="headerlink" title="è¿›ç¨‹çš„ä¼˜å…ˆçº§"></a>è¿›ç¨‹çš„ä¼˜å…ˆçº§</h1><p>Android ç³»ç»Ÿå°†å°½é‡é•¿æ—¶é—´åœ°ä¿æŒåº”ç”¨è¿›ç¨‹ï¼Œä½†ä¸ºäº†æ–°å»ºè¿›ç¨‹æˆ–è¿è¡Œæ›´é‡è¦çš„è¿›ç¨‹ï¼Œæœ€ç»ˆéœ€è¦æ¸…é™¤æ—§è¿›ç¨‹æ¥å›æ”¶å†…å­˜ã€‚ ä¸ºäº†ç¡®å®šä¿ç•™æˆ–ç»ˆæ­¢å“ªäº›è¿›ç¨‹ï¼Œç³»ç»Ÿä¼šæ ¹æ®è¿›ç¨‹ä¸­æ­£åœ¨è¿è¡Œçš„ç»„ä»¶ä»¥åŠè¿™äº›ç»„ä»¶çš„çŠ¶æ€ï¼Œå°†æ¯ä¸ªè¿›ç¨‹æ”¾å…¥â€œé‡è¦æ€§å±‚æ¬¡ç»“æ„â€ä¸­ã€‚ å¿…è¦æ—¶ï¼Œç³»ç»Ÿä¼šé¦–å…ˆæ¶ˆé™¤é‡è¦æ€§æœ€ä½çš„è¿›ç¨‹ï¼Œç„¶åæ˜¯æ¸…é™¤é‡è¦æ€§ç¨ä½ä¸€çº§çš„è¿›ç¨‹ï¼Œä¾æ­¤ç±»æ¨ï¼Œä»¥å›æ”¶ç³»ç»Ÿèµ„æºã€‚</p><p>è¿›ç¨‹çš„é‡è¦æ€§ï¼Œåˆ’åˆ†5çº§ï¼š</p><ol><li>å‰å°è¿›ç¨‹ (Foreground process)</li><li>å¯è§è¿›ç¨‹ (Visible process)</li><li>æœåŠ¡è¿›ç¨‹ (Service process)</li><li>åå°è¿›ç¨‹ (Background process)</li><li>ç©ºè¿›ç¨‹ (Empty process)</li></ol><p><img src="jinchengyouxianji.jpeg" alt></p><p>å‰å°è¿›ç¨‹çš„é‡è¦æ€§æœ€é«˜ï¼Œä¾æ¬¡é€’å‡ï¼Œç©ºè¿›ç¨‹çš„é‡è¦æ€§æœ€ä½ï¼Œä¸‹é¢åˆ†åˆ«æ¥é˜è¿°æ¯ç§çº§åˆ«çš„è¿›ç¨‹</p><h2 id="å‰å°è¿›ç¨‹"><a href="#å‰å°è¿›ç¨‹" class="headerlink" title="å‰å°è¿›ç¨‹"></a>å‰å°è¿›ç¨‹</h2><p>ç”¨æˆ·å½“å‰æ“ä½œçš„è¿›ç¨‹ã€‚ä¸€ä¸ªè¿›ç¨‹æ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶ ï¼Œå³è§†ä¸ºå‰å°è¿›ç¨‹ï¼š</p><ul><li>æ‰˜ç®¡ç”¨æˆ·æ­£åœ¨äº¤äº’çš„ Activityï¼ˆå·²è°ƒç”¨ onResume() æ–¹æ³•ï¼‰ã€‚</li><li>æ‰˜ç®¡æŸä¸ª Service ï¼Œä¸” Service ç»‘å®šåˆ°ç”¨æˆ·æ­£åœ¨äº¤äº’çš„ Activityã€‚</li><li>æ‰˜ç®¡æ­£åœ¨â€œå‰å°â€è¿è¡Œçš„ Serviceï¼ˆæœåŠ¡å·²è°ƒç”¨startForeground()ï¼‰ã€‚</li><li>æ‰˜ç®¡æ­£åœ¨æ‰§è¡Œç”Ÿå‘½å‘¨æœŸå›è°ƒçš„ Serviceï¼ˆ onCreate() ã€ onStart() æˆ– onDestory() ï¼‰ã€‚</li><li>æ‰˜ç®¡æ­£åœ¨æ‰§è¡Œ onReceive() æ–¹æ³•çš„ BroadcastReceiverã€‚</li></ul><blockquote><p>é€šå¸¸ï¼Œä»»æ„æ—¶é—´çš„å‰å°è¿›ç¨‹æ•°æ®éƒ½ä¸å¤šã€‚åªæœ‰åœ¨å†…å­˜ä¸è¶³ä»¥æ”¯æŒå®ƒä»¬åŒæ—¶ç»§ç»­è¿è¡Œè¿™ä¸€ä¸‡ä¸å¾—å·²çš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿæ‰ä¼š kill å®ƒä»¬ã€‚</p></blockquote><h2 id="å¯è§è¿›ç¨‹"><a href="#å¯è§è¿›ç¨‹" class="headerlink" title="å¯è§è¿›ç¨‹"></a>å¯è§è¿›ç¨‹</h2><p>æ²¡æœ‰ä»»ä½•å‰å°ç»„ä»¶ã€ä½†ä»ä¼šå½±å“ç”¨æˆ·åœ¨å±å¹•ä¸Šæ‰€è§å†…å®¹çš„è¿›ç¨‹ã€‚ å¦‚æœä¸€ä¸ªè¿›ç¨‹æ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶ï¼Œå³è§†ä¸ºå¯è§è¿›ç¨‹ï¼š</p><ul><li>æ‰˜ç®¡ä¸åœ¨å‰å°ã€ä½†ä»å¯¹ç”¨æˆ·å¯è§çš„ Activityï¼ˆå·²è°ƒç”¨ onPause() æ–¹æ³•ï¼‰ã€‚å¦‚ï¼šå‰å° Activity å¯åŠ¨äº†ä¸€ä¸ªå¯¹è¯æ¡†ï¼Œå…è®¸åœ¨å…¶åé¢æ˜¾ç¤ºä¸Šä¸€ä¸ª Activityã€‚</li><li>æ‰˜ç®¡ç»‘å®šåˆ°å¯è§ï¼ˆæˆ–å‰å°ï¼‰çš„ Activity çš„ Serviceã€‚</li></ul><blockquote><p>å¯è§è¿›ç¨‹è¢«è§†ä¸ºåŠå…¶é‡è¦çš„è¿›ç¨‹ï¼Œé™¤éä¸ºäº†ç»´æŒæ‰€æœ‰å‰å°è¿›ç¨‹åŒæ—¶è¿è¡Œè€Œå¿…é¡»ç»ˆæ­¢ï¼Œå¦åˆ™ç³»ç»Ÿä¸ä¼škillè¿™äº›è¿›ç¨‹ã€‚</p></blockquote><h2 id="æœåŠ¡è¿›ç¨‹"><a href="#æœåŠ¡è¿›ç¨‹" class="headerlink" title="æœåŠ¡è¿›ç¨‹"></a>æœåŠ¡è¿›ç¨‹</h2><p>æ­£åœ¨è¿è¡Œå·²ä½¿ç”¨ startService() æ–¹æ³•å¯åŠ¨çš„ Service ä¸”ä¸å±äºä¸Šè¿°ä¸¤ä¸ªæ›´é«˜ç±»åˆ«è¿›ç¨‹çš„è¿›ç¨‹ã€‚</p><blockquote><p>å°½ç®¡æœåŠ¡è¿›ç¨‹ä¸ç”¨æˆ·å¯è§å†…å®¹æ²¡æœ‰ç›´æ¥å…³è”ï¼Œä½†æ˜¯å®ƒä»¬é€šå¸¸åœ¨æ‰§è¡Œä¸€äº›ç”¨æˆ·æ¯”è¾ƒå…³å¿ƒçš„æ“ä½œï¼ˆå¦‚ï¼šåœ¨åå°æ’­æ”¾éŸ³ä¹æˆ–ä»ç½‘ç»œä¸‹è½½æ•°æ®ç­‰ï¼‰ï¼Œå› æ­¤ï¼Œé™¤éå†…éƒ¨ä¸è¶³ä»¥ç»´æŒæ‰€æœ‰å‰å°è¿›ç¨‹å’Œå¯è§è¿›ç¨‹åŒæ—¶è¿è¡Œï¼Œå¦åˆ™ç³»ç»Ÿä¸ä¼š kill è¿™äº›è¿›ç¨‹ã€‚</p></blockquote><h2 id="åå°è¿›ç¨‹"><a href="#åå°è¿›ç¨‹" class="headerlink" title="åå°è¿›ç¨‹"></a>åå°è¿›ç¨‹</h2><p>æ‰˜ç®¡ç›®å‰å¯¹ç”¨æˆ·ä¸å¯è§çš„ Activity çš„è¿›ç¨‹ï¼ˆå·²è°ƒç”¨ Activity çš„ onStop() æ–¹æ³•ï¼‰ã€‚</p><blockquote><p>åå°è¿›ç¨‹å¯¹ç”¨æˆ·ä½“éªŒæ²¡æœ‰ç›´æ¥å½±å“ï¼Œç³»ç»Ÿå¯èƒ½éšæ—¶ä¼š kill å®ƒä»¬ï¼Œä»¥å›æ”¶å†…å­˜æä¾›ç»™å‰å°è¿›ç¨‹ã€å¯è§è¿›ç¨‹ã€æœåŠ¡è¿›ç¨‹ä½¿ç”¨ã€‚é€šå¸¸ä¼šæœ‰å¾ˆå¤šåå°è¿›ç¨‹åŒæ—¶è¿è¡Œï¼Œç³»ç»Ÿå°†å®ƒä»¬ä¿å­˜åœ¨ LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰åˆ—è¡¨ä¸­ï¼Œä»¥ç¡®ä¿åŒ…å«ç”¨æˆ·æœ€è¿‘æŸ¥çœ‹çš„ Activity çš„è¿›ç¨‹æœ€åä¸€ä¸ªè¢«ç»ˆæ­¢ã€‚</p></blockquote><h2 id="ç©ºè¿›ç¨‹"><a href="#ç©ºè¿›ç¨‹" class="headerlink" title="ç©ºè¿›ç¨‹"></a>ç©ºè¿›ç¨‹</h2><p>ä¸åŒ…å«ä»»ä½•æ´»åŠ¨ç»„ä»¶çš„è¿›ç¨‹ã€‚</p><blockquote><p>ä¿ç•™è¿™ç§è¿›ç¨‹çš„å”¯ä¸€ç›®çš„æ˜¯ç¼“å­˜ï¼Œä»¥ç¼©çŸ­ä¸‹æ¬¡åœ¨å…¶ä¸­è¿è¡Œçš„ç»„ä»¶çš„å¯åŠ¨æ—¶é—´ã€‚ä¸ºä½¿ç³»ç»Ÿæ€»ä½“èµ„æºåœ¨è¿›ç¨‹ç¼“å­˜å’Œåº•å±‚å†…æ ¸ç¼“å­˜ä¹‹é—´ä¿æŒå¹³è¡¡ï¼Œç³»ç»Ÿå¾€å¾€ä¼škillè¿™äº›è¿›ç¨‹ã€‚</p></blockquote><p>æ ¹æ®è¿›ç¨‹ä¸­å½“å‰æ´»åŠ¨çš„ç»„ä»¶çš„é‡è¦ç¨‹åº¦ï¼ŒAndroid ç³»ç»Ÿä¼šå°†è¿›ç¨‹è¯„å®šä¸ºå¯èƒ½è¾¾åˆ°çš„æœ€é«˜çº§åˆ«ã€‚æ¯”å¦‚ï¼Œæ‰˜ç®¡æœåŠ¡å’Œå¯è§ Activity çš„è¿›ç¨‹ï¼Œç³»ç»Ÿä¼šå°†å…¶è¯„å®šä¸ºå¯è§è¿›ç¨‹ï¼Œè€Œä¸æ˜¯æœåŠ¡è¿›ç¨‹ã€‚</p><p>æ­¤å¤–ï¼Œä¸€ä¸ªè¿›ç¨‹çš„çº§åˆ«å¯èƒ½ä¼šå› ä¸ºå…¶ä»–è¿›ç¨‹å¯¹å…¶ä¾èµ–è€Œæœ‰æ‰€æé«˜ï¼Œå³æœåŠ¡äºå¦ä¸€è¿›ç¨‹çš„è¿›ç¨‹å…¶çº§åˆ«ä¸ä¼šä½äºå…¶æœåŠ¡çš„è¿›ç¨‹ã€‚ä¾‹å¦‚ï¼Œè¿›ç¨‹ A ä¸­çš„ Service ç»‘å®šåˆ°è¿›ç¨‹ B ä¸­çš„ç»„ä»¶ï¼Œåˆ™è¿›ç¨‹ A å§‹ç»ˆè¢«è§†ä¸ºè‡³å°‘å’Œè¿›ç¨‹ B åŒç­‰çº§åˆ«ã€‚</p><p>ç”±äºè¿è¡Œ Service çš„è¿›ç¨‹å…¶çº§åˆ«é«˜äºæ‰˜ç®¡åå° Activity çš„è¿›ç¨‹ï¼Œå› æ­¤åœ¨è¦åšé•¿æ—¶é—´åå°æ“ä½œçš„ Activity ä¸­æœ€å¥½ä¸ºè¯¥æ“ä½œå¯åŠ¨ Serviceï¼Œè€Œä¸æ˜¯ç®€å•çš„åˆ›å»ºå­çº¿ç¨‹ï¼Œå½“æ“ä½œæœ‰å¯èƒ½æ¯” Activity æ›´æŒä¹…æ—¶æ›´éœ€å¦‚æ­¤ã€‚ä¾‹å¦‚ï¼Œéœ€è¦ä¸Šä¼ è¾ƒå¤§å›¾ç‰‡æˆ–è¾ƒå¤§æ–‡ä»¶çš„ Activityï¼Œåº”è¯¥å¯åŠ¨ Service æ¥æ‰§è¡Œä¸Šä¼ æ“ä½œï¼Œè¿™æ ·ï¼Œå³ä½¿ Activity è¢«é”€æ¯ï¼ŒService ä»èƒ½åœ¨åå°ç»§ç»­æ‰§è¡Œä¸Šä¼ æ“ä½œã€‚ä½¿ç”¨ Service æ‰§è¡Œè¾ƒé•¿è€—æ—¶æ“ä½œï¼Œå¯ä»¥ä¿è¯ä¸ç®¡ Activity å‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Œè¯¥æ“ä½œè‡³å°‘æœ‰æœåŠ¡è¿›ç¨‹çš„ä¼˜å…ˆçº§ã€‚åŒç†ï¼Œä½¿ç”¨å¹¿æ’­æ¥æ”¶å™¨æ—¶ï¼Œä¹Ÿå½“å¦‚æ­¤ã€‚</p><blockquote><p><a href="https://developer.android.com/guide/components/processes-and-threads.html" target="_blank" rel="noopener">https://developer.android.com/guide/components/processes-and-threads.html</a></p></blockquote><h1 id="è¿›ç¨‹å›æ”¶ç­–ç•¥"><a href="#è¿›ç¨‹å›æ”¶ç­–ç•¥" class="headerlink" title="è¿›ç¨‹å›æ”¶ç­–ç•¥"></a>è¿›ç¨‹å›æ”¶ç­–ç•¥</h1><p>Android ç³»ç»Ÿå›æ”¶è¿›ç¨‹å†…å­˜çš„æœºåˆ¶å«<code>Low Memory Killer</code>æœºåˆ¶ï¼Œæ˜¯ä¸€ç§æ ¹æ® <code>oom_adj</code>é˜ˆå€¼çº§åˆ«è§¦å‘ç›¸åº”åŠ›åº¦çš„å†…å­˜å›æ”¶çš„æœºåˆ¶ã€‚<code>oom_adj</code> ä»£è¡¨è¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼Œæ•°å€¼è¶Šé«˜ï¼Œä¼˜å…ˆçº§è¶Šä½ï¼Œè¶Šå®¹æ˜“è¢«æ€æ­»ã€‚</p><p><strong>Andoridçš„ Low Memory Killer æ˜¯åœ¨æ ‡å‡†çš„linux lernelçš„ OOM åŸºç¡€ä¸Šä¿®æ”¹è€Œæ¥çš„ä¸€ç§å†…å­˜ç®¡ç†æœºåˆ¶ã€‚å½“ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶ï¼Œæ€æ­»ä¸å¿…è¦çš„è¿›ç¨‹é‡Šæ”¾å…¶å†…å­˜ã€‚ä¸å¿…è¦çš„è¿›ç¨‹çš„é€‰æ‹©æ ¹æ®æœ‰2ä¸ªï¼šoom_adjå’Œå ç”¨çš„å†…å­˜çš„å¤§å°ã€‚oom_adj ä»£è¡¨è¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼Œæ•°å€¼è¶Šé«˜ï¼Œä¼˜å…ˆçº§è¶Šä½ï¼Œè¶Šå®¹æ˜“è¢«æ€æ­»ï¼›å¯¹åº”æ¯ä¸ªoom_adjéƒ½å¯ä»¥æœ‰ä¸€ä¸ªç©ºé—²è¿›ç¨‹çš„é˜€å€¼ã€‚</strong></p><p><strong>Android Kernelæ¯éš”ä¸€æ®µæ—¶é—´ä¼šæ£€æµ‹å½“å‰ç©ºé—²å†…å­˜æ˜¯å¦ä½äºæŸä¸ªé˜€å€¼ã€‚å‡å¦‚æ˜¯ï¼Œåˆ™æ€æ­»oom_adjæœ€å¤§çš„ä¸å¿…è¦çš„è¿›ç¨‹ï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œå°±æ ¹æ® oom_score_adj å»æ€æ­»è¿›ç¨‹ï¼Œç›´åˆ°å†…å­˜æ¢å¤ä½äºé˜€å€¼çš„çŠ¶æ€ã€‚</strong></p><p>å…³äº oom_adj çš„è¯´æ˜å¦‚ä¸‹ï¼š</p><p><img src="oomadj.jpeg" alt></p><blockquote><p>å…¶ä¸­çº¢è‰²éƒ¨åˆ†ä»£è¡¨æ¯”è¾ƒå®¹æ˜“è¢«æ€æ­»çš„ Android è¿›ç¨‹ï¼ˆOOM_ADJ&gt;=4ï¼‰,ç»¿è‰²éƒ¨åˆ†è¡¨ç¤ºä¸å®¹æ˜“è¢«æ€æ­»çš„ Android è¿›ç¨‹ï¼Œå…¶ä»–è¡¨ç¤ºé Android è¿›ç¨‹ï¼ˆçº¯ Linux è¿›ç¨‹ï¼‰ã€‚</p><p>åœ¨ Lowmemorykiller å›æ”¶å†…å­˜æ—¶ä¼šæ ¹æ®è¿›ç¨‹çš„çº§åˆ«ä¼˜å…ˆæ€æ­» OOM_ADJ æ¯”è¾ƒå¤§çš„è¿›ç¨‹ï¼Œå¯¹äºä¼˜å…ˆçº§ç›¸åŒçš„è¿›ç¨‹åˆ™è¿›ä¸€æ­¥å—åˆ°è¿›ç¨‹æ‰€å å†…å­˜å’Œè¿›ç¨‹å­˜æ´»æ—¶é—´çš„å½±å“ã€‚</p><p><strong>æ™®é€šappè¿›ç¨‹çš„oom_adj&gt;=0,ç³»ç»Ÿè¿›ç¨‹çš„oom_adjæ‰å¯èƒ½&lt;0</strong></p><p>æŸ¥çœ‹å½“å‰åº”ç”¨è¿›ç¨‹adjå€¼å‘½ä»¤ä¸ºï¼š<code>cat /proc/è¿›ç¨‹id/oom_adj</code></p><p>æŸ¥çœ‹å½“å‰è¿›ç¨‹idï¼š<code>ps | grep PackageName</code></p></blockquote><p><strong>LowMemoryKiller çš„é˜ˆå€¼çš„è®¾å®šï¼Œä¸»è¦ä¿å­˜åœ¨2ä¸ªæ–‡ä»¶ä¹‹ä¸­ï¼Œåˆ†åˆ«æ˜¯:</strong></p><ul><li><code>/sys/module/lowmemorykiller/parameters/adj</code></li><li><code>/sys/module/lowmemorykiller/parameters/minfree</code></li></ul><p>adjä¿å­˜ç€å½“å‰ç³»ç»Ÿæ€è¿›ç¨‹çš„ç­‰çº§ï¼Œminfreeåˆ™æ˜¯ä¿å­˜ç€å¯¹åº”çš„å†…å­˜é˜€å€¼ã€‚</p><p>åœ¨APIä¸º26çš„Nexusæ¨¡æ‹Ÿå™¨ä¸‹æ‰“å°è¾“å‡ºçš„å€¼ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">generic_x86:/ <span class="comment"># cat /sys/module/lowmemorykiller/parameters/minfree                                                                                                                                        </span></span><br><span class="line">18432,23040,27648,32256,36864,46080</span><br><span class="line">generic_x86:/ <span class="comment"># cat /sys/module/lowmemorykiller/parameters/adj                                                                                                                                            </span></span><br><span class="line">0,100,200,300,900,906</span><br></pre></td></tr></table></figure><p>å†…å­˜é˜€å€¼åœ¨ä¸åŒæ‰‹æœºä¸Šä¸ä¸€æ ·ï¼Œä¸€æ—¦ä½äºè¯¥å€¼ï¼ŒAndroidä¾¿ä¼šæ€æ­»å¯¹åº”ä¼˜å…ˆçº§çš„è¿›ç¨‹ã€‚<strong>ä¾‹å¦‚ä¸Šè¿°æ‰‹æœºä¸­ï¼Œå½“å¯ç”¨å†…å­˜å°äº72MBï¼ˆ18432ï¼‰æ—¶ï¼Œå°±æ€æ­»å‰å°è¿›ç¨‹ï¼›å½“å¯ç”¨å†…å­˜å°äº180MBï¼ˆ46080ï¼‰æ—¶ï¼Œåˆ™æ€æ­»ç©ºè¿›ç¨‹ã€‚å³è·Ÿç…§ä¸Šè¿°æ‰“å°é¡ºåºä¾æ¬¡æ€æ­»ä¸º<code>å‰å°è¿›ç¨‹ -&gt; å¯è§è¿›ç¨‹ -&gt; æœåŠ¡è¿›ç¨‹ -&gt; åå°è¿›ç¨‹ -&gt; Content Provider -&gt; ç©ºè¿›ç¨‹</code>ã€‚</strong></p><blockquote><p>é˜€å€¼å•ä½ä¸ºpageï¼Œå³4kbã€‚</p></blockquote><p><strong>Android æ‰‹æœºä¸­è¿›ç¨‹è¢«æ€æ­»å¯èƒ½æœ‰å¦‚ä¸‹æƒ…å†µï¼š</strong></p><p><img src="killevent.jpg" alt></p><p>ç»¼ä¸Šï¼Œå¯ä»¥å¾—å‡ºå‡å°‘è¿›ç¨‹è¢«æ€æ­»æ¦‚ç‡æ— éå°±æ˜¯æƒ³åŠæ³•æé«˜è¿›ç¨‹ä¼˜å…ˆçº§ï¼Œå‡å°‘è¿›ç¨‹åœ¨å†…å­˜ä¸è¶³ç­‰æƒ…å†µä¸‹è¢«æ€æ­»çš„æ¦‚ç‡ã€‚</p><h1 id="æå‡è¿›ç¨‹ä¼˜å…ˆçº§çš„æ–¹æ¡ˆ"><a href="#æå‡è¿›ç¨‹ä¼˜å…ˆçº§çš„æ–¹æ¡ˆ" class="headerlink" title="æå‡è¿›ç¨‹ä¼˜å…ˆçº§çš„æ–¹æ¡ˆ"></a>æå‡è¿›ç¨‹ä¼˜å…ˆçº§çš„æ–¹æ¡ˆ</h1><h2 id="åˆ©ç”¨-Activity-æå‡æƒé™"><a href="#åˆ©ç”¨-Activity-æå‡æƒé™" class="headerlink" title="åˆ©ç”¨ Activity æå‡æƒé™"></a>åˆ©ç”¨ Activity æå‡æƒé™</h2><p>é€šè¿‡ç›‘æ§æ‰‹æœºé”å±ï¼Œåœ¨å±å¹•é”å±æ—¶å¯åŠ¨1ä¸ªåƒç´ çš„Activityï¼Œåœ¨ç”¨æˆ·è§£é”æ—¶å°†Activityé”€æ¯æ‰ã€‚</p><p>è¿›ç¨‹çš„ä¼˜å…ˆçº§åœ¨å±å¹•é”å±æ—¶é—´ç”±4æå‡ä¸ºæœ€é«˜ä¼˜å…ˆçº§0ã€‚</p><p>ä¸»è¦è§£å†³ç¬¬ä¸‰æ–¹åº”ç”¨åŠç³»ç»Ÿç®¡ç†å·¥å…·åœ¨æ£€æµ‹åˆ°é”å±äº‹ä»¶åä¸€æ®µæ—¶é—´ï¼ˆä¸€èˆ¬ä¸º5åˆ†é’Ÿä»¥å†…ï¼‰å†…ä¼šæ€æ­»åå°è¿›ç¨‹ï¼Œå·²è¾¾åˆ°çœç”µçš„ç›®çš„é—®é¢˜ã€‚<strong>ä½†æ˜¯åœ¨Android Pä¹‹ååå°éƒ½ä½œäº†é™åˆ¶åè¯¥æ–¹æ¡ˆæ— æ•ˆã€‚æµ‹è¯•7.0å‰çš„ç‰ˆæœ¬ç¨³å®šã€‚ä½†æ˜¯ä¸å»ºè®®ä½¿ç”¨ã€‚æ²¡æœ‰é”€æ¯æ‰1åƒç´ Activityæ—¶å€™ä¼šäº§ç”Ÿä¸¥é‡çš„ä½“éªŒé—®é¢˜ã€‚</strong></p><h3 id="å…·ä½“æ–¹æ¡ˆå®ç°"><a href="#å…·ä½“æ–¹æ¡ˆå®ç°" class="headerlink" title="å…·ä½“æ–¹æ¡ˆå®ç°"></a>å…·ä½“æ–¹æ¡ˆå®ç°</h3><p>è‡ªå®šä¹‰Activityï¼Œå¹¶ä¸”è®¾ç½®Activityå¤§å°ä¸º1åƒç´ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SinglePixelActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = SinglePixelActivity<span class="class">.<span class="keyword">class</span>.<span class="title">getSimpleName</span>()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        Window window = getWindow();</span><br><span class="line">        window.setGravity(Gravity.LEFT | Gravity.TOP);</span><br><span class="line">        WindowManager.LayoutParams layoutParams = window.getAttributes();</span><br><span class="line">        layoutParams.x = <span class="number">0</span>;</span><br><span class="line">        layoutParams.y = <span class="number">0</span>;</span><br><span class="line">        layoutParams.width = <span class="number">1</span>;</span><br><span class="line">        layoutParams.height = <span class="number">1</span>;</span><br><span class="line">        window.setAttributes(layoutParams);</span><br><span class="line">        <span class="comment">//setting</span></span><br><span class="line">        KeepManager.getInstance().setSinglePixelActivity(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä½œä¸€äº›å”¤é†’æœåŠ¡åŠ¨ä½œ</span></span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶æ¬¡ï¼Œä» AndroidManifest ä¸­é€šè¿‡å¦‚ä¸‹å±æ€§ï¼Œæ’é™¤ Activity åœ¨ RecentTask ä¸­çš„æ˜¾ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> </span></span><br><span class="line"><span class="tag">           <span class="attr">android:name</span>=<span class="string">".onepixel.SinglePixelActivity"</span> </span></span><br><span class="line"><span class="tag">           <span class="attr">android:configChanges</span>=<span class="string">"keyboardHidden|orientation|screenSize|navigation|keyboard"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">android:excludeFromRecents</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:exported</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:finishOnTaskLaunch</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:launchMode</span>=<span class="string">"singleInstance"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:theme</span>=<span class="string">"@style/SinglePixelActivityStyle"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>è®²è§£ä¸€ä¸‹ï¼š</strong></p><ul><li><strong>android:launchModeå±æ€§ï¼š</strong>ç”¨äºæŒ‡å®šactivityçš„å¯åŠ¨æ¨¡å¼ï¼Œæ€»å…±åˆ†ä¸ºå››ç§ï¼Œå³ï¼š<ul><li><strong>standaræ¨¡å¼</strong>ï¼Œæ¯æ¬¡å¯åŠ¨activityéƒ½ä¼šåˆ›å»ºå…¶å®ä¾‹ï¼Œå¹¶åŠ å…¥åˆ°ä»»åŠ¡æ ˆçš„æ ˆé¡¶ï¼›</li><li><strong>singleTopæ¨¡å¼</strong>ï¼Œæ¯æ¬¡å¯åŠ¨activityå¦‚æœæ ˆé¡¶æ—¶è¯¥activityåˆ™æ— éœ€åˆ›å»ºï¼Œå…¶ä½™æƒ…å†µéƒ½è¦åˆ›å»ºè¯¥activityçš„å®ä¾‹ï¼›</li><li><strong>singleTaskæ¨¡å¼</strong>ï¼Œå¦‚æœè¢«å¯åŠ¨çš„activityçš„å®ä¾‹å­˜åœ¨æ ˆä¸­ï¼Œåˆ™ä¸éœ€è¦åˆ›å»ºï¼Œåªéœ€è¦æŠŠæ­¤activityåŠ å…¥åˆ°æ ˆé¡¶ï¼Œå¹¶æŠŠè¯¥activityä»¥ä¸Šçš„activityå®ä¾‹å…¨éƒ¨popï¼›</li><li><strong>singleInstanceæ¨¡å¼</strong>ï¼šå°†åˆ›å»ºçš„activityå®ä¾‹æ”¾å…¥å•ç‹¬çš„æ ˆä¸­ï¼Œè¯¥æ ˆåªèƒ½å­˜å‚¨è¿™ä¸ªå®ä¾‹ï¼Œä¸”æ˜¯ä½œä¸ºå…±äº«å®ä¾‹å­˜åœ¨ã€‚</li></ul></li><li><strong>android:configChangeså±æ€§ï¼š</strong>ç”¨äºæ•è·æ‰‹æœºçŠ¶æ€çš„æ”¹å˜ï¼Œå³å½“æ‰‹æœºçŠ¶æ€(å¦‚åˆ‡æ¢æ¨ªç«–å±ã€å±å¹•å¤§å°)æ”¹å˜æ—¶ä¼šä¿å­˜å½“å‰æ´»åŠ¨çŠ¶æ€é‡å¯Activityï¼Œç”±äºSinglePixelActivityè‚©è´Ÿç€ä¿æ´»çš„ç‰¹æ®Šä½¿å‘½ï¼Œè¿™é‡Œä½¿ç”¨<strong>android:configChanges</strong>å±æ€§ï¼šé˜²æ­¢Activityé‡å¯ï¼Œå®ƒåªæ˜¯è°ƒç”¨äº†<strong>onConfigurationChanged(Configuration newConfig)</strong>æ¥é€šçŸ¥æ‰‹æœºçŠ¶æ€çš„æ”¹å˜ï¼›</li><li><strong>android:excludeFromRecentså±æ€§ï¼š</strong>ç”¨äºæ§åˆ¶SinglePixelActivityä¸åœ¨æœ€è¿‘ä»»åŠ¡åˆ—è¡¨ä¸­æ˜¾ç¤ºï¼›</li><li><strong>android:finishOnTaskLaunchå±æ€§ï¼š</strong>ç”¨äºæ ‡è®°å½“ç”¨æˆ·å†èµ·å¯åŠ¨åº”ç”¨(TASK)æ—¶æ˜¯å¦å…³é—­å·²ç»å­˜åœ¨çš„Activityçš„å®ä¾‹ï¼Œfalseè¡¨ç¤ºä¸å…³é—­ï¼›</li><li><strong>android:themeå±æ€§ï¼š</strong>ç”¨äºæŒ‡å®šActivityæ˜¾ç¤ºä¸»é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬è‡ªå®šä¹‰ä¸»é¢˜SingleActivityStyleã€‚</li></ul></blockquote><p>è®¾ç½®Activityæ ·å¼ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¯¹1åƒç´ Activityè¿›è¡Œç‰¹æ®Šå¤„ç† --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"SinglePixelActivityStyle"</span>&gt;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowBackground"</span>&gt;</span>@android:color/transparent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowIsTranslucent"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowFrame"</span>&gt;</span>@null<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowNoTitle"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowIsFloating"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowContentOverlay"</span>&gt;</span>@null<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:backgroundDimEnabled"</span>&gt;</span>false<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowAnimationStyle"</span>&gt;</span>@null<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowDisablePreview"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowNoDisplay"</span>&gt;</span>false<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰å¹¿æ’­æ¥æ”¶è€…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScreenBroadcastReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">        String action = intent.getAction();</span><br><span class="line">      <span class="comment">// Activity å¯åŠ¨ä¸é”€æ¯æ—¶æœºçš„æ§åˆ¶ï¼š</span></span><br><span class="line">        <span class="keyword">if</span> (Intent.ACTION_SCREEN_OFF.equals(action)) &#123;</span><br><span class="line">            KeepManager.getInstance().startSinglePixelActivity(context);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Intent.ACTION_SCREEN_ON.equals(action) || Intent.ACTION_USER_PRESENT.equals(action)) &#123;</span><br><span class="line">            KeepManager.getInstance().finishSinglePixelActivity();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®¡ç†ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScreenManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = ScreenManager<span class="class">.<span class="keyword">class</span>.<span class="title">getSimpleName</span>()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> ScreenManager mInstance = <span class="keyword">new</span> ScreenManager();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ScreenBroadcastReceiver mKeepBroadcastReceiver;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> WeakReference&lt;Activity&gt; mActivity;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ScreenManager <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mInstance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerKeepReceiver</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        mKeepBroadcastReceiver = <span class="keyword">new</span> ScreenBroadcastReceiver();</span><br><span class="line">        IntentFilter filter = <span class="keyword">new</span> IntentFilter();</span><br><span class="line">        filter.addAction(Intent.ACTION_SCREEN_OFF);</span><br><span class="line">        filter.addAction(Intent.ACTION_SCREEN_ON);</span><br><span class="line">        context.registerReceiver(mKeepBroadcastReceiver, filter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unregisterKeepReceiver</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mKeepBroadcastReceiver != <span class="keyword">null</span>) &#123;</span><br><span class="line">            context.unregisterReceiver(mKeepBroadcastReceiver);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŒæœ‰SinglePixelActivityçš„å¼±å¼•ç”¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activity</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSinglePixelActivity</span><span class="params">(Activity activity)</span> </span>&#123;</span><br><span class="line">        mActivity = <span class="keyword">new</span> WeakReference&lt;&gt;(activity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯åŠ¨SinglePixelActivity</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startSinglePixelActivity</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(context, SinglePixelActivity<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">        context.startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»“æŸSinglePixelActivity</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">finishSinglePixelActivity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mActivity != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Activity activity = mActivity.get();</span><br><span class="line">            <span class="keyword">if</span> (activity != <span class="keyword">null</span>) &#123;</span><br><span class="line">                activity.finish();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨éœ€è¦ä½¿ç”¨çš„åœ°æ–¹ä½¿ç”¨ï¼Œå¦‚MainActivityï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="comment">// 1åƒç´ ä¿æ´»</span></span><br><span class="line">        activeSinglePixelActivity();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        ScreenManager.getInstance().unregisterKeepReceiver(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">activeSinglePixelActivity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ScreenManager.getInstance().registerKeepReceiver(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ©ç”¨å‰å°-Service-æå‡æƒé™"><a href="#åˆ©ç”¨å‰å°-Service-æå‡æƒé™" class="headerlink" title="åˆ©ç”¨å‰å° Service æå‡æƒé™"></a>åˆ©ç”¨å‰å° Service æå‡æƒé™</h2><p>Android ä¸­ Service çš„ä¼˜å…ˆçº§ä¸º4ï¼Œé€šè¿‡ setForeground æ¥å£å¯ä»¥å°†åå° Service è®¾ç½®ä¸ºå‰å° Serviceï¼Œä½¿è¿›ç¨‹çš„ä¼˜å…ˆçº§ç”±4æå‡ä¸º2ï¼Œä»è€Œä½¿è¿›ç¨‹çš„ä¼˜å…ˆçº§ä»…ä»…ä½äºç”¨æˆ·å½“å‰æ­£åœ¨äº¤äº’çš„è¿›ç¨‹ï¼Œä¸å¯è§è¿›ç¨‹ä¼˜å…ˆçº§ä¸€è‡´ï¼Œä½¿è¿›ç¨‹è¢«æ€æ­»çš„æ¦‚ç‡å¤§å¤§é™ä½ã€‚</p><p>ä» Android2.3 å¼€å§‹è°ƒç”¨ setForeground å°†åå° Service è®¾ç½®ä¸ºå‰å° Service æ—¶ï¼Œå¿…é¡»åœ¨ç³»ç»Ÿçš„é€šçŸ¥æ å‘é€ä¸€æ¡é€šçŸ¥ï¼Œä¹Ÿå°±æ˜¯å‰å° Service ä¸ä¸€æ¡å¯è§çš„é€šçŸ¥æ—¶ç»‘å®šåœ¨ä¸€èµ·çš„ã€‚</p><p>å¯¹äºä¸éœ€è¦å¸¸é©»é€šçŸ¥æ çš„åº”ç”¨æ¥è¯´ï¼Œè¯¥æ–¹æ¡ˆè™½å¥½ï¼Œä½†å´æ˜¯ç”¨æˆ·æ„ŸçŸ¥çš„ï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨ã€‚</p><p>å¯¹äº API level &lt; 18 ï¼šè°ƒç”¨startForeground(IDï¼Œ new Notification())ï¼Œå‘é€ç©ºçš„Notification ï¼Œå›¾æ ‡åˆ™ä¸ä¼šæ˜¾ç¤ºã€‚å¯¹äº API level &gt;= 18ï¼šåœ¨éœ€è¦æä¼˜å…ˆçº§çš„service Aå¯åŠ¨ä¸€ä¸ªInnerServiceï¼Œä¸¤ä¸ªæœåŠ¡åŒæ—¶startForegroundï¼Œä¸”ç»‘å®šåŒæ ·çš„ IDã€‚Stop æ‰InnerService ï¼Œè¿™æ ·é€šçŸ¥æ å›¾æ ‡å³è¢«ç§»é™¤ã€‚è¿™æ–¹æ¡ˆå®é™…åˆ©ç”¨äº†Androidå‰å°serviceçš„æ¼æ´ã€‚</p><p><strong>è¯¥æ–¹æ¡ˆé€‚ç”¨èŒƒå›´ï¼š7.1.1ç³»ç»Ÿä»¥ä¸‹</strong>ï¼Œ8.0åçš„ç³»ç»Ÿé€šçŸ¥æ APIçš„å˜æ›´ä»¥åŠå‰å°æœåŠ¡çš„å˜æ›´å¯¼è‡´é€šçŸ¥æ å¸¸é©»ï¼Œé€ æˆç”¨æˆ·æ„ŸçŸ¥ã€‚</p><h3 id="å…·ä½“æ–¹æ¡ˆå®ç°-1"><a href="#å…·ä½“æ–¹æ¡ˆå®ç°-1" class="headerlink" title="å…·ä½“æ–¹æ¡ˆå®ç°"></a>å…·ä½“æ–¹æ¡ˆå®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProcessService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String TAG = ProcessService<span class="class">.<span class="keyword">class</span>.<span class="title">getSimpleName</span>()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> PROCESS_SERVICE_ID = -<span class="number">10001</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"Not yet implemented"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &lt; <span class="number">18</span>) &#123;</span><br><span class="line">            <span class="comment">// API &lt; 18 ï¼Œæ­¤æ–¹æ³•èƒ½æœ‰æ•ˆéšè—Notificationä¸Šçš„å›¾æ ‡</span></span><br><span class="line">            startForeground(PROCESS_SERVICE_ID, <span class="keyword">new</span> Notification());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Intent innerIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, ProcessInnerService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            startService(innerIntent);</span><br><span class="line">            startForeground(PROCESS_SERVICE_ID, <span class="keyword">new</span> Notification());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> START_STICKY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»™ API &gt;= 18 çš„å¹³å°ä¸Šç”¨çš„ä¿æ´»æ‰‹æ®µ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ProcessInnerService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Nullable</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"Not yet implemented"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">            startForeground(PROCESS_SERVICE_ID, <span class="keyword">new</span> Notification());</span><br><span class="line">            stopSelf();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.onStartCommand(intent, flags, startId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è¿›ç¨‹æ­»åæ‹‰æ´»çš„æ–¹æ¡ˆ"><a href="#è¿›ç¨‹æ­»åæ‹‰æ´»çš„æ–¹æ¡ˆ" class="headerlink" title="è¿›ç¨‹æ­»åæ‹‰æ´»çš„æ–¹æ¡ˆ"></a>è¿›ç¨‹æ­»åæ‹‰æ´»çš„æ–¹æ¡ˆ</h1><h2 id="åˆ©ç”¨ç³»ç»Ÿå¹¿æ’­æ‹‰æ´»"><a href="#åˆ©ç”¨ç³»ç»Ÿå¹¿æ’­æ‹‰æ´»" class="headerlink" title="åˆ©ç”¨ç³»ç»Ÿå¹¿æ’­æ‹‰æ´»"></a>åˆ©ç”¨ç³»ç»Ÿå¹¿æ’­æ‹‰æ´»</h2><p>åœ¨å‘ç”Ÿç‰¹å®šç³»ç»Ÿäº‹ä»¶æ—¶ï¼Œç³»ç»Ÿä¼šå‘å‡ºå“åº”çš„å¹¿æ’­ï¼Œé€šè¿‡åœ¨ AndroidManifest ä¸­â€œé™æ€â€æ³¨å†Œå¯¹åº”çš„å¹¿æ’­ç›‘å¬å™¨ï¼Œå³å¯åœ¨å‘ç”Ÿå“åº”äº‹ä»¶æ—¶æ‹‰æ´»ã€‚</p><p>å¸¸ç”¨çš„ç”¨äºæ‹‰æ´»çš„å¹¿æ’­äº‹ä»¶åŒ…æ‹¬ï¼š</p><p><img src="staticbroadcast.webp" alt></p><p>é€‚ç”¨äºå…¨éƒ¨Androidå¹³å°ã€‚ä½†å­˜åœ¨å¦‚ä¸‹å‡ ä¸ªç¼ºç‚¹ï¼š</p><p>1ï¼‰ å¹¿æ’­æ¥æ”¶å™¨è¢«ç®¡ç†è½¯ä»¶ã€ç³»ç»Ÿè½¯ä»¶é€šè¿‡â€œè‡ªå¯ç®¡ç†â€ç­‰åŠŸèƒ½ç¦ç”¨çš„åœºæ™¯æ— æ³•æ¥æ”¶åˆ°å¹¿æ’­ï¼Œä»è€Œæ— æ³•è‡ªå¯ã€‚</p><p>2ï¼‰ ç³»ç»Ÿå¹¿æ’­äº‹ä»¶ä¸å¯æ§ï¼Œåªèƒ½ä¿è¯å‘ç”Ÿäº‹ä»¶æ—¶æ‹‰æ´»è¿›ç¨‹ï¼Œä½†æ— æ³•ä¿è¯è¿›ç¨‹æŒ‚æ‰åç«‹å³æ‹‰æ´»ã€‚</p><blockquote><p>Googleå·²ç»å¼€å§‹æ„è¯†åˆ°è¿™äº›é—®é¢˜ï¼Œæ‰€ä»¥åœ¨æœ€æ–°çš„Android Nå–æ¶ˆäº† ACTION_NEW_PICTUREï¼ˆæ‹ç…§ï¼‰ï¼ŒACTION_NEW_VIDEOï¼ˆæ‹è§†é¢‘ï¼‰ï¼ŒCONNECTIVITY_ACTIONï¼ˆç½‘ç»œåˆ‡æ¢ï¼‰ç­‰ä¸‰ç§å¹¿æ’­ï¼Œæ— ç–‘ç»™äº†å¾ˆå¤šappæ²‰é‡çš„æ‰“å‡»ã€‚</p></blockquote><p>å› æ­¤ï¼Œè¯¥æ–¹æ¡ˆä¸»è¦ä½œä¸ºå¤‡ç”¨æ‰‹æ®µã€‚</p><h2 id="åˆ©ç”¨ç¬¬ä¸‰æ–¹åº”ç”¨å¹¿æ’­æ‹‰æ´»"><a href="#åˆ©ç”¨ç¬¬ä¸‰æ–¹åº”ç”¨å¹¿æ’­æ‹‰æ´»" class="headerlink" title="åˆ©ç”¨ç¬¬ä¸‰æ–¹åº”ç”¨å¹¿æ’­æ‹‰æ´»"></a>åˆ©ç”¨ç¬¬ä¸‰æ–¹åº”ç”¨å¹¿æ’­æ‹‰æ´»</h2><p><strong>åˆ©ç”¨ä¸åŒçš„appè¿›ç¨‹ä½¿ç”¨å¹¿æ’­æ¥è¿›è¡Œç›¸äº’å”¤é†’ã€‚ä¸¾ä¸ª3ä¸ªæ¯”è¾ƒå¸¸è§çš„åœºæ™¯ï¼š</strong></p><ul><li>åœºæ™¯1ï¼šæ¥å…¥ç¬¬ä¸‰æ–¹SDKä¹Ÿä¼šå”¤é†’ç›¸åº”çš„appè¿›ç¨‹ï¼Œå¦‚å¾®ä¿¡sdkä¼šå”¤é†’å¾®ä¿¡ï¼Œæ”¯ä»˜å®sdkä¼šå”¤é†’æ”¯ä»˜å®ã€‚ç”±æ­¤å‘æ•£å¼€å»ï¼Œå°±ä¼šç›´æ¥è§¦å‘äº†ä¸‹é¢çš„ åœºæ™¯3ï¼›</li><li>åœºæ™¯2ï¼šå‡å¦‚ä½ æ‰‹æœºé‡Œè£…äº†æ”¯ä»˜å®ã€æ·˜å®ã€å¤©çŒ«ã€UCç­‰é˜¿é‡Œç³»çš„appï¼Œé‚£ä¹ˆä½ æ‰“å¼€ä»»æ„ä¸€ä¸ªé˜¿é‡Œç³»çš„appåï¼Œæœ‰å¯èƒ½å°±é¡ºä¾¿æŠŠå…¶ä»–é˜¿é‡Œç³»çš„appç»™å”¤é†’äº†ã€‚ï¼ˆåªæ˜¯æ‹¿é˜¿é‡Œæ‰“ä¸ªæ¯”æ–¹ï¼Œå…¶å®BATç³»éƒ½å·®ä¸å¤šï¼‰ã€‚</li></ul><p>ä¹Ÿå¯ä»¥é€šè¿‡åç¼–è¯‘ç¬¬ä¸‰æ–¹ Top åº”ç”¨ï¼Œå¦‚ï¼šæ‰‹æœºQQã€å¾®ä¿¡ã€æ”¯ä»˜å®ã€UCæµè§ˆå™¨ç­‰ï¼Œä»¥åŠå‹ç›Ÿã€ä¿¡é¸½ã€ä¸ªæ¨ç­‰ SDKï¼Œæ‰¾å‡ºå®ƒä»¬å¤–å‘çš„å¹¿æ’­ï¼Œåœ¨åº”ç”¨ä¸­è¿›è¡Œç›‘å¬ï¼Œè¿™æ ·å½“è¿™äº›åº”ç”¨å‘å‡ºå¹¿æ’­æ—¶ï¼Œå°±ä¼šå°†æˆ‘ä»¬çš„åº”ç”¨æ‹‰æ´»ã€‚</p><p>è¯¥æ–¹æ¡ˆçš„æœ‰æ•ˆç¨‹åº¦é™¤ä¸ç³»ç»Ÿå¹¿æ’­ä¸€æ ·çš„å› ç´ å¤–ï¼Œä¸»è¦å—å¦‚ä¸‹å› ç´ é™åˆ¶ï¼š</p><p>1ï¼‰ åç¼–è¯‘åˆ†æè¿‡çš„ç¬¬ä¸‰æ–¹åº”ç”¨çš„å¤šå°‘</p><p>2ï¼‰ ç¬¬ä¸‰æ–¹åº”ç”¨çš„å¹¿æ’­å±äºåº”ç”¨ç§æœ‰ï¼Œå½“å‰ç‰ˆæœ¬ä¸­æœ‰æ•ˆçš„å¹¿æ’­ï¼Œåœ¨åç»­ç‰ˆæœ¬éšæ—¶å°±å¯èƒ½è¢«ç§»é™¤æˆ–è¢«æ”¹ä¸ºä¸å¤–å‘ã€‚</p><p>è¿™äº›å› ç´ éƒ½å½±å“äº†æ‹‰æ´»çš„æ•ˆæœã€‚</p><h2 id="åˆ©ç”¨ç³»ç»ŸServiceæœºåˆ¶æ‹‰æ´»"><a href="#åˆ©ç”¨ç³»ç»ŸServiceæœºåˆ¶æ‹‰æ´»" class="headerlink" title="åˆ©ç”¨ç³»ç»ŸServiceæœºåˆ¶æ‹‰æ´»"></a>åˆ©ç”¨ç³»ç»ŸServiceæœºåˆ¶æ‹‰æ´»</h2><p>å°† Service è®¾ç½®ä¸º START_STICKYï¼Œåˆ©ç”¨ç³»ç»Ÿæœºåˆ¶åœ¨ Service æŒ‚æ‰åè‡ªåŠ¨æ‹‰æ´»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> START_STICKY;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µæ— æ³•æ‹‰æ´»ï¼š</p><ol><li>Service ç¬¬ä¸€æ¬¡è¢«å¼‚å¸¸æ€æ­»åä¼šåœ¨5ç§’å†…é‡å¯ï¼Œç¬¬äºŒæ¬¡è¢«æ€æ­»ä¼šåœ¨10ç§’å†…é‡å¯ï¼Œç¬¬ä¸‰æ¬¡ä¼šåœ¨20ç§’å†…é‡å¯ï¼Œä¸€æ—¦åœ¨çŸ­æ—¶é—´å†… Service è¢«æ€æ­»è¾¾åˆ°5æ¬¡ï¼Œåˆ™ç³»ç»Ÿä¸å†æ‹‰èµ·ã€‚</li><li>è¿›ç¨‹è¢«å–å¾— Root æƒé™çš„ç®¡ç†å·¥å…·æˆ–ç³»ç»Ÿå·¥å…·é€šè¿‡ forestop åœæ­¢æ‰ï¼Œæ— æ³•é‡å¯ã€‚</li></ol><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://mp.weixin.qq.com/s/OXiFQNTyCHpqSP6B9HOiHw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/OXiFQNTyCHpqSP6B9HOiHw</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;Android ç³»ç»Ÿä¸ºäº†ä¿æŒç³»ç»Ÿè¿è¡Œæµç•…ï¼Œåœ¨å†…å­˜åƒç´§çš„æƒ…å†µä¸‹ï¼Œä¼šå°†ä¸€äº›è¿›ç¨‹ kill ï¼Œä»¥é‡Šæ”¾ä¸€éƒ¨åˆ†å†…å­˜ã€‚ç„¶è€Œï¼Œå¯¹äºä¸€äº›ï¼ˆå¦‚ï¼šIM-QQ ã€å¾®ä¿¡ï¼Œæ”¯ä»˜-æ”¯ä»˜å®ç­‰ï¼‰æ¯”è¾ƒé‡è¦ã€æˆ‘ä»¬å¸Œæœ›èƒ½åŠæ—¶æ”¶åˆ°æ¶ˆæ¯çš„ APPï¼Œéœ€è¦ä¿æŒè¿›ç¨‹æŒç»­æ´»è·ƒï¼Œé‚£ä¹ˆå°±éœ€è¦å®æ–½ä¸€äº›ä¿æ´»æªæ–½æ¥ä¿è¯è¿›ç¨‹èƒ½å¤ŸæŒç»­å­˜æ´»ï¼Œå³ &lt;strong&gt;Android è¿›ç¨‹ä¿æ´»&lt;/strong&gt;ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://hackycy.github.io/categories/Android/"/>
    
    
      <category term="è¿›ç¨‹ä¿æ´»" scheme="http://hackycy.github.io/tags/%E8%BF%9B%E7%A8%8B%E4%BF%9D%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title>é‡å­¦Androidä¹‹Handler</title>
    <link href="http://hackycy.github.io/2020/02/02/%E9%87%8D%E5%AD%A6Android%E4%B9%8BHandler/"/>
    <id>http://hackycy.github.io/2020/02/02/é‡å­¦Androidä¹‹Handler/</id>
    <published>2020-02-02T14:09:03.000Z</published>
    <updated>2020-06-04T06:12:49.384Z</updated>
    
    <content type="html"><![CDATA[<p><code>Handler</code> æ˜¯ <code>Android</code> å¼€å‘è¿‡ç¨‹ä¸­éå¸¸éå¸¸å¸¸è§çš„ä¸œè¥¿ã€‚å®ƒé€šå¸¸è¢«æˆ‘ä»¬ç”¨æ¥åšä¸»çº¿ç¨‹ä¸å­çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡å·¥å…·ï¼Œè€Œ Handler ä½œä¸º Android ä¸­æ¶ˆæ¯æœºåˆ¶çš„é‡è¦ä¸€å‘˜ä¹Ÿç¡®å®ç»™æˆ‘ä»¬çš„å¼€å‘å¸¦æ¥äº†æå¤§çš„ä¾¿åˆ©ã€‚</p><a id="more"></a><h1 id="é‡è¯†Handler"><a href="#é‡è¯†Handler" class="headerlink" title="é‡è¯†Handler"></a>é‡è¯†Handler</h1><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Handler <strong>å‘é€å¹¶å¤„ç†</strong>ä¸ä¸€ä¸ªçº¿ç¨‹å…³è”çš„ Message å’Œ Runnable ã€‚ï¼ˆæ³¨æ„ï¼š<strong>Runnable ä¼šè¢«å°è£…è¿›ä¸€ä¸ª Messageï¼Œæ‰€ä»¥å®ƒæœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ª Message</strong> ï¼‰</p><p>æ¯ä¸ª Handler éƒ½ä¼šè·Ÿä¸€ä¸ªçº¿ç¨‹ç»‘å®šï¼Œå¹¶ä¸è¯¥çº¿ç¨‹çš„ MessageQueue å…³è”åœ¨ä¸€èµ·ï¼Œä»è€Œå®ç°æ¶ˆæ¯çš„ç®¡ç†ä»¥åŠçº¿ç¨‹é—´é€šä¿¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">android.os.Handler handler = <span class="keyword">new</span> Handler()&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(<span class="keyword">final</span> Message msg)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è¿™é‡Œæ¥å—å¹¶å¤„ç†æ¶ˆæ¯</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//å‘é€æ¶ˆæ¯</span></span><br><span class="line">handler.sendMessage(message);</span><br><span class="line">handler.post(runnable);</span><br></pre></td></tr></table></figure><p>å®ä¾‹åŒ–ä¸€ä¸ª Handler é‡å†™ <code>handleMessage</code> æ–¹æ³• ï¼Œç„¶ååœ¨éœ€è¦çš„æ—¶å€™è°ƒç”¨å®ƒçš„ <code>send</code> ä»¥åŠ <code>post</code> <strong>ç³»åˆ—æ–¹æ³•</strong>å°±å¯ä»¥äº†ï¼Œéå¸¸ç®€å•æ˜“ç”¨ï¼Œå¹¶ä¸”æ”¯æŒå»¶æ—¶æ¶ˆæ¯ã€‚</p><p><strong>ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•å¦‚ä¸‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sendMessage(Message msg)</span><br><span class="line">sendMessageDelayed(Message msg, <span class="keyword">long</span> uptimeMillis)</span><br><span class="line">post(Runnable r)</span><br><span class="line">postDelayed(Runnable r, <span class="keyword">long</span> uptimeMillis)</span><br><span class="line">sendMessageAtTime(Message msg,<span class="keyword">long</span> when)</span><br><span class="line">  </span><br><span class="line">sendEmptyMessage(<span class="keyword">int</span> what)</span><br><span class="line">sendEmptyMessageDelayed(<span class="keyword">int</span> what, <span class="keyword">long</span> uptimeMillis)</span><br><span class="line">sendEmptyMessageAtTime(<span class="keyword">int</span> what, <span class="keyword">long</span> when)</span><br></pre></td></tr></table></figure><h1 id="Looperã€Handlerã€MessageQueueä¸Messageçš„å…³ç³»ä¸ç›¸å…³æ¦‚å¿µ"><a href="#Looperã€Handlerã€MessageQueueä¸Messageçš„å…³ç³»ä¸ç›¸å…³æ¦‚å¿µ" class="headerlink" title="Looperã€Handlerã€MessageQueueä¸Messageçš„å…³ç³»ä¸ç›¸å…³æ¦‚å¿µ"></a>Looperã€Handlerã€MessageQueueä¸Messageçš„å…³ç³»ä¸ç›¸å…³æ¦‚å¿µ</h1><h2 id="Androidæ¶ˆæ¯å¤„ç†æœºåˆ¶"><a href="#Androidæ¶ˆæ¯å¤„ç†æœºåˆ¶" class="headerlink" title="Androidæ¶ˆæ¯å¤„ç†æœºåˆ¶"></a>Androidæ¶ˆæ¯å¤„ç†æœºåˆ¶</h2><p>ä»€ä¹ˆæ˜¯Androidæ¶ˆæ¯å¤„ç†æœºåˆ¶ï¼Ÿ</p><p><strong>â€œæ¶ˆæ¯â€</strong>æ˜¯windowsè¿è¡Œæœºåˆ¶ä¸­ä¸€ä¸ªåŸºæœ¬è€Œåˆé‡è¦çš„æ¦‚å¿µã€‚<strong>æ¶ˆæ¯</strong>æ˜¯ä¸€ä¸ª<strong>æŠ¥å‘Šäº‹ä»¶å‘ç”Ÿçš„é€šçŸ¥</strong>ï¼Œ<strong>æ¶ˆæ¯é©±åŠ¨</strong>æ˜¯å›´ç»•æ¶ˆæ¯çš„äº§ç”Ÿä¸å¤„ç†å±•å¼€çš„ï¼Œå¹¶ä¾é <strong>æ¶ˆæ¯å¾ªç¯æœºåˆ¶</strong>æ¥å®ç°ï¼ˆç™¾åº¦ç™¾ç§‘ï¼‰ã€‚ä¸Windowsç³»ç»Ÿä¸€æ ·ï¼ŒAndroidä¹Ÿæ˜¯<strong>æ¶ˆæ¯é©±åŠ¨å‹</strong>çš„ç³»ç»Ÿã€‚å¼•ç”¨ä¸€ä¸‹æ¶ˆæ¯é©±åŠ¨æœºåˆ¶çš„å››è¦ç´ ï¼š</p><ul><li><p>æ¥æ”¶æ¶ˆæ¯çš„â€œæ¶ˆæ¯é˜Ÿåˆ—â€</p></li><li><p>é˜»å¡å¼åœ°ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¥æ”¶æ¶ˆæ¯å¹¶è¿›è¡Œå¤„ç†çš„â€œçº¿ç¨‹â€</p></li><li><p>å¯å‘é€çš„â€œæ¶ˆæ¯çš„æ ¼å¼â€</p></li><li><p>â€œæ¶ˆæ¯å‘é€å‡½æ•°â€</p></li></ul><p>ä¸ä¹‹å¯¹åº”ï¼ŒAndroidç³»ç»Ÿä¸­å¯¹åº”å®ç°äº†ï¼š</p><ul><li>æ¥æ”¶æ¶ˆæ¯çš„â€œæ¶ˆæ¯é˜Ÿåˆ—â€ â€”â€”ã€€<strong>MessageQueue</strong></li><li>é˜»å¡å¼åœ°ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¥æ”¶æ¶ˆæ¯å¹¶è¿›è¡Œå¤„ç†çš„â€œçº¿ç¨‹â€ â€”â€”ã€€<strong>Thread+Looper</strong></li><li>å¯å‘é€çš„â€œæ¶ˆæ¯çš„æ ¼å¼â€ â€”â€”ã€€<strong>Message</strong></li><li>â€œæ¶ˆæ¯å‘é€å‡½æ•°â€â€”â€”ã€€<strong>Handlerçš„post()å’ŒsendMessage()</strong></li></ul><p>Androidæœ‰å¤§é‡çš„æ¶ˆæ¯é©±åŠ¨æ–¹å¼æ¥è¿›è¡Œäº¤äº’ï¼Œæ¯”å¦‚Androidçš„å››å¤§ç»„ä»¶â€”â€”<strong>Activity, Service, Broadcast, ContentProvider</strong>çš„å¯åŠ¨è¿‡ç¨‹çš„äº¤äº’ï¼Œéƒ½ç¦»ä¸å¼€æ¶ˆæ¯æœºåˆ¶ã€‚</p><h2 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h2><p>Handleræ˜¯Androidæ¶ˆæ¯æœºåˆ¶çš„ä¸Šå±‚æ¥å£ã€‚<strong>Handlerå¹¶ä¸æ˜¯ä¸“é—¨ç”¨æ¥æ›´æ–°UIçš„ï¼Œåªæ˜¯å¼€å‘è€…å¸¸å¸¸ç”¨å®ƒæ¥æ›´æ–°UI</strong>ã€‚Handlerçš„ä¸»è¦ç”¨äº<strong>åŒä¸€ä¸ªè¿›ç¨‹é—´çš„çº¿ç¨‹é€šä¿¡</strong>ï¼ŒHandlerç”¨äºæ›´æ–°UIçš„æ—¶å€™æ˜¯<strong>â€œå­çº¿ç¨‹ä¸ä¸»çº¿ç¨‹é€šä¿¡â€ï¼›å½“ç„¶ï¼ŒHandlerä¹Ÿå¯ä»¥ç”¨äºå­çº¿ç¨‹ä¹‹é—´é€šä¿¡ã€‚</strong></p><p>Handlerçš„æ¶ˆæ¯æœºåˆ¶ä¸»è¦æ˜¯å°±æŒ‡â€œHandlerçš„è¿è¡Œæœºåˆ¶â€ï¼ŒHandlerçš„è¿è¡Œæœºåˆ¶æ—¶éœ€è¦åº•å±‚çš„<strong>MessageQueueå’ŒLooper</strong>æ”¯æŒçš„ã€‚</p><h2 id="MessageQueue"><a href="#MessageQueue" class="headerlink" title="MessageQueue"></a>MessageQueue</h2><p>MessageQueueç¿»è¯‘è¿‡æ¥æ˜¯â€æ¶ˆæ¯é˜Ÿåˆ—â€çš„æ„æ€ï¼Œå®é™…ä¸Šå®ƒå†…éƒ¨çš„æ•°æ®ç»“æ„ä¸æ˜¯é˜Ÿåˆ—ï¼Œè€Œæ˜¯<strong>å•å‘é“¾è¡¨</strong>ï¼›MessageQueueä¸­å‚¨å­˜äº†å¤§é‡çš„<strong>æ¶ˆæ¯</strong>ï¼Œç”±äº<strong>ä¸€ä¸ªçº¿ç¨‹åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€æ¡æ¶ˆæ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å»ºäº†ä¸€ä¸ªé“¾è¡¨ï¼Œå°†æˆ‘ä»¬éœ€è¦å¤„ç†çš„æ¶ˆæ¯æŒ‰é¡ºåºå‚¨å­˜èµ·æ¥ï¼Œç„¶åä¸€é¡¹ä¸€é¡¹çš„äº¤ç»™éœ€è¦çš„çº¿ç¨‹å¤„ç†</strong>ï¼Œè¿™å°±æ˜¯MessageQueueå­˜åœ¨çš„ä»·å€¼ã€‚</p><h2 id="Looper"><a href="#Looper" class="headerlink" title="Looper"></a>Looper</h2><p>Looperå’ŒMessageQueueçš„æ¶ˆæ¯å°±åƒæ°´æ³µå’Œäº•(é‡Œè¾¹è£…çš„æ˜¯æ°´)çš„å…³ç³»ä¸€æ ·ï¼Œæˆ‘ä»¬æœ‰äº†æ¶ˆæ¯(æ°´)ï¼Œä½†æ˜¯ä¸ºäº†æŠŠæ°´ä»äº•ä¸­æŠ½å–å‡ºæ¥(å¾ªç¯èµ·æ¥)ï¼Œæˆ‘ä»¬å¾—æœ‰ä¸€ä¸ªæ°´æ³µä½œä¸º<strong>åŠ¨åŠ›</strong>ï¼Œè¿™ä¸ªåŠ¨åŠ›å°±æ˜¯Looperã€‚</p><p>å¦‚æœæˆ‘ä»¬åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨<code>Looper.prepare()...Looper.loop()</code>ï¼Œé‚£ä¹ˆä½ çš„çº¿ç¨‹å°±æˆåŠŸå‡çº§ä¸ºäº†ä¸€ä¸ª<strong>Looperçº¿ç¨‹</strong>ï¼Œè¿™æ„å‘³ç€<strong>ä½ çš„çº¿ç¨‹æœ‰äº†ä¸€ä¸ªæ¶ˆæ¯æ³µ(Looper)å’Œä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—(MessageQueue),æ­¤æ—¶ä½ å°±å¯ä»¥è°ƒç”¨Handleræ¥è¿›è¡Œçº¿ç¨‹é—´çš„é€šä¿¡äº†ã€‚</strong></p><p>æˆ‘ä»¬åº”ç”¨çš„UIçº¿ç¨‹ä¹Ÿå°±æ˜¯ä¸»çº¿ç¨‹ï¼Œåœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆå§‹åŒ–ä¸€ä¸ªLooperï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„UIçº¿ç¨‹é»˜è®¤æ˜¯Looperçº¿ç¨‹ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹ä¸­ç›´æ¥è°ƒç”¨Handleræ²¡ä»€ä¹ˆäº‹ï¼Œä½†æ˜¯å†å­çº¿ç¨‹ä¸­åˆ›å»ºHandleréœ€è¦æ‰‹åŠ¨è°ƒç”¨<code>Looper.prepare()...Looper.loop()</code>çš„å’ŒåŸå› ã€‚</p><h2 id="Message"><a href="#Message" class="headerlink" title="Message"></a>Message</h2><p>Messageä¹Ÿå°±æ˜¯æ¶ˆæ¯ï¼Œäº•ä¸­çš„æ°´ã€‚ä¸€ä¸ªMessageåŒ…æ‹¬äº†æ¶ˆæ¯ç±»å‹(what),æ¶ˆæ¯å†…å®¹(arg1,arg2),å‘é€å®ƒçš„Handler(target),Runnableå›è°ƒæ¥å£ç­‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> what;        <span class="comment">//æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> arg1;        <span class="comment">//ç®€å•çš„æ•´æ•°å€¼</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> arg2;        <span class="comment">//ç®€å•çš„æ•´æ•°å€¼å¯ä»¥ç›´æ¥å‘é€ï¼Œæ˜¯ä¸€ç§æ›¿ä»£setDataï¼ˆBundleï¼‰çš„ä½æˆæœ¬æ–¹æ¡ˆï¼Œæ›´åŠ çœèµ„æº</span></span><br><span class="line"><span class="keyword">public</span> Object obj;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*package*/</span> <span class="keyword">int</span> flags;</span><br><span class="line"><span class="comment">/*package*/</span> <span class="keyword">long</span> when;          <span class="comment">//Handlerå‘é€ä¸€ä¸ªæ¶ˆæ¯ä¹‹åï¼Œè¿”å›æ­¤æ¶ˆæ¯çš„ç›®æ ‡äº¤ä»˜æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">/*package*/</span> Bundle data;        <span class="comment">//Bundleå¯ä»¥æºå¸¦æ›´å¤æ‚çš„æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="comment">/*package*/</span> Handler target;     <span class="comment">//å“ªä¸ªHandlerå‘é€çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">/*package*/</span> Runnable callback;  <span class="comment">//å›è°ƒæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯ä»¥çœ‹åˆ°ï¼ŒMessageå¸¦äº†ä¸€ä¸ªæŒ‡å‘ä¸€ä¸‹ä¸ªèŠ‚ç‚¹çš„é“¾ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒMessageQueueå†…éƒ¨ç»´æŠ¤çš„å®é™…ä¸Šæ˜¯ä¸€ä¸ªé“¾è¡¨</span></span><br><span class="line"><span class="comment">/*package*/</span> Message next;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object sPoolSync = <span class="keyword">new</span> Object();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Message sPool;       <span class="comment">//æ¶ˆæ¯æ± </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> sPoolSize = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_POOL_SIZE = <span class="number">50</span>;    <span class="comment">//æ¶ˆæ¯æ± çš„æœ€å¤§å®¹é‡</span></span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>Handler çš„èƒŒåæœ‰ç€ Looper ä»¥åŠ MessageQueue çš„ååŠ©ï¼Œä¸‰è€…é€šåŠ›åˆä½œï¼Œåˆ†å·¥æ˜ç¡®ã€‚</p><ul><li><strong>Message</strong>ï¼šæ¶ˆæ¯åˆ†ä¸ºç¡¬ä»¶äº§ç”Ÿçš„æ¶ˆæ¯(å¦‚æŒ‰é’®ã€è§¦æ‘¸)å’Œè½¯ä»¶ç”Ÿæˆçš„æ¶ˆæ¯ï¼›</li><li><strong>MessageQueue</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—çš„ä¸»è¦åŠŸèƒ½å‘æ¶ˆæ¯æ± æŠ•é€’æ¶ˆæ¯(<code>MessageQueue.enqueueMessage</code>)å’Œå–èµ°æ¶ˆæ¯æ± çš„æ¶ˆæ¯(<code>MessageQueue.next</code>)ï¼›</li><li><strong>Handler</strong>ï¼šæ¶ˆæ¯è¾…åŠ©ç±»ï¼Œä¸»è¦åŠŸèƒ½å‘æ¶ˆæ¯æ± å‘é€å„ç§æ¶ˆæ¯äº‹ä»¶(<code>Handler.sendMessage</code>)å’Œå¤„ç†ç›¸åº”æ¶ˆæ¯äº‹ä»¶(<code>Handler.handleMessage</code>)ï¼›</li><li><strong>Looper</strong>ï¼šä¸æ–­å¾ªç¯æ‰§è¡Œ(<code>Looper.loop</code>)ï¼ŒæŒ‰åˆ†å‘æœºåˆ¶å°†æ¶ˆæ¯åˆ†å‘ç»™ç›®æ ‡å¤„ç†è€…ã€‚</li></ul><p>ä¸€å¼ å›¾æ¥äº†è§£ä¸€ä¸‹å®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼š</p><p><img src="messagequene.png" alt></p><h1 id="HandleråŸç†è§£æï¼ˆJavaå±‚ï¼‰"><a href="#HandleråŸç†è§£æï¼ˆJavaå±‚ï¼‰" class="headerlink" title="HandleråŸç†è§£æï¼ˆJavaå±‚ï¼‰"></a>HandleråŸç†è§£æï¼ˆJavaå±‚ï¼‰</h1><p>æ¥åˆ†æåŸç†å‰ï¼Œå…ˆæ˜ç¡®ä¸€ä¸‹é—®é¢˜ï¼š</p><ol><li><strong>Handler æ˜¯å¦‚ä½•ä¸çº¿ç¨‹å…³è”çš„ï¼Ÿ</strong></li><li><strong>Handler å‘å‡ºå»çš„æ¶ˆæ¯æ˜¯è°ç®¡ç†çš„ï¼Ÿ</strong></li><li><strong>æ¶ˆæ¯åˆæ˜¯æ€ä¹ˆå›åˆ° handleMessage() æ–¹æ³•çš„ï¼Ÿ</strong></li><li><strong>çº¿ç¨‹çš„åˆ‡æ¢æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ</strong></li></ol><p>å¸¦ç€é—®é¢˜å»å¯»æ‰¾ç­”æ¡ˆã€‚</p><h2 id="Handlerä¸Looperçš„å…³è”"><a href="#Handlerä¸Looperçš„å…³è”" class="headerlink" title="Handlerä¸Looperçš„å…³è”"></a>Handlerä¸Looperçš„å…³è”</h2><p>å®ä¾‹åŒ– Handler çš„æ—¶å€™ Handler ä¼šå»æ£€æŸ¥å½“å‰çº¿ç¨‹çš„ Looper æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä¼šæŠ¥å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>åœ¨åˆ›å»º Handler ä¹‹å‰ä¸€å®šéœ€è¦å…ˆåˆ›å»º Looper</strong> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(@Nullable Callback callback, <span class="keyword">boolean</span> async)</span> </span>&#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//æ£€æŸ¥å½“å‰çš„çº¿ç¨‹æ˜¯å¦æœ‰ Looper</span></span><br><span class="line">mLooper = Looper.myLooper();</span><br><span class="line"><span class="keyword">if</span> (mLooper == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                <span class="string">"Can't create handler inside thread "</span> + Thread.currentThread()</span><br><span class="line">                        + <span class="string">" that has not called Looper.prepare()"</span>);</span><br><span class="line">&#125;</span><br><span class="line">  <span class="comment">//Looper æŒæœ‰ä¸€ä¸ª MessageQueue</span></span><br><span class="line">mQueue = mLooper.mQueue;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™ä¸ªå¼‚å¸¸å¯èƒ½æœ‰çš„ä¸ç†Ÿæ‚‰ï¼Œå› ä¸ºå¹³æ—¶ç›´æ¥ä½¿ç”¨æ„Ÿå—ä¸åˆ°è¿™ä¸ªå¼‚å¸¸æ˜¯å› ä¸ºä¸»çº¿ç¨‹å·²ç»ä¸ºæˆ‘ä»¬åˆ›å»ºå¥½äº† Looper</p></blockquote><p>ä¸€ä¸ªå®Œæ•´çš„ Handler ä½¿ç”¨ä¾‹å­å…¶å®æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LooperThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Handler mHandler;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Looper.prepare();</span><br><span class="line">        mHandler = <span class="keyword">new</span> Handler() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// process incoming messages here</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Looper.loop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Looper.prepare()</strong></p><p>å¯¹äºæ— å‚çš„æƒ…å†µï¼Œé»˜è®¤è°ƒç”¨<code>prepare(true)</code>ï¼Œè¡¨ç¤ºçš„æ˜¯è¿™ä¸ªLooperå…è®¸é€€å‡ºï¼Œè€Œå¯¹äºfalseçš„æƒ…å†µåˆ™è¡¨ç¤ºå½“å‰Looperä¸å…è®¸é€€å‡ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">prepare(<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">(<span class="keyword">boolean</span> quitAllowed)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (sThreadLocal.get() != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Only one Looper may be created per thread"</span>);</span><br><span class="line">&#125;</span><br><span class="line">sThreadLocal.set(<span class="keyword">new</span> Looper(quitAllowed));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>sThreadLocal</code>æ˜¯ThreadLocalç±»å‹ï¼Œä¸‹é¢ï¼Œå…ˆè¯´è¯´ThreadLocalã€‚</p><p><strong>ThreadLocal</strong>ï¼š çº¿ç¨‹æœ¬åœ°å­˜å‚¨åŒºï¼ˆThread Local Storageï¼Œç®€ç§°ä¸ºTLSï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç§æœ‰çš„æœ¬åœ°å­˜å‚¨åŒºåŸŸï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´å½¼æ­¤ä¸èƒ½è®¿é—®å¯¹æ–¹çš„TLSåŒºåŸŸã€‚</p><p>Looperç±»ä¸­å…¶å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Looper&gt; sThreadLocal = <span class="keyword">new</span> ThreadLocal&lt;Looper&gt;();</span><br></pre></td></tr></table></figure><p>å¯è§<code>sThreadLocal</code>çš„get()å’Œset()æ“ä½œçš„ç±»å‹éƒ½æ˜¯<code>Looper</code>ç±»å‹ã€‚</p><blockquote><p>å¦å¤–ï¼Œä¸prepare()ç›¸è¿‘åŠŸèƒ½çš„ï¼Œè¿˜æœ‰ä¸€ä¸ª<code>prepareMainLooper()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸»è¦åœ¨ActivityThreadç±»ä¸­ä½¿ç”¨ã€‚</p></blockquote><p>Looper æä¾›äº† <code>Looper.prepare()</code> æ–¹æ³•æ¥åˆ›å»º Looper ï¼Œå¹¶ä¸”ä¼š<strong>å€ŸåŠ© ThreadLocal æ¥å®ç°ä¸å½“å‰çº¿ç¨‹çš„ç»‘å®š</strong>åŠŸèƒ½ã€‚<strong>Looper.loop() åˆ™ä¼šå¼€å§‹ä¸æ–­å°è¯•ä» MessageQueue ä¸­è·å– Message , å¹¶åˆ†å‘ç»™å¯¹åº”çš„ Handler</strong></p><p><strong>ä¹Ÿå°±æ˜¯è¯´ Handler è·Ÿçº¿ç¨‹çš„å…³è”æ˜¯é  Looper æ¥å®ç°çš„ã€‚</strong></p><h2 id="Message-çš„å‘é€"><a href="#Message-çš„å‘é€" class="headerlink" title="Message çš„å‘é€"></a>Message çš„å‘é€</h2><p>å‘é€æ¶ˆæ¯è°ƒç”¨é“¾ï¼š</p><p><img src="java_sendmessage.png" alt></p><p>ä¸ç®¡æˆ‘ä»¬è°ƒç”¨ä»€ä¹ˆæ–¹æ³•ï¼Œæœ€ç»ˆéƒ½ä¼šèµ°åˆ° <code>MessageQueue.enqueueMessage(Message,long)</code> æ–¹æ³•ã€‚</p><p>ä¾‹å¦‚<code>sendEmptyMessage</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">sendEmptyMessage</span><span class="params">(<span class="keyword">int</span> what)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> sendEmptyMessageDelayed(what, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// -&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">sendEmptyMessageDelayed</span><span class="params">(<span class="keyword">int</span> what, <span class="keyword">long</span> delayMillis)</span> </span>&#123;</span><br><span class="line">Message msg = Message.obtain();</span><br><span class="line">msg.what = what;</span><br><span class="line"><span class="keyword">return</span> sendMessageDelayed(msg, delayMillis);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// -&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">sendMessageDelayed</span><span class="params">(@NonNull Message msg, <span class="keyword">long</span> delayMillis)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (delayMillis &lt; <span class="number">0</span>) &#123;</span><br><span class="line">delayMillis = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> sendMessageAtTime(msg, SystemClock.uptimeMillis() + delayMillis);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// -&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendMessageAtTime</span><span class="params">(@NonNull Message msg, <span class="keyword">long</span> uptimeMillis)</span> </span>&#123;</span><br><span class="line">MessageQueue queue = mQueue;</span><br><span class="line"><span class="keyword">if</span> (queue == <span class="keyword">null</span>) &#123;</span><br><span class="line">RuntimeException e = <span class="keyword">new</span> RuntimeException(</span><br><span class="line">   <span class="keyword">this</span> + <span class="string">" sendMessageAtTime() called with no mQueue"</span>);</span><br><span class="line">Log.w(<span class="string">"Looper"</span>, e.getMessage(), e);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> enqueueMessage(queue, msg, uptimeMillis);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Handler.sendEmptyMessage()</code>ç­‰ç³»åˆ—æ–¹æ³•æœ€ç»ˆè°ƒç”¨<code>MessageQueue.enqueueMessage(msg, uptimeMillis)</code>ï¼Œå°†æ¶ˆæ¯æ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå…¶ä¸­uptimeMillisä¸ºç³»ç»Ÿå½“å‰çš„è¿è¡Œæ—¶é—´ï¼Œä¸åŒ…æ‹¬ä¼‘çœ æ—¶é—´ã€‚</p><p><strong>enqueueMessage</strong></p><p>æ·»åŠ ä¸€æ¡æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">enqueueMessage</span><span class="params">(Message msg, <span class="keyword">long</span> when)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ¯ä¸€ä¸ªæ™®é€šMessageå¿…é¡»æœ‰ä¸€ä¸ªtarget</span></span><br><span class="line">    <span class="keyword">if</span> (msg.target == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Message must have a target."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (msg.isInUse()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(msg + <span class="string">" This message is already in use."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mQuitting) &#123;  <span class="comment">//æ­£åœ¨é€€å‡ºæ—¶ï¼Œå›æ”¶msgï¼ŒåŠ å…¥åˆ°æ¶ˆæ¯æ± </span></span><br><span class="line">            msg.recycle();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        msg.markInUse();</span><br><span class="line">        msg.when = when;</span><br><span class="line">        Message p = mMessages;</span><br><span class="line">        <span class="keyword">boolean</span> needWake;</span><br><span class="line">        <span class="keyword">if</span> (p == <span class="keyword">null</span> || when == <span class="number">0</span> || when &lt; p.when) &#123;</span><br><span class="line">            <span class="comment">//pä¸ºnull(ä»£è¡¨MessageQueueæ²¡æœ‰æ¶ˆæ¯ï¼‰ æˆ–è€…msgçš„è§¦å‘æ—¶é—´æ˜¯é˜Ÿåˆ—ä¸­æœ€æ—©çš„ï¼Œ åˆ™è¿›å…¥è¯¥è¯¥åˆ†æ”¯</span></span><br><span class="line">            msg.next = p;</span><br><span class="line">            mMessages = msg;</span><br><span class="line">            needWake = mBlocked; <span class="comment">//å½“é˜»å¡æ—¶éœ€è¦å”¤é†’</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//å°†æ¶ˆæ¯æŒ‰æ—¶é—´é¡ºåºæ’å…¥åˆ°MessageQueueã€‚ä¸€èˆ¬åœ°ï¼Œä¸éœ€è¦å”¤é†’äº‹ä»¶é˜Ÿåˆ—ï¼Œé™¤é</span></span><br><span class="line">            <span class="comment">//æ¶ˆæ¯é˜Ÿå¤´å­˜åœ¨barrierï¼Œå¹¶ä¸”åŒæ—¶Messageæ˜¯é˜Ÿåˆ—ä¸­æœ€æ—©çš„å¼‚æ­¥æ¶ˆæ¯ã€‚</span></span><br><span class="line">            needWake = mBlocked &amp;&amp; p.target == <span class="keyword">null</span> &amp;&amp; msg.isAsynchronous();</span><br><span class="line">            Message prev;</span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                prev = p;</span><br><span class="line">                p = p.next;</span><br><span class="line">                <span class="keyword">if</span> (p == <span class="keyword">null</span> || when &lt; p.when) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (needWake &amp;&amp; p.isAsynchronous()) &#123;</span><br><span class="line">                    needWake = <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            msg.next = p;</span><br><span class="line">            prev.next = msg;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ¶ˆæ¯æ²¡æœ‰é€€å‡ºï¼Œæˆ‘ä»¬è®¤ä¸ºæ­¤æ—¶mPtr != 0</span></span><br><span class="line">        <span class="keyword">if</span> (needWake) &#123;</span><br><span class="line">            nativeWake(mPtr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>MessageQueue</code>æ˜¯æŒ‰ç…§Messageè§¦å‘æ—¶é—´çš„å…ˆåé¡ºåºæ’åˆ—çš„ï¼Œé˜Ÿå¤´çš„æ¶ˆæ¯æ˜¯å°†è¦æœ€æ—©è§¦å‘çš„æ¶ˆæ¯ã€‚å½“æœ‰æ¶ˆæ¯éœ€è¦åŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—æ—¶ï¼Œä¼šä»é˜Ÿåˆ—å¤´å¼€å§‹éå†ï¼Œç›´åˆ°æ‰¾åˆ°æ¶ˆæ¯åº”è¯¥æ’å…¥çš„åˆé€‚ä½ç½®ï¼Œä»¥ä¿è¯æ‰€æœ‰æ¶ˆæ¯çš„æ—¶é—´é¡ºåºã€‚</p><h2 id="Messageçš„åˆ†å‘"><a href="#Messageçš„åˆ†å‘" class="headerlink" title="Messageçš„åˆ†å‘"></a>Messageçš„åˆ†å‘</h2><p><code>Looper.loop()</code>æ–¹æ³•æ¥è¿›è¡Œæ¶ˆæ¯çš„åˆ†å‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Looper</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Looper me = myLooper(); <span class="comment">//è·å–TLSå­˜å‚¨çš„Looperå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">if</span> (me == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"No Looper; Looper.prepare() wasn't called on this thread."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> MessageQueue queue = me.mQueue; <span class="comment">//è·å–Looperå¯¹è±¡ä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—</span></span><br><span class="line">  </span><br><span class="line">  Binder.clearCallingIdentity();</span><br><span class="line">    <span class="comment">//ç¡®ä¿åœ¨æƒé™æ£€æŸ¥æ—¶åŸºäºæœ¬åœ°è¿›ç¨‹ï¼Œè€Œä¸æ˜¯è°ƒç”¨è¿›ç¨‹ã€‚</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> ident = Binder.clearCallingIdentity();</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">       <span class="comment">// ä¸æ–­ä» MessageQueue è·å– æ¶ˆæ¯</span></span><br><span class="line">        Message msg = queue.next(); <span class="comment">// might block</span></span><br><span class="line">        <span class="comment">//é€€å‡º Looper </span></span><br><span class="line">        <span class="keyword">if</span> (msg == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// No message indicates that the message queue is quitting.</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            msg.target.dispatchMessage(msg);</span><br><span class="line">            end = (slowDispatchThresholdMs == <span class="number">0</span>) ? <span class="number">0</span> : SystemClock.uptimeMillis();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">      <span class="comment">//æ¢å¤è°ƒç”¨è€…ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> newIdent = Binder.clearCallingIdentity();</span><br><span class="line"><span class="comment">//å›æ”¶ message</span></span><br><span class="line">        msg.recycleUnchecked();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>loop()è¿›å…¥å¾ªç¯æ¨¡å¼ï¼Œä¸æ–­é‡å¤ä¸‹é¢çš„æ“ä½œï¼Œç›´åˆ°æ²¡æœ‰æ¶ˆæ¯æ—¶é€€å‡ºå¾ªç¯</p><ul><li>è¯»å–MessageQueueçš„ä¸‹ä¸€æ¡Messageï¼›</li><li>æŠŠMessageåˆ†å‘ç»™ç›¸åº”çš„targetï¼›</li><li>å†æŠŠåˆ†å‘åçš„Messageå›æ”¶åˆ°æ¶ˆæ¯æ± ï¼Œä»¥ä¾¿é‡å¤åˆ©ç”¨ã€‚</li></ul><p>è¿™æ˜¯è¿™ä¸ªæ¶ˆæ¯å¤„ç†çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚å¦å¤–ï¼Œä¸Šé¢ä»£ç ä¸­å¯ä»¥çœ‹åˆ°æœ‰loggingæ–¹æ³•ï¼Œè¿™æ˜¯ç”¨äºdebugçš„ï¼Œé»˜è®¤æƒ…å†µä¸‹<code>logging == null</code>ï¼Œé€šè¿‡è®¾ç½®setMessageLogging()ç”¨æ¥å¼€å¯debugå·¥ä½œã€‚</p><p><code>loop()</code> é‡Œè°ƒç”¨äº† <code>MessageQueue.next()</code> :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Message <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> ptr = mPtr;</span><br><span class="line">    <span class="keyword">if</span> (ptr == <span class="number">0</span>) &#123; <span class="comment">//å½“æ¶ˆæ¯å¾ªç¯å·²ç»é€€å‡ºï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> pendingIdleHandlerCount = -<span class="number">1</span>; <span class="comment">// å¾ªç¯è¿­ä»£çš„é¦–æ¬¡ä¸º-1</span></span><br><span class="line">    <span class="keyword">int</span> nextPollTimeoutMillis = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nextPollTimeoutMillis != <span class="number">0</span>) &#123;</span><br><span class="line">            Binder.flushPendingCommands();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//é˜»å¡æ“ä½œï¼Œå½“ç­‰å¾…nextPollTimeoutMillisæ—¶é•¿ï¼Œæˆ–è€…æ¶ˆæ¯é˜Ÿåˆ—è¢«å”¤é†’ï¼Œéƒ½ä¼šè¿”å›</span></span><br><span class="line">        nativePollOnce(ptr, nextPollTimeoutMillis);</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">long</span> now = SystemClock.uptimeMillis();</span><br><span class="line">            Message prevMsg = <span class="keyword">null</span>;</span><br><span class="line">            Message msg = mMessages;</span><br><span class="line">            <span class="comment">//å½“æ¶ˆæ¯çš„Handlerä¸ºç©ºæ—¶ï¼Œåˆ™æŸ¥è¯¢å¼‚æ­¥æ¶ˆæ¯</span></span><br><span class="line">            <span class="keyword">if</span> (msg != <span class="keyword">null</span> &amp;&amp; msg.target == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">//å½“æŸ¥è¯¢åˆ°å¼‚æ­¥æ¶ˆæ¯ï¼Œåˆ™ç«‹åˆ»é€€å‡ºå¾ªç¯</span></span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    prevMsg = msg;</span><br><span class="line">                    msg = msg.next;</span><br><span class="line">                &#125; <span class="keyword">while</span> (msg != <span class="keyword">null</span> &amp;&amp; !msg.isAsynchronous());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (msg != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (now &lt; msg.when) &#123;</span><br><span class="line">                    <span class="comment">//å½“å¼‚æ­¥æ¶ˆæ¯è§¦å‘æ—¶é—´å¤§äºå½“å‰æ—¶é—´ï¼Œåˆ™è®¾ç½®ä¸‹ä¸€æ¬¡è½®è¯¢çš„è¶…æ—¶æ—¶é•¿</span></span><br><span class="line">                    nextPollTimeoutMillis = (<span class="keyword">int</span>) Math.min(msg.when - now, Integer.MAX_VALUE);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// è·å–ä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶è¿”å›</span></span><br><span class="line">                    mBlocked = <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">if</span> (prevMsg != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        prevMsg.next = msg.next;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        mMessages = msg.next;</span><br><span class="line">                    &#125;</span><br><span class="line">                    msg.next = <span class="keyword">null</span>;</span><br><span class="line">                    <span class="comment">//è®¾ç½®æ¶ˆæ¯çš„ä½¿ç”¨çŠ¶æ€ï¼Œå³flags |= FLAG_IN_USE</span></span><br><span class="line">                    msg.markInUse();</span><br><span class="line">                    <span class="keyword">return</span> msg;   <span class="comment">//æˆåŠŸåœ°è·å–MessageQueueä¸­çš„ä¸‹ä¸€æ¡å³å°†è¦æ‰§è¡Œçš„æ¶ˆæ¯</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//æ²¡æœ‰æ¶ˆæ¯</span></span><br><span class="line">                nextPollTimeoutMillis = -<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//æ¶ˆæ¯æ­£åœ¨é€€å‡ºï¼Œè¿”å›null</span></span><br><span class="line">            <span class="keyword">if</span> (mQuitting) &#123;</span><br><span class="line">                dispose();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å½“æ¶ˆæ¯é˜Ÿåˆ—ä¸ºç©ºï¼Œæˆ–è€…æ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯æ—¶</span></span><br><span class="line">            <span class="keyword">if</span> (pendingIdleHandlerCount &lt; <span class="number">0</span> &amp;&amp; (mMessages == <span class="keyword">null</span> || now &lt; mMessages.when)) &#123;</span><br><span class="line">                pendingIdleHandlerCount = mIdleHandlers.size();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (pendingIdleHandlerCount &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">//æ²¡æœ‰idle handlers éœ€è¦è¿è¡Œï¼Œåˆ™å¾ªç¯å¹¶ç­‰å¾…ã€‚</span></span><br><span class="line">                mBlocked = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (mPendingIdleHandlers == <span class="keyword">null</span>) &#123;</span><br><span class="line">                mPendingIdleHandlers = <span class="keyword">new</span> IdleHandler[Math.max(pendingIdleHandlerCount, <span class="number">4</span>)];</span><br><span class="line">            &#125;</span><br><span class="line">            mPendingIdleHandlers = mIdleHandlers.toArray(mPendingIdleHandlers);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åªæœ‰ç¬¬ä¸€æ¬¡å¾ªç¯æ—¶ï¼Œä¼šè¿è¡Œidle handlersï¼Œæ‰§è¡Œå®Œæˆåï¼Œé‡ç½®pendingIdleHandlerCountä¸º0.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pendingIdleHandlerCount; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> IdleHandler idler = mPendingIdleHandlers[i];</span><br><span class="line">            mPendingIdleHandlers[i] = <span class="keyword">null</span>; <span class="comment">//å»æ‰handlerçš„å¼•ç”¨</span></span><br><span class="line">            <span class="keyword">boolean</span> keep = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                keep = idler.queueIdle();  <span class="comment">//idleæ—¶æ‰§è¡Œçš„æ–¹æ³•</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">                Log.wtf(TAG, <span class="string">"IdleHandler threw exception"</span>, t);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!keep) &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">                    mIdleHandlers.remove(idler);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//é‡ç½®idle handlerä¸ªæ•°ä¸º0ï¼Œä»¥ä¿è¯ä¸ä¼šå†æ¬¡é‡å¤è¿è¡Œ</span></span><br><span class="line">        pendingIdleHandlerCount = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//å½“è°ƒç”¨ä¸€ä¸ªç©ºé—²handleræ—¶ï¼Œä¸€ä¸ªæ–°messageèƒ½å¤Ÿè¢«åˆ†å‘ï¼Œå› æ­¤æ— éœ€ç­‰å¾…å¯ä»¥ç›´æ¥æŸ¥è¯¢pending message.</span></span><br><span class="line">        nextPollTimeoutMillis = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>nativePollOnce</code>æ˜¯é˜»å¡æ“ä½œï¼Œå…¶ä¸­<code>nextPollTimeoutMillis</code>ä»£è¡¨ä¸‹ä¸€ä¸ªæ¶ˆæ¯åˆ°æ¥å‰ï¼Œè¿˜éœ€è¦ç­‰å¾…çš„æ—¶é•¿ï¼›å½“nextPollTimeoutMillis = -1æ—¶ï¼Œè¡¨ç¤ºæ¶ˆæ¯é˜Ÿåˆ—ä¸­æ— æ¶ˆæ¯ï¼Œä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ã€‚</p><p>å½“å¤„äºç©ºé—²æ—¶ï¼Œå¾€å¾€ä¼šæ‰§è¡Œ<code>IdleHandler</code>ä¸­çš„æ–¹æ³•ã€‚å½“nativePollOnce()è¿”å›åï¼Œnext()ä»<code>mMessages</code>ä¸­æå–ä¸€ä¸ªæ¶ˆæ¯ã€‚</p></blockquote><p>å¹¶ä¸”loopæ–¹æ³•è°ƒç”¨äº† <code>msg.target.dispatchMessage(msg)</code> ï¼Œmsg.target å°±æ˜¯å‘é€è¯¥æ¶ˆæ¯çš„ Handler</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Handler</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispatchMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//msg.callback æ˜¯ Runnable ï¼Œå¦‚æœæ˜¯ postæ–¹æ³•åˆ™ä¼šèµ°è¿™ä¸ª if</span></span><br><span class="line">  <span class="keyword">if</span> (msg.callback != <span class="keyword">null</span>) &#123;</span><br><span class="line">    handleCallback(msg);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//callback </span></span><br><span class="line">    <span class="keyword">if</span> (mCallback != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (mCallback.handleMessage(msg)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å›è°ƒåˆ° Handler çš„ handleMessage æ–¹æ³•</span></span><br><span class="line">    handleMessage(msg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>dispatchMessage() æ–¹æ³•é’ˆå¯¹ Runnable çš„æ–¹æ³•åšäº†ç‰¹æ®Šå¤„ç†ï¼Œå¦‚æœæ˜¯ ï¼Œåˆ™ä¼šç›´æ¥æ‰§è¡Œ <code>Runnable.run()</code> ã€‚</strong></p></blockquote><p><strong>Looper.loop() æ˜¯ä¸ªæ­»å¾ªç¯ï¼Œä¼šä¸æ–­è°ƒç”¨ MessageQueue.next() è·å– Message ï¼Œå¹¶è°ƒç”¨ <code>msg.target.dispatchMessage(msg)</code> å›åˆ°äº† Handler æ¥åˆ†å‘æ¶ˆæ¯ï¼Œä»¥æ­¤æ¥å®Œæˆæ¶ˆæ¯çš„å›è°ƒ</strong>ã€‚</p><p><img src="yuanli.webp" alt></p><h2 id="çº¿ç¨‹çš„åˆ‡æ¢"><a href="#çº¿ç¨‹çš„åˆ‡æ¢" class="headerlink" title="çº¿ç¨‹çš„åˆ‡æ¢"></a>çº¿ç¨‹çš„åˆ‡æ¢</h2><p>å…ˆå°†æ‰€æ¶‰åŠçš„æ–¹æ³•è°ƒç”¨æ ˆç”»å‡ºæ¥ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Thread.foo()&#123;</span><br><span class="line">Looper.loop()</span><br><span class="line"> -&gt; MessageQueue.next()</span><br><span class="line">   -&gt; Message.target.dispatchMessage()</span><br><span class="line">    -&gt; Handler.handleMessage()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ˜¾è€Œæ˜“è§ï¼ŒHandler.handleMessage() æ‰€åœ¨çš„çº¿ç¨‹æœ€ç»ˆç”±è°ƒç”¨ Looper.loop() çš„çº¿ç¨‹æ‰€å†³å®šã€‚</strong></p><p>å¹³æ—¶æˆ‘ä»¬ç”¨çš„æ—¶å€™ä»å¼‚æ­¥çº¿ç¨‹å‘é€æ¶ˆæ¯åˆ° Handlerï¼Œè¿™ä¸ª Handler çš„ <code>handleMessage()</code> æ–¹æ³•æ˜¯åœ¨ä¸»çº¿ç¨‹è°ƒç”¨çš„ï¼Œæ‰€ä»¥æ¶ˆæ¯å°±ä»å¼‚æ­¥çº¿ç¨‹åˆ‡æ¢åˆ°äº†ä¸»çº¿ç¨‹ã€‚</p><h1 id="Handlerçš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿"><a href="#Handlerçš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿" class="headerlink" title="Handlerçš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿"></a>Handlerçš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿</h1><p>Handlerå¾ˆå¸¸ç”¨ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¾ˆå¤šéœ€è¦æ³¨æ„çš„ã€‚</p><h2 id="ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹å¯ä»¥ç›´æ¥ä½¿ç”¨-Handlerï¼Œä¸éœ€è¦åˆ›å»º-Looper"><a href="#ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹å¯ä»¥ç›´æ¥ä½¿ç”¨-Handlerï¼Œä¸éœ€è¦åˆ›å»º-Looper" class="headerlink" title="ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹å¯ä»¥ç›´æ¥ä½¿ç”¨ Handlerï¼Œä¸éœ€è¦åˆ›å»º Looper"></a>ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹å¯ä»¥ç›´æ¥ä½¿ç”¨ Handlerï¼Œä¸éœ€è¦åˆ›å»º Looper</h2><p>å‰é¢æˆ‘ä»¬æåˆ°äº†æ¯ä¸ªHandler çš„çº¿ç¨‹éƒ½æœ‰ä¸€ä¸ª Looper ï¼Œä¸»çº¿ç¨‹å½“ç„¶ä¹Ÿä¸ä¾‹å¤–ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸æ›¾å‡†å¤‡è¿‡ä¸»çº¿ç¨‹çš„ Looper è€Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè¿™æ˜¯ä¸ºä½•ï¼Ÿ</p><p><strong>æ³¨æ„ï¼šé€šå¸¸æˆ‘ä»¬è®¤ä¸º ActivityThread å°±æ˜¯ä¸»çº¿ç¨‹ã€‚äº‹å®ä¸Šå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œæ˜¯ä¸»çº¿ç¨‹æ“ä½œçš„ç®¡ç†è€…ï¼Œæ‰€ä»¥å§ï¼Œæˆ‘è§‰å¾—æŠŠ ActivityThread è®¤ä¸ºå°±æ˜¯ä¸»çº¿ç¨‹æ— å¯åšéï¼Œå¦å¤–ä¸»çº¿ç¨‹ä¹Ÿå¯ä»¥è¯´æˆ UI çº¿ç¨‹ã€‚</strong></p><p>åœ¨ ActivityThread.main() æ–¹æ³•ä¸­æœ‰å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//android.app.ActivityThread</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">  //...</span><br><span class="line">  Looper.prepareMainLooper();</span><br><span class="line"></span><br><span class="line">  ActivityThread thread = new ActivityThread();</span><br><span class="line">  thread.attach(false);</span><br><span class="line"></span><br><span class="line">  if (sMainThreadHandler == null) &#123;</span><br><span class="line">    sMainThreadHandler = thread.getHandler();</span><br><span class="line">  &#125;</span><br><span class="line">  //...</span><br><span class="line">  Looper.loop();</span><br><span class="line"></span><br><span class="line">  throw new RuntimeException(&quot;Main thread loop unexpectedly exited&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Looper.prepareMainLooper(); ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Initialize the current thread as a looper, marking it as an</span><br><span class="line"> * application&apos;s main looper. The main looper for your application</span><br><span class="line"> * is created by the Android environment, so you should never need</span><br><span class="line"> * to call this function yourself.  See also: &#123;@link #prepare()&#125;</span><br><span class="line"> */</span><br><span class="line">public static void prepareMainLooper() &#123;</span><br><span class="line">    prepare(false);</span><br><span class="line">    synchronized (Looper.class) &#123;</span><br><span class="line">        if (sMainLooper != null) &#123;</span><br><span class="line">            throw new IllegalStateException(&quot;The main Looper has already been prepared.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        sMainLooper = myLooper();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<strong>åœ¨ ActivityThread é‡Œ è°ƒç”¨äº† Looper.prepareMainLooper() æ–¹æ³•åˆ›å»ºäº† ä¸»çº¿ç¨‹çš„ Looper ,å¹¶ä¸”è°ƒç”¨äº† loop() æ–¹æ³•</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ Handler äº†ã€‚</p><p><strong>æ³¨æ„ï¼š<code>Looper.loop()</code> æ˜¯ä¸ªæ­»å¾ªç¯ï¼Œåé¢çš„ä»£ç æ­£å¸¸æƒ…å†µä¸ä¼šæ‰§è¡Œã€‚</strong></p><h2 id="ä¸»çº¿ç¨‹çš„-Looper-ä¸å…è®¸é€€å‡º"><a href="#ä¸»çº¿ç¨‹çš„-Looper-ä¸å…è®¸é€€å‡º" class="headerlink" title="ä¸»çº¿ç¨‹çš„ Looper ä¸å…è®¸é€€å‡º"></a>ä¸»çº¿ç¨‹çš„ Looper ä¸å…è®¸é€€å‡º</h2><p>å¦‚æœä½ å°è¯•é€€å‡º Looper ï¼Œä½ ä¼šå¾—åˆ°ä»¥ä¸‹é”™è¯¯ä¿¡æ¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.lang.IllegalStateException: Main thread not allowed to quit.</span><br><span class="line">  at android.os.MessageQueue.quit(MessageQueue.java:415)</span><br><span class="line">  at android.os.Looper.quit(Looper.java:240)</span><br></pre></td></tr></table></figure><p> å…¶å®åŸå› å¾ˆç®€å•ï¼Œ<strong>ä¸»çº¿ç¨‹ä¸å…è®¸é€€å‡º</strong>ï¼Œé€€å‡ºå°±æ„å‘³ APP è¦æŒ‚ã€‚</p><h2 id="ä¸ºä»€ä¹ˆLooper-loopæ–¹æ³•ä¸ä¼šå¡æ­»ä¸»çº¿ç¨‹"><a href="#ä¸ºä»€ä¹ˆLooper-loopæ–¹æ³•ä¸ä¼šå¡æ­»ä¸»çº¿ç¨‹" class="headerlink" title="ä¸ºä»€ä¹ˆLooper.loopæ–¹æ³•ä¸ä¼šå¡æ­»ä¸»çº¿ç¨‹"></a>ä¸ºä»€ä¹ˆLooper.loopæ–¹æ³•ä¸ä¼šå¡æ­»ä¸»çº¿ç¨‹</h2><p>å‚è€ƒï¼š<a href="https://www.zhihu.com/question/34652589/answer/90344494" target="_blank" rel="noopener">https://www.zhihu.com/question/34652589/answer/90344494</a></p><h2 id="Handler-é‡Œè—ç€çš„-Callback-èƒ½å¹²ä»€ä¹ˆ"><a href="#Handler-é‡Œè—ç€çš„-Callback-èƒ½å¹²ä»€ä¹ˆ" class="headerlink" title="Handler é‡Œè—ç€çš„ Callback èƒ½å¹²ä»€ä¹ˆ"></a>Handler é‡Œè—ç€çš„ Callback èƒ½å¹²ä»€ä¹ˆ</h2><p>åœ¨ Handler çš„æ„é€ æ–¹æ³•ä¸­æœ‰å‡ ä¸ª è¦æ±‚ä¼ å…¥ Callback ï¼Œé‚£å®ƒæ˜¯ä»€ä¹ˆï¼Œåˆèƒ½åšä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æ¥çœ‹çœ‹ <code>Handler.dispatchMessage(msg)</code> æ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public void dispatchMessage(Message msg) &#123;</span><br><span class="line">  //è¿™é‡Œçš„ callback æ˜¯ Runnable</span><br><span class="line">  if (msg.callback != null) &#123;</span><br><span class="line">    handleCallback(msg);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    //å¦‚æœ callback å¤„ç†äº†è¯¥ msg å¹¶ä¸”è¿”å› trueï¼Œ å°±ä¸ä¼šå†å›è°ƒ handleMessage</span><br><span class="line">    if (mCallback != null) &#123;</span><br><span class="line">      if (mCallback.handleMessage(msg)) &#123;</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    handleMessage(msg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° Handler.Callback æœ‰<strong>ä¼˜å…ˆå¤„ç†æ¶ˆæ¯çš„æƒåˆ©</strong> ï¼Œå½“ä¸€æ¡æ¶ˆæ¯è¢« Callback å¤„ç†<strong>å¹¶æ‹¦æˆªï¼ˆè¿”å› trueï¼‰</strong>ï¼Œé‚£ä¹ˆ Handler çš„ <code>handleMessage(msg)</code> æ–¹æ³•å°±ä¸ä¼šè¢«è°ƒç”¨äº†ï¼›å¦‚æœ Callback å¤„ç†äº†æ¶ˆæ¯ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ‹¦æˆªï¼Œé‚£ä¹ˆå°±æ„å‘³ç€<strong>ä¸€ä¸ªæ¶ˆæ¯å¯ä»¥åŒæ—¶è¢« Callback ä»¥åŠ Handler å¤„ç†</strong>ã€‚</p><p><strong>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Callback è¿™ä¸ªæ‹¦æˆªæœºåˆ¶æ¥æ‹¦æˆª Handler çš„æ¶ˆæ¯ï¼</strong></p><blockquote><p> åœºæ™¯ï¼šHook <code>ActivityThread.mH</code>ï¼Œ åœ¨ ActivityThread ä¸­æœ‰ä¸ªæˆå‘˜å˜é‡ <code>mH</code> ï¼Œå®ƒæ˜¯ä¸ª Handlerï¼Œåˆæ˜¯ä¸ªæå…¶é‡è¦çš„ç±»ï¼Œå‡ ä¹æ‰€æœ‰çš„æ’ä»¶åŒ–æ¡†æ¶éƒ½ä½¿ç”¨äº†è¿™ä¸ªæ–¹æ³•ã€‚</p></blockquote><h2 id="åˆ›å»º-Message-å®ä¾‹çš„æ–¹å¼"><a href="#åˆ›å»º-Message-å®ä¾‹çš„æ–¹å¼" class="headerlink" title="åˆ›å»º Message å®ä¾‹çš„æ–¹å¼"></a>åˆ›å»º Message å®ä¾‹çš„æ–¹å¼</h2><p>å…ˆæ¥çœ‹çœ‹æ¶ˆæ¯æ± ï¼š</p><p>åœ¨ä»£ç ä¸­ï¼Œå¯èƒ½ç»å¸¸çœ‹åˆ°recycle()æ–¹æ³•ï¼Œå’‹ä¸€çœ‹ï¼Œå¯èƒ½æ˜¯åœ¨åšè™šæ‹Ÿæœºçš„gc()ç›¸å…³çš„å·¥ä½œï¼Œå…¶å®ä¸ç„¶ï¼Œè¿™æ˜¯ç”¨äºæŠŠæ¶ˆæ¯åŠ å…¥åˆ°æ¶ˆæ¯æ± çš„ä½œç”¨ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œå½“æ¶ˆæ¯æ± ä¸ä¸ºç©ºæ—¶ï¼Œå¯ä»¥ç›´æ¥ä»æ¶ˆæ¯æ± ä¸­è·å–Messageå¯¹è±¡ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ›å»ºï¼Œæé«˜æ•ˆç‡ã€‚</p><p>é™æ€å˜é‡<code>sPool</code>çš„æ•°æ®ç±»å‹ä¸ºMessageï¼Œé€šè¿‡nextæˆå‘˜å˜é‡ï¼Œç»´æŠ¤ä¸€ä¸ªæ¶ˆæ¯æ± ï¼›é™æ€å˜é‡<code>MAX_POOL_SIZE</code>ä»£è¡¨æ¶ˆæ¯æ± çš„å¯ç”¨å¤§å°ï¼›æ¶ˆæ¯æ± çš„é»˜è®¤å¤§å°ä¸º50ã€‚</p><p>æ¶ˆæ¯æ± å¸¸ç”¨çš„æ“ä½œæ–¹æ³•æ˜¯obtain()å’Œrecycle()ã€‚</p><p><strong>obtain</strong></p><p>ä»æ¶ˆæ¯æ± ä¸­è·å–æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Message <span class="title">obtain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (sPoolSync) &#123;</span><br><span class="line">        <span class="keyword">if</span> (sPool != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Message m = sPool;</span><br><span class="line">            sPool = m.next;</span><br><span class="line">            m.next = <span class="keyword">null</span>; <span class="comment">//ä»sPoolä¸­å–å‡ºä¸€ä¸ªMessageå¯¹è±¡ï¼Œå¹¶æ¶ˆæ¯é“¾è¡¨æ–­å¼€</span></span><br><span class="line">            m.flags = <span class="number">0</span>; <span class="comment">// æ¸…é™¤in-use flag</span></span><br><span class="line">            sPoolSize--; <span class="comment">//æ¶ˆæ¯æ± çš„å¯ç”¨å¤§å°è¿›è¡Œå‡1æ“ä½œ</span></span><br><span class="line">            <span class="keyword">return</span> m;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Message(); <span class="comment">// å½“æ¶ˆæ¯æ± ä¸ºç©ºæ—¶ï¼Œç›´æ¥åˆ›å»ºMessageå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>obtain()ï¼Œä»æ¶ˆæ¯æ± å–Messageï¼Œéƒ½æ˜¯æŠŠæ¶ˆæ¯æ± è¡¨å¤´çš„Messageå–èµ°ï¼Œå†æŠŠè¡¨å¤´æŒ‡å‘next;</p><p><strong>recycle</strong></p><p>æŠŠä¸å†ä½¿ç”¨çš„æ¶ˆæ¯åŠ å…¥æ¶ˆæ¯æ± </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">recycle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isInUse()) &#123; <span class="comment">//åˆ¤æ–­æ¶ˆæ¯æ˜¯å¦æ­£åœ¨ä½¿ç”¨</span></span><br><span class="line">        <span class="keyword">if</span> (gCheckRecycle) &#123; <span class="comment">//Android 5.0ä»¥åçš„ç‰ˆæœ¬é»˜è®¤ä¸ºtrue,ä¹‹å‰çš„ç‰ˆæœ¬é»˜è®¤ä¸ºfalse.</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"This message cannot be recycled because it is still in use."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    recycleUnchecked();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯¹äºä¸å†ä½¿ç”¨çš„æ¶ˆæ¯ï¼ŒåŠ å…¥åˆ°æ¶ˆæ¯æ± </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">recycleUnchecked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//å°†æ¶ˆæ¯æ ‡ç¤ºä½ç½®ä¸ºIN_USEï¼Œå¹¶æ¸…ç©ºæ¶ˆæ¯æ‰€æœ‰çš„å‚æ•°ã€‚</span></span><br><span class="line">    flags = FLAG_IN_USE;</span><br><span class="line">    what = <span class="number">0</span>;</span><br><span class="line">    arg1 = <span class="number">0</span>;</span><br><span class="line">    arg2 = <span class="number">0</span>;</span><br><span class="line">    obj = <span class="keyword">null</span>;</span><br><span class="line">    replyTo = <span class="keyword">null</span>;</span><br><span class="line">    sendingUid = -<span class="number">1</span>;</span><br><span class="line">    when = <span class="number">0</span>;</span><br><span class="line">    target = <span class="keyword">null</span>;</span><br><span class="line">    callback = <span class="keyword">null</span>;</span><br><span class="line">    data = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">synchronized</span> (sPoolSync) &#123;</span><br><span class="line">        <span class="keyword">if</span> (sPoolSize &lt; MAX_POOL_SIZE) &#123; <span class="comment">//å½“æ¶ˆæ¯æ± æ²¡æœ‰æ»¡æ—¶ï¼Œå°†Messageå¯¹è±¡åŠ å…¥æ¶ˆæ¯æ± </span></span><br><span class="line">            next = sPool;</span><br><span class="line">            sPool = <span class="keyword">this</span>;</span><br><span class="line">            sPoolSize++; <span class="comment">//æ¶ˆæ¯æ± çš„å¯ç”¨å¤§å°è¿›è¡ŒåŠ 1æ“ä½œ</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>recycle()ï¼Œå°†MessageåŠ å…¥åˆ°æ¶ˆæ¯æ± çš„è¿‡ç¨‹ï¼Œéƒ½æ˜¯æŠŠMessageåŠ åˆ°é“¾è¡¨çš„è¡¨å¤´ï¼›</p><p><strong>æ‰€ä»¥ç”±äº Handler æä¸ºå¸¸ç”¨ï¼Œæ‰€ä»¥ä¸ºäº†èŠ‚çœå¼€é”€ï¼ŒAndroid ç»™ Message è®¾è®¡äº†å›æ”¶æœºåˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™å°½é‡å¤ç”¨ Message ï¼Œå‡å°‘å†…å­˜æ¶ˆè€—ã€‚</strong></p><ul><li><p>1ã€é€šè¿‡ Message çš„é™æ€æ–¹æ³• <code>Message.obtain();</code>  è·å–ï¼›</p></li><li><p>2ã€é€šè¿‡ Handler çš„å…¬æœ‰æ–¹æ³• <code>handler.obtainMessage();</code> ã€‚</p></li></ul><h2 id="Handler-å¼•èµ·çš„å†…å­˜æ³„éœ²åŸå› ä»¥åŠè§£å†³æ–¹æ¡ˆ"><a href="#Handler-å¼•èµ·çš„å†…å­˜æ³„éœ²åŸå› ä»¥åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="Handler å¼•èµ·çš„å†…å­˜æ³„éœ²åŸå› ä»¥åŠè§£å†³æ–¹æ¡ˆ"></a>Handler å¼•èµ·çš„å†…å­˜æ³„éœ²åŸå› ä»¥åŠè§£å†³æ–¹æ¡ˆ</h2><p>Handler å…è®¸æˆ‘ä»¬å‘é€<strong>å»¶æ—¶æ¶ˆæ¯</strong>ï¼Œå¦‚æœåœ¨å»¶æ—¶æœŸé—´ç”¨æˆ·å…³é—­äº† Activityï¼Œé‚£ä¹ˆè¯¥ Activity ä¼šæ³„éœ²ã€‚</p><p>è¿™ä¸ªæ³„éœ²æ˜¯å› ä¸º Message ä¼šæŒæœ‰ Handlerï¼Œè€Œåˆå› ä¸º <strong>Java çš„ç‰¹æ€§ï¼Œå†…éƒ¨ç±»ä¼šæŒæœ‰å¤–éƒ¨ç±»</strong>ï¼Œä½¿å¾— Activity ä¼šè¢« Handler æŒæœ‰ï¼Œè¿™æ ·æœ€ç»ˆå°±å¯¼è‡´ Activity æ³„éœ²ã€‚</p><p>è§£å†³è¯¥é—®é¢˜çš„æœ€æœ‰æ•ˆçš„æ–¹æ³•æ˜¯ï¼š<strong>å°† Handler å®šä¹‰æˆé™æ€çš„å†…éƒ¨ç±»ï¼Œåœ¨å†…éƒ¨æŒæœ‰ Activity çš„å¼±å¼•ç”¨ï¼Œå¹¶åŠæ—¶ç§»é™¤æ‰€æœ‰æ¶ˆæ¯</strong>ã€‚</p><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SafeHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> WeakReference&lt;DemoActivity&gt; ref;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SafeHandler</span><span class="params">(DemoActivity activity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ref = <span class="keyword">new</span> WeakReference(activity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(<span class="keyword">final</span> Message msg)</span> </span>&#123;</span><br><span class="line">        DemoActivity activity = ref.get();</span><br><span class="line">        <span class="keyword">if</span> (activity != <span class="keyword">null</span>) &#123;</span><br><span class="line">            activity.handleMessage(msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> SafeHandler mSafeHandler = <span class="keyword">new</span> SafeHandler(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// .... do somthing</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//ç§»é™¤æ¶ˆæ¯ï¼ŒåŠ ä¸€å±‚ä¿éšœï¼š</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  mSafeHandler.removeCallbacksAndMessages(<span class="keyword">null</span>);</span><br><span class="line">  <span class="keyword">super</span>.onDestroy();</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„ï¼šå•çº¯çš„åœ¨ <code>onDestroy</code> ç§»é™¤æ¶ˆæ¯å¹¶ä¸ä¿é™©ï¼Œå› ä¸º <code>onDestroy</code> å¹¶ä¸ä¸€å®šæ‰§è¡Œã€‚</strong></p></blockquote><h2 id="å­çº¿ç¨‹é‡Œå¼¹-Toast"><a href="#å­çº¿ç¨‹é‡Œå¼¹-Toast" class="headerlink" title="å­çº¿ç¨‹é‡Œå¼¹ Toast"></a>å­çº¿ç¨‹é‡Œå¼¹ Toast</h2><p>å½“æˆ‘ä»¬å°è¯•åœ¨å­çº¿ç¨‹é‡Œç›´æ¥å»å¼¹ Toast çš„æ—¶å€™ï¼Œä¼š crash ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.RuntimeException: Can&apos;t create handler inside thread that has not called Looper.prepare()</span><br></pre></td></tr></table></figure><p><strong>æœ¬è´¨ä¸Šæ˜¯å› ä¸º Toast çš„å®ç°ä¾èµ–äº Handler</strong>ï¼ŒåŒç†çš„è¿˜æœ‰ Dialogã€‚</p><p>æ­£ç¡®ä½¿ç”¨ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Looper.prepare();</span><br><span class="line">    Toast.makeText(HandlerActivity.<span class="keyword">this</span>, <span class="string">"å­çº¿ç¨‹ä¸‹æµ‹è¯•ä¸ä¼šå´©æºƒå•¦ï¼"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">    Looper.loop();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).start();</span><br></pre></td></tr></table></figure><h2 id="å·§å¦™åˆ©ç”¨-Looper-æœºåˆ¶"><a href="#å·§å¦™åˆ©ç”¨-Looper-æœºåˆ¶" class="headerlink" title="å·§å¦™åˆ©ç”¨ Looper æœºåˆ¶"></a>å·§å¦™åˆ©ç”¨ Looper æœºåˆ¶</h2><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Looper çš„æœºåˆ¶æ¥å¸®åŠ©æˆ‘ä»¬åšä¸€äº›äº‹æƒ…ï¼š</p><ol><li>å°† Runnable post åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œï¼›</li><li>åˆ©ç”¨ Looper åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æ˜¯ä¸»çº¿ç¨‹ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MainThread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MainThread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Handler HANDLER = <span class="keyword">new</span> Handler(Looper.getMainLooper());</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(@NonNull Runnable runnable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isMainThread()) &#123;</span><br><span class="line">            runnable.run();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            HANDLER.post(runnable);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isMainThread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Looper.myLooper() == Looper.getMainLooper();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://www.jianshu.com/p/f70ee1765a61" target="_blank" rel="noopener">https://www.jianshu.com/p/f70ee1765a61</a></p><p><a href="http://gityuan.com/2015/12/26/handler-message-framework/" target="_blank" rel="noopener">http://gityuan.com/2015/12/26/handler-message-framework/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;Handler&lt;/code&gt; æ˜¯ &lt;code&gt;Android&lt;/code&gt; å¼€å‘è¿‡ç¨‹ä¸­éå¸¸éå¸¸å¸¸è§çš„ä¸œè¥¿ã€‚å®ƒé€šå¸¸è¢«æˆ‘ä»¬ç”¨æ¥åšä¸»çº¿ç¨‹ä¸å­çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡å·¥å…·ï¼Œè€Œ Handler ä½œä¸º Android ä¸­æ¶ˆæ¯æœºåˆ¶çš„é‡è¦ä¸€å‘˜ä¹Ÿç¡®å®ç»™æˆ‘ä»¬çš„å¼€å‘å¸¦æ¥äº†æå¤§çš„ä¾¿åˆ©ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://hackycy.github.io/categories/Android/"/>
    
    
      <category term="Handler" scheme="http://hackycy.github.io/tags/Handler/"/>
    
  </entry>
  
  <entry>
    <title>è§£å†³Android Studioâ€”â€”Configuration on demand is not supported by the current version of the Android Gradle</title>
    <link href="http://hackycy.github.io/2020/01/17/%E8%A7%A3%E5%86%B3Android-Studio%E2%80%94%E2%80%94Configuration-on-demand-is-not-supported-by-the-current-version-of-the-Android-Gradle/"/>
    <id>http://hackycy.github.io/2020/01/17/è§£å†³Android-Studioâ€”â€”Configuration-on-demand-is-not-supported-by-the-current-version-of-the-Android-Gradle/</id>
    <published>2020-01-17T14:45:50.000Z</published>
    <updated>2020-06-04T06:12:49.376Z</updated>
    
    <content type="html"><![CDATA[<p>ã€é”™è¯¯ã€‘<br>Configuration on demand is not supported by the current version of the Android Gradle plugin since you are using Gradle version 4.6 or above. </p><p>Suggestion: disable configuration on demand by setting org.gradle.configureondemand=false in your gradle.properties file or use a Gradle version less than 4.6.</p><p>ã€ç¿»è¯‘ã€‘<br>ç”±äºä½¿ç”¨ä½ æ­£åœ¨ä½¿ç”¨ Gradle ç‰ˆæœ¬4.6æˆ–ä»¥ä¸Šï¼Œå½“å‰ç‰ˆæœ¬çš„Androidçš„ Gradle æ’ä»¶ä¸æ”¯æŒæŒ‰éœ€é…ç½®ã€‚</p><p>å»ºè®®ï¼šé€šè¿‡åœ¨ä½ çš„ gradle.properties æ–‡ä»¶ä¸­è®¾ç½® org.gradle.configureondemand=false ç¦ç”¨æŒ‰éœ€é…ç½®ï¼Œæˆ–è€…ä½¿ç”¨ä¸€ä¸ªä½äº4.6ç‰ˆæœ¬çš„ Gradleã€‚</p><a id="more"></a><p><strong>è§£å†³æ–¹æ¡ˆ1ï¼šé™çº§</strong></p><p>æ‰“å¼€ <strong>gradle-wrapper.properties</strong> æ–‡ä»¶ï¼Œä¿®æ”¹ <strong>distributionUrl</strong> å‚æ•°ï¼Œå°†å…¶åé¢ä¿®æ”¹ä¸ºä½äº4.6ç‰ˆæœ¬çš„ Gradleã€‚å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">distributionUrl=https\://services.gradle.org/distributions/gradle-4.1-all.zip</span><br></pre></td></tr></table></figure><p><img src="properties.png" alt></p><p><strong>è§£å†³æ–¹æ³•2ï¼šç¦ç”¨æŒ‰éœ€é…ç½®</strong></p><p>1ã€æ‰“å¼€ <strong>gradle.properties</strong> æ–‡ä»¶ï¼Œå…±æœ‰ä¸¤ä¸ªï¼š<strong>Global Properties</strong> å’Œ <strong>Project Properties</strong>ï¼Œå°†å…¶ä¸­çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.gradle.configureondemand=true</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.gradle.configureondemand=false</span><br></pre></td></tr></table></figure><blockquote><p>æˆ–åˆ é™¤è¯¥è¯­å¥ï¼Œæˆ–æ³¨é‡Šæ‰è¯¥è¯­å¥ã€‚</p></blockquote><p>2ã€æˆ–è€…é€šè¿‡ <strong>Preferences</strong> èœå•ï¼Œæ‰¾åˆ° <strong>Build, Execution, Deployment</strong> é‡Œé¢çš„ <strong>Compiler</strong>ï¼Œå°†å³é¢çš„ <strong>Configure on demand</strong> å–æ¶ˆå‹¾é€‰ã€‚</p><p><img src="panel.png" alt></p><p><strong>å‚è€ƒé“¾æ¥</strong></p><p><a href="https://stackoverflow.com/questions/49990933/configuration-on-demand-is-not-supported-by-the-current-version-of-the-android-g" target="_blank" rel="noopener">https://stackoverflow.com/questions/49990933/configuration-on-demand-is-not-supported-by-the-current-version-of-the-android-g</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ã€é”™è¯¯ã€‘&lt;br&gt;Configuration on demand is not supported by the current version of the Android Gradle plugin since you are using Gradle version 4.6 or above. &lt;/p&gt;
&lt;p&gt;Suggestion: disable configuration on demand by setting org.gradle.configureondemand=false in your gradle.properties file or use a Gradle version less than 4.6.&lt;/p&gt;
&lt;p&gt;ã€ç¿»è¯‘ã€‘&lt;br&gt;ç”±äºä½¿ç”¨ä½ æ­£åœ¨ä½¿ç”¨ Gradle ç‰ˆæœ¬4.6æˆ–ä»¥ä¸Šï¼Œå½“å‰ç‰ˆæœ¬çš„Androidçš„ Gradle æ’ä»¶ä¸æ”¯æŒæŒ‰éœ€é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;å»ºè®®ï¼šé€šè¿‡åœ¨ä½ çš„ gradle.properties æ–‡ä»¶ä¸­è®¾ç½® org.gradle.configureondemand=false ç¦ç”¨æŒ‰éœ€é…ç½®ï¼Œæˆ–è€…ä½¿ç”¨ä¸€ä¸ªä½äº4.6ç‰ˆæœ¬çš„ Gradleã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://hackycy.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="http://hackycy.github.io/tags/Android/"/>
    
      <category term="Android Studio" scheme="http://hackycy.github.io/tags/Android-Studio/"/>
    
  </entry>
  
  <entry>
    <title>Java 8 æ–°ç‰¹æ€§ä¸€è§ˆ</title>
    <link href="http://hackycy.github.io/2020/01/04/Java-8-%E6%96%B0%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88/"/>
    <id>http://hackycy.github.io/2020/01/04/Java-8-æ–°ç‰¹æ€§ä¸€è§ˆ/</id>
    <published>2020-01-04T10:13:58.000Z</published>
    <updated>2020-06-04T06:12:49.280Z</updated>
    
    <content type="html"><![CDATA[<p>Java 8 (åˆç§°ä¸º jdk 1.8) æ˜¯ Java è¯­è¨€å¼€å‘çš„ä¸€ä¸ªä¸»è¦ç‰ˆæœ¬ã€‚ Oracle å…¬å¸äº 2014 å¹´ 3 æœˆ 18 æ—¥å‘å¸ƒ Java 8 ï¼Œå®ƒæ”¯æŒå‡½æ•°å¼ç¼–ç¨‹ï¼Œæ–°çš„ JavaScript å¼•æ“ï¼Œæ–°çš„æ—¥æœŸ APIï¼Œæ–°çš„Stream API ç­‰ã€‚</p><a id="more"></a><h1 id="æ–°ç‰¹æ€§"><a href="#æ–°ç‰¹æ€§" class="headerlink" title="æ–°ç‰¹æ€§"></a>æ–°ç‰¹æ€§</h1><p>Java8 æ–°å¢äº†éå¸¸å¤šçš„ç‰¹æ€§ï¼Œæˆ‘ä»¬ä¸»è¦è®¨è®ºä»¥ä¸‹å‡ ä¸ªï¼š</p><ul><li><strong>Lambda è¡¨è¾¾å¼</strong> âˆ’ Lambda å…è®¸æŠŠå‡½æ•°ä½œä¸ºä¸€ä¸ªæ–¹æ³•çš„å‚æ•°ï¼ˆå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’åˆ°æ–¹æ³•ä¸­ï¼‰ã€‚</li><li><strong>æ–¹æ³•å¼•ç”¨</strong> âˆ’ æ–¹æ³•å¼•ç”¨æä¾›äº†éå¸¸æœ‰ç”¨çš„è¯­æ³•ï¼Œå¯ä»¥ç›´æ¥å¼•ç”¨å·²æœ‰Javaç±»æˆ–å¯¹è±¡ï¼ˆå®ä¾‹ï¼‰çš„æ–¹æ³•æˆ–æ„é€ å™¨ã€‚ä¸lambdaè”åˆä½¿ç”¨ï¼Œæ–¹æ³•å¼•ç”¨å¯ä»¥ä½¿è¯­è¨€çš„æ„é€ æ›´ç´§å‡‘ç®€æ´ï¼Œå‡å°‘å†—ä½™ä»£ç ã€‚</li><li><strong>é»˜è®¤æ–¹æ³•</strong> âˆ’ é»˜è®¤æ–¹æ³•å°±æ˜¯ä¸€ä¸ªåœ¨æ¥å£é‡Œé¢æœ‰äº†ä¸€ä¸ªå®ç°çš„æ–¹æ³•ã€‚</li><li><strong>Stream API</strong> âˆ’æ–°æ·»åŠ çš„Stream APIï¼ˆjava.util.streamï¼‰ æŠŠçœŸæ­£çš„å‡½æ•°å¼ç¼–ç¨‹é£æ ¼å¼•å…¥åˆ°Javaä¸­ã€‚</li><li><strong>Date Time API</strong> âˆ’ åŠ å¼ºå¯¹æ—¥æœŸä¸æ—¶é—´çš„å¤„ç†ã€‚</li><li><strong>Optional ç±»</strong> âˆ’ Optional ç±»å·²ç»æˆä¸º Java 8 ç±»åº“çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æ¥è§£å†³ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</li></ul><blockquote><p>æ›´å¤šç›¸å…³è¯·æµè§ˆ-&gt;<a href="https://www.oracle.com/technetwork/java/javase/8-whats-new-2157071.html" target="_blank" rel="noopener">https://www.oracle.com/technetwork/java/javase/8-whats-new-2157071.html</a></p></blockquote><h1 id="Lambda-è¡¨è¾¾å¼"><a href="#Lambda-è¡¨è¾¾å¼" class="headerlink" title="Lambda è¡¨è¾¾å¼"></a>Lambda è¡¨è¾¾å¼</h1><p>Lambda è¡¨è¾¾å¼ï¼Œä¹Ÿå¯ç§°ä¸ºé—­åŒ…ï¼Œå®ƒæ˜¯æ¨åŠ¨ Java 8 å‘å¸ƒçš„æœ€é‡è¦æ–°ç‰¹æ€§ã€‚</p><p>Lambda å…è®¸æŠŠå‡½æ•°ä½œä¸ºä¸€ä¸ªæ–¹æ³•çš„å‚æ•°ï¼ˆå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’è¿›æ–¹æ³•ä¸­ï¼‰ã€‚</p><p>ä½¿ç”¨ Lambda è¡¨è¾¾å¼å¯ä»¥ä½¿ä»£ç å˜çš„æ›´åŠ ç®€æ´ç´§å‡‘ã€‚</p><h2 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><p>lambda è¡¨è¾¾å¼çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(parameters) -&gt; expression </span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">(parameters) -&gt;&#123; statements; &#125;</span><br></pre></td></tr></table></figure><ul><li><strong>å¯é€‰ç±»å‹å£°æ˜ï¼š</strong>ä¸éœ€è¦å£°æ˜å‚æ•°ç±»å‹ï¼Œç¼–è¯‘å™¨å¯ä»¥ç»Ÿä¸€è¯†åˆ«å‚æ•°å€¼ã€‚</li><li><strong>å¯é€‰çš„å‚æ•°åœ†æ‹¬å·ï¼š</strong>ä¸€ä¸ªå‚æ•°æ— éœ€å®šä¹‰åœ†æ‹¬å·ï¼Œä½†å¤šä¸ªå‚æ•°éœ€è¦å®šä¹‰åœ†æ‹¬å·ã€‚</li><li><strong>å¯é€‰çš„å¤§æ‹¬å·ï¼š</strong>å¦‚æœä¸»ä½“åŒ…å«äº†ä¸€ä¸ªè¯­å¥ï¼Œå°±ä¸éœ€è¦ä½¿ç”¨å¤§æ‹¬å·ã€‚</li><li><strong>å¯é€‰çš„è¿”å›å…³é”®å­—ï¼š</strong>å¦‚æœä¸»ä½“åªæœ‰ä¸€ä¸ªè¡¨è¾¾å¼è¿”å›å€¼åˆ™ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿”å›å€¼ï¼Œå¤§æ‹¬å·éœ€è¦æŒ‡å®šæ˜è¡¨è¾¾å¼è¿”å›äº†ä¸€ä¸ªæ•°å€¼ã€‚</li></ul><p>æ¥çœ‹ä¸€ä¸‹æœ€ç®€å•çš„ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lambda</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"åŒ¿åå†…éƒ¨ç±»å®ç°"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">"Lambdaå®ç°"</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        Lambda lambda = <span class="keyword">new</span> Lambda();</span><br><span class="line">        lambda.printFunc(() -&gt; System.out.println(<span class="string">"hello, lambda"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printFunc</span><span class="params">(Functional func)</span> </span>&#123;</span><br><span class="line">        func.accept();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">Functional</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">accept</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åŒ¿åå†…éƒ¨ç±»å®ç°</span><br><span class="line">Lambdaå®ç°</span><br><span class="line">hello, lambda</span><br></pre></td></tr></table></figure><p><strong>æ›´å¤šå®ä¾‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. ä¸éœ€è¦å‚æ•°,è¿”å›å€¼ä¸º 5  </span></span><br><span class="line">() -&gt; <span class="number">5</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// 2. æ¥æ”¶ä¸€ä¸ªå‚æ•°(æ•°å­—ç±»å‹),è¿”å›å…¶2å€çš„å€¼  </span></span><br><span class="line">x -&gt; <span class="number">2</span> * x  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// 3. æ¥å—2ä¸ªå‚æ•°(æ•°å­—),å¹¶è¿”å›ä»–ä»¬çš„å·®å€¼  </span></span><br><span class="line">(x, y) -&gt; x â€“ y  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// 4. æ¥æ”¶2ä¸ªintå‹æ•´æ•°,è¿”å›ä»–ä»¬çš„å’Œ  </span></span><br><span class="line">(<span class="keyword">int</span> x, <span class="keyword">int</span> y) -&gt; x + y  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// 5. æ¥å—ä¸€ä¸ª string å¯¹è±¡,å¹¶åœ¨æ§åˆ¶å°æ‰“å°,ä¸è¿”å›ä»»ä½•å€¼(çœ‹èµ·æ¥åƒæ˜¯è¿”å›void)  </span></span><br><span class="line">(String s) -&gt; System.out.print(s)</span><br></pre></td></tr></table></figure><h2 id="å‰ææ¡ä»¶"><a href="#å‰ææ¡ä»¶" class="headerlink" title="å‰ææ¡ä»¶"></a>å‰ææ¡ä»¶</h2><p>Lambdaçš„è¯­æ³•éå¸¸ç®€æ´ï¼Œä½†å¹¶ä¸æ˜¯å¯ä»¥éšä¾¿ä½¿ç”¨çš„ï¼Œä½¿ç”¨æ—¶æœ‰å‡ ä¸ªæ¡ä»¶éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼š</p><ul><li><strong>æ–¹æ³•çš„å‚æ•°</strong>æˆ–è€…<strong>å±€éƒ¨å˜é‡ç±»å‹</strong>å¿…é¡»ä¸º<strong>æ¥å£</strong>æ‰èƒ½ä½¿ç”¨Lambda</li><li>æ¥å£ä¸­æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•</li></ul><h2 id="å‡½æ•°å¼æ¥å£"><a href="#å‡½æ•°å¼æ¥å£" class="headerlink" title="å‡½æ•°å¼æ¥å£"></a>å‡½æ•°å¼æ¥å£</h2><p>å‡½æ•°å¼æ¥å£åœ¨Javaä¸­æŒ‡çš„æ˜¯ï¼š<strong>æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£</strong>ã€‚</p><p>å‡½æ•°å¼æ¥å£ï¼Œå³é€‚ç”¨äºå‡½æ•°å¼å˜æˆåœºæ™¯çš„æ¥å£ï¼Œè€ŒJavaä¸­çš„å‡½æ•°å¼ç¼–ç¨‹ä½“ç°å°±æ˜¯Lambdaï¼Œæ‰€ä»¥å‡½æ•°å¼æ¥å£å°±æ˜¯å¯ä»¥é€‚ç”¨äºLambdaä½¿ç”¨çš„æ¥å£ã€‚åªæœ‰ç¡®ä¿æ¥å£ä¸­æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼ŒJavaä¸­çš„Lambdaæ‰èƒ½é¡ºåˆ©è¿›è¡Œæ¨å¯¼ã€‚</p><p><code>@FunctionalInterface</code>æ³¨è§£</p><p>ä¸<code>@Override</code>æ³¨è§£çš„ä½œç”¨ç±»ä¼¼ï¼ŒJava 8ä¸­ä¸“é—¨ä¸ºå‡½æ•°å¼æ¥å£å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ³¨è§£ï¼š<code>@FunctionalInterface</code>ã€‚è¯¥æ³¨è§£å¯ä»¥ç”¨äºä¸€ä¸ªæ¥å£çš„å®šä¹‰ä¸Šã€‚</p><blockquote><p>é»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•ä¸ä¼šç ´åå‡½æ•°å¼æ¥å£çš„å®šä¹‰ï¼Œå› æ­¤å¦‚ä¸‹çš„ä»£ç æ˜¯åˆæ³•çš„ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FunctionalDefaultMethods</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">method</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">defaultMethod</span><span class="params">()</span> </span>&#123;&#125;        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Lambdaä¸åŒ¿åå†…éƒ¨ç±»å¯¹æ¯”"><a href="#Lambdaä¸åŒ¿åå†…éƒ¨ç±»å¯¹æ¯”" class="headerlink" title="Lambdaä¸åŒ¿åå†…éƒ¨ç±»å¯¹æ¯”"></a>Lambdaä¸åŒ¿åå†…éƒ¨ç±»å¯¹æ¯”</h2><ul><li>æ‰€éœ€è¦çš„ç±»å‹ä¸ä¸€æ ·ï¼šåŒ¿åå†…éƒ¨ç±»éœ€è¦çš„ç±»å‹å¯ä»¥æ˜¯ç±»ã€æŠ½è±¡ç±»ã€æ¥å£ã€‚Lambdaè¡¨è¾¾å¼éœ€è¦çš„ç±»å‹å¿…é¡»æ˜¯æ¥å£ã€‚</li><li>æŠ½è±¡æ–¹æ³•çš„æ•°é‡ä¸ä¸€æ ·ï¼šåŒ¿åå†…éƒ¨ç±»æ‰€éœ€çš„æ¥å£ä¸­æŠ½è±¡æ–¹æ³•æ•°é‡éšæ„ï¼ŒLambdaè¡¨è¾¾å¼æ‰€éœ€çš„æ¥å£æœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ã€‚</li><li>å®ç°åŸç†ä¸åŒï¼šåŒ¿åå†…éƒ¨ç±»æ˜¯åœ¨ç¼–è¯‘åå½¢æˆclassï¼ŒLambdaè¡¨è¾¾å¼æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆclassã€‚</li></ul><h2 id="å¸¸ç”¨çš„å†…ç½®å‡½æ•°å¼æ¥å£"><a href="#å¸¸ç”¨çš„å†…ç½®å‡½æ•°å¼æ¥å£" class="headerlink" title="å¸¸ç”¨çš„å†…ç½®å‡½æ•°å¼æ¥å£"></a>å¸¸ç”¨çš„å†…ç½®å‡½æ•°å¼æ¥å£</h2><p>Lambdaè¡¨è¾¾å¼çš„å‰ææ˜¯éœ€è¦æœ‰å‡½æ•°å¼æ¥å£ã€‚è€ŒLambdaä½¿ç”¨æ—¶ä¸éœ€è¦å…³å¿ƒæ¥å£åã€æŠ½è±¡æ–¹æ³•åã€‚åªå…³å¿ƒæŠ½è±¡æ–¹æ³•çš„å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼ç±»å‹ã€‚å› æ­¤ä¸ºäº†è®©æˆ‘ä»¬ä½¿ç”¨Lambdaæ–¹ä¾¿ï¼ŒJDKæä¾›äº†å¤§é‡çš„å‡½æ•°å¼æ¥å£ã€‚éƒ½åœ¨<code>java.util.function</code>åŒ…ä¸‹å¯ä»¥æŸ¥çœ‹ã€‚</p><p>å¸¸ç”¨çš„å‡ ä¸ªæ¥å£ï¼š</p><h3 id="Supplier"><a href="#Supplier" class="headerlink" title="Supplier"></a>Supplier</h3><p>è¯¥æ¥å£æ„å‘³ç€â€œä¾›ç»™â€ï¼Œå¯¹åº”çš„Lambdaè¡¨è¾¾å¼éœ€è¦å¯¹å¤–æä¾›ä¸€ä¸ªç¬¦åˆæ³›å‹ç±»å‹çš„å¯¹è±¡æ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Supplier</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">T <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Consumer"><a href="#Consumer" class="headerlink" title="Consumer"></a>Consumer</h3><p>è¯¥æ¥å£ä¸Supplieræ­£å¥½ç›¸åï¼Œå®ƒä¸æ˜¯ç”Ÿäº§ä¸€ä¸ªæ•°æ®ï¼Œè€Œæ˜¯æ¶ˆè´¹ä¸€ä¸ªæ•°æ®ï¼Œå…¶æ•°æ®ç±»å‹ç”±æ³›å‹å‚æ•°å†³å®šã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Consumer</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">accept</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h3><p>è¯¥æ¥å£ç”¨æ¥æä¾›ä¸€ä¸ªç±»å‹çš„æ•°æ®å¾—åˆ°å¦ä¸€ä¸ªç±»å‹çš„æ•°æ®ï¼Œå‰è€…ç§°ä¸ºå‰ç½®æ¡ä»¶ï¼Œåè€…ç§°ä¸ºåç½®æ¡ä»¶ï¼Œæœ‰å‚æ•°æœ‰è¿”å›å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Function</span>&lt;<span class="title">T</span>, <span class="title">R</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">R <span class="title">apply</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Predicate"><a href="#Predicate" class="headerlink" title="Predicate"></a>Predicate</h3><p>æœ‰æ—¶å€™éœ€è¦å¯¹æŸç§ç±»å‹æ•°æ®è¿›è¡Œåˆ¤æ–­ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªå¸ƒå°”å€¼çš„æ¥å£ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨è¯¥æ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Predicate</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">test</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ¥å£é»˜è®¤æ–¹æ³•"><a href="#æ¥å£é»˜è®¤æ–¹æ³•" class="headerlink" title="æ¥å£é»˜è®¤æ–¹æ³•"></a>æ¥å£é»˜è®¤æ–¹æ³•</h1><p>Java 8 æ–°å¢äº†æ¥å£çš„é»˜è®¤æ–¹æ³•ã€‚</p><p>ç®€å•è¯´ï¼Œé»˜è®¤æ–¹æ³•å°±æ˜¯æ¥å£å¯ä»¥æœ‰å®ç°æ–¹æ³•ï¼Œè€Œä¸”ä¸éœ€è¦å®ç°ç±»å»å®ç°å…¶æ–¹æ³•ã€‚</p><p>æˆ‘ä»¬åªéœ€åœ¨æ–¹æ³•åå‰é¢åŠ ä¸ª default å…³é”®å­—å³å¯å®ç°é»˜è®¤æ–¹æ³•ã€‚</p><blockquote><p><strong>ä¸ºä»€ä¹ˆè¦æœ‰è¿™ä¸ªç‰¹æ€§ï¼Ÿ</strong></p><p>é¦–å…ˆï¼Œä¹‹å‰çš„æ¥å£æ˜¯ä¸ªåŒåˆƒå‰‘ï¼Œå¥½å¤„æ˜¯é¢å‘æŠ½è±¡è€Œä¸æ˜¯é¢å‘å…·ä½“ç¼–ç¨‹ï¼Œç¼ºé™·æ˜¯ï¼Œå½“éœ€è¦ä¿®æ”¹æ¥å£æ—¶å€™ï¼Œéœ€è¦ä¿®æ”¹å…¨éƒ¨å®ç°è¯¥æ¥å£çš„ç±»ï¼Œç›®å‰çš„ java 8 ä¹‹å‰çš„é›†åˆæ¡†æ¶æ²¡æœ‰ foreach æ–¹æ³•ï¼Œé€šå¸¸èƒ½æƒ³åˆ°çš„è§£å†³åŠæ³•æ˜¯åœ¨JDKé‡Œç»™ç›¸å…³çš„æ¥å£æ·»åŠ æ–°çš„æ–¹æ³•åŠå®ç°ã€‚ç„¶è€Œï¼Œå¯¹äºå·²ç»å‘å¸ƒçš„ç‰ˆæœ¬ï¼Œæ˜¯æ²¡æ³•åœ¨ç»™æ¥å£æ·»åŠ æ–°æ–¹æ³•çš„åŒæ—¶ä¸å½±å“å·²æœ‰çš„å®ç°ã€‚æ‰€ä»¥å¼•è¿›çš„é»˜è®¤æ–¹æ³•ã€‚ä»–ä»¬çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³æ¥å£çš„ä¿®æ”¹ä¸ç°æœ‰çš„å®ç°ä¸å…¼å®¹çš„é—®é¢˜ã€‚</p></blockquote><h2 id="è¯­æ³•-1"><a href="#è¯­æ³•-1" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><h3 id="é»˜è®¤æ–¹æ³•è¯­æ³•ï¼š"><a href="#é»˜è®¤æ–¹æ³•è¯­æ³•ï¼š" class="headerlink" title="é»˜è®¤æ–¹æ³•è¯­æ³•ï¼š"></a>é»˜è®¤æ–¹æ³•è¯­æ³•ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"æˆ‘æ˜¯ä¸€è¾†è½¦!"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤šä¸ªé»˜è®¤æ–¹æ³•"><a href="#å¤šä¸ªé»˜è®¤æ–¹æ³•" class="headerlink" title="å¤šä¸ªé»˜è®¤æ–¹æ³•"></a>å¤šä¸ªé»˜è®¤æ–¹æ³•</h3><p>ä¸€ä¸ªæ¥å£æœ‰é»˜è®¤æ–¹æ³•ï¼Œè€ƒè™‘è¿™æ ·çš„æƒ…å†µï¼Œä¸€ä¸ªç±»å®ç°äº†å¤šä¸ªæ¥å£ï¼Œä¸”è¿™äº›æ¥å£æœ‰ç›¸åŒçš„é»˜è®¤æ–¹æ³•ï¼Œä»¥ä¸‹å®ä¾‹è¯´æ˜äº†è¿™ç§æƒ…å†µçš„è§£å†³æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"æˆ‘æ˜¯ä¸€è¾†è½¦!"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FourWheeler</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"æˆ‘æ˜¯ä¸€è¾†å››è½®è½¦!"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é™æ€é»˜è®¤æ–¹æ³•"><a href="#é™æ€é»˜è®¤æ–¹æ³•" class="headerlink" title="é™æ€é»˜è®¤æ–¹æ³•"></a>é™æ€é»˜è®¤æ–¹æ³•</h2><p>Java 8 çš„å¦ä¸€ä¸ªç‰¹æ€§æ˜¯æ¥å£å¯ä»¥å£°æ˜ï¼ˆå¹¶ä¸”å¯ä»¥æä¾›å®ç°ï¼‰é™æ€æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"æˆ‘æ˜¯ä¸€è¾†è½¦!"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">// é™æ€æ–¹æ³•</span></span><br><span class="line">   <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">blowHorn</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"æŒ‰å–‡å­!!!"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å°½ç®¡é»˜è®¤æ–¹æ³•æœ‰è¿™ä¹ˆå¤šå¥½å¤„ï¼Œä½†åœ¨å®é™…å¼€å‘ä¸­åº”è¯¥è°¨æ…ä½¿ç”¨ï¼šåœ¨å¤æ‚çš„ç»§æ‰¿ä½“ç³»ä¸­ï¼Œé»˜è®¤æ–¹æ³•å¯èƒ½å¼•èµ·æ­§ä¹‰å’Œç¼–è¯‘é”™è¯¯ã€‚</p></blockquote><h1 id="æ–¹æ³•å¼•ç”¨"><a href="#æ–¹æ³•å¼•ç”¨" class="headerlink" title="æ–¹æ³•å¼•ç”¨"></a>æ–¹æ³•å¼•ç”¨</h1><p>æ–¹æ³•å¼•ç”¨ä½¿å¾—å¼€å‘è€…å¯ä»¥ç›´æ¥å¼•ç”¨ç°å­˜çš„æ–¹æ³•ã€Javaç±»çš„æ„é€ æ–¹æ³•æˆ–è€…å®ä¾‹å¯¹è±¡ã€‚æ–¹æ³•å¼•ç”¨å’ŒLambdaè¡¨è¾¾å¼é…åˆä½¿ç”¨ï¼Œä½¿å¾—javaç±»çš„æ„é€ æ–¹æ³•çœ‹èµ·æ¥ç´§å‡‘è€Œç®€æ´ï¼Œæ²¡æœ‰å¾ˆå¤šå¤æ‚çš„æ¨¡æ¿ä»£ç ã€‚</p><p>æ–¹æ³•å¼•ç”¨ä½¿ç”¨ä¸€å¯¹å†’å· <strong>::</strong> </p><ul><li><strong>æ„é€ å™¨å¼•ç”¨ï¼š</strong>å®ƒçš„è¯­æ³•æ˜¯<code>Class::new</code>ï¼Œæˆ–è€…æ›´ä¸€èˆ¬çš„<code>Class&lt; T &gt;::new</code>å®ä¾‹å¦‚ä¸‹ï¼š</li><li><strong>é™æ€æ–¹æ³•å¼•ç”¨ï¼š</strong>å®ƒçš„è¯­æ³•æ˜¯<code>Class::static_method</code>ï¼Œå®ä¾‹å¦‚ä¸‹ï¼š</li><li><strong>ç‰¹å®šç±»çš„ä»»æ„å¯¹è±¡çš„æ–¹æ³•å¼•ç”¨ï¼š</strong>å®ƒçš„è¯­æ³•æ˜¯<code>Class::method</code>å®ä¾‹å¦‚ä¸‹ï¼š</li><li><strong>ç‰¹å®šå¯¹è±¡çš„æ–¹æ³•å¼•ç”¨ï¼š</strong>å®ƒçš„è¯­æ³•æ˜¯<code>instance::method</code>å®ä¾‹å¦‚ä¸‹ï¼š</li></ul><p>æˆ‘ä»¬æ¥ç”¨ä¸€ä¸ªæ¡ˆä¾‹æ¥ç†è§£ä¸€ä¸‹ä¸ºä»€ä¹ˆéœ€è¦æ–¹æ³•å¼•ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodRef</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getMax</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> n : arr) &#123;</span><br><span class="line">            sum += n;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(sum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// ç›´æ¥é‡å¤æ‹·è´ä»£ç </span></span><br><span class="line">        printMax((arr) -&gt; &#123;</span><br><span class="line">            <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> n : arr) &#123;</span><br><span class="line">                sum += n;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(sum);</span><br><span class="line">        &#125;);</span><br><span class="line"><span class="comment">// åœ¨Lambdaä¸­è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line">        printMax((arr) -&gt; &#123;</span><br><span class="line">            getMax(arr);</span><br><span class="line">        &#125;);</span><br><span class="line"><span class="comment">// ç›´æ¥ä½¿ç”¨æ–¹æ³•å¼•ç”¨</span></span><br><span class="line">        printMax(MethodRef::getMax);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printMax</span><span class="params">(Consumer&lt;<span class="keyword">int</span>[]&gt; consumer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>&#125;;</span><br><span class="line">        consumer.accept(arr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨mainå‡½æ•°ä¸­çš„ä½¿ç”¨çš„ä¸‰ä¸ªå¯¹æ¯”ï¼Œè¿™å°±æ˜¯å‡å°‘äº†ä»£ç çš„å†—ä½™ã€‚</p><h1 id="Streamæµ"><a href="#Streamæµ" class="headerlink" title="Streamæµ"></a>Streamæµ</h1><p>Java 8 APIæ·»åŠ äº†ä¸€ä¸ªæ–°çš„æŠ½è±¡ç§°ä¸ºæµStreamï¼Œå¯ä»¥è®©ä½ ä»¥ä¸€ç§å£°æ˜çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚</p><p>Stream ä½¿ç”¨ä¸€ç§ç±»ä¼¼ç”¨ SQL è¯­å¥ä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®çš„ç›´è§‚æ–¹å¼æ¥æä¾›ä¸€ç§å¯¹ Java é›†åˆè¿ç®—å’Œè¡¨è¾¾çš„é«˜é˜¶æŠ½è±¡ã€‚</p><p>Stream APIå¯ä»¥æå¤§æé«˜Javaç¨‹åºå‘˜çš„ç”Ÿäº§åŠ›ï¼Œè®©ç¨‹åºå‘˜å†™å‡ºé«˜æ•ˆç‡ã€å¹²å‡€ã€ç®€æ´çš„ä»£ç ã€‚</p><p>è¿™ç§é£æ ¼å°†è¦å¤„ç†çš„å…ƒç´ é›†åˆçœ‹ä½œä¸€ç§æµï¼Œ æµåœ¨ç®¡é“ä¸­ä¼ è¾“ï¼Œ å¹¶ä¸”å¯ä»¥åœ¨ç®¡é“çš„èŠ‚ç‚¹ä¸Šè¿›è¡Œå¤„ç†ï¼Œ æ¯”å¦‚ç­›é€‰ï¼Œ æ’åºï¼Œèšåˆç­‰ã€‚</p><p>å…ƒç´ æµåœ¨ç®¡é“ä¸­ç»è¿‡ä¸­é—´æ“ä½œï¼ˆintermediate operationï¼‰çš„å¤„ç†ï¼Œæœ€åç”±æœ€ç»ˆæ“ä½œ(terminal operation)å¾—åˆ°å‰é¢å¤„ç†çš„ç»“æœã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+--------------------+       +------+   +------+   +---+   +-------+</span><br><span class="line">| stream of elements +-----&gt; |filter+-&gt; |sorted+-&gt; |map+-&gt; |collect|</span><br><span class="line">+--------------------+       +------+   +------+   +---+   +-------+</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šçš„æµç¨‹è½¬æ¢ä¸º Java ä»£ç ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; transactionsIds = </span><br><span class="line">widgets.stream()</span><br><span class="line">             .filter(b -&gt; b.getColor() == RED)</span><br><span class="line">             .sorted((x,y) -&gt; x.getWeight() - y.getWeight())</span><br><span class="line">             .mapToInt(Widget::getWeight)</span><br><span class="line">             .sum();</span><br></pre></td></tr></table></figure><h2 id="ä»€ä¹ˆæ˜¯-Stream"><a href="#ä»€ä¹ˆæ˜¯-Stream" class="headerlink" title="ä»€ä¹ˆæ˜¯ Stream"></a>ä»€ä¹ˆæ˜¯ Stream</h2><p>Streamï¼ˆæµï¼‰æ˜¯ä¸€ä¸ªæ¥è‡ªæ•°æ®æºçš„å…ƒç´ é˜Ÿåˆ—å¹¶æ”¯æŒèšåˆæ“ä½œ</p><ul><li>å…ƒç´ æ˜¯ç‰¹å®šç±»å‹çš„å¯¹è±¡ï¼Œå½¢æˆä¸€ä¸ªé˜Ÿåˆ—ã€‚ Javaä¸­çš„Streamå¹¶ä¸ä¼šå­˜å‚¨å…ƒç´ ï¼Œè€Œæ˜¯æŒ‰éœ€è®¡ç®—ã€‚</li><li><strong>æ•°æ®æº</strong> æµçš„æ¥æºã€‚ å¯ä»¥æ˜¯é›†åˆï¼Œæ•°ç»„ï¼ŒI/O channelï¼Œ äº§ç”Ÿå™¨generator ç­‰ã€‚</li><li><strong>èšåˆæ“ä½œ</strong> ç±»ä¼¼SQLè¯­å¥ä¸€æ ·çš„æ“ä½œï¼Œ æ¯”å¦‚filter, map, reduce, find, match, sortedç­‰ã€‚</li></ul><p>å’Œä»¥å‰çš„Collectionæ“ä½œä¸åŒï¼Œ Streamæ“ä½œè¿˜æœ‰ä¸¤ä¸ªåŸºç¡€çš„ç‰¹å¾ï¼š</p><ul><li><strong>Pipelining</strong>: ä¸­é—´æ“ä½œéƒ½ä¼šè¿”å›æµå¯¹è±¡æœ¬èº«ã€‚ è¿™æ ·å¤šä¸ªæ“ä½œå¯ä»¥ä¸²è”æˆä¸€ä¸ªç®¡é“ï¼Œ å¦‚åŒæµå¼é£æ ¼ï¼ˆfluent styleï¼‰ã€‚ è¿™æ ·åšå¯ä»¥å¯¹æ“ä½œè¿›è¡Œä¼˜åŒ–ï¼Œ æ¯”å¦‚å»¶è¿Ÿæ‰§è¡Œ(laziness)å’ŒçŸ­è·¯( short-circuiting)ã€‚</li><li><strong>å†…éƒ¨è¿­ä»£</strong>ï¼š ä»¥å‰å¯¹é›†åˆéå†éƒ½æ˜¯é€šè¿‡Iteratoræˆ–è€…For-Eachçš„æ–¹å¼, æ˜¾å¼çš„åœ¨é›†åˆå¤–éƒ¨è¿›è¡Œè¿­ä»£ï¼Œ è¿™å«åšå¤–éƒ¨è¿­ä»£ã€‚ Streamæä¾›äº†å†…éƒ¨è¿­ä»£çš„æ–¹å¼ï¼Œ é€šè¿‡è®¿é—®è€…æ¨¡å¼(Visitor)å®ç°ã€‚</li></ul><h2 id="ç”Ÿæˆæµ"><a href="#ç”Ÿæˆæµ" class="headerlink" title="ç”Ÿæˆæµ"></a>ç”Ÿæˆæµ</h2><p>åœ¨ Java 8 ä¸­, é›†åˆæ¥å£æœ‰ä¸¤ä¸ªæ–¹æ³•æ¥ç”Ÿæˆæµï¼š</p><ul><li><strong>stream()</strong> âˆ’ ä¸ºé›†åˆåˆ›å»ºä¸²è¡Œæµã€‚</li><li><strong>parallelStream()</strong> âˆ’ ä¸ºé›†åˆåˆ›å»ºå¹¶è¡Œæµã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; strings = Arrays.asList(<span class="string">"abc"</span>, <span class="string">""</span>, <span class="string">"bc"</span>, <span class="string">"efg"</span>, <span class="string">"abcd"</span>,<span class="string">""</span>, <span class="string">"jkl"</span>);</span><br><span class="line">List&lt;String&gt; filtered = strings.stream().filter(string -&gt; !string.isEmpty()).collect(Collectors.toList());</span><br></pre></td></tr></table></figure><h2 id="forEach"><a href="#forEach" class="headerlink" title="forEach"></a>forEach</h2><p>Stream æä¾›äº†æ–°çš„æ–¹æ³• â€˜forEachâ€™ æ¥è¿­ä»£æµä¸­çš„æ¯ä¸ªæ•°æ®ã€‚ä»¥ä¸‹ä»£ç ç‰‡æ®µä½¿ç”¨ forEach è¾“å‡ºäº†10ä¸ªéšæœºæ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Random random = <span class="keyword">new</span> Random();</span><br><span class="line">random.ints().limit(<span class="number">10</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure><h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><p>map æ–¹æ³•ç”¨äºæ˜ å°„æ¯ä¸ªå…ƒç´ åˆ°å¯¹åº”çš„ç»“æœï¼Œä»¥ä¸‹ä»£ç ç‰‡æ®µä½¿ç”¨ map è¾“å‡ºäº†å…ƒç´ å¯¹åº”çš„å¹³æ–¹æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line"><span class="comment">// è·å–å¯¹åº”çš„å¹³æ–¹æ•°</span></span><br><span class="line">List&lt;Integer&gt; squaresList = numbers.stream().map( i -&gt; i*i).distinct().collect(Collectors.toList());</span><br></pre></td></tr></table></figure><h2 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h2><p>filter æ–¹æ³•ç”¨äºé€šè¿‡è®¾ç½®çš„æ¡ä»¶è¿‡æ»¤å‡ºå…ƒç´ ã€‚ä»¥ä¸‹ä»£ç ç‰‡æ®µä½¿ç”¨ filter æ–¹æ³•è¿‡æ»¤å‡ºç©ºå­—ç¬¦ä¸²ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt;strings = Arrays.asList(<span class="string">"abc"</span>, <span class="string">""</span>, <span class="string">"bc"</span>, <span class="string">"efg"</span>, <span class="string">"abcd"</span>,<span class="string">""</span>, <span class="string">"jkl"</span>);</span><br><span class="line"><span class="comment">// è·å–ç©ºå­—ç¬¦ä¸²çš„æ•°é‡</span></span><br><span class="line"><span class="keyword">long</span> count = strings.stream().filter(string -&gt; string.isEmpty()).count();</span><br></pre></td></tr></table></figure><h2 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h2><p>limit æ–¹æ³•ç”¨äºè·å–æŒ‡å®šæ•°é‡çš„æµã€‚ ä»¥ä¸‹ä»£ç ç‰‡æ®µä½¿ç”¨ limit æ–¹æ³•æ‰“å°å‡º 10 æ¡æ•°æ®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Random random = <span class="keyword">new</span> Random();</span><br><span class="line">random.ints().limit(<span class="number">10</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure><h2 id="sorted"><a href="#sorted" class="headerlink" title="sorted"></a>sorted</h2><p>sorted æ–¹æ³•ç”¨äºå¯¹æµè¿›è¡Œæ’åºã€‚ä»¥ä¸‹ä»£ç ç‰‡æ®µä½¿ç”¨ sorted æ–¹æ³•å¯¹è¾“å‡ºçš„ 10 ä¸ªéšæœºæ•°è¿›è¡Œæ’åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Random random = <span class="keyword">new</span> Random();</span><br><span class="line">random.ints().limit(<span class="number">10</span>).sorted().forEach(System.out::println);</span><br></pre></td></tr></table></figure><h2 id="å¹¶è¡Œï¼ˆparallelï¼‰ç¨‹åº"><a href="#å¹¶è¡Œï¼ˆparallelï¼‰ç¨‹åº" class="headerlink" title="å¹¶è¡Œï¼ˆparallelï¼‰ç¨‹åº"></a>å¹¶è¡Œï¼ˆparallelï¼‰ç¨‹åº</h2><p>parallelStream æ˜¯æµå¹¶è¡Œå¤„ç†ç¨‹åºçš„ä»£æ›¿æ–¹æ³•ã€‚ä»¥ä¸‹å®ä¾‹æˆ‘ä»¬ä½¿ç”¨ parallelStream æ¥è¾“å‡ºç©ºå­—ç¬¦ä¸²çš„æ•°é‡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; strings = Arrays.asList(<span class="string">"abc"</span>, <span class="string">""</span>, <span class="string">"bc"</span>, <span class="string">"efg"</span>, <span class="string">"abcd"</span>,<span class="string">""</span>, <span class="string">"jkl"</span>);</span><br><span class="line"><span class="comment">// è·å–ç©ºå­—ç¬¦ä¸²çš„æ•°é‡</span></span><br><span class="line"><span class="keyword">int</span> count = strings.parallelStream().filter(string -&gt; string.isEmpty()).count();</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„åœ¨é¡ºåºè¿è¡Œå’Œå¹¶è¡Œç›´æ¥åˆ‡æ¢ã€‚</p><h2 id="Collectors"><a href="#Collectors" class="headerlink" title="Collectors"></a>Collectors</h2><p>Collectors ç±»å®ç°äº†å¾ˆå¤šå½’çº¦æ“ä½œï¼Œä¾‹å¦‚å°†æµè½¬æ¢æˆé›†åˆå’Œèšåˆå…ƒç´ ã€‚Collectors å¯ç”¨äºè¿”å›åˆ—è¡¨æˆ–å­—ç¬¦ä¸²ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt;strings = Arrays.asList(<span class="string">"abc"</span>, <span class="string">""</span>, <span class="string">"bc"</span>, <span class="string">"efg"</span>, <span class="string">"abcd"</span>,<span class="string">""</span>, <span class="string">"jkl"</span>);</span><br><span class="line">List&lt;String&gt; filtered = strings.stream().filter(string -&gt; !string.isEmpty()).collect(Collectors.toList());</span><br><span class="line"> </span><br><span class="line">System.out.println(<span class="string">"ç­›é€‰åˆ—è¡¨: "</span> + filtered);</span><br><span class="line">String mergedString = strings.stream().filter(string -&gt; !string.isEmpty()).collect(Collectors.joining(<span class="string">", "</span>));</span><br><span class="line">System.out.println(<span class="string">"åˆå¹¶å­—ç¬¦ä¸²: "</span> + mergedString);</span><br></pre></td></tr></table></figure><h2 id="ç»Ÿè®¡"><a href="#ç»Ÿè®¡" class="headerlink" title="ç»Ÿè®¡"></a>ç»Ÿè®¡</h2><p>å¦å¤–ï¼Œä¸€äº›äº§ç”Ÿç»Ÿè®¡ç»“æœçš„æ”¶é›†å™¨ä¹Ÿéå¸¸æœ‰ç”¨ã€‚å®ƒä»¬ä¸»è¦ç”¨äºintã€doubleã€longç­‰åŸºæœ¬ç±»å‹ä¸Šï¼Œå®ƒä»¬å¯ä»¥ç”¨æ¥äº§ç”Ÿç±»ä¼¼å¦‚ä¸‹çš„ç»Ÿè®¡ç»“æœã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line"> </span><br><span class="line">IntSummaryStatistics stats = numbers.stream().mapToInt((x) -&gt; x).summaryStatistics();</span><br><span class="line"> </span><br><span class="line">System.out.println(<span class="string">"åˆ—è¡¨ä¸­æœ€å¤§çš„æ•° : "</span> + stats.getMax());</span><br><span class="line">System.out.println(<span class="string">"åˆ—è¡¨ä¸­æœ€å°çš„æ•° : "</span> + stats.getMin());</span><br><span class="line">System.out.println(<span class="string">"æ‰€æœ‰æ•°ä¹‹å’Œ : "</span> + stats.getSum());</span><br><span class="line">System.out.println(<span class="string">"å¹³å‡æ•° : "</span> + stats.getAverage());</span><br></pre></td></tr></table></figure><blockquote><p>æ›´å¤šApiè¯·ç¿»é˜…æ–‡æ¡£ï¼š<a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/package-summary.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/util/stream/package-summary.html</a></p></blockquote><h1 id="Date-Time-API"><a href="#Date-Time-API" class="headerlink" title="Date/Time API"></a>Date/Time API</h1><p>Java 8é€šè¿‡å‘å¸ƒæ–°çš„Date-Time API (JSR 310)æ¥è¿›ä¸€æ­¥åŠ å¼ºå¯¹æ—¥æœŸä¸æ—¶é—´çš„å¤„ç†ã€‚</p><p>åœ¨æ—§ç‰ˆçš„ Java ä¸­ï¼Œæ—¥æœŸæ—¶é—´ API å­˜åœ¨è¯¸å¤šé—®é¢˜ï¼Œå…¶ä¸­æœ‰ï¼š</p><ul><li><strong>éçº¿ç¨‹å®‰å…¨</strong> âˆ’ java.util.Date æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€æœ‰çš„æ—¥æœŸç±»éƒ½æ˜¯å¯å˜çš„ï¼Œè¿™æ˜¯Javaæ—¥æœŸç±»æœ€å¤§çš„é—®é¢˜ä¹‹ä¸€ã€‚</li><li><strong>è®¾è®¡å¾ˆå·®</strong> âˆ’ Javaçš„æ—¥æœŸ/æ—¶é—´ç±»çš„å®šä¹‰å¹¶ä¸ä¸€è‡´ï¼Œåœ¨java.utilå’Œjava.sqlçš„åŒ…ä¸­éƒ½æœ‰æ—¥æœŸç±»ï¼Œæ­¤å¤–ç”¨äºæ ¼å¼åŒ–å’Œè§£æçš„ç±»åœ¨java.textåŒ…ä¸­å®šä¹‰ã€‚java.util.DateåŒæ—¶åŒ…å«æ—¥æœŸå’Œæ—¶é—´ï¼Œè€Œjava.sql.Dateä»…åŒ…å«æ—¥æœŸï¼Œå°†å…¶çº³å…¥java.sqlåŒ…å¹¶ä¸åˆç†ã€‚å¦å¤–è¿™ä¸¤ä¸ªç±»éƒ½æœ‰ç›¸åŒçš„åå­—ï¼Œè¿™æœ¬èº«å°±æ˜¯ä¸€ä¸ªéå¸¸ç³Ÿç³•çš„è®¾è®¡ã€‚</li><li><strong>æ—¶åŒºå¤„ç†éº»çƒ¦</strong> âˆ’ æ—¥æœŸç±»å¹¶ä¸æä¾›å›½é™…åŒ–ï¼Œæ²¡æœ‰æ—¶åŒºæ”¯æŒï¼Œå› æ­¤Javaå¼•å…¥äº†java.util.Calendarå’Œjava.util.TimeZoneç±»ï¼Œä½†ä»–ä»¬åŒæ ·å­˜åœ¨ä¸Šè¿°æ‰€æœ‰çš„é—®é¢˜ã€‚</li></ul><p>Java 8 åœ¨ <strong>java.time</strong> åŒ…ä¸‹æä¾›äº†å¾ˆå¤šæ–°çš„ APIã€‚ä»¥ä¸‹ä¸ºä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„ APIï¼š</p><ul><li><strong>Local(æœ¬åœ°)</strong> âˆ’ ç®€åŒ–äº†æ—¥æœŸæ—¶é—´çš„å¤„ç†ï¼Œæ²¡æœ‰æ—¶åŒºçš„é—®é¢˜ã€‚</li><li><strong>Zoned(æ—¶åŒº)</strong> âˆ’ é€šè¿‡åˆ¶å®šçš„æ—¶åŒºå¤„ç†æ—¥æœŸæ—¶é—´ã€‚</li></ul><p>æ–°çš„java.timeåŒ…æ¶µç›–äº†æ‰€æœ‰å¤„ç†æ—¥æœŸï¼Œæ—¶é—´ï¼Œæ—¥æœŸ/æ—¶é—´ï¼Œæ—¶åŒºï¼Œæ—¶åˆ»ï¼ˆinstantsï¼‰ï¼Œè¿‡ç¨‹ï¼ˆduringï¼‰ä¸æ—¶é’Ÿï¼ˆclockï¼‰çš„æ“ä½œã€‚</p><blockquote><p><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/datetime/index.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/guides/datetime/index.html</a></p></blockquote><h2 id="æœ¬åœ°åŒ–æ—¥æœŸæ—¶é—´-API"><a href="#æœ¬åœ°åŒ–æ—¥æœŸæ—¶é—´-API" class="headerlink" title="æœ¬åœ°åŒ–æ—¥æœŸæ—¶é—´ API"></a>æœ¬åœ°åŒ–æ—¥æœŸæ—¶é—´ API</h2><p><code>LocalDate/LocalTime</code> å’Œ <code>LocalDateTime</code> ç±»å¯ä»¥åœ¨å¤„ç†æ—¶åŒºä¸æ˜¯å¿…é¡»çš„æƒ…å†µã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å½“å‰çš„æ—¥æœŸæ—¶é—´</span></span><br><span class="line">LocalDateTime currentTime = LocalDateTime.now();</span><br><span class="line">System.out.println(<span class="string">"å½“å‰æ—¶é—´: "</span> + currentTime);</span><br><span class="line">        </span><br><span class="line">LocalDate date1 = currentTime.toLocalDate();</span><br><span class="line">System.out.println(<span class="string">"date1: "</span> + date1);</span><br><span class="line">        </span><br><span class="line">Month month = currentTime.getMonth();</span><br><span class="line"><span class="keyword">int</span> day = currentTime.getDayOfMonth();</span><br><span class="line"><span class="keyword">int</span> seconds = currentTime.getSecond();</span><br><span class="line">        </span><br><span class="line">System.out.println(<span class="string">"æœˆ: "</span> + month +<span class="string">", æ—¥: "</span> + day +<span class="string">", ç§’: "</span> + seconds);</span><br><span class="line">        </span><br><span class="line">LocalDateTime date2 = currentTime.withDayOfMonth(<span class="number">10</span>).withYear(<span class="number">2012</span>);</span><br><span class="line">System.out.println(<span class="string">"date2: "</span> + date2);</span><br><span class="line">        </span><br><span class="line"><span class="comment">// 12 december 2014</span></span><br><span class="line">LocalDate date3 = LocalDate.of(<span class="number">2014</span>, Month.DECEMBER, <span class="number">12</span>);</span><br><span class="line">System.out.println(<span class="string">"date3: "</span> + date3);</span><br><span class="line">        </span><br><span class="line"><span class="comment">// 22 å°æ—¶ 15 åˆ†é’Ÿ</span></span><br><span class="line">LocalTime date4 = LocalTime.of(<span class="number">22</span>, <span class="number">15</span>);</span><br><span class="line">System.out.println(<span class="string">"date4: "</span> + date4);</span><br><span class="line">        </span><br><span class="line"><span class="comment">// è§£æå­—ç¬¦ä¸²</span></span><br><span class="line">LocalTime date5 = LocalTime.parse(<span class="string">"20:15:30"</span>);</span><br><span class="line">System.out.println(<span class="string">"date5: "</span> + date5);</span><br></pre></td></tr></table></figure><blockquote><p> output</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; å½“å‰æ—¶é—´: 2016-04-15T16:55:48.668</span><br><span class="line">&gt; date1: 2016-04-15</span><br><span class="line">&gt; æœˆ: APRIL, æ—¥: 15, ç§’: 48</span><br><span class="line">&gt; date2: 2012-04-10T16:55:48.668</span><br><span class="line">&gt; date3: 2014-12-12</span><br><span class="line">&gt; date4: 22:15</span><br><span class="line">&gt; date5: 20:15:30</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><h2 id="ä½¿ç”¨æ—¶åŒºçš„æ—¥æœŸæ—¶é—´API"><a href="#ä½¿ç”¨æ—¶åŒºçš„æ—¥æœŸæ—¶é—´API" class="headerlink" title="ä½¿ç”¨æ—¶åŒºçš„æ—¥æœŸæ—¶é—´API"></a>ä½¿ç”¨æ—¶åŒºçš„æ—¥æœŸæ—¶é—´API</h2><p>å¦‚æœæˆ‘ä»¬éœ€è¦è€ƒè™‘åˆ°æ—¶åŒºï¼Œå°±å¯ä»¥ä½¿ç”¨æ—¶åŒº<code>ZonedDateTime</code>çš„æ—¥æœŸæ—¶é—´APIï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å½“å‰æ—¶é—´æ—¥æœŸ</span></span><br><span class="line">ZonedDateTime date1 = ZonedDateTime.parse(<span class="string">"2015-12-03T10:15:30+05:30[Asia/Shanghai]"</span>);</span><br><span class="line">System.out.println(<span class="string">"date1: "</span> + date1);</span><br><span class="line">        </span><br><span class="line">ZoneId id = ZoneId.of(<span class="string">"Europe/Paris"</span>);</span><br><span class="line">System.out.println(<span class="string">"ZoneId: "</span> + id);</span><br><span class="line">        </span><br><span class="line">ZoneId currentZone = ZoneId.systemDefault();</span><br><span class="line">System.out.println(<span class="string">"å½“æœŸæ—¶åŒº: "</span> + currentZone);</span><br></pre></td></tr></table></figure><blockquote><p>output</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; date1: 2015-12-03T10:15:30+08:00[Asia/Shanghai]</span><br><span class="line">&gt; ZoneId: Europe/Paris</span><br><span class="line">&gt; å½“æœŸæ—¶åŒº: Asia/Shanghai</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><blockquote><p>æ›´å¤šç¤ºä¾‹<a href="https://www.javacodegeeks.com/2014/04/java-8-date-time-api-tutorial-localdatetime.html" target="_blank" rel="noopener">https://www.javacodegeeks.com/2014/04/java-8-date-time-api-tutorial-localdatetime.html</a></p></blockquote><h1 id="Optional-ç±»"><a href="#Optional-ç±»" class="headerlink" title="Optional ç±»"></a>Optional ç±»</h1><p>Optional ç±»æ˜¯ä¸€ä¸ªå¯ä»¥ä¸ºnullçš„å®¹å™¨å¯¹è±¡ã€‚å¦‚æœå€¼å­˜åœ¨åˆ™isPresent()æ–¹æ³•ä¼šè¿”å›trueï¼Œè°ƒç”¨get()æ–¹æ³•ä¼šè¿”å›è¯¥å¯¹è±¡ã€‚</p><p>Optional æ˜¯ä¸ªå®¹å™¨ï¼šå®ƒå¯ä»¥ä¿å­˜ç±»å‹Tçš„å€¼ï¼Œæˆ–è€…ä»…ä»…ä¿å­˜nullã€‚Optionalæä¾›å¾ˆå¤šæœ‰ç”¨çš„æ–¹æ³•ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨æ˜¾å¼è¿›è¡Œç©ºå€¼æ£€æµ‹ã€‚</p><p>Optional ç±»çš„å¼•å…¥å¾ˆå¥½çš„è§£å†³ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p><h2 id="ç±»å£°æ˜"><a href="#ç±»å£°æ˜" class="headerlink" title="ç±»å£°æ˜"></a>ç±»å£°æ˜</h2><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ª <strong>java.util.Optional</strong> ç±»çš„å£°æ˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Optional</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">Object</span></span></span><br></pre></td></tr></table></figure><h2 id="ç±»æ–¹æ³•"><a href="#ç±»æ–¹æ³•" class="headerlink" title="ç±»æ–¹æ³•"></a>ç±»æ–¹æ³•</h2><table><thead><tr><th style="text-align:left">åºå·</th><th style="text-align:left">æ–¹æ³• &amp; æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left"><strong>static  Optional empty()</strong>è¿”å›ç©ºçš„ Optional å®ä¾‹ã€‚</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left"><strong>boolean equals(Object obj)</strong>åˆ¤æ–­å…¶ä»–å¯¹è±¡æ˜¯å¦ç­‰äº Optionalã€‚</td></tr><tr><td style="text-align:left">3</td><td style="text-align:left"><strong>Optional filter(Predicate predicate)</strong>å¦‚æœå€¼å­˜åœ¨ï¼Œå¹¶ä¸”è¿™ä¸ªå€¼åŒ¹é…ç»™å®šçš„ predicateï¼Œè¿”å›ä¸€ä¸ªOptionalç”¨ä»¥æè¿°è¿™ä¸ªå€¼ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªç©ºçš„Optionalã€‚</td></tr><tr><td style="text-align:left">4</td><td style="text-align:left"><strong> Optional flatMap(Function&gt; mapper)</strong>å¦‚æœå€¼å­˜åœ¨ï¼Œè¿”å›åŸºäºOptionalåŒ…å«çš„æ˜ å°„æ–¹æ³•çš„å€¼ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªç©ºçš„Optional</td></tr><tr><td style="text-align:left">5</td><td style="text-align:left"><strong>T get()</strong>å¦‚æœåœ¨è¿™ä¸ªOptionalä¸­åŒ…å«è¿™ä¸ªå€¼ï¼Œè¿”å›å€¼ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼šNoSuchElementException</td></tr><tr><td style="text-align:left">6</td><td style="text-align:left"><strong>int hashCode()</strong>è¿”å›å­˜åœ¨å€¼çš„å“ˆå¸Œç ï¼Œå¦‚æœå€¼ä¸å­˜åœ¨ è¿”å› 0ã€‚</td></tr><tr><td style="text-align:left">7</td><td style="text-align:left"><strong>void ifPresent(Consumer consumer)</strong>å¦‚æœå€¼å­˜åœ¨åˆ™ä½¿ç”¨è¯¥å€¼è°ƒç”¨ consumer , å¦åˆ™ä¸åšä»»ä½•äº‹æƒ…ã€‚</td></tr><tr><td style="text-align:left">8</td><td style="text-align:left"><strong>boolean isPresent()</strong>å¦‚æœå€¼å­˜åœ¨åˆ™æ–¹æ³•ä¼šè¿”å›trueï¼Œå¦åˆ™è¿”å› falseã€‚</td></tr><tr><td style="text-align:left">9</td><td style="text-align:left"><strong>Optional map(Function mapper)</strong>å¦‚æœæœ‰å€¼ï¼Œåˆ™å¯¹å…¶æ‰§è¡Œè°ƒç”¨æ˜ å°„å‡½æ•°å¾—åˆ°è¿”å›å€¼ã€‚å¦‚æœè¿”å›å€¼ä¸ä¸º nullï¼Œåˆ™åˆ›å»ºåŒ…å«æ˜ å°„è¿”å›å€¼çš„Optionalä½œä¸ºmapæ–¹æ³•è¿”å›å€¼ï¼Œå¦åˆ™è¿”å›ç©ºOptionalã€‚</td></tr><tr><td style="text-align:left">10</td><td style="text-align:left"><strong>static  Optional of(T value)</strong>è¿”å›ä¸€ä¸ªæŒ‡å®šénullå€¼çš„Optionalã€‚</td></tr><tr><td style="text-align:left">11</td><td style="text-align:left"><strong>static  Optional ofNullable(T value)</strong>å¦‚æœä¸ºéç©ºï¼Œè¿”å› Optional æè¿°çš„æŒ‡å®šå€¼ï¼Œå¦åˆ™è¿”å›ç©ºçš„ Optionalã€‚</td></tr><tr><td style="text-align:left">12</td><td style="text-align:left"><strong>T orElse(T other)</strong>å¦‚æœå­˜åœ¨è¯¥å€¼ï¼Œè¿”å›å€¼ï¼Œ å¦åˆ™è¿”å› otherã€‚</td></tr><tr><td style="text-align:left">13</td><td style="text-align:left"><strong>T orElseGet(Supplier other)</strong>å¦‚æœå­˜åœ¨è¯¥å€¼ï¼Œè¿”å›å€¼ï¼Œ å¦åˆ™è§¦å‘ otherï¼Œå¹¶è¿”å› other è°ƒç”¨çš„ç»“æœã€‚</td></tr><tr><td style="text-align:left">14</td><td style="text-align:left"><strong> T orElseThrow(Supplier exceptionSupplier)</strong>å¦‚æœå­˜åœ¨è¯¥å€¼ï¼Œè¿”å›åŒ…å«çš„å€¼ï¼Œå¦åˆ™æŠ›å‡ºç”± Supplier ç»§æ‰¿çš„å¼‚å¸¸</td></tr><tr><td style="text-align:left">15</td><td style="text-align:left"><strong>String toString()</strong>è¿”å›ä¸€ä¸ªOptionalçš„éç©ºå­—ç¬¦ä¸²ï¼Œç”¨æ¥è°ƒè¯•</td></tr></tbody></table><p><strong>æ³¨æ„ï¼š</strong> è¿™äº›æ–¹æ³•æ˜¯ä» <strong>java.lang.Object</strong> ç±»ç»§æ‰¿æ¥çš„ã€‚</p><h2 id="Optionalå®ä¾‹"><a href="#Optionalå®ä¾‹" class="headerlink" title="Optionalå®ä¾‹"></a>Optionalå®ä¾‹</h2><p>é€šè¿‡ä»¥ä¸‹å®ä¾‹æ¥æ›´å¥½çš„äº†è§£ Optional ç±»çš„ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OptionalDemo</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">   </span><br><span class="line">      OptionalDemo optionalDemo = <span class="keyword">new</span> OptionalDemo();</span><br><span class="line">      Integer value1 = <span class="keyword">null</span>;</span><br><span class="line">      Integer value2 = <span class="keyword">new</span> Integer(<span class="number">10</span>);</span><br><span class="line">        </span><br><span class="line">      <span class="comment">// Optional.ofNullable - å…è®¸ä¼ é€’ä¸º null å‚æ•°</span></span><br><span class="line">      Optional&lt;Integer&gt; a = Optional.ofNullable(value1);</span><br><span class="line">        </span><br><span class="line">      <span class="comment">// Optional.of - å¦‚æœä¼ é€’çš„å‚æ•°æ˜¯ nullï¼ŒæŠ›å‡ºå¼‚å¸¸ NullPointerException</span></span><br><span class="line">      Optional&lt;Integer&gt; b = Optional.of(value2);</span><br><span class="line">      System.out.println(optionalDemo.sum(a,b));</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">   <span class="function"><span class="keyword">public</span> Integer <span class="title">sum</span><span class="params">(Optional&lt;Integer&gt; a, Optional&lt;Integer&gt; b)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">      <span class="comment">// Optional.isPresent - åˆ¤æ–­å€¼æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">      System.out.println(<span class="string">"ç¬¬ä¸€ä¸ªå‚æ•°å€¼å­˜åœ¨: "</span> + a.isPresent());</span><br><span class="line">      System.out.println(<span class="string">"ç¬¬äºŒä¸ªå‚æ•°å€¼å­˜åœ¨: "</span> + b.isPresent());</span><br><span class="line">        </span><br><span class="line">      <span class="comment">// Optional.orElse - å¦‚æœå€¼å­˜åœ¨ï¼Œè¿”å›å®ƒï¼Œå¦åˆ™è¿”å›é»˜è®¤å€¼</span></span><br><span class="line">      Integer value1 = a.orElse(<span class="keyword">new</span> Integer(<span class="number">0</span>));</span><br><span class="line">        </span><br><span class="line">      <span class="comment">//Optional.get - è·å–å€¼ï¼Œå€¼éœ€è¦å­˜åœ¨</span></span><br><span class="line">      Integer value2 = b.get();</span><br><span class="line">      <span class="keyword">return</span> value1 + value2;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>output</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; ç¬¬ä¸€ä¸ªå‚æ•°å€¼å­˜åœ¨: false</span><br><span class="line">&gt; ç¬¬äºŒä¸ªå‚æ•°å€¼å­˜åœ¨: true</span><br><span class="line">&gt; 10</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://www.jianshu.com/p/5b800057f2d8" target="_blank" rel="noopener">https://www.jianshu.com/p/5b800057f2d8</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Java 8 (åˆç§°ä¸º jdk 1.8) æ˜¯ Java è¯­è¨€å¼€å‘çš„ä¸€ä¸ªä¸»è¦ç‰ˆæœ¬ã€‚ Oracle å…¬å¸äº 2014 å¹´ 3 æœˆ 18 æ—¥å‘å¸ƒ Java 8 ï¼Œå®ƒæ”¯æŒå‡½æ•°å¼ç¼–ç¨‹ï¼Œæ–°çš„ JavaScript å¼•æ“ï¼Œæ–°çš„æ—¥æœŸ APIï¼Œæ–°çš„Stream API ç­‰ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://hackycy.github.io/categories/Java/"/>
    
    
      <category term="Java" scheme="http://hackycy.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>i18nï¼ˆå›½é™…åŒ–ï¼‰åœ°åŸŸæ ‡è¯†ç </title>
    <link href="http://hackycy.github.io/2019/12/16/i18n%EF%BC%88%E5%9B%BD%E9%99%85%E5%8C%96%EF%BC%89%E5%9C%B0%E5%9F%9F%E6%A0%87%E8%AF%86%E7%A0%81/"/>
    <id>http://hackycy.github.io/2019/12/16/i18nï¼ˆå›½é™…åŒ–ï¼‰åœ°åŸŸæ ‡è¯†ç /</id>
    <published>2019-12-16T17:00:27.000Z</published>
    <updated>2020-06-04T06:12:49.332Z</updated>
    
    <content type="html"><![CDATA[<p>i18n(å›½é™…åŒ–) å’Œl18n(æœ¬åœ°åŒ–)æ—¶çš„åœ°åŸŸæ ‡è¯†ä»£ç  æ ¼å¼å¦‚ zh-CN(è¯­è¨€-å›½å®¶)</p><a id="more"></a><table><thead><tr><th style="text-align:left">å›½å®¶</th><th style="text-align:left">è¯­è¨€</th><th style="text-align:left">è¯­è¨€ç¼–ç </th><th style="text-align:left">å›½å®¶ç¼–ç </th></tr></thead><tbody><tr><td style="text-align:left">ä¸­å›½</td><td style="text-align:left">æ±‰è¯­</td><td style="text-align:left">zh</td><td style="text-align:left">CN</td></tr><tr><td style="text-align:left">ä¸­å›½é¦™æ¸¯</td><td style="text-align:left"></td><td style="text-align:left">zh</td><td style="text-align:left">HK</td></tr><tr><td style="text-align:left">ä¸­å›½æ¾³é—¨</td><td style="text-align:left"></td><td style="text-align:left">zh</td><td style="text-align:left">MO</td></tr><tr><td style="text-align:left">ä¸­å›½å°æ¹¾</td><td style="text-align:left"></td><td style="text-align:left">zh</td><td style="text-align:left">TW</td></tr><tr><td style="text-align:left">æ–°åŠ å¡</td><td style="text-align:left">æ±‰è¯­</td><td style="text-align:left">zh</td><td style="text-align:left">SG</td></tr><tr><td style="text-align:left">ä¸­å›½ç®€ä½“ä¸­æ–‡</td><td style="text-align:left">zh-CHS</td><td style="text-align:left"></td><td style="text-align:left"></td></tr><tr><td style="text-align:left">ä¸­å›½ç¹ä½“ä¸­æ–‡</td><td style="text-align:left">zh-CHT</td><td style="text-align:left"></td><td style="text-align:left"></td></tr><tr><td style="text-align:left">è‹±å›½</td><td style="text-align:left">è‹±è¯­</td><td style="text-align:left">en</td><td style="text-align:left">GB</td></tr><tr><td style="text-align:left">ç¾å›½</td><td style="text-align:left">è‹±è¯­</td><td style="text-align:left">en</td><td style="text-align:left">US</td></tr><tr><td style="text-align:left">ä¿„ç½—æ–¯</td><td style="text-align:left">ä¿„ç½—æ–¯ Tatar è¯­</td><td style="text-align:left">tt</td><td style="text-align:left">RU</td></tr><tr><td style="text-align:left">ä¿„ç½—æ–¯</td><td style="text-align:left">ä¿„ç½—æ–¯è¯­</td><td style="text-align:left">ru</td><td style="text-align:left">RU</td></tr><tr><td style="text-align:left">å¾·å›½</td><td style="text-align:left">å¾·è¯­</td><td style="text-align:left">de</td><td style="text-align:left">DE</td></tr><tr><td style="text-align:left">ç‘å£«</td><td style="text-align:left">å¾·è¯­</td><td style="text-align:left">de</td><td style="text-align:left">CH</td></tr><tr><td style="text-align:left">å¢æ£®å ¡</td><td style="text-align:left">å¾·è¯­</td><td style="text-align:left">de</td><td style="text-align:left">LU</td></tr><tr><td style="text-align:left">å¥¥åœ°åˆ©</td><td style="text-align:left">å¾·è¯­</td><td style="text-align:left">de</td><td style="text-align:left">AT</td></tr><tr><td style="text-align:left">åˆ—æ”¯æ•¦å£«ç™»</td><td style="text-align:left">å¾·è¯­</td><td style="text-align:left">de</td><td style="text-align:left">LI</td></tr><tr><td style="text-align:left">åŠ æ‹¿å¤§</td><td style="text-align:left">æ³•è¯­</td><td style="text-align:left">fr</td><td style="text-align:left">CA</td></tr><tr><td style="text-align:left">æ³•å›½</td><td style="text-align:left">æ³•è¯­</td><td style="text-align:left">fr</td><td style="text-align:left">FR</td></tr><tr><td style="text-align:left">å¢æ£®å ¡</td><td style="text-align:left">æ³•è¯­</td><td style="text-align:left">fr</td><td style="text-align:left">LU</td></tr><tr><td style="text-align:left">æ¯”åˆ©æ—¶</td><td style="text-align:left">æ³•è¯­</td><td style="text-align:left">fr</td><td style="text-align:left">BE</td></tr><tr><td style="text-align:left">æ‘©çº³å“¥</td><td style="text-align:left">æ³•è¯­</td><td style="text-align:left">fr</td><td style="text-align:left">MC</td></tr><tr><td style="text-align:left">ç‘å£«</td><td style="text-align:left">æ³•è¯­</td><td style="text-align:left">fr</td><td style="text-align:left">CH</td></tr><tr><td style="text-align:left">æ„å¤§åˆ©</td><td style="text-align:left">æ„å¤§åˆ©</td><td style="text-align:left">it</td><td style="text-align:left">IT</td></tr><tr><td style="text-align:left">æ—¥æœ¬</td><td style="text-align:left">æ—¥è¯­</td><td style="text-align:left">ja</td><td style="text-align:left">JP</td></tr><tr><td style="text-align:left">éŸ©å›½</td><td style="text-align:left">éŸ©å›½</td><td style="text-align:left">ko</td><td style="text-align:left">KR</td></tr><tr><td style="text-align:left">å“ˆè¨å…‹</td><td style="text-align:left">å“ˆè¨å…‹(Kazakh)</td><td style="text-align:left">kk</td><td style="text-align:left">KZ</td></tr><tr><td style="text-align:left">èŠ¬å…°</td><td style="text-align:left">èŠ¬å…°è¯­</td><td style="text-align:left">fi</td><td style="text-align:left">FI</td></tr><tr><td style="text-align:left">ç‘å…¸</td><td style="text-align:left">èŠ¬å…°è¯­</td><td style="text-align:left">sv</td><td style="text-align:left">FI</td></tr><tr><td style="text-align:left">ç‘å…¸</td><td style="text-align:left">ç‘å…¸è¯­</td><td style="text-align:left">sv</td><td style="text-align:left">SE</td></tr><tr><td style="text-align:left">åŒˆç‰™åˆ©</td><td style="text-align:left">åŒˆç‰™åˆ©</td><td style="text-align:left">hu</td><td style="text-align:left">HU</td></tr><tr><td style="text-align:left">å†°å²›</td><td style="text-align:left">å†°å²›</td><td style="text-align:left">is</td><td style="text-align:left">IS</td></tr><tr><td style="text-align:left">å°å°¼</td><td style="text-align:left">å°å°¼</td><td style="text-align:left">id</td><td style="text-align:left">ID</td></tr><tr><td style="text-align:left">ç‘å£«</td><td style="text-align:left">æ„å¤§åˆ©</td><td style="text-align:left">it</td><td style="text-align:left">CH</td></tr><tr><td style="text-align:left">åœŸè€³å…¶</td><td style="text-align:left">åœŸè€³å…¶è¯­</td><td style="text-align:left">tr</td><td style="text-align:left">TR</td></tr><tr><td style="text-align:left">ä¹Œå…‹å…°</td><td style="text-align:left">ä¹Œå…‹å…°è¯­</td><td style="text-align:left">uk</td><td style="text-align:left">UA</td></tr><tr><td style="text-align:left">å·´åŸºæ–¯å¦</td><td style="text-align:left">å·´åŸºæ–¯å¦ Urdu è¯­</td><td style="text-align:left">ur</td><td style="text-align:left">PK</td></tr><tr><td style="text-align:left">åŠ æ‹¿å¤§</td><td style="text-align:left">è‹±è¯­</td><td style="text-align:left">en</td><td style="text-align:left">CA</td></tr><tr><td style="text-align:left">çˆ±å°”å…°</td><td style="text-align:left">è‹±è¯­</td><td style="text-align:left">en</td><td style="text-align:left">IE</td></tr><tr><td style="text-align:left">æ·å…‹</td><td style="text-align:left">æ·å…‹</td><td style="text-align:left">cs</td><td style="text-align:left">CZ</td></tr><tr><td style="text-align:left">ç‘å£«</td><td style="text-align:left">æ³•è¯­</td><td style="text-align:left">fr</td><td style="text-align:left">CH</td></tr><tr><td style="text-align:left">åŠ å‹’æ¯”æµ·</td><td style="text-align:left">è‹±è¯­</td><td style="text-align:left">en</td><td style="text-align:left">CB</td></tr><tr><td style="text-align:left">æ¾³æ´²</td><td style="text-align:left">è‹±è¯­</td><td style="text-align:left">en</td><td style="text-align:left">AU</td></tr><tr><td style="text-align:left">æ–°è¥¿å…°</td><td style="text-align:left">è‹±è¯­</td><td style="text-align:left">en</td><td style="text-align:left">NZ</td></tr><tr><td style="text-align:left">æ¯”åˆ©æ—¶</td><td style="text-align:left">æ³•è¯­</td><td style="text-align:left">fr</td><td style="text-align:left">BE</td></tr><tr><td style="text-align:left">è²å¾‹å®¾</td><td style="text-align:left">è‹±è¯­</td><td style="text-align:left">en</td><td style="text-align:left">PH</td></tr><tr><td style="text-align:left">ç‰™ä¹°åŠ </td><td style="text-align:left">è‹±è¯­</td><td style="text-align:left">en</td><td style="text-align:left">JM</td></tr><tr><td style="text-align:left">ä¼¯åˆ©å…¹</td><td style="text-align:left">è‹±è¯­</td><td style="text-align:left">en</td><td style="text-align:left">BZ</td></tr><tr><td style="text-align:left">åƒé‡Œè¾¾æ‰˜è´å“¥å…±å’Œå›½è‹±è¯­</td><td style="text-align:left"></td><td style="text-align:left">en</td><td style="text-align:left">TT</td></tr><tr><td style="text-align:left">æ´¥å·´å¸ƒéŸ¦</td><td style="text-align:left">è‹±è¯­</td><td style="text-align:left">en</td><td style="text-align:left">ZW</td></tr><tr><td style="text-align:left">çˆ±æ²™å°¼äºš</td><td style="text-align:left">çˆ±æ²™å°¼äºš</td><td style="text-align:left">et</td><td style="text-align:left">EE</td></tr><tr><td style="text-align:left">æ³•ç½—ç¾¤å²›</td><td style="text-align:left">æ³•ç½—è¯­(Faroese)</td><td style="text-align:left">fo</td><td style="text-align:left">FO</td></tr><tr><td style="text-align:left">æ‘©çº³å“¥</td><td style="text-align:left">æ³•è¯­</td><td style="text-align:left">fr</td><td style="text-align:left">MC</td></tr><tr><td style="text-align:left">è¥¿ç­ç‰™</td><td style="text-align:left">è¥¿ç­ç‰™è¯­</td><td style="text-align:left">es</td><td style="text-align:left">ES</td></tr><tr><td style="text-align:left">é˜¿æ ¹å»·</td><td style="text-align:left">è¥¿ç­ç‰™è¯­</td><td style="text-align:left">es</td><td style="text-align:left">AR</td></tr><tr><td style="text-align:left">å¢¨è¥¿å“¥</td><td style="text-align:left">è¥¿ç­ç‰™è¯­</td><td style="text-align:left">es</td><td style="text-align:left">MX</td></tr><tr><td style="text-align:left">ç»åˆ©ç»´äºš</td><td style="text-align:left">è¥¿ç­ç‰™è¯­</td><td style="text-align:left">es</td><td style="text-align:left">BO</td></tr><tr><td style="text-align:left">æ™ºåˆ©</td><td style="text-align:left">è¥¿ç­ç‰™è¯­</td><td style="text-align:left">es</td><td style="text-align:left">CL</td></tr><tr><td style="text-align:left">å·´æ‹¿é©¬</td><td style="text-align:left">è¥¿ç­ç‰™è¯­</td><td style="text-align:left">es</td><td style="text-align:left">PA</td></tr><tr><td style="text-align:left">å§”å†…ç‘æ‹‰</td><td style="text-align:left">è¥¿ç­ç‰™è¯­</td><td style="text-align:left">es</td><td style="text-align:left">VE</td></tr><tr><td style="text-align:left">å“¥ä¼¦æ¯”äºš</td><td style="text-align:left">è¥¿ç­ç‰™è¯­</td><td style="text-align:left">es</td><td style="text-align:left">CO</td></tr><tr><td style="text-align:left">ç§˜é²</td><td style="text-align:left">è¥¿ç­ç‰™è¯­</td><td style="text-align:left">es</td><td style="text-align:left">PE</td></tr><tr><td style="text-align:left">å“¥æ–¯è¾¾é»åŠ </td><td style="text-align:left">è¥¿ç­ç‰™è¯­</td><td style="text-align:left">es</td><td style="text-align:left">CR</td></tr><tr><td style="text-align:left">å¤šç±³å°¼åŠ å…±å’Œå›½</td><td style="text-align:left">è¥¿ç­ç‰™è¯­</td><td style="text-align:left">es</td><td style="text-align:left">DO</td></tr><tr><td style="text-align:left">å„ç“œå¤šå°”</td><td style="text-align:left">è¥¿ç­ç‰™è¯­</td><td style="text-align:left">es</td><td style="text-align:left">EC</td></tr><tr><td style="text-align:left">è¨å°”ç“¦å¤š</td><td style="text-align:left">è¥¿ç­ç‰™è¯­</td><td style="text-align:left">es</td><td style="text-align:left">SV</td></tr><tr><td style="text-align:left">å±åœ°é©¬æ‹‰</td><td style="text-align:left">è¥¿ç­ç‰™è¯­</td><td style="text-align:left">es</td><td style="text-align:left">GT</td></tr><tr><td style="text-align:left">æ´ªéƒ½æ‹‰æ–¯</td><td style="text-align:left">è¥¿ç­ç‰™è¯­</td><td style="text-align:left">es</td><td style="text-align:left">HN</td></tr><tr><td style="text-align:left">å°¼åŠ æ‹‰ç“œ</td><td style="text-align:left">è¥¿ç­ç‰™è¯­</td><td style="text-align:left">es</td><td style="text-align:left">NI</td></tr><tr><td style="text-align:left">å·´æ‹‰åœ­</td><td style="text-align:left">è¥¿ç­ç‰™è¯­</td><td style="text-align:left">es</td><td style="text-align:left">PY</td></tr><tr><td style="text-align:left">æ³¢å¤šé»å„</td><td style="text-align:left">è¥¿ç­ç‰™è¯­</td><td style="text-align:left">es</td><td style="text-align:left">PR</td></tr><tr><td style="text-align:left">ä¹Œæ‹‰åœ­</td><td style="text-align:left">è¥¿ç­ç‰™è¯­</td><td style="text-align:left">es</td><td style="text-align:left">UY</td></tr><tr><td style="text-align:left">å°åº¦</td><td style="text-align:left">å¦ç±³å°”è¯­</td><td style="text-align:left">ta</td><td style="text-align:left">IN</td></tr><tr><td style="text-align:left">å°åº¦</td><td style="text-align:left">å°åº¦è¯­(Gujarati)</td><td style="text-align:left">gu</td><td style="text-align:left">IN</td></tr><tr><td style="text-align:left">å°åº¦</td><td style="text-align:left">åŒ—å°åº¦è¯­</td><td style="text-align:left">hi</td><td style="text-align:left">IN</td></tr><tr><td style="text-align:left">å°åº¦</td><td style="text-align:left">å¡çº³è¾¾è¯­</td><td style="text-align:left">kn</td><td style="text-align:left">IN</td></tr><tr><td style="text-align:left">å°åº¦</td><td style="text-align:left">Konkani</td><td style="text-align:left">kok</td><td style="text-align:left">IN</td></tr><tr><td style="text-align:left">å°åº¦</td><td style="text-align:left">é©¬æ‹‰åœ°è¯­</td><td style="text-align:left">mr</td><td style="text-align:left">IN</td></tr><tr><td style="text-align:left">å°åº¦</td><td style="text-align:left">Punjab è¯­</td><td style="text-align:left">pa</td><td style="text-align:left">IN</td></tr><tr><td style="text-align:left">å°åº¦</td><td style="text-align:left">æ¢µæ–‡</td><td style="text-align:left">sa</td><td style="text-align:left">IN</td></tr><tr><td style="text-align:left">å°åº¦</td><td style="text-align:left">å°åº¦ Telugu è¯­</td><td style="text-align:left">te</td><td style="text-align:left">IN</td></tr><tr><td style="text-align:left">æŒªå¨</td><td style="text-align:left">æŒªå¨</td><td style="text-align:left">nb</td><td style="text-align:left">NO</td></tr><tr><td style="text-align:left">æŒªå¨</td><td style="text-align:left">æŒªå¨(Nynorsk)</td><td style="text-align:left">nn</td><td style="text-align:left">NO</td></tr><tr><td style="text-align:left">æ³¢å…°</td><td style="text-align:left">æ³¢å…°</td><td style="text-align:left">pl</td><td style="text-align:left">PL</td></tr><tr><td style="text-align:left">å·´è¥¿</td><td style="text-align:left">è‘¡è„ç‰™è¯­</td><td style="text-align:left">pt</td><td style="text-align:left">BR</td></tr><tr><td style="text-align:left">è‘¡è„ç‰™</td><td style="text-align:left">è‘¡è„ç‰™è¯­</td><td style="text-align:left">pt</td><td style="text-align:left">PT</td></tr><tr><td style="text-align:left">è¶Šå—</td><td style="text-align:left">è¶Šå—è¯­</td><td style="text-align:left">vi</td><td style="text-align:left">VN</td></tr><tr><td style="text-align:left">æ³°å›½</td><td style="text-align:left">æ³°è¯­</td><td style="text-align:left">th</td><td style="text-align:left">TH</td></tr><tr><td style="text-align:left">å—é</td><td style="text-align:left">è‹±è¯­</td><td style="text-align:left">en</td><td style="text-align:left">ZA</td></tr><tr><td style="text-align:left">å—é</td><td style="text-align:left">å…¬ç”¨è·å…°è¯­</td><td style="text-align:left">af</td><td style="text-align:left">ZA</td></tr><tr><td style="text-align:left">ç™½ä¿„ç½—æ–¯</td><td style="text-align:left">ç™½ä¿„ç½—æ–¯è¯­(Belarusian)</td><td style="text-align:left">be</td><td style="text-align:left">BY</td></tr><tr><td style="text-align:left">ä¼Šæœ—ç‹å›½</td><td style="text-align:left">æ³¢æ–¯è¯­</td><td style="text-align:left">fa</td><td style="text-align:left">IR</td></tr><tr><td style="text-align:left">ä»¥è‰²åˆ—</td><td style="text-align:left">å¸Œä¼¯æ¥æ–‡</td><td style="text-align:left">he</td><td style="text-align:left">IL</td></tr><tr><td style="text-align:left">ä¸¹éº¦</td><td style="text-align:left">ä¸¹éº¦</td><td style="text-align:left">da</td><td style="text-align:left">DK</td></tr><tr><td style="text-align:left">é©¬å°”ä»£å¤«</td><td style="text-align:left">é©¬å°”ä»£å¤«(Dhivehi)</td><td style="text-align:left">div</td><td style="text-align:left">MV</td></tr><tr><td style="text-align:left">æ¯”åˆ©æ—¶</td><td style="text-align:left">è·å…°è¯­</td><td style="text-align:left">nl</td><td style="text-align:left">BE</td></tr><tr><td style="text-align:left">è·å…°</td><td style="text-align:left">è·å…°è¯­</td><td style="text-align:left">nl</td><td style="text-align:left">NL</td></tr><tr><td style="text-align:left">å¸Œè…Š</td><td style="text-align:left">å¸Œè…Š</td><td style="text-align:left">el</td><td style="text-align:left">GR</td></tr><tr><td style="text-align:left">æ²™ç‰¹é˜¿æ‹‰ä¼¯</td><td style="text-align:left">é˜¿æ‹‰ä¼¯è¯­</td><td style="text-align:left">ar</td><td style="text-align:left">SA</td></tr><tr><td style="text-align:left">åŸƒåŠ</td><td style="text-align:left">é˜¿æ‹‰ä¼¯è¯­</td><td style="text-align:left">ar</td><td style="text-align:left">EG</td></tr><tr><td style="text-align:left">ä¼Šæ‹‰å…‹</td><td style="text-align:left">é˜¿æ‹‰ä¼¯è¯­</td><td style="text-align:left">ar</td><td style="text-align:left">IQ</td></tr><tr><td style="text-align:left">çº¦æ—¦</td><td style="text-align:left">é˜¿æ‹‰ä¼¯è¯­</td><td style="text-align:left">ar</td><td style="text-align:left">JO</td></tr><tr><td style="text-align:left">ç§‘å¨ç‰¹</td><td style="text-align:left">é˜¿æ‹‰ä¼¯è¯­</td><td style="text-align:left">ar</td><td style="text-align:left">KW</td></tr><tr><td style="text-align:left">é»å·´å«©</td><td style="text-align:left">é˜¿æ‹‰ä¼¯è¯­</td><td style="text-align:left">ar</td><td style="text-align:left">LB</td></tr><tr><td style="text-align:left">åˆ©æ¯”äºš</td><td style="text-align:left">é˜¿æ‹‰ä¼¯è¯­</td><td style="text-align:left">ar</td><td style="text-align:left">LY</td></tr><tr><td style="text-align:left">å¡å¡”å°”</td><td style="text-align:left">é˜¿æ‹‰ä¼¯è¯­</td><td style="text-align:left">ar</td><td style="text-align:left">QA</td></tr><tr><td style="text-align:left">å™åˆ©äºšå…±å’Œå›½</td><td style="text-align:left">é˜¿æ‹‰ä¼¯è¯­</td><td style="text-align:left">ar</td><td style="text-align:left">SY</td></tr><tr><td style="text-align:left">å™åˆ©äºšå…±å’Œå›½</td><td style="text-align:left">å™åˆ©äºšè¯­(Syriac)</td><td style="text-align:left">syr</td><td style="text-align:left">SY</td></tr><tr><td style="text-align:left">ä¿åŠ åˆ©äºš</td><td style="text-align:left">ä¿åŠ åˆ©äºš</td><td style="text-align:left">bg</td><td style="text-align:left">BG</td></tr><tr><td style="text-align:left">é˜¿å°”å·´å°¼äºš</td><td style="text-align:left">é˜¿å°”å·´å°¼äºš</td><td style="text-align:left">sq</td><td style="text-align:left">AL</td></tr><tr><td style="text-align:left">é˜¿å°”åŠåˆ©äºš</td><td style="text-align:left">é˜¿æ‹‰ä¼¯è¯­</td><td style="text-align:left">ar</td><td style="text-align:left">DZ</td></tr><tr><td style="text-align:left">å·´æ—</td><td style="text-align:left">é˜¿æ‹‰ä¼¯è¯­</td><td style="text-align:left">ar</td><td style="text-align:left">BH</td></tr><tr><td style="text-align:left">æ‘©æ´›å“¥</td><td style="text-align:left">é˜¿æ‹‰ä¼¯è¯­</td><td style="text-align:left">ar</td><td style="text-align:left">MA</td></tr><tr><td style="text-align:left">é˜¿æ›¼</td><td style="text-align:left">é˜¿æ‹‰ä¼¯è¯­</td><td style="text-align:left">ar</td><td style="text-align:left">OM</td></tr><tr><td style="text-align:left">åŒ—éçš„å…±å’Œå›½</td><td style="text-align:left">é˜¿æ‹‰ä¼¯è¯­</td><td style="text-align:left">ar</td><td style="text-align:left">TN</td></tr><tr><td style="text-align:left">é˜¿æ‹‰ä¼¯è”åˆé…‹é•¿å›½</td><td style="text-align:left">é˜¿æ‹‰ä¼¯è¯­</td><td style="text-align:left">ar</td><td style="text-align:left">AE</td></tr><tr><td style="text-align:left">ä¹Ÿé—¨</td><td style="text-align:left">é˜¿æ‹‰ä¼¯è¯­</td><td style="text-align:left">ar</td><td style="text-align:left">YE</td></tr><tr><td style="text-align:left">äºšç¾å°¼äºš</td><td style="text-align:left">äºšç¾å°¼äºšè¯­</td><td style="text-align:left">hy</td><td style="text-align:left">AM</td></tr><tr><td style="text-align:left">å·´æ–¯å…‹</td><td style="text-align:left">å·´æ–¯å…‹</td><td style="text-align:left">eu</td><td style="text-align:left">ES</td></tr><tr><td style="text-align:left">å˜‰æ³°ç½—å°¼äºš</td><td style="text-align:left">å˜‰æ³°ç½—å°¼äºš</td><td style="text-align:left">ca</td><td style="text-align:left">ES</td></tr><tr><td style="text-align:left">è‚¯å°¼äºš</td><td style="text-align:left">è‚¯å°¼äºš(Swahili)è¯­</td><td style="text-align:left">sw</td><td style="text-align:left">KE</td></tr><tr><td style="text-align:left">å…‹ç½—åŸƒè¥¿äºš</td><td style="text-align:left">å…‹ç½—åŸƒè¥¿äºš</td><td style="text-align:left">hr</td><td style="text-align:left">HR</td></tr><tr><td style="text-align:left">åŠ åˆ©è¥¿äºš</td><td style="text-align:left">åŠ åˆ©è¥¿äºš</td><td style="text-align:left">gl</td><td style="text-align:left">ES</td></tr><tr><td style="text-align:left">æ ¼é²å‰äºšå·</td><td style="text-align:left">æ ¼é²å‰äºšå·</td><td style="text-align:left">ka</td><td style="text-align:left">GE</td></tr><tr><td style="text-align:left">å“ˆè¨å…‹</td><td style="text-align:left">Kyrgyz</td><td style="text-align:left">ky</td><td style="text-align:left">KZ</td></tr><tr><td style="text-align:left">æ‹‰è„±ç»´äºš</td><td style="text-align:left">æ‹‰è„±ç»´äºš</td><td style="text-align:left">lv</td><td style="text-align:left">LV</td></tr><tr><td style="text-align:left">ç«‹é™¶å®›</td><td style="text-align:left">ç«‹é™¶å®›</td><td style="text-align:left">lt</td><td style="text-align:left">LT</td></tr><tr><td style="text-align:left">é©¬å…¶é¡¿</td><td style="text-align:left">é©¬å…¶é¡¿</td><td style="text-align:left">mk</td><td style="text-align:left">MK</td></tr><tr><td style="text-align:left">æ±¶è±</td><td style="text-align:left">é©¬æ¥è¯­</td><td style="text-align:left">ms</td><td style="text-align:left">BN</td></tr><tr><td style="text-align:left">é©¬æ¥è¥¿äºš</td><td style="text-align:left">é©¬æ¥è¥¿äºšè¯­</td><td style="text-align:left">ms</td><td style="text-align:left">MY</td></tr><tr><td style="text-align:left">è’™å¤</td><td style="text-align:left">è’™å¤</td><td style="text-align:left">mn</td><td style="text-align:left">MN</td></tr><tr><td style="text-align:left">ç½—é©¬å°¼äºš</td><td style="text-align:left">ç½—é©¬å°¼äºšè¯­</td><td style="text-align:left">ro</td><td style="text-align:left">RO</td></tr><tr><td style="text-align:left">å¡å°”ç»´äºš(è¥¿é‡Œå°”å­—æ¯çš„)</td><td style="text-align:left">sr-SP-Cyrl</td><td style="text-align:left"></td><td style="text-align:left"></td></tr><tr><td style="text-align:left">å¡å°”(æ‹‰ä¸æ–‡)</td><td style="text-align:left">sr-SP-Latn</td><td style="text-align:left"></td><td style="text-align:left"></td></tr><tr><td style="text-align:left">æ–¯æ´›ä¼å…‹</td><td style="text-align:left">æ–¯æ´›ä¼å…‹</td><td style="text-align:left">sk</td><td style="text-align:left">SK</td></tr><tr><td style="text-align:left">æ–¯æ´›æ–‡å°¼äºš</td><td style="text-align:left">æ–¯æ´›æ–‡å°¼äºš</td><td style="text-align:left">sl</td><td style="text-align:left">SI</td></tr><tr><td style="text-align:left">ä¹Œå…¹åˆ«å…‹</td><td style="text-align:left">ä¹Œå…¹åˆ«å…‹(è¥¿é‡Œå°”å­—æ¯çš„)</td><td style="text-align:left">uz</td><td style="text-align:left">uz-UZ-Cyrl</td></tr><tr><td style="text-align:left">ä¹Œå…¹åˆ«å…‹</td><td style="text-align:left">ä¹Œå…¹åˆ«å…‹(æ‹‰ä¸æ–‡çš„)</td><td style="text-align:left">uz</td><td style="text-align:left">UZ-Latn</td></tr><tr><td style="text-align:left">å¡æµ¦è·¯æ–¯</td><td style="text-align:left">å¸Œè…Šæ–‡</td><td style="text-align:left">el</td><td style="text-align:left">CY</td></tr><tr><td style="text-align:left">è‹±è¯­(å…¨çƒ)</td><td style="text-align:left">en-WW</td><td style="text-align:left"></td></tr></tbody></table><blockquote><p>å†…å®¹è½¬è½½äº<a href="https://www.cnblogs.com/isdom/p/webclips009.html" target="_blank" rel="noopener">https://www.cnblogs.com/isdom/p/webclips009.html</a></p></blockquote><p>æ›´ä¸ºè¯¦ç»†çš„ä¸€ä¸ªè¡¨æ ¼ï¼š</p><table><thead><tr><th>Language</th><th>English Name</th><th>Chinese Name</th><th>Code</th><th>GB</th><th>ICS</th><th>JB</th><th>KK</th></tr></thead><tbody><tr><td>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</td><td>Arabic(Israel)</td><td>é˜¿æ‹‰ä¼¯è¯­(ä»¥è‰²åˆ—)</td><td>ar_IL</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td></td><td>Arabic(Egypt)</td><td>é˜¿æ‹‰ä¼¯è¯­(åŸƒåŠ)</td><td>ar_EG</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td>ä¸­æ–‡</td><td>Chinese Simplified</td><td>ä¸­æ–‡ç®€ä½“</td><td>zh_TW</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td></td><td>Chinese Tradition</td><td>ä¸­æ–‡ç¹ä½“</td><td>zh_CN</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td></td><td>Chinese</td><td>ä¸­æ–‡(é¦™æ¸¯)</td><td>zh_HK</td><td>N</td><td>N</td><td>P</td><td>P</td></tr><tr><td>Nederlands</td><td>Dutch (Netherlands)</td><td>è·å…°è¯­</td><td>nl_NL</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td></td><td>Dutch (Netherlands)</td><td>è·å…°è¯­(æ¯”åˆ©æ—¶)</td><td>nl_BE</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td>English</td><td>English(United States)</td><td>è‹±è¯­(ç¾å›½)</td><td>en_US</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td></td><td>English(Australia)</td><td>è‹±è¯­(æ¾³å¤§åˆ©äºš)</td><td>en_AU</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td></td><td>English(Canada)</td><td>è‹±è¯­(åŠ æ‹¿å¤§)</td><td>en_CA</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td></td><td>English(India)</td><td>è‹±è¯­(å°åº¦)</td><td>en_IN</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td></td><td>English(Ireland)</td><td>è‹±è¯­(çˆ±å°”å…°)</td><td>en_IE</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td></td><td>English(New Zealand)</td><td>è‹±è¯­(æ–°è¥¿å…°)</td><td>en_NZ</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td></td><td>English(Singapore)</td><td>è‹±è¯­(æ–°åŠ æ³¢)</td><td>en_SG</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td></td><td>English(South Africa)</td><td>è‹±è¯­(å—é)</td><td>en_ZA</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td></td><td>English(United Kingdom)</td><td>è‹±è¯­(è‹±å›½)</td><td>en_GB</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td><td>Y</td></tr><tr><td>FranÃ§ais</td><td>French</td><td>æ³•è¯­</td><td>fr_FR</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td></td><td>French</td><td>æ³•è¯­(æ¯”åˆ©æ—¶)</td><td>fr_BE</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td></td><td>French</td><td>æ³•è¯­(åŠ æ‹¿å¤§)</td><td>fr_CA</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td></td><td>French</td><td>æ³•è¯­(ç‘å£«)</td><td>fr_CH</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td>Deutsch</td><td>German</td><td>å¾·è¯­</td><td>de_DE</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td></td><td>German</td><td>å¾·è¯­(åˆ—æ”¯æ•¦æ–¯ç™»)</td><td>de_LI</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td></td><td>German</td><td>å¾·è¯­(å¥¥åœ°åˆ©)</td><td>de_AT</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td><td>Y</td></tr><tr><td></td><td>German</td><td>å¾·è¯­(ç‘å£«)</td><td>de_CH</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td>Italiano</td><td>Italian</td><td>æ„å¤§åˆ©è¯­</td><td>it_IT</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td></td><td>Italian</td><td>æ„å¤§åˆ©è¯­(ç‘å£«)</td><td>it_CH</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td>ProtuguÃªs</td><td>Portuguese</td><td>è‘¡è„ç‰™è¯­ï¼ˆå·´è¥¿ï¼‰</td><td>pt_BR</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td></td><td>Portuguese</td><td>è‘¡è„ç‰™è¯­</td><td>pt_PT</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>EspaÃ±ol</td><td>Spanish</td><td>è¥¿ç­ç‰™è¯­</td><td>es_ES</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td></td><td>Spanish</td><td>è¥¿ç­ç‰™è¯­(ç¾å›½)</td><td>es_US</td><td>GD_MN</td><td>GD_MN</td><td>P</td><td>Y</td></tr><tr><td>à¦¬à¦¾à¦‚à¦²à¦¾</td><td>Bengali</td><td>å­ŸåŠ æ‹‰è¯­</td><td>bn_BD</td><td>Y</td><td>N</td><td>N</td><td>N</td></tr><tr><td></td><td>Bengali</td><td>å­ŸåŠ æ‹‰è¯­(å°åº¦)</td><td>bn_IN</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>hrvatski</td><td>Croatian</td><td>å…‹ç½—åœ°äºšè¯­</td><td>hr_HR</td><td>GD_MN</td><td>GD_MN</td><td>P</td><td>Y</td></tr><tr><td>ÄeÅ¡tina</td><td>Czech</td><td>æ·å…‹è¯­</td><td>cs_CZ</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>Dansk</td><td>Danish</td><td>ä¸¹éº¦è¯­</td><td>da_DK</td><td>GD_MN</td><td>GD_MN</td><td>P</td><td>Y</td></tr><tr><td>ÎµÎ»Î»Î·Î½Î¹ÎºÎ¬</td><td>Greek</td><td>å¸Œè…Šè¯­</td><td>el_GR</td><td>GD_MN</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>×¢×‘×¨×™×ª</td><td>Hebrew</td><td>å¸Œä¼¯æ¥è¯­(ä»¥è‰²åˆ—)</td><td>he_IL</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td></td><td>Hebrew</td><td>å¸Œä¼¯æ¥è¯­(ä»¥è‰²åˆ—)</td><td>iw_IL</td><td>GD_MN</td><td>GD_MN</td><td>Y</td><td>Y</td></tr><tr><td>à¤¹à¤¿à¤‚à¤¦à¥€</td><td>Hindi</td><td>å°åº¦è¯­</td><td>hi_IN</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>Magyar</td><td>Hungarian</td><td>åŒˆç‰™åˆ©è¯­</td><td>hu_HU</td><td>GD_MN</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td></td><td>Indonesian</td><td>å°åº¦å°¼è¥¿äºšè¯­</td><td>in_ID</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>æ—¥æœ¬èªã®è¨€èª</td><td>Japanese</td><td>æ—¥è¯­</td><td>ja_JP</td><td>GD_MN</td><td>GD_MN</td><td>P</td><td>P</td></tr><tr><td>í•œêµ­ì˜</td><td>Korean</td><td>éŸ©è¯­ï¼ˆæœé²œè¯­ï¼‰</td><td>ko_KR</td><td>GD_MN</td><td>GD_MN</td><td>Y</td><td>Y</td></tr><tr><td>Bahasa Melayu</td><td>Malay</td><td>é©¬æ¥è¯­</td><td>ms_MY</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>ÙØ§Ø±Ø³ÛŒ</td><td>Perisan</td><td>æ³¢æ–¯è¯­</td><td>fa_IR</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>Polski</td><td>Polish</td><td>æ³¢å…°è¯­</td><td>pl_PL</td><td>GD_MN</td><td>GD_MN</td><td>P</td><td>Y</td></tr><tr><td>romÃ¢na</td><td>Romanian</td><td>ç½—é©¬å°¼äºšè¯­</td><td>ro_RO</td><td>GD_MN</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>Ğ ÑƒÑÑĞºĞ¸Ğ¹</td><td>Russian</td><td>ä¿„ç½—æ–¯è¯­</td><td>ru_RU</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>ÑÑ€Ğ¿ÑĞºĞ¸</td><td>Serbian</td><td>å¡å°”ç»´äºšè¯­</td><td>sr_RS</td><td>GD_MN</td><td>GD_MN</td><td>P</td><td>P</td></tr><tr><td>Svenska</td><td>Swedish</td><td>ç‘å…¸è¯­</td><td>sv_SE</td><td>GD_MN</td><td>GD_MN</td><td>P</td><td>Y</td></tr><tr><td>à¹„à¸—à¸¢</td><td>Thai</td><td>æ³°è¯­</td><td>th_TH</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>TÃ¼rkÃ§e</td><td>Turkey</td><td>åœŸè€³å…¶è¯­</td><td>tr_TR</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>Ø§Ø±Ø¯Ùˆ</td><td>Urdu</td><td>ä¹Œå°”éƒ½è¯­</td><td>ur_PK</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>tiáº¿ng viá»‡t</td><td>Vietnamese</td><td>è¶Šå—è¯­</td><td>vi_VN</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>catalÃ¡</td><td>Catalan</td><td>åŠ æ³°éš†è¯­(è¥¿ç­ç‰™)</td><td>ca_ES</td><td>GD_MN</td><td>GD_MN</td><td>P</td><td>P</td></tr><tr><td>latvieÅ¡u</td><td>Latviesu</td><td>æ‹‰è„±ç»´äºšè¯­</td><td>lv_LV</td><td>GD_MN</td><td>GD_MN</td><td>P</td><td>Y</td></tr><tr><td>LietuviÅ³</td><td>Lithuanian</td><td>ç«‹é™¶å®›è¯­</td><td>lt_LT</td><td>GD_MN</td><td>GD_MN</td><td>P</td><td>Y</td></tr><tr><td>Norsk bokmal</td><td>Norwegian</td><td>æŒªå¨è¯­</td><td>nb_NO</td><td>GD_MN</td><td>GD_MN</td><td>P</td><td>Y</td></tr><tr><td>SlovenÄina</td><td>slovencina</td><td>æ–¯æ´›ä¼å…‹è¯­</td><td>sk_SK</td><td>GD_MN</td><td>GD_MN</td><td>P</td><td>Y</td></tr><tr><td>SlovenÅ¡Äina</td><td>Slovenian</td><td>æ–¯æ´›æ–‡å°¼äºšè¯­</td><td>sl_SI</td><td>GD_MN</td><td>GD_MN</td><td>P</td><td>P</td></tr><tr><td>Ğ±ÑŠĞ»Ğ³Ğ°Ñ€ÑĞºĞ¸</td><td>bulgarian</td><td>ä¿åŠ åˆ©äºšè¯­</td><td>bg_BG</td><td>GD_MN</td><td>GD_MN</td><td>P</td><td>Y</td></tr><tr><td>ÑƒĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°</td><td>Ukrainian</td><td>ä¹Œå…‹å…°è¯­</td><td>uk_UA</td><td>GD_MN</td><td>GD_MN</td><td>P</td><td>Y</td></tr><tr><td>Tagalog</td><td>Filipino</td><td>è²å¾‹å®¾è¯­</td><td>tl_PH</td><td>GD_MN</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>Suomi</td><td>Finnish</td><td>èŠ¬å…°è¯­</td><td>fi_FI</td><td>GD_MN</td><td>GD_MN</td><td>P</td><td>Y</td></tr><tr><td>Afrikaans</td><td>Afrikaans</td><td>å—éè¯­</td><td>af_ZA</td><td>N</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td>Rumantsch</td><td>Romansh</td><td>ç½—æ›¼ä»€è¯­(ç‘å£«)</td><td>rm_CH</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td>á€—á€™á€¬</td><td>Burmese(Zawgyi)</td><td>ç¼…ç”¸è¯­(æ°‘é—´)</td><td>my_ZG</td><td>N</td><td>N</td><td>P</td><td>P</td></tr><tr><td></td><td>Burmese(Paduak)</td><td>ç¼…ç”¸è¯­(å®˜æ–¹)</td><td>my_MM</td><td>N</td><td>N</td><td>Y</td><td>Y</td></tr><tr><td>á˜áŸ‚áš</td><td>Khmer</td><td>æŸ¬åŸ”å¯¨è¯­</td><td>km_KH</td><td>N</td><td>N</td><td>Y</td><td>Y</td></tr><tr><td>áŠ áˆ›áˆ­áŠ›</td><td>Amharic</td><td>é˜¿å§†å“ˆæ‹‰è¯­(åŸƒå¡ä¿„æ¯”äºš)</td><td>am_ET</td><td>N</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td>Ğ±ĞµĞ»Ğ°Ñ€ÑƒÑĞºĞ°Ñ</td><td>Belarusian</td><td>ç™½ä¿„ç½—æ–¯è¯­</td><td>be_BY</td><td>N</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td>eesti</td><td>Estonian</td><td>çˆ±æ²™å°¼äºšè¯­</td><td>et_EE</td><td>N</td><td>GD_MN</td><td>P</td><td>P</td></tr><tr><td>Kiswahili</td><td>Swahili</td><td>æ–¯ç“¦å¸Œé‡Œè¯­(å¦æ¡‘å°¼äºš)</td><td>sw_TZ</td><td>N</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td>isiZulu</td><td>Zulu</td><td>ç¥–é²è¯­(å—é)</td><td>zu_ZA</td><td>N</td><td>GD_MN</td><td>GD_MN</td><td>GD_MN</td></tr><tr><td>azÉ™rbaycanca</td><td>Azerbaijani</td><td>é˜¿å¡æ‹œç–†è¯­</td><td>az_AZ</td><td>N</td><td>N</td><td>N</td><td>GD_MN</td></tr><tr><td>Õ€Õ¡ÕµÕ¥Ö€Õ§Õ¶</td><td>Armenian</td><td>äºšç¾å°¼äºšè¯­(äºšç¾å°¼äºš)</td><td>hy_AM</td><td>N</td><td>N</td><td>P</td><td>P</td></tr><tr><td>áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜</td><td>Georgian</td><td>æ ¼é²å‰äºšè¯­(æ ¼é²å‰äºš)</td><td>ka_GE</td><td>N</td><td>N</td><td>N</td><td>GD_MN</td></tr><tr><td>àº¥àº²àº§</td><td>Laotian</td><td>è€æŒè¯­(è€æŒ)</td><td>lo_LA</td><td>N</td><td>N</td><td>N</td><td>GD_MN</td></tr><tr><td>ĞœĞ¾Ğ½Ğ³Ğ¾Ğ»</td><td>Mongolian</td><td>è’™å¤è¯­</td><td>mn_MN</td><td>N</td><td>N</td><td>N</td><td>GD_MN</td></tr><tr><td>à¤¨à¥‡à¤ªà¤¾à¤²à¥€</td><td>Nepali</td><td>å°¼æ³Šå°”è¯­</td><td>ne_NP</td><td>N</td><td>N</td><td>N</td><td>GD_MN</td></tr><tr><td>Ò›Ğ°Ğ·Ğ°Ò› Ñ‚Ñ–Ğ»Ñ–</td><td>Kazakh</td><td>å“ˆè¨å…‹è¯­</td><td>kk_KZ</td><td>N</td><td>N</td><td>P</td><td>P</td></tr><tr><td>à·ƒà·’à¶‚à·„à¶½</td><td>Sinhala</td><td>åƒ§åŠ ç½—è¯­(æ–¯é‡Œå…°å¡)</td><td>si_LK</td><td>N</td><td>N</td><td>N</td><td>GD_MN</td></tr></tbody></table><blockquote><p>1ã€æ ‡è®°â€œNâ€è¡¨ç¤ºå½“å‰ç‰ˆæœ¬ä¸æ”¯æŒï¼›æ ‡è®°â€œYâ€è¡¨ç¤ºmtkã€googleå‡æ”¯æŒï¼›æ ‡è®°â€œGD_MNâ€è¡¨ç¤ºGoogleé»˜è®¤æ”¯æŒï¼ŒMTKä¸æ”¯æŒã€‚<br>2ã€å¯¹äºGD_MNï¼Œå¦‚æœè¦æ”¯æŒçš„è¯ï¼Œåªéœ€ç¿»è¯‘mtkæ–°å¢çš„éƒ¨åˆ†å­—ä¸²å°±è¡Œã€‚<br>3ã€å¦‚è‹¥æ‰“å¼€æˆ–è€…æ·»åŠ è¯­è¨€ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹FAQï¼Œ<br>   å¦‚ä½•æ‰“å¼€ä¸€ç§è¯­è¨€ï¼šFAQ04326<br>4ã€æ ‡è®°â€œPâ€æ˜¯mtkåé¢æ–°æ”¯æŒçš„ä¸€äº›è¯­è¨€,å¦‚æœè¦æ”¯æŒï¼Œå¯ä»¥é€šè¿‡PMSç³»ç»Ÿç›´æ¥ç”³è¯·Patchï¼ŒALPS01686452  æ”¯æŒé™¤æ°‘é—´ç¼…ç”¸è¯­ä»¥å¤–æ‰€æœ‰ç‰ˆæœ¬çš„å¤šå›½è¯­è¨€ï¼ˆè¿™ä¸ªPATCHçš„æ°‘é—´ç¼…ç”¸è¯­åªæ”¯æŒKK.MP1 , KK.MP6 , KK.MP7ï¼‰<br>5ã€å…³äºæ°‘é—´ç¼…ç”¸è¯­çš„æƒ…å†µ<br>ç›®å‰MTK JB3.MP,JB5.MP,JB9.MP,KK.MP1,KK.MP6å·²ç»å¯ä»¥æ”¯æŒZawgyiã€‚å¦‚æœéœ€è¦çš„è¯å¯ä»¥é€šè¿‡PMSç³»ç»Ÿç”³è¯·patch,è¯·æŒ‰ä»¥ä¸‹æ“ä½œï¼š<br>1).ç”³è¯·strings patch å’Œå­—åº“PATCH<br>   JBX:<br>      ALPS01561463<br>      ALPS01400558<br>      ALPS01444813<br>      ALPS01444868<br>KK.MP1 , KK.MP6 , KK.MP7<br>ALPS01686452<br>3).éœ€è¦æ³¨æ„çš„æ˜¯padauk(my_MM)å’Œzawgyi(my_ZG)ä¸èƒ½åŒæ—¶å¼€,åªèƒ½æ‰“å¼€ä¸€ä¸ª.<br>4)å¦‚æœé‡åˆ°è®¿é—®ä¸€äº›ç¼…ç”¸è¯­è¯­ç½‘ç«™æ—¶å‡ºç°å¤§é‡åœˆåœˆï¼Œå¯èƒ½æ˜¯è¯¥ç½‘ç«™æ˜¯æ°‘é—´ç¼…ç”¸è¯­ç½‘ç«™ï¼Œå¯ä»¥ç”³è¯·è¿™äº›patch</p></blockquote><p>æ‘˜æŠ„è‡ªï¼š<a href="https://blog.csdn.net/ouyang_peng/article/details/50209789" target="_blank" rel="noopener">https://blog.csdn.net/ouyang_peng/article/details/50209789</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;i18n(å›½é™…åŒ–) å’Œl18n(æœ¬åœ°åŒ–)æ—¶çš„åœ°åŸŸæ ‡è¯†ä»£ç  æ ¼å¼å¦‚ zh-CN(è¯­è¨€-å›½å®¶)&lt;/p&gt;
    
    </summary>
    
      <category term="ç¨‹åºäººç”Ÿ" scheme="http://hackycy.github.io/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/"/>
    
    
      <category term="i18n" scheme="http://hackycy.github.io/tags/i18n/"/>
    
  </entry>
  
  <entry>
    <title>ç½‘é¡µå¸ƒå±€ä¹‹Flexå¸ƒå±€</title>
    <link href="http://hackycy.github.io/2019/12/14/%E7%BD%91%E9%A1%B5%E5%B8%83%E5%B1%80%E4%B9%8BFlex%E5%B8%83%E5%B1%80/"/>
    <id>http://hackycy.github.io/2019/12/14/ç½‘é¡µå¸ƒå±€ä¹‹Flexå¸ƒå±€/</id>
    <published>2019-12-14T11:24:47.000Z</published>
    <updated>2020-06-04T06:12:49.372Z</updated>
    
    <content type="html"><![CDATA[<p>ç½‘é¡µå¸ƒå±€ï¼ˆlayoutï¼‰æ˜¯ CSS çš„ä¸€ä¸ªé‡ç‚¹åº”ç”¨ã€‚å¸ƒå±€çš„ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆï¼ŒåŸºäº<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/box_model" target="_blank" rel="noopener">ç›’çŠ¶æ¨¡å‹</a>ï¼Œä¾èµ– <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/display" target="_blank" rel="noopener"><code>display</code></a> å±æ€§ + <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/position" target="_blank" rel="noopener"><code>position</code></a>å±æ€§ + <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/float" target="_blank" rel="noopener"><code>float</code></a>å±æ€§ã€‚å®ƒå¯¹äºé‚£äº›ç‰¹æ®Šå¸ƒå±€éå¸¸ä¸æ–¹ä¾¿ï¼Œæ¯”å¦‚ï¼Œ<a href="https://css-tricks.com/centering-css-complete-guide/" target="_blank" rel="noopener">å‚ç›´å±…ä¸­</a>å°±ä¸å®¹æ˜“å®ç°ã€‚</p><a id="more"></a><p><img src="flexbg.png" alt></p><p>2009å¹´ï¼ŒW3C æå‡ºäº†ä¸€ç§æ–°çš„æ–¹æ¡ˆâ€”-Flex å¸ƒå±€ï¼Œå¯ä»¥ç®€ä¾¿ã€å®Œæ•´ã€å“åº”å¼åœ°å®ç°å„ç§é¡µé¢å¸ƒå±€ã€‚ç›®å‰ï¼Œå®ƒå·²ç»å¾—åˆ°äº†æ‰€æœ‰æµè§ˆå™¨çš„æ”¯æŒï¼Œè¿™æ„å‘³ç€ï¼Œç°åœ¨å°±èƒ½å¾ˆå®‰å…¨åœ°ä½¿ç”¨è¿™é¡¹åŠŸèƒ½ã€‚</p><p><img src="caniuseflex.png" alt></p><h1 id="Flexå¸ƒå±€æ˜¯ä»€ä¹ˆ"><a href="#Flexå¸ƒå±€æ˜¯ä»€ä¹ˆ" class="headerlink" title="Flexå¸ƒå±€æ˜¯ä»€ä¹ˆ"></a>Flexå¸ƒå±€æ˜¯ä»€ä¹ˆ</h1><p>Flexæ˜¯Flexible Boxçš„ç¼©å†™ã€‚è¯‘ä¸ºâ€œå¼¹æ€§å¸ƒå±€â€ï¼Œç”¨æ¥ä½œä¸ºç›’çŠ¶æ¨¡å‹æä¾›æœ€å¤§çš„çµæ´»æ€§ã€‚</p><p>ä»»ä½•ä¸€ä¸ªå®¹å™¨éƒ½å¯ä»¥æŒ‡å®šä¸ºFlexå¸ƒå±€ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¡Œå†…å…ƒç´ ä¹Ÿå¯ä»¥ä½¿ç”¨Flexå¸ƒå±€ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-flex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Webkitå†…æ ¸çš„æµè§ˆå™¨ï¼Œå¿…é¡»åŠ ä¸Š<code>-webkit</code>å‰ç¼€ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-flex;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼Œè®¾ä¸º Flex å¸ƒå±€ä»¥åï¼Œå­å…ƒç´ çš„<code>float</code>ã€<code>clear</code>å’Œ<code>vertical-align</code>å±æ€§å°†å¤±æ•ˆã€‚</p></blockquote><h1 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h1><p>é‡‡ç”¨ Flex å¸ƒå±€çš„å…ƒç´ ï¼Œç§°ä¸º Flex å®¹å™¨ï¼ˆflex containerï¼‰ï¼Œç®€ç§°â€å®¹å™¨â€ã€‚å®ƒçš„æ‰€æœ‰å­å…ƒç´ è‡ªåŠ¨æˆä¸ºå®¹å™¨æˆå‘˜ï¼Œç§°ä¸º Flex é¡¹ç›®ï¼ˆflex itemï¼‰ï¼Œç®€ç§°â€é¡¹ç›®â€ã€‚</p><p>æˆ‘ä»¬æŠŠä¸€ä¸ªå®¹å™¨çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/display" target="_blank" rel="noopener"><code>display</code></a> å±æ€§å€¼æ”¹ä¸º <code>flex</code> æˆ–è€… <code>inline-flex</code> å®Œæˆè¿™ä¸€æ­¥ä¹‹åï¼Œå®¹å™¨ä¸­çš„ç›´ç³»å­å…ƒç´ å°±ä¼šå˜ä¸º <strong>flex å…ƒç´ </strong>ã€‚æ‰€æœ‰CSSå±æ€§éƒ½ä¼šæœ‰ä¸€ä¸ªåˆå§‹å€¼ï¼Œæ‰€ä»¥ flex å®¹å™¨ä¸­çš„æ‰€æœ‰ flex å…ƒç´ éƒ½ä¼šæœ‰ä¸‹åˆ—è¡Œä¸ºï¼š</p><ul><li>å…ƒç´ æ’åˆ—ä¸ºä¸€è¡Œ (<code>flex-direction</code> å±æ€§çš„åˆå§‹å€¼æ˜¯ <code>row</code>)ã€‚</li><li>å…ƒç´ ä»ä¸»è½´çš„èµ·å§‹çº¿å¼€å§‹ã€‚</li><li>å…ƒç´ ä¸ä¼šåœ¨ä¸»ç»´åº¦æ–¹å‘æ‹‰ä¼¸ï¼Œä½†æ˜¯å¯ä»¥ç¼©å°ã€‚</li><li>å…ƒç´ è¢«æ‹‰ä¼¸æ¥å¡«å……äº¤å‰è½´å¤§å°ã€‚</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/flex-basis" target="_blank" rel="noopener"><code>flex-basis</code></a> å±æ€§ä¸º <code>autoã€‚</code></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/flex-wrap" target="_blank" rel="noopener"><code>flex-wrap</code></a> å±æ€§ä¸º <code>nowrapã€‚</code></li></ul><p>å®¹å™¨é»˜è®¤å­˜åœ¨ä¸¤æ ¹è½´ï¼šä¸»è½´å’Œäº¤å‰è½´ã€‚ä¸»è½´ç”± <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/flex-direction" target="_blank" rel="noopener"><code>flex-direction</code></a> å®šä¹‰ï¼Œå¦ä¸€æ ¹è½´å‚ç›´äºå®ƒã€‚è€ŒFlexboxçš„æ‰€æœ‰å±æ€§éƒ½ä¸è¿™ä¸¤æ ¹ä¸»è½´æœ‰å…³ã€‚</p><h2 id="ä¸»è½´"><a href="#ä¸»è½´" class="headerlink" title="ä¸»è½´"></a>ä¸»è½´</h2><p>ä¸»è½´ï¼ˆmain axisï¼‰ç”±<code>flex-direction</code>å®šä¹‰ï¼Œå¯ä»¥å–å››ä¸ªå€¼ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flex-direction: column | column-reverse | row | row-reverse;</span><br></pre></td></tr></table></figure><blockquote><p>é€‰æ‹©äº† <code>row</code> æˆ–è€… <code>row-reverse</code>ï¼Œä½ çš„ä¸»è½´å°†æ²¿ç€ <strong>inline</strong> æ–¹å‘å»¶ä¼¸ã€‚</p><p>é€‰æ‹© <code>column</code> æˆ–è€… <code>column-reverse</code> æ—¶ï¼Œä½ çš„ä¸»è½´ä¼šæ²¿ç€ä¸Šä¸‹æ–¹å‘å»¶ä¼¸ â€” ä¹Ÿå°±æ˜¯ <strong>block æ’åˆ—çš„æ–¹å‘ã€‚</strong></p></blockquote><h2 id="äº¤å‰è½´"><a href="#äº¤å‰è½´" class="headerlink" title="äº¤å‰è½´"></a>äº¤å‰è½´</h2><p>äº¤å‰è½´ï¼ˆcross axisï¼‰å‚ç›´äºä¸»è½´</p><blockquote><p><code>flex-direction</code> (ä¸»è½´) è®¾æˆäº† <code>row</code> æˆ–è€… <code>row-reverse</code> çš„è¯ï¼Œäº¤å‰è½´çš„æ–¹å‘å°±æ˜¯æ²¿ç€åˆ—å‘ä¸‹çš„ã€‚</p><p>ä¸»è½´æ–¹å‘è®¾æˆäº† <code>column</code> æˆ–è€… <code>column-reverse</code>ï¼Œäº¤å‰è½´å°±æ˜¯æ°´å¹³æ–¹å‘ã€‚</p></blockquote><h2 id="èµ·å§‹çº¿å’Œç»ˆæ­¢çº¿"><a href="#èµ·å§‹çº¿å’Œç»ˆæ­¢çº¿" class="headerlink" title="èµ·å§‹çº¿å’Œç»ˆæ­¢çº¿"></a>èµ·å§‹çº¿å’Œç»ˆæ­¢çº¿</h2><p>ä¸»è½´çš„å¼€å§‹ä½ç½®ï¼ˆä¸è¾¹æ¡†çš„äº¤å‰ç‚¹ï¼‰å«åš<code>main start</code>ï¼Œç»“æŸä½ç½®å«åš<code>main end</code>ï¼›äº¤å‰è½´çš„å¼€å§‹ä½ç½®å«åš<code>cross start</code>ï¼Œç»“æŸä½ç½®å«åš<code>cross end</code>ã€‚</p><p>é¡¹ç›®é»˜è®¤æ²¿ä¸»è½´æ’åˆ—ã€‚å•ä¸ªé¡¹ç›®å æ®çš„ä¸»è½´ç©ºé—´å«åš<code>main size</code>ï¼Œå æ®çš„äº¤å‰è½´ç©ºé—´å«åš<code>cross size</code>ã€‚</p><p><img src="axis.png" alt></p><h1 id="å®¹å™¨çš„å±æ€§"><a href="#å®¹å™¨çš„å±æ€§" class="headerlink" title="å®¹å™¨çš„å±æ€§"></a>å®¹å™¨çš„å±æ€§</h1><p>ä»¥ä¸‹6ä¸ªå±æ€§è®¾ç½®åœ¨å®¹å™¨ä¸Šã€‚</p><ul><li>flex-direction</li><li>flex-wrap</li><li>flex-flow</li><li>justify-content</li><li>align-items</li><li>align-content</li></ul><h2 id="flex-directionå±æ€§"><a href="#flex-directionå±æ€§" class="headerlink" title="flex-directionå±æ€§"></a>flex-directionå±æ€§</h2><p><code>flex-direction</code>å±æ€§å†³å®šä¸»è½´çš„æ–¹å‘ï¼ˆå³é¡¹ç›®çš„æ’åˆ—æ–¹å‘ï¼‰ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flex-direction: row | row-reverse | column | column-reverse;</span><br></pre></td></tr></table></figure><p>å®ƒå¯èƒ½å–å››ä¸ªå€¼ï¼š</p><ul><li><code>row</code>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šä¸»è½´ä¸ºæ°´å¹³æ–¹å‘ï¼Œèµ·ç‚¹åœ¨å·¦ç«¯ã€‚</li><li><code>row-reverse</code>ï¼šä¸»è½´ä¸ºæ°´å¹³æ–¹å‘ï¼Œèµ·ç‚¹åœ¨å³ç«¯ã€‚</li><li><code>column</code>ï¼šä¸»è½´ä¸ºå‚ç›´æ–¹å‘ï¼Œèµ·ç‚¹åœ¨ä¸Šæ²¿ã€‚</li><li><code>column-reverse</code>ï¼šä¸»è½´ä¸ºå‚ç›´æ–¹å‘ï¼Œèµ·ç‚¹åœ¨ä¸‹æ²¿ã€‚</li></ul><p><img src="flexdirection.png" alt></p><h2 id="flex-wrapå±æ€§"><a href="#flex-wrapå±æ€§" class="headerlink" title="flex-wrapå±æ€§"></a>flex-wrapå±æ€§</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé¡¹ç›®éƒ½æ’åœ¨ä¸€æ¡çº¿ï¼ˆåˆç§°â€è½´çº¿â€ï¼‰ä¸Šã€‚<code>flex-wrap</code>å±æ€§å®šä¹‰ï¼Œå¦‚æœä¸€æ¡è½´çº¿æ’ä¸ä¸‹ï¼Œå¦‚ä½•æ¢è¡Œã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flex-wrap: nowrap | wrap | wrap-reverse;</span><br></pre></td></tr></table></figure><p>å®ƒå¯èƒ½å–ä¸‰ä¸ªå€¼ï¼š</p><ul><li><code>nowrap</code>ï¼ˆé»˜è®¤ï¼‰ï¼šä¸æ¢è¡Œã€‚</li><li><code>wrap</code>ï¼šæ¢è¡Œï¼Œç¬¬ä¸€è¡Œåœ¨ä¸Šæ–¹ã€‚</li><li><code>wrap-reverse</code>ï¼šæ¢è¡Œï¼Œç¬¬ä¸€è¡Œåœ¨ä¸‹æ–¹ã€‚</li></ul><p><img src="flexwrap.png" alt></p><h2 id="flex-flowå±æ€§"><a href="#flex-flowå±æ€§" class="headerlink" title="flex-flowå±æ€§"></a>flex-flowå±æ€§</h2><p><code>flex-flow</code>å±æ€§æ˜¯<code>flex-direction</code>å±æ€§å’Œ<code>flex-wrap</code>å±æ€§çš„ç®€å†™å½¢å¼ï¼Œé»˜è®¤å€¼ä¸º<code>row nowrap</code>ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flex-flow: &lt;flex-direction&gt; || &lt;flex-wrap&gt;;</span><br></pre></td></tr></table></figure><h2 id="justify-contentå±æ€§"><a href="#justify-contentå±æ€§" class="headerlink" title="justify-contentå±æ€§"></a>justify-contentå±æ€§</h2><p><code>justify-content</code>å±æ€§å®šä¹‰äº†é¡¹ç›®åœ¨ä¸»è½´ä¸Šçš„å¯¹é½æ–¹å¼ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">justify-content: flex-start | flex-end | center | space-between | space-around;</span><br></pre></td></tr></table></figure><p>å®ƒå¯èƒ½å–5ä¸ªå€¼ï¼Œå…·ä½“å¯¹é½æ–¹å¼ä¸è½´çš„æ–¹å‘æœ‰å…³ã€‚</p><ul><li><code>flex-start</code>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šä¸»è½´çš„èµ·ç‚¹å¯¹é½</li><li><code>flex-end</code>ï¼šä¸»è½´çš„ç»ˆç‚¹å¯¹é½</li><li><code>center</code>ï¼š ä¸»è½´çš„ä¸­ç‚¹å¯¹é½</li><li><code>space-between</code>ï¼šä¸»è½´ä¸¤ç«¯å¯¹é½ï¼Œé¡¹ç›®ä¹‹é—´çš„é—´éš”éƒ½ç›¸ç­‰ã€‚</li><li><code>space-around</code>ï¼šæ¯ä¸ªé¡¹ç›®ä¸¤ä¾§çš„é—´éš”ç›¸ç­‰ã€‚æ‰€ä»¥ï¼Œé¡¹ç›®ä¹‹é—´çš„é—´éš”æ¯”é¡¹ç›®ä¸è¾¹æ¡†çš„é—´éš”å¤§ä¸€å€ã€‚</li></ul><p><img src="justifycontent.png" alt></p><h2 id="align-itemså±æ€§"><a href="#align-itemså±æ€§" class="headerlink" title="align-itemså±æ€§"></a>align-itemså±æ€§</h2><p><code>align-items</code>å±æ€§å®šä¹‰é¡¹ç›®åœ¨äº¤å‰è½´ä¸Šå¦‚ä½•å¯¹é½ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">align-items: flex-start | flex-end | center | baseline | stretch;</span><br></pre></td></tr></table></figure><p>å®ƒå¯èƒ½å–5ä¸ªå€¼ã€‚å…·ä½“çš„å¯¹é½æ–¹å¼ä¸äº¤å‰è½´çš„æ–¹å‘æœ‰å…³ï¼Œä¸‹é¢å‡è®¾äº¤å‰è½´ä»ä¸Šåˆ°ä¸‹ã€‚</p><ul><li><code>flex-start</code>ï¼šäº¤å‰è½´çš„èµ·ç‚¹å¯¹é½ã€‚</li><li><code>flex-end</code>ï¼šäº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½ã€‚</li><li><code>center</code>ï¼šäº¤å‰è½´çš„ä¸­ç‚¹å¯¹é½ã€‚</li><li><code>baseline</code>: é¡¹ç›®çš„ç¬¬ä¸€è¡Œæ–‡å­—çš„åŸºçº¿å¯¹é½ã€‚</li><li><code>stretch</code>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šå¦‚æœé¡¹ç›®æœªè®¾ç½®é«˜åº¦æˆ–è®¾ä¸ºautoï¼Œå°†å æ»¡æ•´ä¸ªå®¹å™¨çš„é«˜åº¦ã€‚</li></ul><p><img src="alignitems.png" alt></p><h2 id="align-contentå±æ€§"><a href="#align-contentå±æ€§" class="headerlink" title="align-contentå±æ€§"></a>align-contentå±æ€§</h2><p><code>align-content</code>å±æ€§å®šä¹‰äº†å¤šæ ¹è½´çº¿çš„å¯¹é½æ–¹å¼ã€‚å¦‚æœé¡¹ç›®åªæœ‰ä¸€æ ¹è½´çº¿ï¼Œè¯¥å±æ€§ä¸èµ·ä½œç”¨ã€‚</p><p>å³è¯¥å±æ€§å¯¹å•è¡Œå¼¹æ€§ç›’å­æ¨¡å‹æ— æ•ˆã€‚ï¼ˆå³ï¼šå¸¦æœ‰ <code>flex-wrap: nowrap</code>ï¼‰ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">align-content: flex-start | flex-end | center | space-between | space-around | stretch;</span><br></pre></td></tr></table></figure><p>è¯¥å±æ€§å¯èƒ½å–6ä¸ªå€¼ã€‚</p><ul><li><code>flex-start</code>ï¼šä¸äº¤å‰è½´çš„èµ·ç‚¹å¯¹é½ã€‚</li><li><code>flex-end</code>ï¼šä¸äº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½ã€‚</li><li><code>center</code>ï¼šä¸äº¤å‰è½´çš„ä¸­ç‚¹å¯¹é½ã€‚</li><li><code>space-between</code>ï¼šä¸äº¤å‰è½´ä¸¤ç«¯å¯¹é½ï¼Œè½´çº¿ä¹‹é—´çš„é—´éš”å¹³å‡åˆ†å¸ƒã€‚</li><li><code>space-around</code>ï¼šæ¯æ ¹è½´çº¿ä¸¤ä¾§çš„é—´éš”éƒ½ç›¸ç­‰ã€‚æ‰€ä»¥ï¼Œè½´çº¿ä¹‹é—´çš„é—´éš”æ¯”è½´çº¿ä¸è¾¹æ¡†çš„é—´éš”å¤§ä¸€å€ã€‚</li><li><code>stretch</code>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šè½´çº¿å æ»¡æ•´ä¸ªäº¤å‰è½´ã€‚</li></ul><p><img src="aligncontent.png" alt></p><h1 id="é¡¹ç›®çš„å±æ€§"><a href="#é¡¹ç›®çš„å±æ€§" class="headerlink" title="é¡¹ç›®çš„å±æ€§"></a>é¡¹ç›®çš„å±æ€§</h1><p>ä»¥ä¸‹6ä¸ªå±æ€§è®¾ç½®åœ¨é¡¹ç›®ä¸Šã€‚</p><ul><li><code>order</code></li><li><code>flex-grow</code></li><li><code>flex-shrink</code></li><li><code>flex-basis</code></li><li><code>flex</code></li><li><code>align-self</code></li></ul><h2 id="orderå±æ€§"><a href="#orderå±æ€§" class="headerlink" title="orderå±æ€§"></a>orderå±æ€§</h2><p><code>order</code>å±æ€§å®šä¹‰é¡¹ç›®çš„æ’åˆ—é¡ºåºã€‚æ•°å€¼è¶Šå°ï¼Œæ’åˆ—è¶Šé å‰ï¼Œé»˜è®¤ä¸º0ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">order</span>: &lt;<span class="selector-tag">integer</span>&gt;; <span class="comment">/* default 0 */</span></span><br></pre></td></tr></table></figure><p><img src="order.png" alt></p><h2 id="flex-growå±æ€§"><a href="#flex-growå±æ€§" class="headerlink" title="flex-growå±æ€§"></a>flex-growå±æ€§</h2><p><code>flex-grow</code>å±æ€§å®šä¹‰é¡¹ç›®çš„æ”¾å¤§æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º<code>0</code>ï¼Œå³å¦‚æœå­˜åœ¨å‰©ä½™ç©ºé—´ï¼Œä¹Ÿä¸æ”¾å¤§ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">flex-grow</span>: &lt;<span class="selector-tag">number</span>&gt;; <span class="comment">/* default 0 */</span></span><br></pre></td></tr></table></figure><p><img src="flexgrow.png" alt></p><p>å¦‚æœæ‰€æœ‰é¡¹ç›®çš„<code>flex-grow</code>å±æ€§éƒ½ä¸º1ï¼Œåˆ™å®ƒä»¬å°†ç­‰åˆ†å‰©ä½™ç©ºé—´ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚å¦‚æœä¸€ä¸ªé¡¹ç›®çš„<code>flex-grow</code>å±æ€§ä¸º2ï¼Œå…¶ä»–é¡¹ç›®éƒ½ä¸º1ï¼Œåˆ™å‰è€…å æ®çš„å‰©ä½™ç©ºé—´å°†æ¯”å…¶ä»–é¡¹å¤šä¸€å€ã€‚</p><h2 id="flex-shrinkå±æ€§"><a href="#flex-shrinkå±æ€§" class="headerlink" title="flex-shrinkå±æ€§"></a>flex-shrinkå±æ€§</h2><p><code>flex-shrink</code>å±æ€§å®šä¹‰äº†é¡¹ç›®çš„ç¼©å°æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º1ï¼Œå³å¦‚æœç©ºé—´ä¸è¶³ï¼Œè¯¥é¡¹ç›®å°†ç¼©å°ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">flex-shrink</span>: &lt;<span class="selector-tag">number</span>&gt;; <span class="comment">/* default 1 */</span></span><br></pre></td></tr></table></figure><p><img src="flexshrink.png" alt></p><p>å¦‚æœæ‰€æœ‰é¡¹ç›®çš„<code>flex-shrink</code>å±æ€§éƒ½ä¸º1ï¼Œå½“ç©ºé—´ä¸è¶³æ—¶ï¼Œéƒ½å°†ç­‰æ¯”ä¾‹ç¼©å°ã€‚å¦‚æœä¸€ä¸ªé¡¹ç›®çš„<code>flex-shrink</code>å±æ€§ä¸º0ï¼Œå…¶ä»–é¡¹ç›®éƒ½ä¸º1ï¼Œåˆ™ç©ºé—´ä¸è¶³æ—¶ï¼Œå‰è€…ä¸ç¼©å°ã€‚</p><p>è´Ÿå€¼å¯¹è¯¥å±æ€§æ— æ•ˆã€‚</p><h2 id="flex-basiså±æ€§"><a href="#flex-basiså±æ€§" class="headerlink" title="flex-basiså±æ€§"></a>flex-basiså±æ€§</h2><p><code>flex-basis</code>å±æ€§å®šä¹‰äº†åœ¨åˆ†é…å¤šä½™ç©ºé—´ä¹‹å‰ï¼Œé¡¹ç›®å æ®çš„ä¸»è½´ç©ºé—´ï¼ˆmain sizeï¼‰ã€‚æµè§ˆå™¨æ ¹æ®è¿™ä¸ªå±æ€§ï¼Œè®¡ç®—ä¸»è½´æ˜¯å¦æœ‰å¤šä½™ç©ºé—´ã€‚å®ƒçš„é»˜è®¤å€¼æ˜¯<code>auto</code>ï¼Œå³é¡¹ç›®çš„æœ¬æ¥å¤§å°ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flex-basis: &lt;length&gt; | auto; /* default auto */</span><br></pre></td></tr></table></figure><p>å®ƒå¯ä»¥è®¾ä¸ºè·Ÿ<code>width</code>æˆ–<code>height</code>å±æ€§ä¸€æ ·çš„å€¼ï¼ˆæ¯”å¦‚350pxï¼‰ï¼Œåˆ™é¡¹ç›®å°†å æ®å›ºå®šç©ºé—´ã€‚</p><h2 id="flexå±æ€§"><a href="#flexå±æ€§" class="headerlink" title="flexå±æ€§"></a>flexå±æ€§</h2><p><code>flex</code>å±æ€§æ˜¯<code>flex-grow</code>, <code>flex-shrink</code> å’Œ <code>flex-basis</code>çš„ç®€å†™ï¼Œé»˜è®¤å€¼ä¸º<code>0 1 auto</code>ã€‚åä¸¤ä¸ªå±æ€§å¯é€‰ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flex: none | [ &lt;'flex-grow'&gt; &lt;'flex-shrink'&gt;? || &lt;'flex-basis'&gt; ]</span><br></pre></td></tr></table></figure><p>è¯¥å±æ€§æœ‰ä¸¤ä¸ªå¿«æ·å€¼ï¼š<code>auto</code> (<code>1 1 auto</code>) å’Œ none (<code>0 0 auto</code>)ã€‚</p><p>å»ºè®®ä¼˜å…ˆä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œè€Œä¸æ˜¯å•ç‹¬å†™ä¸‰ä¸ªåˆ†ç¦»çš„å±æ€§ï¼Œå› ä¸ºæµè§ˆå™¨ä¼šæ¨ç®—ç›¸å…³å€¼ã€‚</p><h2 id="align-selfå±æ€§"><a href="#align-selfå±æ€§" class="headerlink" title="align-selfå±æ€§"></a>align-selfå±æ€§</h2><p><code>align-self</code>å±æ€§å…è®¸å•ä¸ªé¡¹ç›®æœ‰ä¸å…¶ä»–é¡¹ç›®ä¸ä¸€æ ·çš„å¯¹é½æ–¹å¼ï¼Œå¯è¦†ç›–<code>align-items</code>å±æ€§ã€‚é»˜è®¤å€¼ä¸º<code>auto</code>ï¼Œè¡¨ç¤ºç»§æ‰¿çˆ¶å…ƒç´ çš„<code>align-items</code>å±æ€§ï¼Œå¦‚æœæ²¡æœ‰çˆ¶å…ƒç´ ï¼Œåˆ™ç­‰åŒäº<code>stretch</code>ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">align-self: auto | flex-start | flex-end | center | baseline | stretch;</span><br></pre></td></tr></table></figure><p>è¯¥å±æ€§å¯èƒ½å–6ä¸ªå€¼ï¼Œé™¤äº†autoï¼Œå…¶ä»–éƒ½ä¸align-itemså±æ€§å®Œå…¨ä¸€è‡´ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Flexible_Box_Layout/Basic_Concepts_of_Flexbox" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Flexible_Box_Layout/Basic_Concepts_of_Flexbox</a></p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Box_Alignment/Box_Alignment_in_Flexbox" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Box_Alignment/Box_Alignment_in_Flexbox</a></p><p><a href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç½‘é¡µå¸ƒå±€ï¼ˆlayoutï¼‰æ˜¯ CSS çš„ä¸€ä¸ªé‡ç‚¹åº”ç”¨ã€‚å¸ƒå±€çš„ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆï¼ŒåŸºäº&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/CSS/box_model&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ç›’çŠ¶æ¨¡å‹&lt;/a&gt;ï¼Œä¾èµ– &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/CSS/display&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;code&gt;display&lt;/code&gt;&lt;/a&gt; å±æ€§ + &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/CSS/position&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;code&gt;position&lt;/code&gt;&lt;/a&gt;å±æ€§ + &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/CSS/float&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;code&gt;float&lt;/code&gt;&lt;/a&gt;å±æ€§ã€‚å®ƒå¯¹äºé‚£äº›ç‰¹æ®Šå¸ƒå±€éå¸¸ä¸æ–¹ä¾¿ï¼Œæ¯”å¦‚ï¼Œ&lt;a href=&quot;https://css-tricks.com/centering-css-complete-guide/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å‚ç›´å±…ä¸­&lt;/a&gt;å°±ä¸å®¹æ˜“å®ç°ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="CSS" scheme="http://hackycy.github.io/categories/CSS/"/>
    
    
      <category term="CSS" scheme="http://hackycy.github.io/tags/CSS/"/>
    
      <category term="Flexå¸ƒå±€" scheme="http://hackycy.github.io/tags/Flex%E5%B8%83%E5%B1%80/"/>
    
  </entry>
  
</feed>
